<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Trace_ppx (elpi.Trace_ppx)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">elpi</a> &#x00BB; Trace_ppx</nav><h1>Module <code>Trace_ppx</code></h1><p>elpi.trace.ppx provides the following syntax extensions:</p><p>type t = <code> a : T; b : S [@trace] </code></p><p>let rec f x (w<code>@trace</code>) = <code>%trace &quot;f&quot; (fun fmt -&gt; .. x ..) begin
         match x with
         | K1 -&gt; ...
         | K2 x -&gt; [%tcall f x]
         | K2(x,y) -&gt;
            let z = f x in
            [%spy &quot;z&quot; ~rid ~gid ~cond (fun fmt z -&gt; .. z ..) z];
            [%spyl &quot;z&quot; ~rid ~gid ~cond (fun fmt z -&gt; .. z ..) zs];
            [%log &quot;K2&quot; &quot;whatever&quot; 37];
            let x[@trace] = ... in e
            let w = { a; b = b[@trace ] } in
            match w with
            | { a; b = b [@trace] } -&gt;
               z + f y (b[@trace])
     end</code></p><p>If --cookie &quot;elpi_trace=\&quot;true\&quot;&quot; is not passed to the ppx rewriter:</p><ul><li><code>%trace &quot;foo&quot; pp code</code> ---&gt; code</li><li><code>%tcall f x</code> ---&gt; f x</li><li><code>%spy ...</code> <code>%spyl ...</code> and <code>%log ...</code> ---&gt; ()</li><li>f x (y<code>@trace</code>) z ---&gt; f x z</li><li>let x<code>@trace</code> = .. in e ---&gt; e</li><li>type x = <code> a : T; b : T [@trace] </code> ---&gt; type x = <code> a : T </code></li><li><code> a; b = b [@trace] </code> ---&gt; <code> a </code> (in both patterns and expressions)</li><li>T -&gt; (S<code>@trace</code>) -&gt; U ---&gt; T -&gt; U</li></ul><p>In records, the shorcut &quot;x&quot; to mean &quot;x = x&quot; does not work, you have to use the longer form.</p></header><dl><dt class="spec value" id="val-err"><a href="#val-err" class="anchor"></a><code><span class="keyword">val</span> err : <span>loc:Ppxlib.Location.t</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-trace"><a href="#val-trace" class="anchor"></a><code><span class="keyword">val</span> trace : <span>rid:Ppxlib.expression</span> <span>&#45;&gt;</span> <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-spy"><a href="#val-spy" class="anchor"></a><code><span class="keyword">val</span> spy : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>(<span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> Ppxlib.expression)</span> <span>&#45;&gt;</span> <span>?&#8288;cond:Ppxlib.expression</span> <span>&#45;&gt;</span> <span>rid:Ppxlib.expression</span> <span>&#45;&gt;</span> <span>?&#8288;gid:Ppxlib.expression</span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> <span>Ppxlib.expression list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-spyl"><a href="#val-spyl" class="anchor"></a><code><span class="keyword">val</span> spyl : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>(<span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> Ppxlib.expression)</span> <span>&#45;&gt;</span> <span>?&#8288;cond:Ppxlib.expression</span> <span>&#45;&gt;</span> <span>rid:Ppxlib.expression</span> <span>&#45;&gt;</span> <span>?&#8288;gid:Ppxlib.expression</span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> <span>Ppxlib.expression list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-log"><a href="#val-log" class="anchor"></a><code><span class="keyword">val</span> log : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-cur_pred"><a href="#val-cur_pred" class="anchor"></a><code><span class="keyword">val</span> cur_pred : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-tcall"><a href="#val-tcall" class="anchor"></a><code><span class="keyword">val</span> tcall : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> Ppxlib__.Import.expression <span>&#45;&gt;</span> <span>Ppxlib__.Import.expression list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-enabled"><a href="#val-enabled" class="anchor"></a><code><span class="keyword">val</span> enabled : <span>bool Stdlib.ref</span></code></dt><dt class="spec value" id="val-has_iftrace_attribute"><a href="#val-has_iftrace_attribute" class="anchor"></a><code><span class="keyword">val</span> has_iftrace_attribute : Ppxlib.attributes <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-has_iftrace"><a href="#val-has_iftrace" class="anchor"></a><code><span class="keyword">val</span> has_iftrace : Ppxlib.core_type <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-map_trace"><a href="#val-map_trace" class="anchor"></a><code><span class="keyword">val</span> map_trace : Ppxlib.Ast_traverse.map</code></dt><dt class="spec value" id="val-is_string_literal"><a href="#val-is_string_literal" class="anchor"></a><code><span class="keyword">val</span> is_string_literal : Ppxlib.expression <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-is_gid"><a href="#val-is_gid" class="anchor"></a><code><span class="keyword">val</span> is_gid : Ppxlib.arg_label <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-is_rid"><a href="#val-is_rid" class="anchor"></a><code><span class="keyword">val</span> is_rid : Ppxlib.arg_label <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-is_cond"><a href="#val-is_cond" class="anchor"></a><code><span class="keyword">val</span> is_cond : Ppxlib.arg_label <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-pull"><a href="#val-pull" class="anchor"></a><code><span class="keyword">val</span> pull : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> option</span> * <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> list</span></code></dt><dt class="spec value" id="val-err_spy"><a href="#val-err_spy" class="anchor"></a><code><span class="keyword">val</span> err_spy : <span>loc:Ppxlib.Location.t</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-spyl_expand_function"><a href="#val-spyl_expand_function" class="anchor"></a><code><span class="keyword">val</span> spyl_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-spyl_extension"><a href="#val-spyl_extension" class="anchor"></a><code><span class="keyword">val</span> spyl_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-spyl_rule"><a href="#val-spyl_rule" class="anchor"></a><code><span class="keyword">val</span> spyl_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-spy_expand_function"><a href="#val-spy_expand_function" class="anchor"></a><code><span class="keyword">val</span> spy_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-spy_extension"><a href="#val-spy_extension" class="anchor"></a><code><span class="keyword">val</span> spy_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-spy_rule"><a href="#val-spy_rule" class="anchor"></a><code><span class="keyword">val</span> spy_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-tcall_expand_function"><a href="#val-tcall_expand_function" class="anchor"></a><code><span class="keyword">val</span> tcall_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-tcall_extension"><a href="#val-tcall_extension" class="anchor"></a><code><span class="keyword">val</span> tcall_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-tcall_rule"><a href="#val-tcall_rule" class="anchor"></a><code><span class="keyword">val</span> tcall_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-trace_expand_function"><a href="#val-trace_expand_function" class="anchor"></a><code><span class="keyword">val</span> trace_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-trace_extension"><a href="#val-trace_extension" class="anchor"></a><code><span class="keyword">val</span> trace_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-trace_rule"><a href="#val-trace_rule" class="anchor"></a><code><span class="keyword">val</span> trace_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-cur_pred_expand_function"><a href="#val-cur_pred_expand_function" class="anchor"></a><code><span class="keyword">val</span> cur_pred_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-cur_pred_extension"><a href="#val-cur_pred_extension" class="anchor"></a><code><span class="keyword">val</span> cur_pred_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-cur_pred_rule"><a href="#val-cur_pred_rule" class="anchor"></a><code><span class="keyword">val</span> cur_pred_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-log_expand_function"><a href="#val-log_expand_function" class="anchor"></a><code><span class="keyword">val</span> log_expand_function : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>path:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> Ppxlib.expression <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dt class="spec value" id="val-log_extension"><a href="#val-log_extension" class="anchor"></a><code><span class="keyword">val</span> log_extension : Ppxlib.Extension.t</code></dt><dt class="spec value" id="val-log_rule"><a href="#val-log_rule" class="anchor"></a><code><span class="keyword">val</span> log_rule : Ppxlib.Context_free.Rule.t</code></dt><dt class="spec value" id="val-arg_trace"><a href="#val-arg_trace" class="anchor"></a><code><span class="keyword">val</span> arg_trace : Ppxlib.Driver.Cookies.t <span>&#45;&gt;</span> unit</code></dt></dl></div></body></html>
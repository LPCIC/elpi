<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Trace_ppx (elpi.Trace_ppx)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">elpi</a> &#x00BB; Trace_ppx</nav><header class="odoc-preamble"><h1>Module <code><span>Trace_ppx</span></code></h1><p>elpi.trace.ppx provides the following syntax extensions:</p><pre><code>type t = { a : T; b : S [@trace] }

let rec f x (w[@trace]) =
 [%trace &quot;f&quot; (fun fmt -&gt; .. x ..) begin
     match x with
     | K1 -&gt; ...
     | K2 x -&gt; [%tcall f x]
     | K2(x,y) -&gt;
        let z = f x in
        [%spy &quot;z&quot; ~rid ~gid ~cond (fun fmt z -&gt; .. z ..) z];
        [%spyl &quot;z&quot; ~rid ~gid ~cond (fun fmt z -&gt; .. z ..) zs];
        [%log &quot;K2&quot; ~rid &quot;whatever&quot; 37];
        let x[@trace] = ... in e
        let w = { a; b = b[@trace ] } in
        match w with
        | { a; b = b [@trace] } -&gt;
           z + f y (b[@trace])
 end]

[%end_trace &quot;stop&quot; ~rid]</code></pre><p>If --cookie &quot;elpi_trace=\&quot;true\&quot;&quot; is not passed to the ppx rewriter:</p><ul><li><code>[%end_trace &quot;stop&quot; ~rid]</code> ---&gt; <code>()</code></li><li><code>[%trace &quot;foo&quot; pp code]</code> ---&gt; <code>code</code></li><li><code>[%tcall f x]</code> ---&gt; <code>f x</code></li><li><code>[%spy ...]</code> <code>[%spyl ...]</code> and <code>[%log ...]</code> ---&gt; <code>()</code></li><li><code>f x (y[@trace]) z</code> ---&gt; <code>f x z</code></li><li><code>let x[@trace] = .. in e</code> ---&gt; <code>e</code></li><li><code>type x = { a : T; b : T [@trace] }</code> ---&gt; <code>type x = { a : T }</code></li><li><code>{ a; b = b [@trace] }</code> ---&gt; <code>{ a }</code> (in both patterns and expressions)</li><li><code>T -&gt; (S[@trace]) -&gt; U</code> ---&gt; <code>T -&gt; U</code></li></ul><p>In records, the shorcut &quot;x&quot; to mean &quot;x = x&quot; does not work, you have to use the longer form.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-err" class="anchored"><a href="#val-err" class="anchor"></a><code><span><span class="keyword">val</span> err : <span>loc:<span class="xref-unresolved">Ppxlib</span>.Location.t <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-trace" class="anchored"><a href="#val-trace" class="anchor"></a><code><span><span class="keyword">val</span> trace : 
  <span>rid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spy" class="anchored"><a href="#val-spy" class="anchor"></a><code><span><span class="keyword">val</span> spy : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?cond:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>rid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>?gid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spyl" class="anchored"><a href="#val-spyl" class="anchor"></a><code><span><span class="keyword">val</span> spyl : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?cond:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>rid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>?gid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-log" class="anchored"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span>rid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cur_pred" class="anchored"><a href="#val-cur_pred" class="anchor"></a><code><span><span class="keyword">val</span> cur_pred : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-end_trace" class="anchored"><a href="#val-end_trace" class="anchor"></a><code><span><span class="keyword">val</span> end_trace : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>rid:<span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcall" class="anchored"><a href="#val-tcall" class="anchor"></a><code><span><span class="keyword">val</span> tcall : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib__</span>.Import.expression <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ppxlib__</span>.Import.expression list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-enabled" class="anchored"><a href="#val-enabled" class="anchor"></a><code><span><span class="keyword">val</span> enabled : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-has_iftrace_attribute" class="anchored"><a href="#val-has_iftrace_attribute" class="anchor"></a><code><span><span class="keyword">val</span> has_iftrace_attribute : <span><span class="xref-unresolved">Ppxlib</span>.attributes <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-has_iftrace" class="anchored"><a href="#val-has_iftrace" class="anchor"></a><code><span><span class="keyword">val</span> has_iftrace : <span><span class="xref-unresolved">Ppxlib</span>.core_type <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-map_trace" class="anchored"><a href="#val-map_trace" class="anchor"></a><code><span><span class="keyword">val</span> map_trace : <span class="xref-unresolved">Ppxlib</span>.Ast_traverse.map</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_string_literal" class="anchored"><a href="#val-is_string_literal" class="anchor"></a><code><span><span class="keyword">val</span> is_string_literal : <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_gid" class="anchored"><a href="#val-is_gid" class="anchor"></a><code><span><span class="keyword">val</span> is_gid : <span><span class="xref-unresolved">Ppxlib</span>.arg_label <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_rid" class="anchored"><a href="#val-is_rid" class="anchor"></a><code><span><span class="keyword">val</span> is_rid : <span><span class="xref-unresolved">Ppxlib</span>.arg_label <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_cond" class="anchored"><a href="#val-is_cond" class="anchor"></a><code><span><span class="keyword">val</span> is_cond : <span><span class="xref-unresolved">Ppxlib</span>.arg_label <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pull" class="anchored"><a href="#val-pull" class="anchor"></a><code><span><span class="keyword">val</span> pull : <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'d</span> option</span> * <span><span>(<span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-err_spy" class="anchored"><a href="#val-err_spy" class="anchor"></a><code><span><span class="keyword">val</span> err_spy : <span>loc:<span class="xref-unresolved">Ppxlib</span>.Location.t <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spyl_expand_function" class="anchored"><a href="#val-spyl_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> spyl_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spyl_extension" class="anchored"><a href="#val-spyl_extension" class="anchor"></a><code><span><span class="keyword">val</span> spyl_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spyl_rule" class="anchored"><a href="#val-spyl_rule" class="anchor"></a><code><span><span class="keyword">val</span> spyl_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spy_expand_function" class="anchored"><a href="#val-spy_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> spy_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spy_extension" class="anchored"><a href="#val-spy_extension" class="anchor"></a><code><span><span class="keyword">val</span> spy_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-spy_rule" class="anchored"><a href="#val-spy_rule" class="anchor"></a><code><span><span class="keyword">val</span> spy_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcall_expand_function" class="anchored"><a href="#val-tcall_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> tcall_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcall_extension" class="anchored"><a href="#val-tcall_extension" class="anchor"></a><code><span><span class="keyword">val</span> tcall_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcall_rule" class="anchored"><a href="#val-tcall_rule" class="anchor"></a><code><span><span class="keyword">val</span> tcall_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-trace_expand_function" class="anchored"><a href="#val-trace_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> trace_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-trace_extension" class="anchored"><a href="#val-trace_extension" class="anchor"></a><code><span><span class="keyword">val</span> trace_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-trace_rule" class="anchored"><a href="#val-trace_rule" class="anchor"></a><code><span><span class="keyword">val</span> trace_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cur_pred_expand_function" class="anchored"><a href="#val-cur_pred_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> cur_pred_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cur_pred_extension" class="anchored"><a href="#val-cur_pred_extension" class="anchor"></a><code><span><span class="keyword">val</span> cur_pred_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cur_pred_rule" class="anchored"><a href="#val-cur_pred_rule" class="anchor"></a><code><span><span class="keyword">val</span> cur_pred_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-log_expand_function" class="anchored"><a href="#val-log_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> log_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-log_extension" class="anchored"><a href="#val-log_extension" class="anchor"></a><code><span><span class="keyword">val</span> log_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-log_rule" class="anchored"><a href="#val-log_rule" class="anchor"></a><code><span><span class="keyword">val</span> log_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-end_trace_expand_function" class="anchored"><a href="#val-end_trace_expand_function" class="anchor"></a><code><span><span class="keyword">val</span> end_trace_expand_function : 
  <span>loc:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>path:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.expression <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.expression</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-end_trace_extension" class="anchored"><a href="#val-end_trace_extension" class="anchor"></a><code><span><span class="keyword">val</span> end_trace_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-end_trace_rule" class="anchored"><a href="#val-end_trace_rule" class="anchor"></a><code><span><span class="keyword">val</span> end_trace_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-arg_trace" class="anchored"><a href="#val-arg_trace" class="anchor"></a><code><span><span class="keyword">val</span> arg_trace : <span><span class="xref-unresolved">Ppxlib</span>.Driver.Cookies.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>
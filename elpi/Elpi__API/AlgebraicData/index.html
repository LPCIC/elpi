<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>AlgebraicData (elpi.Elpi__API.AlgebraicData)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">elpi</a> &#x00BB; <a href="../index.html">Elpi__API</a> &#x00BB; AlgebraicData</nav><h1>Module <code>Elpi__API.AlgebraicData</code></h1><p>Declare data from the host application that has syntax, like list or pair but not like int. So far there is no support for data with binder using this API. The type of each constructor is described using a GADT so that the code to build or match the data can be given the right type. Example: define the ADT for &quot;option a&quot;</p><pre><code class="ml">let option_declaration a = {
  ty = TyApp(&quot;option&quot;,a.ty,[]);
  doc = &quot;The option type (aka Maybe)&quot;;
  pp = (fun fmt -&gt; function
          | None -&gt; Format.fprintf fmt &quot;None&quot;
          | Some x -&gt; Format.fprintf fmt &quot;Some %a&quot; a.pp x);
  constructors = [
   K(&quot;none&quot;,&quot;nothing in this case&quot;,
     N,                                                   (* no arguments *)
     B None,                                                   (* builder *)
     M (fun ~ok ~ko -&gt; function None -&gt; ok | _ -&gt; ko ()));     (* matcher *)
   K(&quot;some&quot;,&quot;something in this case&quot;,
     A (a,N),                                   (* one argument of type a *)
     B (fun x -&gt; Some x),                                      (* builder *)
     M (fun ~ok ~ko -&gt; function Some x -&gt; ok x | _ -&gt; ko ())); (* matcher *)
  ]
}</code></pre><p><code>K</code> stands for &quot;constructor&quot;, <code>B</code> for &quot;build&quot;, <code>M</code> for &quot;match&quot;. Variants <code>BS</code> and <code>MS</code> give read/write access to the state.</p></header><dl><dt class="spec type" id="type-name"><a href="#type-name" class="anchor"></a><code><span class="keyword">type</span> name</code><code> = string</code></dt><dt class="spec type" id="type-doc"><a href="#type-doc" class="anchor"></a><code><span class="keyword">type</span> doc</code><code> = string</code></dt><dt class="spec type" id="type-match_t"><a href="#type-match_t" class="anchor"></a><code><span class="keyword">type</span> <span>('match_stateful_t, 'match_t, 't) match_t</span></code><code> = </code><table class="variant"><tr id="type-match_t.M" class="anchored"><td class="def constructor"><a href="#type-match_t.M" class="anchor"></a><code>| </code><code><span class="constructor">M</span> <span class="keyword">of</span> <span>ok:<span class="type-var">'match_t</span></span> <span>&#45;&gt;</span> <span>ko:<span>(unit <span>&#45;&gt;</span> <a href="../Data/index.html#type-term">Data.term</a>)</span></span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <a href="../Data/index.html#type-term">Data.term</a></code></td></tr><tr id="type-match_t.MS" class="anchored"><td class="def constructor"><a href="#type-match_t.MS" class="anchor"></a><code>| </code><code><span class="constructor">MS</span> <span class="keyword">of</span> <span>ok:<span class="type-var">'match_stateful_t</span></span> <span>&#45;&gt;</span> <span>ko:<span>(<a href="../Data/index.html#type-state">Data.state</a> <span>&#45;&gt;</span> <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a>)</span></span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <a href="../Data/index.html#type-state">Data.state</a> <span>&#45;&gt;</span> <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a></code></td></tr></table></dt><dt class="spec type" id="type-build_t"><a href="#type-build_t" class="anchor"></a><code><span class="keyword">type</span> <span>('build_stateful_t, 'build_t) build_t</span></code><code> = </code><table class="variant"><tr id="type-build_t.B" class="anchored"><td class="def constructor"><a href="#type-build_t.B" class="anchor"></a><code>| </code><code><span class="constructor">B</span> <span class="keyword">of</span> <span class="type-var">'build_t</span></code></td></tr><tr id="type-build_t.BS" class="anchored"><td class="def constructor"><a href="#type-build_t.BS" class="anchor"></a><code>| </code><code><span class="constructor">BS</span> <span class="keyword">of</span> <span class="type-var">'build_stateful_t</span></code></td></tr></table></dt><dt class="spec type" id="type-constructor_arguments"><a href="#type-constructor_arguments" class="anchor"></a><code><span class="keyword">type</span> <span>('stateful_builder, 'builder, 'stateful_matcher, 'matcher, 'self, 'hyps, 'constraints) constructor_arguments</span></code><code> = </code><table class="variant"><tr id="type-constructor_arguments.N" class="anchored"><td class="def constructor"><a href="#type-constructor_arguments.N" class="anchor"></a><code>| </code><code><span class="constructor">N</span> : <span><span>(<a href="../Data/index.html#type-state">Data.state</a> <span>&#45;&gt;</span> <a href="../Data/index.html#type-state">Data.state</a> * <span class="type-var">'self</span>, <span class="type-var">'self</span>, <a href="../Data/index.html#type-state">Data.state</a> <span>&#45;&gt;</span> <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a>, <a href="../Data/index.html#type-term">Data.term</a>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span></code></td></tr><tr id="type-constructor_arguments.A" class="anchored"><td class="def constructor"><a href="#type-constructor_arguments.A" class="anchor"></a><code>| </code><code><span class="constructor">A</span> : <span><span class="type-var">'a</span> <a href="../Conversion/index.html#type-t">Conversion.t</a></span> * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'bs</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'ms</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span></code></td></tr><tr id="type-constructor_arguments.CA" class="anchored"><td class="def constructor"><a href="#type-constructor_arguments.CA" class="anchor"></a><code>| </code><code><span class="constructor">CA</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span> * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'bs</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'ms</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span></code></td></tr><tr id="type-constructor_arguments.S" class="anchored"><td class="def constructor"><a href="#type-constructor_arguments.S" class="anchor"></a><code>| </code><code><span class="constructor">S</span> : <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'self</span> <span>&#45;&gt;</span> <span class="type-var">'bs</span>, <span class="type-var">'self</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>, <span class="type-var">'self</span> <span>&#45;&gt;</span> <span class="type-var">'ms</span>, <span class="type-var">'self</span> <span>&#45;&gt;</span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span></code></td></tr><tr id="type-constructor_arguments.C" class="anchored"><td class="def constructor"><a href="#type-constructor_arguments.C" class="anchor"></a><code>| </code><code><span class="constructor">C</span> : <span>(<span><span>(<span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span>)</span> * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'bs</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'ms</span>, <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span></code></td></tr></table></dt><dd><p>GADT for describing the type of the constructor:</p><ul><li>N is the terminator</li><li>A(a,...) is an argument of type a (a is a Conversion.t)</li><li>S stands for self</li><li>C stands for container</li></ul></dd></dl><dl><dt class="spec type" id="type-constructor"><a href="#type-constructor" class="anchor"></a><code><span class="keyword">type</span> <span>('t, 'h, 'c) constructor</span></code><code> = </code><table class="variant"><tr id="type-constructor.K" class="anchored"><td class="def constructor"><a href="#type-constructor.K" class="anchor"></a><code>| </code><code><span class="constructor">K</span> : <a href="index.html#type-name">name</a> * <a href="index.html#type-doc">doc</a> * <span><span>(<span class="type-var">'build_stateful_t</span>, <span class="type-var">'build_t</span>, <span class="type-var">'match_stateful_t</span>, <span class="type-var">'match_t</span>, <span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="index.html#type-constructor_arguments">constructor_arguments</a></span> * <span><span>(<span class="type-var">'build_stateful_t</span>, <span class="type-var">'build_t</span>)</span> <a href="index.html#type-build_t">build_t</a></span> * <span><span>(<span class="type-var">'match_stateful_t</span>, <span class="type-var">'match_t</span>, <span class="type-var">'t</span>)</span> <a href="index.html#type-match_t">match_t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="index.html#type-constructor">constructor</a></span></code></td></tr></table></dt><dt class="spec type" id="type-declaration"><a href="#type-declaration" class="anchor"></a><code><span class="keyword">type</span> <span>('t, 'h, 'c) declaration</span></code><code> = </code><code>{</code><table class="record"><tr id="type-declaration.ty" class="anchored"><td class="def field"><a href="#type-declaration.ty" class="anchor"></a><code>ty : <a href="../Conversion/index.html#type-ty_ast">Conversion.ty_ast</a>;</code></td></tr><tr id="type-declaration.doc" class="anchored"><td class="def field"><a href="#type-declaration.doc" class="anchor"></a><code>doc : <a href="index.html#type-doc">doc</a>;</code></td></tr><tr id="type-declaration.pp" class="anchored"><td class="def field"><a href="#type-declaration.pp" class="anchor"></a><code>pp : Stdlib.Format.formatter <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> unit;</code></td></tr><tr id="type-declaration.constructors" class="anchored"><td class="def field"><a href="#type-declaration.constructors" class="anchor"></a><code>constructors : <span><span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="index.html#type-constructor">constructor</a></span> list</span>;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-declare"><a href="#val-declare" class="anchor"></a><code><span class="keyword">val</span> declare : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="index.html#type-declaration">declaration</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span></code></dt></dl></div></body></html>
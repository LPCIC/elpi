<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>AlgebraicData (elpi.Elpi.API.AlgebraicData)</title><link rel="stylesheet" href="../../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">elpi</a> &#x00BB; <a href="../../index.html">Elpi</a> &#x00BB; <a href="../index.html">API</a> &#x00BB; AlgebraicData</nav><header class="odoc-preamble"><h1>Module <code><span>API.AlgebraicData</span></code></h1><p>Declare data from the host application that has syntax, like list or pair but not like int. So far there is no support for data with binder using this API. The type of each constructor is described using a GADT so that the code to build or match the data can be given the right type. Example: define the ADT for &quot;option a&quot;</p><pre class="language-ocaml"><code>let option_declaration a = {
  ty = TyApp(&quot;option&quot;,a.ty,[]);
  doc = &quot;The option type (aka Maybe)&quot;;
  pp = (fun fmt -&gt; function
          | None -&gt; Format.fprintf fmt &quot;None&quot;
          | Some x -&gt; Format.fprintf fmt &quot;Some %a&quot; a.pp x);
  constructors = [
   K(&quot;none&quot;,&quot;nothing in this case&quot;,
     N,                                                   (* no arguments *)
     B None,                                                   (* builder *)
     M (fun ~ok ~ko -&gt; function None -&gt; ok | _ -&gt; ko ()));     (* matcher *)
   K(&quot;some&quot;,&quot;something in this case&quot;,
     A (a,N),                                   (* one argument of type a *)
     B (fun x -&gt; Some x),                                      (* builder *)
     M (fun ~ok ~ko -&gt; function Some x -&gt; ok x | _ -&gt; ko ())); (* matcher *)
  ]
}</code></pre><p><code>K</code> stands for &quot;constructor&quot;, <code>B</code> for &quot;build&quot;, <code>M</code> for &quot;match&quot;. Variants <code>BS</code> and <code>MS</code> give read/write access to the state.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-name"><a href="#type-name" class="anchor"></a><code><span><span class="keyword">type</span> name</span><span> = string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-doc"><a href="#type-doc" class="anchor"></a><code><span><span class="keyword">type</span> doc</span><span> = string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-match_t"><a href="#type-match_t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('match_stateful_t, 'match_t, 't) match_t</span></span><span> = </span></code><ol><li id="type-match_t.M" class="def variant constructor anchored"><a href="#type-match_t.M" class="anchor"></a><code><span>| </span><span><span class="constructor">M</span> <span class="keyword">of</span> <span>ok:<span class="type-var">'match_t</span> <span class="arrow">&#45;&gt;</span></span> <span>ko:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Data/index.html#type-term">Data.term</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span> <a href="../Data/index.html#type-term">Data.term</a></span></code></li><li id="type-match_t.MS" class="def variant constructor anchored"><a href="#type-match_t.MS" class="anchor"></a><code><span>| </span><span><span class="constructor">MS</span> <span class="keyword">of</span> <span>ok:<span class="type-var">'match_stateful_t</span> <span class="arrow">&#45;&gt;</span></span>
  <span>ko:<span>(<span><a href="../Data/index.html#type-state">Data.state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Data/index.html#type-state">Data.state</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-build_t"><a href="#type-build_t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('build_stateful_t, 'build_t) build_t</span></span><span> = </span></code><ol><li id="type-build_t.B" class="def variant constructor anchored"><a href="#type-build_t.B" class="anchor"></a><code><span>| </span><span><span class="constructor">B</span> <span class="keyword">of</span> <span class="type-var">'build_t</span></span></code></li><li id="type-build_t.BS" class="def variant constructor anchored"><a href="#type-build_t.BS" class="anchor"></a><code><span>| </span><span><span class="constructor">BS</span> <span class="keyword">of</span> <span class="type-var">'build_stateful_t</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-constructor_arguments"><a href="#type-constructor_arguments" class="anchor"></a><code><span><span class="keyword">type</span> <span>('stateful_builder, 'builder, 'stateful_matcher, 'matcher, 'self, 'hyps, 'constraints)
  constructor_arguments</span></span><span> =
  </span></code><ol><li id="type-constructor_arguments.N" class="def variant constructor anchored"><a href="#type-constructor_arguments.N" class="anchor"></a><code><span>| </span><span><span class="constructor">N</span> : <span><span>(<span><a href="../Data/index.html#type-state">Data.state</a> <span class="arrow">&#45;&gt;</span></span>
      <a href="../Data/index.html#type-state">Data.state</a> * <span class="type-var">'self</span>,
      <span class="type-var">'self</span>,
      <span><a href="../Data/index.html#type-state">Data.state</a> <span class="arrow">&#45;&gt;</span></span>
      <a href="../Data/index.html#type-state">Data.state</a> * <a href="../Data/index.html#type-term">Data.term</a> * <a href="../Conversion/index.html#type-extra_goals">Conversion.extra_goals</a>,
      <a href="../Data/index.html#type-term">Data.term</a>,
      <span class="type-var">'self</span>,
      <span class="type-var">'hyps</span>,
      <span class="type-var">'constraints</span>)</span>
      <a href="#type-constructor_arguments">constructor_arguments</a></span></span></code></li><li id="type-constructor_arguments.A" class="def variant constructor anchored"><a href="#type-constructor_arguments.A" class="anchor"></a><code><span>| </span><span><span class="constructor">A</span> : <span><span class="type-var">'a</span> <a href="../Conversion/index.html#type-t">Conversion.t</a></span>
  * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="#type-constructor_arguments">constructor_arguments</a></span> <span class="arrow">&#45;&gt;</span> 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'bs</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'ms</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span>
    <a href="#type-constructor_arguments">constructor_arguments</a></span></span></code></li><li id="type-constructor_arguments.CA" class="def variant constructor anchored"><a href="#type-constructor_arguments.CA" class="anchor"></a><code><span>| </span><span><span class="constructor">CA</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span>
  * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="#type-constructor_arguments">constructor_arguments</a></span> <span class="arrow">&#45;&gt;</span> 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'bs</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'ms</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span>
    <a href="#type-constructor_arguments">constructor_arguments</a></span></span></code></li><li id="type-constructor_arguments.S" class="def variant constructor anchored"><a href="#type-constructor_arguments.S" class="anchor"></a><code><span>| </span><span><span class="constructor">S</span> : <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="#type-constructor_arguments">constructor_arguments</a></span> <span class="arrow">&#45;&gt;</span> 
  <span><span>(<span><span class="type-var">'self</span> <span class="arrow">&#45;&gt;</span></span>
    <span class="type-var">'bs</span>,
    <span><span class="type-var">'self</span> <span class="arrow">&#45;&gt;</span></span>
    <span class="type-var">'b</span>,
    <span><span class="type-var">'self</span> <span class="arrow">&#45;&gt;</span></span>
    <span class="type-var">'ms</span>,
    <span><span class="type-var">'self</span> <span class="arrow">&#45;&gt;</span></span>
    <span class="type-var">'m</span>,
    <span class="type-var">'self</span>,
    <span class="type-var">'hyps</span>,
    <span class="type-var">'constraints</span>)</span>
    <a href="#type-constructor_arguments">constructor_arguments</a></span></span></code></li><li id="type-constructor_arguments.C" class="def variant constructor anchored"><a href="#type-constructor_arguments.C" class="anchor"></a><code><span>| </span><span><span class="constructor">C</span> : <span>(<span><span><span>(<span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span>)</span>
  * <span><span>(<span class="type-var">'bs</span>, <span class="type-var">'b</span>, <span class="type-var">'ms</span>, <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span> <a href="#type-constructor_arguments">constructor_arguments</a></span> <span class="arrow">&#45;&gt;</span> 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'bs</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'ms</span>, <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>, <span class="type-var">'self</span>, <span class="type-var">'hyps</span>, <span class="type-var">'constraints</span>)</span>
    <a href="#type-constructor_arguments">constructor_arguments</a></span></span></code></li></ol></div><div class="spec-doc"><p>GADT for describing the type of the constructor:</p><ul><li>N is the terminator</li><li>A(a,...) is an argument of type a (a is a Conversion.t)</li><li>S stands for self</li><li>C stands for container</li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-constructor"><a href="#type-constructor" class="anchor"></a><code><span><span class="keyword">type</span> <span>('t, 'h, 'c) constructor</span></span><span> = </span></code><ol><li id="type-constructor.K" class="def variant constructor anchored"><a href="#type-constructor.K" class="anchor"></a><code><span>| </span><span><span class="constructor">K</span> : <a href="#type-name">name</a>
  * <a href="#type-doc">doc</a>
  * <span><span>(<span class="type-var">'build_stateful_t</span>, <span class="type-var">'build_t</span>, <span class="type-var">'match_stateful_t</span>, <span class="type-var">'match_t</span>, <span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span>
      <a href="#type-constructor_arguments">constructor_arguments</a></span>
  * <span><span>(<span class="type-var">'build_stateful_t</span>, <span class="type-var">'build_t</span>)</span> <a href="#type-build_t">build_t</a></span>
  * <span><span>(<span class="type-var">'match_stateful_t</span>, <span class="type-var">'match_t</span>, <span class="type-var">'t</span>)</span> <a href="#type-match_t">match_t</a></span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="#type-constructor">constructor</a></span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-declaration"><a href="#type-declaration" class="anchor"></a><code><span><span class="keyword">type</span> <span>('t, 'h, 'c) declaration</span></span><span> = </span><span>{</span></code><ol><li id="type-declaration.ty" class="def record field anchored"><a href="#type-declaration.ty" class="anchor"></a><code><span>ty : <a href="../Conversion/index.html#type-ty_ast">Conversion.ty_ast</a>;</span></code></li><li id="type-declaration.doc" class="def record field anchored"><a href="#type-declaration.doc" class="anchor"></a><code><span>doc : <a href="#type-doc">doc</a>;</span></code></li><li id="type-declaration.pp" class="def record field anchored"><a href="#type-declaration.pp" class="anchor"></a><code><span>pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></li><li id="type-declaration.constructors" class="def record field anchored"><a href="#type-declaration.constructors" class="anchor"></a><code><span>constructors : <span><span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="#type-constructor">constructor</a></span> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-declare"><a href="#val-declare" class="anchor"></a><code><span><span class="keyword">val</span> declare : <span><span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="#type-declaration">declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'h</span>, <span class="type-var">'c</span>)</span> <a href="../ContextualConversion/index.html#type-t">ContextualConversion.t</a></span></span></code></div></div></div></body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Discrimination_tree (elpi.Elpi.Internal.Discrimination_tree)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">elpi</a> &#x00BB; <a href="../../index.html">Elpi</a> &#x00BB; <a href="../index.html">Internal</a> &#x00BB; Discrimination_tree</nav><header class="odoc-preamble"><h1>Module <code><span>Internal.Discrimination_tree</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-cell"><a href="#type-cell" class="anchor"></a><code><span><span class="keyword">type</span> cell</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Path"><a href="#module-Path" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Path/index.html">Path</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkConstant"><a href="#val-mkConstant" class="anchor"></a><code><span><span class="keyword">val</span> mkConstant : <span><span class="label">safe</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="label">data</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">arity</span>:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkPrimitive"><a href="#val-mkPrimitive" class="anchor"></a><code><span><span class="keyword">val</span> mkPrimitive : <span><a href="../../../Elpi_util/Util/CData/index.html#type-t">Elpi_util.Util.CData.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkVariable"><a href="#val-mkVariable" class="anchor"></a><code><span><span class="keyword">val</span> mkVariable : <a href="#type-cell">cell</a></span></code></div><div class="spec-doc"><p>This is for: unification variables, discard</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkAny"><a href="#val-mkAny" class="anchor"></a><code><span><span class="keyword">val</span> mkAny : <a href="#type-cell">cell</a></span></code></div><div class="spec-doc"><p>This is for:</p><ul><li>lambda-abstractions: DT does not perform HO unification, nor βη-redex unif</li><li>too big terms: if the path of the goal is bigger then the max path in the rules, each term is replaced with this constructor. Note that we do not use mkVariable, since in input mode a variable cannot be unified with non-flex terms. In DT, mkAny is unified with anything</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkInputMode"><a href="#val-mkInputMode" class="anchor"></a><code><span><span class="keyword">val</span> mkInputMode : <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkOutputMode"><a href="#val-mkOutputMode" class="anchor"></a><code><span><span class="keyword">val</span> mkOutputMode : <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkListTailVariable"><a href="#val-mkListTailVariable" class="anchor"></a><code><span><span class="keyword">val</span> mkListTailVariable : <a href="#type-cell">cell</a></span></code></div><div class="spec-doc"><p>This is for the last term of opened lists.</p><p>If the list ends is <code>1,2|X</code> == Cons (CData'1',Cons(CData'2',Arg (_, _)))</p><p>The corresponding path will be: ListHead, Primitive, Primitive, ListTailVariable</p><p>ListTailVariable is considered as a variable, and if it appears in a goal in input position, it cannot be unified with non-flex terms</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkListTailVariableUnif"><a href="#val-mkListTailVariableUnif" class="anchor"></a><code><span><span class="keyword">val</span> mkListTailVariableUnif : <a href="#type-cell">cell</a></span></code></div><div class="spec-doc"><p>This is used for capped lists.</p><p>If the length of the maximal list in the rules of a predicate is N, then any (sub-)list in the goal longer then N encodes the first N elements in the path and the last are replaced with ListTailVariableUnif.</p><p>The main difference with ListTailVariable is that DT will unify this symbol to both flex and non-flex terms in the path of rules</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkListHead"><a href="#val-mkListHead" class="anchor"></a><code><span><span class="keyword">val</span> mkListHead : <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkListEnd"><a href="#val-mkListEnd" class="anchor"></a><code><span><span class="keyword">val</span> mkListEnd : <a href="#type-cell">cell</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkPathEnd"><a href="#val-mkPathEnd" class="anchor"></a><code><span><span class="keyword">val</span> mkPathEnd : <a href="#type-cell">cell</a></span></code></div><div class="spec-doc"><p>This is padding used to fill the array in paths and indicate the retrieve function to stop making unification.</p><p>Note that the array for the path has a length which is doubled each time the terms in it are larger then the forseen length. Each time the array is doubled, the new cells are filled with PathEnd.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-index"><a href="#val-index" class="anchor"></a><code><span><span class="keyword">val</span> index : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">max_list_length</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="Path/index.html#type-t">Path.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>index dt ~max_list_length path value</code> returns a new discrimination tree starting from <code>dt</code> where <code>value</code> is added wrt its <code>path</code>.</p><p><code>max_list_length</code> is provided and used to update (if needed) the length of the longest list in the received path.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_path"><a href="#val-max_path" class="anchor"></a><code><span><span class="keyword">val</span> max_path : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_list_length"><a href="#val-max_list_length" class="anchor"></a><code><span><span class="keyword">val</span> max_list_length : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_depths"><a href="#val-max_depths" class="anchor"></a><code><span><span class="keyword">val</span> max_depths : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int array</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty_dt"><a href="#val-empty_dt" class="anchor"></a><code><span><span class="keyword">val</span> empty_dt : <span><span><span class="type-var">'b</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-retrieve"><a href="#val-retrieve" class="anchor"></a><code><span><span class="keyword">val</span> retrieve : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Path/index.html#type-t">Path.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Elpi__.Bl.scan</span></span></span></code></div><div class="spec-doc"><p><code>retrive cmp path dt</code> Retrives all values in a discrimination tree <code>dt</code> from a given path <code>p</code>.</p><p>The retrival algorithm performs a light unification between <code>p</code> and the nodes in the discrimination tree. This light unification takes care of unification variables that can be either in the path or in the nodes of <code>dt</code></p><p>The returned list is sorted wrt <code>cmp</code> so that rules are given in the expected order</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-replace"><a href="#val-replace" class="anchor"></a><code><span><span class="keyword">val</span> replace : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_cell"><a href="#val-pp_cell" class="anchor"></a><code><span><span class="keyword">val</span> pp_cell : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cell">cell</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show_cell"><a href="#val-show_cell" class="anchor"></a><code><span><span class="keyword">val</span> show_cell : <span><a href="#type-cell">cell</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : 
  <span><span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show"><a href="#val-show" class="anchor"></a><code><span><span class="keyword">val</span> show : <span><span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal"><a href="#module-Internal" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal/index.html">Internal</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>

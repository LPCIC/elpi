
name: Users workflow

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
    test-users:
        name: "test users"
        runs-on: ubuntu-latest
        env:
          OPAMWITHTEST: true
          OPAMVERBOSE: true
        steps:
        - uses: actions/checkout@v4

        - uses: ocaml/setup-ocaml@v3
          with:
            ocaml-compiler: 4.14.x
            opam-local-packages:

        - run: opam pin add sexplib0 v0.16.0
          env:
            OPAMWITHTEST: false

        - run: opam pin add elpi .
          env:
            OPAMWITHTEST: false
            
        - run: opam pin --ignore-constraints-on elpi add rocq-elpi https://github.com/LPCIC/coq-elpi.git#fix-elpi-3.0
        - run: opam pin --ignore-constraints-on elpi add coq-elpi https://github.com/LPCIC/coq-elpi.git#fix-elpi-3.0
        - run: opam pin --ignore-constraints-on elpi add rocq-stdlib https://github.com/rocq-prover/stdlib.git#master
        - run: opam pin --ignore-constraints-on elpi add coq-hierarchy-builder https://github.com/gares/hierarchy-builder.git#elpi-3.0
        - run: opam pin --ignore-constraints-on elpi add rocq-mathcomp-ssreflect https://github.com/math-comp/math-comp.git#master
        - run: opam pin --ignore-constraints-on elpi add rocq-mathcomp-fingroup https://github.com/math-comp/math-comp.git#master
        - run: opam pin --ignore-constraints-on elpi add rocq-mathcomp-algebra https://github.com/math-comp/math-comp.git#master
        - run: opam pin --ignore-constraints-on elpi add rocq-mathcomp-solvable https://github.com/math-comp/math-comp.git#master
        - run: opam pin --ignore-constraints-on elpi add rocq-mathcomp-field https://github.com/math-comp/math-comp.git#master

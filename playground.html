<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Playground &mdash; Elpi  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Elpi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="elpi/index.html#http://">elpi</a></li>
<li class="toctree-l1"><a class="reference external" href="elpi-option-legacy-parser/index.html#http://">elpi-option-legacy-parser</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Elpi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Playground</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/playground.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="playground">
<h1>Playground<a class="headerlink" href="#playground" title="Permalink to this heading"></a></h1>
<p>This page is used to test hooks in order to run <code class="docutils literal notranslate"><span class="pre">elpi</span></code> on code snippets and inject its output within <code class="docutils literal notranslate"><span class="pre">sphinx</span></code> documentation sources.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>Before running the hooks, make sure to have <code class="docutils literal notranslate"><span class="pre">elpi</span></code> built locally:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">eval $(opam env)</span>
<span class="go">make build</span>
</pre></div>
</div>
<p>It doesn’t hurt to check that <code class="docutils literal notranslate"><span class="pre">dune</span></code> runs the locally built <code class="docutils literal notranslate"><span class="pre">elpi</span></code> correctly:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dune exec elpi -- -h</span>
</pre></div>
</div>
</section>
<section id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading"></a></h2>
<p>Elpi code blocks to be evaluated and which output is to be injected from <code class="docutils literal notranslate"><span class="pre">docs/base</span></code> to <code class="docutils literal notranslate"><span class="pre">docs/source</span></code> are conventionally denoted in <code class="docutils literal notranslate"><span class="pre">reStructuredText</span></code> as <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">elpi::</span> <span class="pre">FILE</span></code>.</p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>type app term -&gt; term -&gt; term.
<span class="linenos"> 2</span>type lam (term -&gt; term) -&gt; term.
<span class="linenos"> 3</span>type arr ty -&gt; ty -&gt; ty.
<span class="linenos"> 4</span>type nat ty.
<span class="linenos"> 5</span>type bool ty.
<span class="linenos"> 6</span>mode (term i o).
<span class="linenos"> 7</span>term (app HD ARG) TGT :- term HD (arr SRC TGT), term ARG SRC.
<span class="linenos"> 8</span>term (lam F) (arr SRC TGT) :- pi x\ term x SRC =&gt; term (F x) TGT.
<span class="linenos"> 9</span>term (uvar as X) T :- declare_constraint (term X T) [X].
<span class="linenos">10</span>
<span class="linenos">11</span>len [] 0.
<span class="linenos">12</span>len [_|XS] N :- len XS M, N is M + 1.
<span class="linenos">13</span>
<span class="linenos">14</span>constraint term {
<span class="linenos">15</span>  rule
<span class="linenos">16</span>     \ (term (uvar K LX) _) (term (uvar K LY) _)
<span class="linenos">17</span>     | (len LX N, len LY M, not(N = M))
<span class="linenos">18</span>   &lt;=&gt; (print &quot;wrong arity&quot; K, false).
<span class="linenos">19</span>
<span class="linenos">20</span>  rule (GX ?- term (uvar K LX) TX)
<span class="linenos">21</span>     \ (GY ?- term (uvar K LY) TY)
<span class="linenos">22</span>     | (print &quot;compat&quot; GX &quot;|-&quot; K LX TX &quot;,&quot; GY &quot;|-&quot; K LY TY, 
<span class="linenos">23</span>        compatible GX LX GY LY CTXCONSTR)
<span class="linenos">24</span>   &lt;=&gt; (print &quot;NEW&quot; CTXCONSTR TX &quot;=&quot; TY, CTXCONSTR, TX = TY).
<span class="linenos">25</span>
<span class="linenos">26</span>}
<span class="linenos">27</span>
<span class="linenos">28</span>compatible _ [] _ [] [] :- !.
<span class="linenos">29</span>compatible GX [X|XS] GY [Y|YS] [TX = TY | K] :-
<span class="linenos">30</span> (GX =&gt; term X TX),
<span class="linenos">31</span> (GY =&gt; term Y TY),
<span class="linenos">32</span> !,
<span class="linenos">33</span> compatible GX XS GY YS K.
<span class="linenos">34</span>compatible _ _ _ _ [false].
<span class="linenos">35</span>
<span class="linenos">36</span>main :-
<span class="linenos">37</span>  (term (lam x\ lam y\ app (app (F x y) x) y) T1_, 
<span class="linenos">38</span>   term (lam y\ lam x\ app (app (F x y) y) x) T2_),
<span class="linenos">39</span>  print &quot;1&quot;,
<span class="linenos">40</span>  (term (lam x \ X x) (arr A_ nat),
<span class="linenos">41</span>   term (lam x \ X x) (arr bool B_)),
<span class="linenos">42</span>  print &quot;2&quot;,
<span class="linenos">43</span>  not(term (lam x \ Y x) (arr C nat), term (lam x \ Y x) (arr bool C)),
<span class="linenos">44</span>  not(term (lam x \ Z x) (arr nat nat), term (lam x \ Z x) (arr bool D_)).
<span class="linenos">45</span>
</pre></div>
</div>
<p>The injection engine:</p>
<ul class="simple">
<li><p>Retrieves all <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">elpi::</span></code> directives</p></li>
<li><p>Changes them into <code class="docutils literal notranslate"><span class="pre">literalinclude</span></code> in the generated source with relevant options</p></li>
<li><p>Runs <code class="docutils literal notranslate"><span class="pre">dune</span> <span class="pre">exec</span> <span class="pre">elpi</span> <span class="pre">--</span> <span class="pre">-test</span> <span class="pre">FILE</span></code> on the <code class="docutils literal notranslate"><span class="pre">FILE</span></code> containing the <code class="docutils literal notranslate"><span class="pre">elpi</span></code> snippet, test or example.</p></li>
<li><p>Captures its output (<code class="docutils literal notranslate"><span class="pre">stdout</span></code>)</p></li>
<li><p>Creates a <code class="docutils literal notranslate"><span class="pre">code-block::</span> <span class="pre">console</span></code> just after it to inject the captured console output</p></li>
<li><p>Captures its output (<code class="docutils literal notranslate"><span class="pre">stderr</span></code>)</p></li>
<li><p>Creates a <code class="docutils literal notranslate"><span class="pre">code-block::</span> <span class="pre">console</span></code> just after it to inject the captured console erros</p></li>
<li><p>In case of an assertion option for the <code class="docutils literal notranslate"><span class="pre">elpi</span></code> directive, the output is injected only if matched</p></li>
</ul>
<p>Result should look as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.004</span>
<span class="go">File &quot;/home/jwintz/Development/elpi/tests/sources/chr.elpi&quot;, line 7, column 60, character 133: Warning: constant term has no declared type.</span>
<span class="go">File &quot;/home/jwintz/Development/elpi/tests/sources/chr.elpi&quot;, line 11, column 8, character 319: Warning: constant len has no declared type. Did you mean std.length ?</span>
<span class="go">File &quot;/home/jwintz/Development/elpi/tests/sources/chr.elpi&quot;, line 28, column 28, character 761: Warning: constant compatible has no declared type.</span>

<span class="go">Typechecking time: 0.154</span>
<span class="go">compat [term c1 (uvar frozen--501 []), term c0 (uvar frozen--502 [])] |- frozen--494 [</span>
<span class="go"> c1, c0] arr (uvar frozen--495 [c0, c1]) (arr (uvar frozen--496 [c0, c1]) (uvar frozen--497 [])) , [</span>
<span class="go"> term c3 (uvar frozen--499 []), term c2 (uvar frozen--498 [])] |- frozen--494 [</span>
<span class="go"> c2, c3] arr (uvar frozen--498 []) (arr (uvar frozen--499 []) (uvar frozen--500 []))</span>
<span class="go">NEW [X0 = X1, X2 = X3] arr (X4 c0 c1) (arr (X5 c0 c1) X6) = arr X1 (arr X3 X7)</span>
<span class="go">1</span>
<span class="go">compat [term c0 bool] |- frozen--507 [c0] uvar frozen--508 [] , [term c1 (uvar frozen--509 [])] |- frozen--507 [c1] nat</span>
<span class="go">NEW [bool = X8] X9 = nat</span>
<span class="go">2</span>
<span class="go">compat [term c0 bool] |- frozen--514 [c0] uvar frozen--515 [] , [term c1 (uvar frozen--515 [])] |- frozen--514 [c1] nat</span>
<span class="go">NEW [bool = X10] X10 = nat</span>
<span class="go">compat [term c0 bool] |- frozen--520 [c0] uvar frozen--521 [] , [term c1 nat] |- frozen--520 [c1] nat</span>
<span class="go">NEW [bool = nat] X11 = nat</span>

<span class="go">Success:</span>

<span class="go">Time: 0.001</span>

<span class="go">Constraints:</span>
<span class="go"> {c0} : term c0 bool ?- term (X12 c0) nat  /* suspended on X12 */ {c0 c1} : term c1 X13, term c0 X13 ?- term (X14 c1 c0) (arr X13 (arr X13 X6))  /* suspended on X14 */</span>

<span class="go">State:</span>
</pre></div>
</div>
</section>
<section id="regexp-matching">
<h2>Regexp Matching<a class="headerlink" href="#regexp-matching" title="Permalink to this heading"></a></h2>
<p>This <code class="docutils literal notranslate"><span class="pre">elpi</span></code> directive should pass validation:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">.. elpi:: ./a.elpi</span>
<span class="go">   :assert: V = s \(.*\)</span>
</pre></div>
</div>
<p><strong>./a.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">type</span><span class="w"> </span><span class="nf">s</span><span class="w"> </span><span class="kt">num</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">num</span>.
<span class="linenos">2</span><span class="kd">type</span><span class="w"> </span><span class="nf">zero</span><span class="w"> </span><span class="kt">num</span>.
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">ack</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">num</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">num</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">num</span>.
<span class="linenos">4</span>ack<span class="w"> </span>zero<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">).</span>
<span class="linenos">5</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span>zero<span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">6</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">N</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N2</span><span class="w"> </span><span class="nv">V2</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">V2</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">7</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>ack<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;V =&quot;</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">V = s (s (s (s (s (s (s (s (s (s (s (s (s zero))))))))))))</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.106</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p>This one should fail validation, only a message stating the regexp matching error will be printed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">.. elpi:: ./a.elpi</span>
<span class="go">   :assert: /(?!)/</span>
</pre></div>
</div>
<p><strong>./a.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">type</span><span class="w"> </span><span class="nf">s</span><span class="w"> </span><span class="kt">num</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">num</span>.
<span class="linenos">2</span><span class="kd">type</span><span class="w"> </span><span class="nf">zero</span><span class="w"> </span><span class="kt">num</span>.
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">ack</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">num</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">num</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">num</span>.
<span class="linenos">4</span>ack<span class="w"> </span>zero<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">).</span>
<span class="linenos">5</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span>zero<span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">6</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">N</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N2</span><span class="w"> </span><span class="nv">V2</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">V2</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">7</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>ack<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;V =&quot;</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight" style="background-color: rgb(248, 148, 148);"><pre>Injection failure: result did not pass regexp check (/(?!)/)</pre></div></div></section>
<section id="test-bed">
<h2>Test Bed<a class="headerlink" href="#test-bed" title="Permalink to this heading"></a></h2>
<p><strong>../../tests/sources/accumulate_twice1.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">doomed</span><span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos">2</span><span class="kd">accumulate</span><span class="w"> </span>accumulated<span class="o">.</span>
<span class="linenos">3</span><span class="kd">accumulate</span><span class="w"> </span>accumulated<span class="o">.</span>
<span class="linenos">4</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">5</span><span class="w">  </span>doomed<span class="w"> </span><span class="mi">100</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.002</span>

<span class="go">Compilation time: 0.001</span>

<span class="go">Typechecking time: 0.106</span>
</pre></div>
</div>
<p><strong>../../tests/sources/accumulate_twice2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">doomed</span><span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos">2</span><span class="kd">accumulate</span><span class="w"> </span>accumulated<span class="o">.</span>
<span class="linenos">3</span><span class="kd">namespace</span><span class="w"> </span>other<span class="w"> </span>{ <span class="kd">accumulate</span><span class="w"> </span>accumulated<span class="o">.</span><span class="w"> </span>}
<span class="linenos">4</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">5</span><span class="w">  </span>doomed<span class="w"> </span><span class="mi">100</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span>other.doomed<span class="w"> </span><span class="mi">100</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/accumulate_twice2.elpi&quot;, line 4, column 0, character 87:</span>
<span class="go"> Warning: constant other.doomed has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.002</span>

<span class="go">Compilation time: 0.001</span>

<span class="go">Typechecking time: 0.117</span>
</pre></div>
</div>
<p><strong>../../tests/sources/accumulated.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>doomed<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos">2</span>doomed<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="kd">,</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">-</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>doomed<span class="w"> </span><span class="nv">M</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/accumulated.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant doomed has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.111</span>
</pre></div>
</div>
<p><strong>../../tests/sources/ackermann.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% ack (s zero) (s zero) V.              yields V = s(s(s(zero)))   = 3</span>
<span class="linenos"> 2</span><span class="c">% ack (s (s zero)) (s (s zero)) V.      yields V = s(s...(s zero)) = 7</span>
<span class="linenos"> 3</span><span class="c">% ack (s (s (s zero))) (s zero) V.      yields V = s(s...(s zero)) = 13</span>
<span class="linenos"> 4</span><span class="c">% ack (s (s (s zero))) (s (s zero)) V.  yields V = ....            = 29</span>
<span class="linenos"> 5</span><span class="c">% ack (s (s (s (s zero)))) (s zero) V.  yields  nothing</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c">% ack   +int    +int  -int</span>
<span class="linenos"> 8</span><span class="c">% ack(0, N, V) :- !, V is N + 1.</span>
<span class="linenos"> 9</span><span class="c">% ack(M, 0, V) :- !, M2 is M - 1, ack(M2, 1, V).</span>
<span class="linenos">10</span><span class="c">% ack(M, N, V) :- M2 is M - 1, N2 is N - 1, ack(M, N2, V2), ack(M2, V2, V).</span>
<span class="linenos">11</span>
<span class="linenos">12</span>
<span class="linenos">13</span>ack<span class="w"> </span>zero<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">).</span>
<span class="linenos">14</span>
<span class="linenos">15</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span>zero<span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">M</span><span class="kd">,</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N2</span><span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">N</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N2</span><span class="w"> </span><span class="nv">V2</span><span class="kd">,</span><span class="w"> </span>ack<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">V2</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">18</span>
<span class="linenos">19</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>ack<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ackermann.elpi&quot;, line 13, column 0, character 530:</span>
<span class="go"> Warning: constant zero has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ackermann.elpi&quot;, line 13, column 0, character 530:</span>
<span class="go"> Warning:</span>
<span class="go"> constant s has no declared type. Did you mean std.spy std.spy! std.split-at std.spy-do! std.set.mem std.set.make std.set.add std.set.remove std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.cardinal std.set.elements std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.set std.set std.loc.set std.int.set std.string.set std.string.map gc.stat gc.set std.loc.set.cardinal std.loc.set.elements std.loc.set.subset std.loc.set.equal std.loc.set.diff std.loc.set.inter std.loc.set.union std.loc.set.remove std.loc.set.add std.loc.set.mem std.loc.set.empty std.int.set.cardinal std.int.set.elements std.int.set.subset std.int.set.equal std.int.set.diff std.int.set.inter std.int.set.union std.int.set.remove std.int.set.add std.int.set.mem std.int.set.empty std.string.set.cardinal std.string.set.elements std.string.set.subset std.string.set.equal std.string.set.diff std.string.set.inter std.string.set.union std.string.set.remove std.string.set.add std.string.set.mem std.string.set.empty std.string.map.bindings std.string.map.find std.string.map.remove std.string.map.add std.string.map.mem std.string.map.empty std.string.concat random.self_init rex.split ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ackermann.elpi&quot;, line 13, column 0, character 530:</span>
<span class="go"> Warning: constant ack has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ackermann.elpi&quot;, line 19, column 0, character 676:</span>
<span class="go"> Warning: V is linear: name it _V (discard) or V_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.130</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/asclause.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>hard<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">P</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="nv">P</span><span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>
<span class="linenos">4</span>simple<span class="w"> </span>(<span class="mi">1</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">P</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="nv">P</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">7</span><span class="w">  </span>simple<span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>hard<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>x<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/asclause.elpi&quot;, line 5, column 0, character 36:</span>
<span class="go"> Warning: constant simple has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/asclause.elpi&quot;, line 2, column 0, character 1:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/asclause.elpi&quot;, line 2, column 0, character 1:</span>
<span class="go"> Warning: constant hard has no declared type.</span>
<span class="go">1</span>
<span class="go">lam c0 \ c0</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.130</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/beta.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span><span class="nv">y\</span><span class="w"> </span>f<span class="w"> </span>x<span class="w"> </span>y<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>a<span class="w"> </span>b<span class="w"> </span><span class="kd">=</span><span class="w"> </span>f<span class="w"> </span>a<span class="w"> </span>b<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/beta.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/beta.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/beta.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.124</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/block.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">namespace</span><span class="w"> </span>xxx<span class="w"> </span>{
<span class="linenos">2</span><span class="w"> </span>foo<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/block.elpi&quot;, line 1, column 0, character 0:matching } is missing</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chr.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>type app term -&gt; term -&gt; term.
<span class="linenos"> 2</span>type lam (term -&gt; term) -&gt; term.
<span class="linenos"> 3</span>type arr ty -&gt; ty -&gt; ty.
<span class="linenos"> 4</span>type nat ty.
<span class="linenos"> 5</span>type bool ty.
<span class="linenos"> 6</span>mode (term i o).
<span class="linenos"> 7</span>term (app HD ARG) TGT :- term HD (arr SRC TGT), term ARG SRC.
<span class="linenos"> 8</span>term (lam F) (arr SRC TGT) :- pi x\ term x SRC =&gt; term (F x) TGT.
<span class="linenos"> 9</span>term (uvar as X) T :- declare_constraint (term X T) [X].
<span class="linenos">10</span>
<span class="linenos">11</span>len [] 0.
<span class="linenos">12</span>len [_|XS] N :- len XS M, N is M + 1.
<span class="linenos">13</span>
<span class="linenos">14</span>constraint term {
<span class="linenos">15</span>  rule
<span class="linenos">16</span>     \ (term (uvar K LX) _) (term (uvar K LY) _)
<span class="linenos">17</span>     | (len LX N, len LY M, not(N = M))
<span class="linenos">18</span>   &lt;=&gt; (print &quot;wrong arity&quot; K, false).
<span class="linenos">19</span>
<span class="linenos">20</span>  rule (GX ?- term (uvar K LX) TX)
<span class="linenos">21</span>     \ (GY ?- term (uvar K LY) TY)
<span class="linenos">22</span>     | (print &quot;compat&quot; GX &quot;|-&quot; K LX TX &quot;,&quot; GY &quot;|-&quot; K LY TY, 
<span class="linenos">23</span>        compatible GX LX GY LY CTXCONSTR)
<span class="linenos">24</span>   &lt;=&gt; (print &quot;NEW&quot; CTXCONSTR TX &quot;=&quot; TY, CTXCONSTR, TX = TY).
<span class="linenos">25</span>
<span class="linenos">26</span>}
<span class="linenos">27</span>
<span class="linenos">28</span>compatible _ [] _ [] [] :- !.
<span class="linenos">29</span>compatible GX [X|XS] GY [Y|YS] [TX = TY | K] :-
<span class="linenos">30</span> (GX =&gt; term X TX),
<span class="linenos">31</span> (GY =&gt; term Y TY),
<span class="linenos">32</span> !,
<span class="linenos">33</span> compatible GX XS GY YS K.
<span class="linenos">34</span>compatible _ _ _ _ [false].
<span class="linenos">35</span>
<span class="linenos">36</span>main :-
<span class="linenos">37</span>  (term (lam x\ lam y\ app (app (F x y) x) y) T1_, 
<span class="linenos">38</span>   term (lam y\ lam x\ app (app (F x y) y) x) T2_),
<span class="linenos">39</span>  print &quot;1&quot;,
<span class="linenos">40</span>  (term (lam x \ X x) (arr A_ nat),
<span class="linenos">41</span>   term (lam x \ X x) (arr bool B_)),
<span class="linenos">42</span>  print &quot;2&quot;,
<span class="linenos">43</span>  not(term (lam x \ Y x) (arr C nat), term (lam x \ Y x) (arr bool C)),
<span class="linenos">44</span>  not(term (lam x \ Z x) (arr nat nat), term (lam x \ Z x) (arr bool D_)).
<span class="linenos">45</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr.elpi&quot;, line 7, column 0, character 133:</span>
<span class="go"> Warning: constant term has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr.elpi&quot;, line 11, column 0, character 319:</span>
<span class="go"> Warning: constant len has no declared type. Did you mean std.length ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr.elpi&quot;, line 28, column 0, character 761:</span>
<span class="go"> Warning: constant compatible has no declared type.</span>
<span class="go">compat [term c1 (uvar frozen--501 []), term c0 (uvar frozen--502 [])] |-</span>
<span class="go"> frozen--494 [c1, c0]</span>
<span class="go"> arr (uvar frozen--495 [c0, c1])</span>
<span class="go">  (arr (uvar frozen--496 [c0, c1]) (uvar frozen--497 [])) ,</span>
<span class="go"> [term c3 (uvar frozen--499 []), term c2 (uvar frozen--498 [])] |- frozen--494</span>
<span class="go"> [c2, c3]</span>
<span class="go"> arr (uvar frozen--498 []) (arr (uvar frozen--499 []) (uvar frozen--500 []))</span>
<span class="go">NEW [X0 = X1, X2 = X3] arr (X4 c0 c1) (arr (X5 c0 c1) X6) = arr X1 (arr X3 X7)</span>
<span class="go">1</span>
<span class="go">compat [term c0 bool] |- frozen--507 [c0] uvar frozen--508 [] ,</span>
<span class="go"> [term c1 (uvar frozen--509 [])] |- frozen--507 [c1] nat</span>
<span class="go">NEW [bool = X8] X9 = nat</span>
<span class="go">2</span>
<span class="go">compat [term c0 bool] |- frozen--514 [c0] uvar frozen--515 [] ,</span>
<span class="go"> [term c1 (uvar frozen--515 [])] |- frozen--514 [c1] nat</span>
<span class="go">NEW [bool = X10] X10 = nat</span>
<span class="go">compat [term c0 bool] |- frozen--520 [c0] uvar frozen--521 [] , [term c1 nat]</span>
<span class="go"> |- frozen--520 [c1] nat</span>
<span class="go">NEW [bool = nat] X11 = nat</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.135</span>

<span class="go">Success:</span>

<span class="go">Time: 0.001</span>

<span class="go">Constraints:</span>
<span class="go"> {c0} : term c0 bool ?- term (X12 c0) nat  /* suspended on X12 */</span>
<span class="go"> {c0 c1} : term c1 X13, term c0 X13 ?- term (X14 c1 c0) (arr X13 (arr X13 X6))  /* suspended on X14 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chrGCD.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>mode<span class="w"> </span>(gcd<span class="w"> </span>i<span class="w"> </span>i<span class="o">).</span>
<span class="linenos"> 2</span><span class="kd">kind</span><span class="w"> </span><span class="nf">group</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 3</span><span class="kd">type</span><span class="w"> </span><span class="nf">group-1</span><span class="w"> </span><span class="kt">group</span>.
<span class="linenos"> 4</span><span class="kd">type</span><span class="w"> </span><span class="nf">group-2</span><span class="w"> </span><span class="kt">group</span>.
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>gcd<span class="w"> </span><span class="nv">A</span><span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>declare_constraint<span class="w"> </span>(gcd<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">B</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c">% assert result is OK</span>
<span class="linenos"> 9</span>gcd<span class="w"> </span><span class="mi">11</span><span class="w"> </span>group-1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;group 1 solved&quot;</span><span class="o">.</span>
<span class="linenos">10</span>gcd<span class="w"> </span><span class="mi">7</span><span class="w"> </span>group-2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;group 2 solved&quot;</span><span class="o">.</span>
<span class="linenos">11</span>
<span class="linenos">12</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>gcd<span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>gcd<span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>gcd<span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span>gcd<span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>gcd<span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="nv">Y</span><span class="kd">,</span>
<span class="linenos">13</span><span class="w">        </span><span class="c">% we then force a resumption to check only GCDs are there</span>
<span class="linenos">14</span><span class="w">        </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>group-1<span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>group-2<span class="o">.</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">gcd </span>{
<span class="linenos">17</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(gcd<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(gcd<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">B</span><span class="o">).</span>
<span class="linenos">18</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(gcd<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(gcd<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">&lt;</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="o">(</span><span class="nv">B</span><span class="w"> </span><span class="kd">-</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>gcd<span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">19</span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chrGCD.elpi&quot;, line 6, column 0, character 74:</span>
<span class="go"> Warning: constant gcd has no declared type.</span>
<span class="go">group 1 solved</span>
<span class="go">group 2 solved</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.113</span>

<span class="go">Success:</span>

<span class="go">Time: 0.001</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chrLEQ.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>mode<span class="w"> </span>(leq<span class="w"> </span>i<span class="w"> </span>i<span class="o">).</span>
<span class="linenos"> 2</span>leq<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(leq<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">A</span><span class="kd">,</span><span class="nv">B</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 3</span>leq<span class="w"> </span><span class="nv">A</span><span class="w">         </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(leq<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">B</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 4</span>leq<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="w">         </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(leq<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">A</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>mode<span class="w"> </span>(ltn<span class="w"> </span>i<span class="w"> </span>i<span class="o">).</span>
<span class="linenos"> 7</span>ltn<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(ltn<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">A</span><span class="kd">,</span><span class="nv">B</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 8</span>ltn<span class="w"> </span><span class="nv">A</span><span class="w">         </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(ltn<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">B</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 9</span>ltn<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="w">         </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w">  </span>declare_constraint<span class="w"> </span>(ltn<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">A</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">12</span><span class="w">  </span>leq<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span>leq<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="kd">,</span><span class="w"> </span>not<span class="w"> </span>(ltn<span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>ltn<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span>not(<span class="nv">A</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">C</span><span class="o">).</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">leq ltn </span>{
<span class="linenos">15</span><span class="w">  </span><span class="c">% incompat (FIRST!!)</span>
<span class="linenos">16</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>false<span class="o">.</span>
<span class="linenos">17</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>false<span class="o">.</span>
<span class="linenos">18</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>false<span class="o">.</span>
<span class="linenos">19</span><span class="w">  </span>
<span class="linenos">20</span><span class="w">  </span><span class="c">% refl</span>
<span class="linenos">21</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="w">  </span><span class="c">% atisym</span>
<span class="linenos">24</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="c">% trans</span>
<span class="linenos">27</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="o">).</span>
<span class="linenos">28</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="o">).</span>
<span class="linenos">29</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="o">).</span>
<span class="linenos">30</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="o">).</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="w">  </span><span class="c">% idempotence</span>
<span class="linenos">33</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(leq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">).</span>
<span class="linenos">34</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(ltn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">).</span>
<span class="linenos">35</span>
<span class="linenos">36</span>}
<span class="linenos">37</span>
<span class="linenos">38</span><span class="c">% vim:set ft=lprolog:</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chrLEQ.elpi&quot;, line 7, column 0, character 238:</span>
<span class="go"> Warning: constant ltn has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chrLEQ.elpi&quot;, line 2, column 0, character 16:</span>
<span class="go"> Warning: constant leq has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.117</span>

<span class="go">Success:</span>

<span class="go">Time: 0.001</span>

<span class="go">Constraints:</span>
<span class="go"> ltn X0 X1  /* suspended on X0, X1 */ leq X0 X1  /* suspended on X0, X1 */</span>
<span class="go"> leq X2 X1  /* suspended on X2, X1 */ ltn X0 X2  /* suspended on X0, X2 */</span>
<span class="go"> leq X0 X2  /* suspended on X0, X2 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chr_nokey.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">type</span><span class="w"> </span><span class="nf">test</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>declare_constraint<span class="w"> </span>(test<span class="w"> </span><span class="mi">1</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">],</span><span class="w"> </span>declare_constraint<span class="w"> </span>(test<span class="w"> </span><span class="mi">2</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">test </span>{
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="w"> </span><span class="k k-Mode">:name</span><span class="w"> </span><span class="s2">&quot;fst&quot;</span>
<span class="linenos"> 8</span><span class="w"> </span><span class="kd">rule</span><span class="w"> </span>(test<span class="w"> </span><span class="mi">1</span><span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(test<span class="w"> </span><span class="mi">2</span><span class="o">).</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w"> </span><span class="kd">rule</span><span class="w"> </span>(test<span class="w"> </span><span class="mi">2</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos">11</span>
<span class="linenos">12</span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.111</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> test 1  /* suspended on X0 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chr_nokey2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>declare_constraint<span class="w"> </span>foo<span class="w"> </span><span class="kd">[],</span><span class="w"> </span>declare_constraint<span class="w"> </span>(bar<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[],</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">foo bar </span>{<span class="w"> </span><span class="kd">rule</span><span class="w"> </span>foo<span class="w"> </span>(bar<span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>false<span class="o">.</span><span class="w"> </span><span class="kd">rule</span><span class="w"> </span>(bar<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>true<span class="o">).</span><span class="w"> </span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_nokey2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_nokey2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant bar has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.124</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> bar true  /* suspended on  */ foo  /* suspended on  */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chr_not_clique.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">a </span>{
<span class="linenos">2</span>
<span class="linenos">3</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>b<span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: CHR rule File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_not_clique.elpi&quot;, line 3, column 3, character 19:: matches b which is not a constraint on which it is applied. Check the list of predicates after the &quot;constraint&quot; keyword.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/chr_sem.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>declare_constraint<span class="w"> </span>a<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">],</span>
<span class="linenos"> 2</span><span class="w">        </span>declare_constraint<span class="w"> </span>b<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">],</span>
<span class="linenos"> 3</span><span class="w">        </span>declare_constraint<span class="w"> </span>b<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">],</span>
<span class="linenos"> 4</span><span class="w">        </span>declare_constraint<span class="w"> </span>d<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">a b c d </span>{
<span class="linenos"> 7</span><span class="w"> </span><span class="kd">rule</span><span class="w"> </span>a<span class="w"> </span>(d<span class="o">)</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>b<span class="w"> </span>b<span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(print<span class="w"> </span>c<span class="kd">,</span><span class="w"> </span>declare_constraint<span class="w"> </span>c<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 8</span><span class="w"> </span><span class="kd">rule</span><span class="w"> </span>c<span class="w"> </span>c<span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_sem.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant d has no declared type. Did you mean std.debug-print std.drop std.drop-last std.do! std.do-ok! std.loc.set.diff std.int.set.diff std.string.set.diff ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_sem.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/chr_sem.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
<span class="go">c</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.134</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> c  /* suspended on X0 */ d  /* suspended on X0 */ a  /* suspended on X0 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/conj2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>test1<span class="kd">,</span><span class="w"> </span>test2<span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>test1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="w"> </span><span class="kd">&amp;</span><span class="w"> </span>true<span class="w"> </span><span class="kd">&amp;</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos">4</span>test2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span>true<span class="w"> </span><span class="kd">&amp;</span><span class="w"> </span>true<span class="kd">,</span><span class="w"> </span>false<span class="kd">],</span><span class="w"> </span>std.length<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/conj2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant test2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/conj2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant test1 has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.114</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/ctx_loading.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">a b c d1 d2 d3 d11 d22 d33 </span>{
<span class="linenos"> 2</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d1<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(print<span class="w"> </span><span class="nv">C</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>declare_constraint<span class="w"> </span><span class="o">(</span>d11<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d2<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(print<span class="w"> </span><span class="nv">C</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>declare_constraint<span class="w"> </span><span class="o">(</span>d22<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d3<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(print<span class="w"> </span><span class="nv">C</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>declare_constraint<span class="w"> </span><span class="o">(</span>d33<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d1<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d11<span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d2<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d22<span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d3<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(<span class="nv">C</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>d33<span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos"> 8</span>}
<span class="linenos"> 9</span><span class="kd">type</span><span class="w"> </span><span class="nf">p</span><span class="w"> </span><span class="kt">prop</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">10</span><span class="kd">type</span><span class="w"> </span><span class="nf">a</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">11</span><span class="kd">type</span><span class="w"> </span><span class="nf">b</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">12</span><span class="kd">type</span><span class="w"> </span><span class="nf">c</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">13</span><span class="kd">type</span><span class="w"> </span><span class="nf">d1, d2, d3, d11, d22, d33</span><span class="w"> </span><span class="kt">prop</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">14</span>
<span class="linenos">15</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">16</span><span class="w">  </span>p<span class="w"> </span>b<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span>a<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span><span class="nv">W</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>a<span class="kd">,</span>
<span class="linenos">17</span><span class="w">  </span><span class="kd">[</span>p<span class="w"> </span>a<span class="kd">,</span><span class="w"> </span>p<span class="w"> </span>b<span class="kd">]</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>a<span class="kd">,</span><span class="w"> </span>
<span class="linenos">18</span><span class="w">  </span>(p<span class="w"> </span>a<span class="kd">,</span><span class="w"> </span>p<span class="w"> </span>b<span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>a<span class="kd">,</span>
<span class="linenos">19</span><span class="w">  </span><span class="kd">[</span>a<span class="kd">,</span><span class="w"> </span>b<span class="kd">,</span><span class="w"> </span>c<span class="kd">]</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w">   </span>declare_constraint<span class="w"> </span>(d1<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">],</span>
<span class="linenos">20</span><span class="w">  </span>c<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>b<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>a<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>declare_constraint<span class="w"> </span>(d2<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">],</span>
<span class="linenos">21</span><span class="w">  </span>(a<span class="kd">,</span><span class="w"> </span>b<span class="kd">,</span><span class="w"> </span>c<span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w">   </span>declare_constraint<span class="w"> </span>(d3<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">],</span>
<span class="linenos">22</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>a<span class="o">.</span>
<span class="linenos">23</span><span class="w">	</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[a, b, c]</span>
<span class="go">[a, b, c]</span>
<span class="go">[a, b, c]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.104</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">/* To test: query q X. The only answer should be X = ok. */</span>
<span class="linenos"> 2</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 3</span>q<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>a<span class="w"> </span>ko<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>c<span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos"> 6</span>a<span class="w"> </span>two<span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>b<span class="w"> </span>three<span class="o">.</span>
<span class="linenos"> 9</span>b<span class="w"> </span>four<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>c<span class="w"> </span>four<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 6, column 0, character 100:</span>
<span class="go"> Warning: constant two has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 8, column 0, character 108:</span>
<span class="go"> Warning: constant three has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 2, column 0, character 60:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 9, column 0, character 117:</span>
<span class="go"> Warning: constant four has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut.elpi&quot;, line 2, column 0, character 60:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.158</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">/* To test run q X; the only expected result is X=ok.</span>
<span class="linenos"> 2</span><span class="w">   </span><span class="nv">This</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span>different<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>brain-damaged<span class="w"> </span>semantics<span class="w"> </span>of<span class="w"> </span><span class="nv">Teyjus</span>
<span class="linenos"> 3</span><span class="w">   </span>and<span class="w"> </span>consistent<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>implicit<span class="w"> </span>declaration
<span class="linenos"> 4</span><span class="w">   </span><span class="kd">;</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos"> 5</span><span class="w">   </span><span class="kd">;</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">B</span>
<span class="linenos"> 6</span><span class="kd">*/</span>
<span class="linenos"> 7</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>c<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>x<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">;</span><span class="w"> </span>e<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 8</span>q<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>c<span class="w"> </span>one<span class="o">.</span>
<span class="linenos">11</span>c<span class="w"> </span>two<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>x<span class="w"> </span>two<span class="w"> </span>ko1<span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span>e<span class="w"> </span>ko2<span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 7, column 0, character 198:</span>
<span class="go"> Warning: constant x has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 11, column 0, character 240:</span>
<span class="go"> Warning: constant two has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 7, column 0, character 198:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 10, column 0, character 233:</span>
<span class="go"> Warning: constant one has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 15, column 0, character 260:</span>
<span class="go"> Warning: constant ko2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 13, column 0, character 248:</span>
<span class="go"> Warning: constant ko1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 7, column 0, character 198:</span>
<span class="go"> Warning:</span>
<span class="go"> constant e has no declared type. Did you mean std.exists std.exists2 std.map.private.empty std.set.private.empty std.set.elements std.set.private.elements std.loc.set.elements std.loc.set.equal std.loc.set.empty std.int.set.elements std.int.set.equal std.int.set.empty std.string.set.elements std.string.set.equal std.string.set.empty std.loc.map.empty std.int.map.empty std.string.map.empty ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut2.elpi&quot;, line 7, column 0, character 198:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.158</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% Test with q X; should yield X=ok</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>b<span class="kd">,</span><span class="w"> </span>c<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>a<span class="w"> </span>ko<span class="o">.</span>
<span class="linenos"> 6</span>a<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>b<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 9</span>b<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>c<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut3.elpi&quot;, line 3, column 0, character 36:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut3.elpi&quot;, line 5, column 0, character 57:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut3.elpi&quot;, line 3, column 0, character 36:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut3.elpi&quot;, line 3, column 0, character 36:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut3.elpi&quot;, line 3, column 0, character 36:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.133</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut4.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% Test: main. Should not fail.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.110</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut5.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">/* To test: query q X. The only answer should be X = ok. */</span>
<span class="linenos"> 2</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 3</span>q<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>a<span class="w"> </span>ko<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>d<span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>c<span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos"> 6</span>a<span class="w"> </span>two<span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>b<span class="w"> </span>three<span class="o">.</span>
<span class="linenos"> 9</span>b<span class="w"> </span>four<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>c<span class="w"> </span>four<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>d<span class="w"> </span>three<span class="o">.</span>
<span class="linenos">14</span>d<span class="w"> </span>four<span class="o">.</span>
<span class="linenos">15</span>
<span class="linenos">16</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 6, column 0, character 108:</span>
<span class="go"> Warning: constant two has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 8, column 0, character 116:</span>
<span class="go"> Warning: constant three has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 2, column 0, character 60:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 9, column 0, character 125:</span>
<span class="go"> Warning: constant four has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant d has no declared type. Did you mean std.debug-print std.drop std.drop-last std.do! std.do-ok! std.loc.set.diff std.int.set.diff std.string.set.diff ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 2, column 0, character 60:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut5.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning: Y is linear: name it _Y (discard) or Y_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.167</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/cut6.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% q X should yield X=ok</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 4</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>a<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>c<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>c<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 9</span>c<span class="w"> </span>ko<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>b<span class="w"> </span>ko<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut6.elpi&quot;, line 3, column 0, character 25:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut6.elpi&quot;, line 9, column 0, character 75:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut6.elpi&quot;, line 6, column 0, character 53:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut6.elpi&quot;, line 4, column 0, character 40:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/cut6.elpi&quot;, line 3, column 0, character 25:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.139</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/deep_indexing.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% select should only find 2 clauses (the last 2) since indexing at level 3 drops the others</span>
<span class="linenos"> 2</span><span class="c">% ./elpi -test tests/sources/deep_indexing.elpi -no-tc -trace-on -trace-at run 1 300 -trace-only select</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="kd">kind</span><span class="w"> </span><span class="nf">term</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 5</span><span class="kd">type</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 6</span><span class="kd">type</span><span class="w"> </span><span class="nf">g</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k k-Mode">:index</span><span class="w">(</span><span class="mi">3</span>)
<span class="linenos"> 9</span><span class="kd">pred</span><span class="w"> </span><span class="nf">find</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>.
<span class="linenos">10</span>find<span class="w"> </span>g<span class="o">.</span>
<span class="linenos">11</span>find<span class="w"> </span>(f<span class="w"> </span>g<span class="o">).</span>
<span class="linenos">12</span>find<span class="w"> </span>(f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>g<span class="o">)).</span>
<span class="linenos">13</span>find<span class="w"> </span>(f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>g<span class="o">))).</span>
<span class="linenos">14</span>find<span class="w"> </span>(f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>g<span class="o">)))).</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>find<span class="w"> </span>(f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>g<span class="o">))).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.117</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/discard.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>foo<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">_</span><span class="kd">,</span>
<span class="linenos">3</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="mi">4</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">_</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span><span class="nv">_Foo</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>bar<span class="kd">,</span>
<span class="linenos">7</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x </span>\<span class="w"> </span><span class="nv">_Foo</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>x<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/discard.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/discard.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant bar has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.120</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/elpi_only_llam.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span>(f<span class="w"> </span>x<span class="o">)</span><span class="w"> </span>f<span class="w"> </span>x<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/elpi_only_llam.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant x has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/elpi_only_llam.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/elpi_only_llam.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.124</span>
<span class="go">Fatal error: Unification problem outside the pattern fragment. ((Data.Term.App (f, (Data.Term.Const x), [])) == (Data.Term.AppUVar (</span>
<span class="go">   { Data.Term.contents = please extend this printer; uid_private = 41025 },</span>
<span class="go">   0,</span>
<span class="go">   [(Data.Term.UVar (</span>
<span class="go">       { Data.Term.contents = please extend this printer; uid_private = 41024</span>
<span class="go">         },</span>
<span class="go">       0, 0))</span>
<span class="go">     ]</span>
<span class="go">   ))) Pass -delay-problems-outside-pattern-fragment (elpi command line utility) or set delay_outside_fragment to true (Elpi_API) in order to delay (deprecated, for Teyjus compatibility).</span>
</pre></div>
</div>
<p><strong>../../tests/sources/end_comment.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="o">.</span>
<span class="linenos">2</span><span class="c">% foo </span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.118</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/eta.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>kind tm type.
<span class="linenos"> 2</span>type c (tm -&gt; A) -&gt; tm.
<span class="linenos"> 3</span>macro @ctx A :- c (_\ A). % to have depth &gt; 0 in unif
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>% to test the indexing
<span class="linenos"> 6</span>k1 (x\ g x).
<span class="linenos"> 7</span>k2 g.
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>%mode (foo i i).
<span class="linenos">10</span>pred foo i:(X -&gt; X), i:(X -&gt; X -&gt; X).
<span class="linenos">11</span>foo X (x1 \ (x2 \ X x2)) :- (print X).
<span class="linenos">12</span>%% Fails, but should output `y`
<span class="linenos">13</span>
<span class="linenos">14</span>main :-
<span class="linenos">15</span>  pi f y\
<span class="linenos">16</span>    % 4 branches in unif
<span class="linenos">17</span>    @ctx (x\ f x) = @ctx f,
<span class="linenos">18</span>    @ctx f = @ctx (x\ f x),
<span class="linenos">19</span>    @ctx (x\ f y x) = @ctx (f y),
<span class="linenos">20</span>    @ctx (f y) = @ctx (x\ f y x),
<span class="linenos">21</span>
<span class="linenos">22</span>    % put some uvar around
<span class="linenos">23</span>    @ctx (f (X y)) = @ctx (x\ f y x), print X,
<span class="linenos">24</span>    @ctx (x\ f y x) = @ctx (f (Y y)), print Y,
<span class="linenos">25</span>
<span class="linenos">26</span>    % index + adepth=2 &lt;&gt; bdepth=0
<span class="linenos">27</span>    k1 g,
<span class="linenos">28</span>    k2 (x\ g x),
<span class="linenos">29</span>    
<span class="linenos">30</span>    % regression #135
<span class="linenos">31</span>    foo y (x1 \ (x2 \ y x2))
<span class="linenos">32</span>.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta.elpi&quot;, line 7, column 0, character 129:</span>
<span class="go"> Warning: constant k2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta.elpi&quot;, line 6, column 0, character 116:</span>
<span class="go"> Warning: constant k1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta.elpi&quot;, line 6, column 0, character 116:</span>
<span class="go"> Warning: constant g has no declared type. Did you mean gc.get ?</span>
<span class="go">c2 \ c2</span>
<span class="go">c2 \ c2</span>
<span class="go">c1</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.127</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/eta_as.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>pred as_1 i:any.
<span class="linenos">  2</span>pred as_2 i:any.
<span class="linenos">  3</span>pred as_3 i:any.
<span class="linenos">  4</span>
<span class="linenos">  5</span>pred uvar_1 i:any.
<span class="linenos">  6</span>pred uvar_2 i:any.
<span class="linenos">  7</span>pred uvar_3 i:any.
<span class="linenos">  8</span>pred uvar_4 i:A.
<span class="linenos">  9</span>pred uvar_5 i:A.
<span class="linenos"> 10</span>pred uvar_6 i:A.
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>pred test-as.
<span class="linenos"> 13</span>pred test-uvar.
<span class="linenos"> 14</span>pred test-var.
<span class="linenos"> 15</span>pred test-declare-constraint.
<span class="linenos"> 16</span>
<span class="linenos"> 17</span>uvar_1 (bar (uvar K Args)) :- std.assert! (var K) &quot;uvar_1 bar X, not a var&quot;, print K Args.
<span class="linenos"> 18</span>uvar_2 (bar X) :- std.assert! (var X K Args) &quot;uvar_2 bar X, not a var&quot;, print K Args.
<span class="linenos"> 19</span>uvar_3 (uvar K) :- std.assert! (var K) &quot;uvar_3 X, not a var&quot;, print K.
<span class="linenos"> 20</span>uvar_4 (uvar K Args) :- std.assert! (var K) &quot;uvar_4 X, not a var&quot;, std.assert! (distinct_names Args) &quot;uvar_4 not in pattern&quot;.
<span class="linenos"> 21</span>uvar_5 (uvar K Args) :- std.assert! (var K) &quot;uvar_5 X, not a var&quot;, distinct_names Args.
<span class="linenos"> 22</span>
<span class="linenos"> 23</span>uvar_6 X :- fail.
<span class="linenos"> 24</span>uvar_6 (uvar as X) :- print X.
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>as_1 (bar (uvar as K)) :- std.assert! (var K) &quot;bar (uvar as_1 X), not a var&quot;, print K.
<span class="linenos"> 27</span>as_2 (uvar as K) :- std.assert! (var K) &quot;uvar as_2 X, not a var&quot;, print K.
<span class="linenos"> 28</span>as_3 (uvar as K) :- std.assert! (var K) &quot;uvar as_3 X, not a var&quot;, print K.
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>pred unif_1 o:A.
<span class="linenos"> 31</span>pred unif_2 o:A.
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>unif_1 (x\ X x).
<span class="linenos"> 34</span>unif_2 (x\ y\ X x y).
<span class="linenos"> 35</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span>tests-uvar :-
<span class="linenos"> 38</span>  print &quot;--------- uvar_1&quot;,
<span class="linenos"> 39</span>  not(uvar_1 (bar (x \ u))),
<span class="linenos"> 40</span>  print &quot;--------- uvar_2&quot;,
<span class="linenos"> 41</span>  (pi x \ (uvar_2 (bar (X x)))),
<span class="linenos"> 42</span>  print &quot;--------- uvar_3&quot;,
<span class="linenos"> 43</span>  not (uvar_3 (x \ X0)),
<span class="linenos"> 44</span>  print &quot;--------- uvar_3 bis&quot;,
<span class="linenos"> 45</span>  uvar_3 (x \ y\ X01 x y),
<span class="linenos"> 46</span>  print &quot;--------- uvar_4&quot;,
<span class="linenos"> 47</span>  uvar_4 X1,
<span class="linenos"> 48</span>  print &quot;--------- uvar_4 bis&quot;,
<span class="linenos"> 49</span>  not(uvar_4 (x \ X2)),
<span class="linenos"> 50</span>  print &quot;--------- uvar_4 ter&quot;,
<span class="linenos"> 51</span>  uvar_4 (x \ X3 x),
<span class="linenos"> 52</span>  print &quot;--------- uvar_4 quater&quot;,
<span class="linenos"> 53</span>  (pi u\ uvar_4 (x \ X4 u x)),
<span class="linenos"> 54</span>  print &quot;--------- uvar_5&quot;,
<span class="linenos"> 55</span>  not (uvar_5 (x \ X5 u x)),
<span class="linenos"> 56</span>  print &quot;--------- uvar_6&quot;,
<span class="linenos"> 57</span>  uvar_6 (x \ X6 x), var X6.
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>tests-as :-
<span class="linenos"> 60</span>  print &quot;---------- as_1&quot;,
<span class="linenos"> 61</span>  not(as_1 (x \ bar u)), % fails because (bar (uvar as K) x ==!== bar u)
<span class="linenos"> 62</span>  print &quot;---------- as_1 bis&quot;,
<span class="linenos"> 63</span>  not(as_1 (x \ bar u x)), % fails because u is not flexible (input mode)
<span class="linenos"> 64</span>  print &quot;---------- as_1 ter&quot;,
<span class="linenos"> 65</span>     (as_1 (x \ bar (X2 x) x)), % works but X2 is pruned
<span class="linenos"> 66</span>       (pi a\ var (X2 a) _ []), % assert pruning of X2
<span class="linenos"> 67</span>  print &quot;---------- as_2&quot;,
<span class="linenos"> 68</span>     (as_2 (x \ X1 x)) , % works
<span class="linenos"> 69</span>       (pi a\ var (X1 a) _ [a]), % assert X1 was not pruned
<span class="linenos"> 70</span>  print &quot;---------- as_3&quot;,
<span class="linenos"> 71</span>  not (as_3 (x \ X0)).
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>test-unif :-
<span class="linenos"> 74</span>    print &quot;---------- unif_1&quot;,
<span class="linenos"> 75</span>    unif_1 X,
<span class="linenos"> 76</span>    print &quot;---------- unif_1 bis&quot;,
<span class="linenos"> 77</span>    unif_1 (x\ X1 x),
<span class="linenos"> 78</span>    print &quot;---------- unif_1 ter&quot;,
<span class="linenos"> 79</span>    unif_1 (x\ y\ X2 x y),
<span class="linenos"> 80</span>    print &quot;---------- unif_2&quot;,
<span class="linenos"> 81</span>    unif_2 X3,
<span class="linenos"> 82</span>    print &quot;---------- unif_2 bis&quot;,
<span class="linenos"> 83</span>    unif_2 (x\ X4 x),
<span class="linenos"> 84</span>    print &quot;---------- unif_2 ter&quot;,
<span class="linenos"> 85</span>    unif_2 (x\ y\ X5 x y),
<span class="linenos"> 86</span>    print &quot;---------- unif_zero&quot;,
<span class="linenos"> 87</span>    (x\ X6 x) = X6.
<span class="linenos"> 88</span>
<span class="linenos"> 89</span>test-var :-
<span class="linenos"> 90</span>    print &quot;---------- var 1&quot;,
<span class="linenos"> 91</span>   pi x \ (var (y \ X x y)),
<span class="linenos"> 92</span>    print &quot;---------- var 2&quot;,
<span class="linenos"> 93</span>   pi x \ (var (y \ X c y)), 
<span class="linenos"> 94</span>    print &quot;---------- var 3&quot;,
<span class="linenos"> 95</span>   pi x z \ (var (y \ X x y)).
<span class="linenos"> 96</span>
<span class="linenos"> 97</span>test-declare-constraint :-
<span class="linenos"> 98</span>  declare_constraint false [x\ X x],
<span class="linenos"> 99</span>  not(X = 1).
<span class="linenos">100</span>
<span class="linenos">101</span>main :- tests-uvar, tests-as, test-unif, test-var, test-declare-constraint.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning:</span>
<span class="go"> constant u has no declared type. Did you mean std.unsafe-cast std.unzip std.loc.set.union std.int.set.union std.string.set.union ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: constant tests-uvar has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 59, column 0, character 1639:</span>
<span class="go"> Warning: constant tests-as has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: constant test-unif has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 89, column 0, character 2567:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 17, column 0, character 237:</span>
<span class="go"> Warning: constant bar has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 59, column 0, character 1639:</span>
<span class="go"> Error: (bar u) has type any but is applied to c3</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 97, column 0, character 2760:</span>
<span class="go"> Error: 1 has type int but is used with type (X26 c1 -&gt; X27)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 97, column 0, character 2760:</span>
<span class="go"> Error: 1 has type int but is used with type (X28 c1 -&gt; X29)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 23, column 0, character 700:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 33, column 0, character 1023:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 34, column 0, character 1040:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X5 is linear: name it _X5 (discard) or X5_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X4 is linear: name it _X4 (discard) or X4_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X3 is linear: name it _X3 (discard) or X3_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X2 is linear: name it _X2 (discard) or X2_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X1 is linear: name it _X1 (discard) or X1_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X01 is linear: name it _X01 (discard) or X01_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X0 is linear: name it _X0 (discard) or X0_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 37, column 0, character 1064:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 59, column 0, character 1639:</span>
<span class="go"> Warning: X0 is linear: name it _X0 (discard) or X0_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X5 is linear: name it _X5 (discard) or X5_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X4 is linear: name it _X4 (discard) or X4_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X3 is linear: name it _X3 (discard) or X3_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X2 is linear: name it _X2 (discard) or X2_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X1 is linear: name it _X1 (discard) or X1_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/eta_as.elpi&quot;, line 73, column 0, character 2170:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.165</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/even-odd.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">kind</span><span class="w"> </span><span class="nf">nat</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 2</span><span class="kd">type</span><span class="w"> </span><span class="nf">zero</span><span class="w"> </span><span class="kt">nat</span>.
<span class="linenos"> 3</span><span class="kd">type</span><span class="w"> </span><span class="nf">succ</span><span class="w"> </span><span class="kt">nat</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">nat</span>.
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">odd</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">nat</span>.
<span class="linenos"> 6</span><span class="kd">pred</span><span class="w"> </span><span class="nf">even</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">nat</span>.
<span class="linenos"> 7</span><span class="kd">pred</span><span class="w"> </span><span class="nf">double</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">nat</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">nat</span>.
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>even<span class="w"> </span>zero<span class="o">.</span>
<span class="linenos">10</span>odd<span class="w"> </span>(succ<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>even<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">11</span>even<span class="w"> </span>(succ<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>odd<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">12</span>even<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>var<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>declare_constraint<span class="w"> </span>(even<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos">13</span>odd<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>var<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>declare_constraint<span class="w"> </span>(odd<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span>double<span class="w"> </span>zero<span class="w"> </span>zero<span class="o">.</span>
<span class="linenos">16</span>double<span class="w"> </span>(succ<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(succ<span class="w"> </span><span class="o">(</span>succ<span class="w"> </span><span class="nv">Y</span><span class="o">))</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>double<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">17</span>double<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>var<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>declare_constraint<span class="w"> </span>(double<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos">18</span>
<span class="linenos">19</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>odd<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>not(<span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>zero<span class="o">)</span><span class="kd">,</span><span class="w"> </span>not(double<span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">even odd double </span>{
<span class="linenos">22</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(even<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(odd<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos">23</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(double<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(even<span class="w"> </span><span class="nv">Y</span><span class="o">).</span>
<span class="linenos">24</span>}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/even-odd.elpi&quot;, line 19, column 0, character 395:</span>
<span class="go"> Warning: Z is linear: name it _Z (discard) or Z_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.107</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> odd X0  /* suspended on X0 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/findall.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">p</span><span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos"> 2</span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span>
<span class="linenos"> 3</span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 4</span>p<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>test1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>std.findall<span class="w"> </span>(p<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span>p<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="kd">]</span><span class="o">.</span>
<span class="linenos"> 7</span>test2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>std.findall<span class="w"> </span>(p<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span>p<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="kd">],</span><span class="w"> </span>not(var<span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos"> 8</span>test3<span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">q</span>\
<span class="linenos">10</span><span class="w">    </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">11</span><span class="w">    </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">12</span><span class="w">    </span>q<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">13</span><span class="w">      </span>(std.findall<span class="w"> </span><span class="o">(</span>q<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="kd">],</span><span class="w"> </span>not<span class="w"> </span><span class="o">(</span>var<span class="w"> </span><span class="nv">X</span><span class="o">)).</span>
<span class="linenos">14</span>
<span class="linenos">15</span>
<span class="linenos">16</span>test4<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">17</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">q</span>\
<span class="linenos">18</span><span class="w">    </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">19</span><span class="w">    </span>q<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">20</span><span class="w">      </span>(std.findall<span class="w"> </span><span class="o">(</span>q<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span>q<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">Y</span><span class="kd">],</span><span class="w"> </span>not<span class="o">(</span>same_var<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)).</span>
<span class="linenos">21</span><span class="c">% this is super tricky but hard to implement differently.</span>
<span class="linenos">22</span><span class="c">% q _ _ -&gt; q A^1 B^1</span>
<span class="linenos">23</span><span class="c">% q A^1 B^1 == q 1 X0 --restrict--&gt; X0 := X1,  A1 := _\X1</span>
<span class="linenos">24</span><span class="c">% when we backtrack the &quot;restriction&quot; on X0 is lost</span>
<span class="linenos">25</span>
<span class="linenos">26</span>test5<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">27</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">q</span>\
<span class="linenos">28</span><span class="w">    </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">29</span><span class="w">    </span>q<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span>
<span class="linenos">30</span><span class="w">      </span>(std.findall<span class="w"> </span><span class="o">(</span>q<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">Z</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span>q<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">Y</span><span class="kd">],</span><span class="w"> </span>same_var<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">).</span>
<span class="linenos">31</span><span class="c">% this works because there is no restriction</span>
<span class="linenos">32</span>
<span class="linenos">33</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>test1<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">34</span><span class="w">        </span>test2<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="mi">2</span><span class="kd">,</span>
<span class="linenos">35</span><span class="w">        </span>test3<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="mi">3</span><span class="kd">,</span>
<span class="linenos">36</span><span class="w">        </span>test4<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="mi">4</span><span class="kd">,</span>
<span class="linenos">37</span><span class="w">        </span>test5<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="mi">5</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 26, column 0, character 577:</span>
<span class="go"> Warning: constant test5 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 16, column 0, character 281:</span>
<span class="go"> Warning: constant test4 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 8, column 0, character 159:</span>
<span class="go"> Warning: constant test3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 7, column 0, character 95:</span>
<span class="go"> Warning: constant test2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 6, column 0, character 43:</span>
<span class="go"> Warning: constant test1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 6, column 0, character 43:</span>
<span class="go"> Warning: B is linear: name it _B (discard) or B_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 6, column 0, character 43:</span>
<span class="go"> Warning: A is linear: name it _A (discard) or A_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/findall.elpi&quot;, line 26, column 0, character 577:</span>
<span class="go"> Warning: Z is linear: name it _Z (discard) or Z_ (fresh variable)</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">4</span>
<span class="go">5</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.132</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/fragment_exit.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>q<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">d</span>\<span class="w"> </span>r<span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>r<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span>q<span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>c<span class="w"> </span>x<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit.elpi&quot;, line 5, column 0, character 25:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.128</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/fragment_exit2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>ignore<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">2</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span><span class="nv">Y</span><span class="w"> </span>c<span class="w"> </span><span class="kd">=</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>c<span class="w"> </span>x<span class="o">)</span><span class="kd">,</span><span class="w"> </span>ignore<span class="w"> </span>(<span class="nv">Y</span><span class="w"> </span>c<span class="w"> </span>d<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant ignore has no declared type. Did you mean std.ignore-failure! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit2.elpi&quot;, line 2, column 0, character 10:</span>
<span class="go"> Warning:</span>
<span class="go"> constant d has no declared type. Did you mean std.debug-print std.drop std.drop-last std.do! std.do-ok! std.loc.set.diff std.int.set.diff std.string.set.diff ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit2.elpi&quot;, line 2, column 0, character 10:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.117</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/fragment_exit3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>ignore<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">2</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">Y</span>\<span class="w"> </span><span class="nv">X</span><span class="w"> </span>c<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>ignore<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="o">(</span>f<span class="w"> </span>d<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit3.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant ignore has no declared type. Did you mean std.ignore-failure! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit3.elpi&quot;, line 2, column 0, character 10:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/fragment_exit3.elpi&quot;, line 2, column 0, character 10:</span>
<span class="go"> Warning:</span>
<span class="go"> constant d has no declared type. Did you mean std.debug-print std.drop std.drop-last std.do! std.do-ok! std.loc.set.diff std.int.set.diff std.string.set.diff ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.119</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/general_case.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>app<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span><span class="w"> </span>
<span class="linenos">2</span>c<span class="o">.</span>
<span class="linenos">3</span>ignore<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">4</span>foo<span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">d</span>\<span class="w"> </span>ignore<span class="w"> </span><span class="nv">P</span><span class="o">.</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>app<span class="w"> </span>(<span class="nv">x\</span>x<span class="o">)</span><span class="w"> </span>c<span class="kd">,</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(<span class="nv">y\</span>y<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span>c<span class="kd">,</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">d</span>\<span class="w"> </span><span class="nv">F</span><span class="w"> </span>c<span class="o">)</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">        </span>foo<span class="w"> </span>(<span class="nv">G</span><span class="w"> </span>c<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case.elpi&quot;, line 3, column 0, character 20:</span>
<span class="go"> Warning:</span>
<span class="go"> constant ignore has no declared type. Did you mean std.ignore-failure! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case.elpi&quot;, line 4, column 0, character 30:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case.elpi&quot;, line 2, column 0, character 17:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant app has no declared type. Did you mean std.append std.appendR ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case.elpi&quot;, line 5, column 0, character 55:</span>
<span class="go"> Warning: G is linear: name it _G (discard) or G_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.127</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/general_case2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>p<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>c<span class="w"> </span>x<span class="o">).</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>c<span class="w"> </span>x<span class="o">).</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="w"> </span>(<span class="nv">y\</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">z</span>\<span class="w"> </span>q<span class="w"> </span>y<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case2.elpi&quot;, line 3, column 0, character 20:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.117</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/general_case3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">X</span>\<span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">d</span>\<span class="w"> </span><span class="o">(</span><span class="nv">X</span><span class="w"> </span>d<span class="w"> </span><span class="kd">=</span><span class="w"> </span>f<span class="w"> </span>c<span class="w"> </span>d<span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span>c<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X</span><span class="o">))</span><span class="kd">,</span>
<span class="linenos">3</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">c\</span><span class="w"> </span><span class="nv">d\</span><span class="w"> </span>f<span class="w"> </span>c<span class="w"> </span>d<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/general_case3.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.111</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/hc_interp.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">/*</span>
<span class="linenos"> 2</span><span class="w"> </span><span class="kd">*</span><span class="w"> </span><span class="nv">An</span><span class="w"> </span>interpreter<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>logic<span class="w"> </span>of<span class="w"> </span><span class="nv">Horn</span><span class="w"> </span>clauses<span class="o">.</span><span class="w"> </span><span class="nv">This</span><span class="w"> </span>code<span class="w"> </span>illustrates<span class="w"> </span>
<span class="linenos"> 3</span><span class="w"> </span><span class="kd">*</span><span class="w"> </span>the<span class="w"> </span>usefulness<span class="w"> </span>of<span class="w"> </span>beta<span class="w"> </span>reduction<span class="w"> </span>in<span class="w"> </span>realizing<span class="w"> </span>substitution<span class="o">.</span><span class="w"> </span><span class="nv">Also</span><span class="w"> </span>note
<span class="linenos"> 4</span><span class="w"> </span><span class="kd">*</span><span class="w"> </span>the<span class="w"> </span>use<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>logic<span class="w"> </span>variable<span class="w"> </span>in<span class="w"> </span>the<span class="w"> </span>third<span class="w"> </span>clause<span class="w"> </span>for<span class="w"> </span>try_clause<span class="o">.</span>
<span class="linenos"> 5</span><span class="w"> </span><span class="kd">*/</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c">%module  hc_interp.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c">%accumulate lists.</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c">%reduce (app (lam F) T) R :- pi x\ copy x T =&gt; copy (F x) (R&#39; x), R = R&#39; x.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>copy<span class="w"> </span>(and<span class="w"> </span><span class="nv">B1</span><span class="w"> </span><span class="nv">C1</span><span class="o">)</span><span class="w"> </span>(and<span class="w"> </span><span class="nv">B2</span><span class="w"> </span><span class="nv">C2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B1</span><span class="w"> </span><span class="nv">B2</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">C1</span><span class="w"> </span><span class="nv">C2</span><span class="o">.</span>
<span class="linenos">14</span>copy<span class="w"> </span>(or<span class="w"> </span><span class="nv">B1</span><span class="w"> </span><span class="nv">C1</span><span class="o">)</span><span class="w"> </span>(or<span class="w"> </span><span class="nv">B2</span><span class="w"> </span><span class="nv">C2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B1</span><span class="w"> </span><span class="nv">B2</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">C1</span><span class="w"> </span><span class="nv">C2</span><span class="o">.</span>
<span class="linenos">15</span>copy<span class="w"> </span>(box<span class="w"> </span><span class="nv">F1</span><span class="o">)</span><span class="w"> </span>(box<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>(<span class="nv">F1</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos">16</span>copy<span class="w"> </span>a<span class="w"> </span>a<span class="o">.</span>
<span class="linenos">17</span>copy<span class="w"> </span>b<span class="w"> </span>b<span class="o">.</span>
<span class="linenos">18</span>copy<span class="w"> </span>c<span class="w"> </span>c<span class="o">.</span>
<span class="linenos">19</span>copy<span class="w"> </span>(f<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(f<span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">20</span>copy<span class="w"> </span>tru<span class="w"> </span>tru<span class="o">.</span>
<span class="linenos">21</span>copy<span class="w"> </span>perp<span class="w"> </span>perp<span class="o">.</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="c">% a[t/b] = a</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="c">% b[t/b] = t</span>
<span class="linenos">26</span>
<span class="linenos">27</span>subst<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">B1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>(copy<span class="w"> </span><span class="o">(</span><span class="nv">B</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="nv">B2</span><span class="w"> </span>x<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">B2</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">B1</span><span class="o">).</span>
<span class="linenos">28</span><span class="w"> </span>
<span class="linenos">29</span><span class="c">% perp is a fail.</span>
<span class="linenos">30</span><span class="c">% hc_interp Cs G means Cs |- G</span>
<span class="linenos">31</span><span class="c">%hc_interp _ tru.</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c">%hc_interp Cs (box B) :- !, hc_interp Cs (B T).</span>
<span class="linenos">34</span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(box<span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>subst<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">B1</span><span class="kd">,</span><span class="w"> </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos">35</span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(and<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">,</span><span class="w"> </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">C</span><span class="o">.</span>
<span class="linenos">36</span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(or<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>(hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">;</span><span class="w"> </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">C</span><span class="o">).</span>
<span class="linenos">37</span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">A</span><span class="w">  </span><span class="kd">:-</span><span class="w">  </span>backchain<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">38</span><span class="c">% why there is no rule in teyjus: hc_interp Cs (all B) :- .... ?</span>
<span class="linenos">39</span>
<span class="linenos">40</span>backchain<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>memb<span class="w"> </span><span class="nv">D</span><span class="w"> </span><span class="nv">Cs</span><span class="kd">,</span><span class="w"> </span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">D</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">41</span>
<span class="linenos">42</span>memb<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">_</span><span class="o">).</span>
<span class="linenos">43</span>memb<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>memb<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos">44</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="c">% try_clause Cs A B means Cs, A |- B</span>
<span class="linenos">47</span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(and<span class="w"> </span><span class="nv">D1</span><span class="w"> </span><span class="nv">D2</span><span class="o">)</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>
<span class="linenos">48</span><span class="w">     </span><span class="kd">!,</span><span class="w"> </span>(try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">D1</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">;</span><span class="w"> </span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">D2</span><span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos">49</span><span class="c">% try_clause Cs (all D) A :- !, try_clause Cs (D T) A.</span>
<span class="linenos">50</span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">D</span><span class="o">)</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>subst<span class="w"> </span><span class="nv">D</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">D1</span><span class="kd">,</span><span class="w"> </span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">D1</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">51</span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">52</span>try_clause<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(imp<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="nv">G</span><span class="o">.</span>
<span class="linenos">53</span>
<span class="linenos">54</span><span class="c">%prog (xcons (adj a b) (xcons (adj b c) (xcons (adj c (f c))</span>
<span class="linenos">55</span><span class="c">%      (xcons (all X\ (all Y\ (imp (adj X Y) (path X Y))))</span>
<span class="linenos">56</span><span class="c">%      (xcons (all X\ (all Y\ (all Z\ (imp (and (adj X Y) (path Y Z)) </span>
<span class="linenos">57</span><span class="c">%                                           (path X Z))))) xnil))))).</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="c">%pathfroma X :- prog Cs, hc_interp Cs (path a X).</span>
<span class="linenos">60</span>
<span class="linenos">61</span>test1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="c">%Cs = (xcons a (xcons b (xcons c xnil))),</span>
<span class="linenos">62</span><span class="w">        </span><span class="c">%try_clause Cs (and a (or b c)) (or (and a b) (and a c)).</span>
<span class="linenos">63</span><span class="w">        </span>hc_interp<span class="w"> </span>(xcons<span class="w"> </span>a<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span><span class="o">(</span>imp<span class="w"> </span>b<span class="w"> </span>c<span class="o">)</span><span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span><span class="o">(</span>imp<span class="w"> </span>a<span class="w"> </span>b<span class="o">)</span><span class="w"> </span>xnil<span class="o">)))</span><span class="w"> </span>c<span class="o">.</span>
<span class="linenos">64</span>
<span class="linenos">65</span>test2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">Cs</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>xcons<span class="w"> </span>(f<span class="w"> </span>a<span class="o">)</span><span class="w"> </span>xnil<span class="kd">,</span><span class="w"> </span>
<span class="linenos">66</span><span class="w">        </span>hc_interp<span class="w"> </span><span class="nv">Cs</span><span class="w"> </span>(box<span class="w"> </span>f<span class="o">).</span>
<span class="linenos">67</span>
<span class="linenos">68</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>test1<span class="kd">,</span><span class="w"> </span>test2<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 61, column 0, character 1823:</span>
<span class="go"> Warning: constant xnil has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 42, column 0, character 1152:</span>
<span class="go"> Warning: constant xcons has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 40, column 0, character 1103:</span>
<span class="go"> Warning: constant try_clause has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 20, column 0, character 574:</span>
<span class="go"> Warning: constant tru has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 65, column 0, character 2013:</span>
<span class="go"> Warning: constant test2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 61, column 0, character 1823:</span>
<span class="go"> Warning: constant test1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 27, column 0, character 633:</span>
<span class="go"> Warning: constant subst has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 21, column 0, character 588:</span>
<span class="go"> Warning: constant perp has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 14, column 0, character 396:</span>
<span class="go"> Warning: constant or has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 40, column 0, character 1103:</span>
<span class="go"> Warning: constant memb has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 68, column 0, character 2077:</span>
<span class="go"> Warning: [suppressing 12 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 34, column 0, character 817:</span>
<span class="go"> Warning: T is linear: name it _T (discard) or T_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 43, column 0, character 1172:</span>
<span class="go"> Warning: Y is linear: name it _Y (discard) or Y_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 50, column 0, character 1381:</span>
<span class="go"> Warning: T is linear: name it _T (discard) or T_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hc_interp.elpi&quot;, line 51, column 0, character 1445:</span>
<span class="go"> Warning: Cs is linear: name it _Cs (discard) or Cs_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.167</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/hdclause.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">kind</span><span class="w"> </span><span class="nf">foo</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kd">type</span><span class="w"> </span><span class="nf">a</span><span class="w"> </span><span class="kt">((int</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo</span>.
<span class="linenos"> 4</span><span class="kd">type</span><span class="w"> </span><span class="nf">b</span><span class="w"> </span><span class="kt">foo</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo</span>.
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kd">type</span><span class="w"> </span><span class="nf">p</span><span class="w"> </span><span class="kt">(foo</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos"> 7</span><span class="kd">type</span><span class="w"> </span><span class="nf">q</span><span class="w"> </span><span class="kt">(foo</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">foo</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>p<span class="w"> </span><span class="nv">K</span><span class="w"> </span>(a<span class="w"> </span><span class="nv">f\</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="mi">0</span><span class="o">)).</span>
<span class="linenos">10</span>q<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(a<span class="w"> </span><span class="nv">f\</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="mi">0</span><span class="o">)).</span>
<span class="linenos">11</span>
<span class="linenos">12</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">13</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\<span class="w"> </span>p<span class="w"> </span>b<span class="w"> </span><span class="o">(</span><span class="nv">F</span><span class="w"> </span>y<span class="o">))</span><span class="kd">,</span>
<span class="linenos">14</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\<span class="w"> </span>q<span class="w"> </span>b<span class="w"> </span><span class="o">(</span><span class="nv">F</span><span class="w"> </span>y<span class="o">))</span><span class="kd">,</span>
<span class="linenos">15</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span>q<span class="w"> </span>b<span class="w"> </span><span class="o">(</span><span class="nv">F</span><span class="w"> </span>y<span class="o">))</span><span class="kd">,</span>
<span class="linenos">16</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span>p<span class="w"> </span>b<span class="w"> </span><span class="o">(</span><span class="nv">F</span><span class="w"> </span>y<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.105</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/heap_discard.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">,</span><span class="mi">2</span><span class="kd">],</span>
<span class="linenos">3</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="mi">1</span><span class="kd">,</span><span class="mi">2</span><span class="kd">],</span>
<span class="linenos">4</span><span class="w">  </span>not(<span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="mi">2</span><span class="kd">,</span><span class="mi">2</span><span class="kd">]</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">a b</span>\<span class="w"> </span><span class="nv">Y</span><span class="w"> </span>b<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">],</span><span class="w"> </span>b<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">_</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/heap_discard.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: Y is linear: name it _Y (discard) or Y_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.106</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/ho.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q(a): OK; q(b): FAIL; q(X): exception; q(a,a): OK; q(true): OK.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q(<span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>a<span class="o">.</span>
<span class="linenos">6</span>
<span class="linenos">7</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span>a<span class="kd">,</span><span class="w"> </span>q<span class="w"> </span>(a<span class="kd">,</span>a<span class="o">)</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span>true<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ho.elpi&quot;, line 3, column 0, character 67:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/ho.elpi&quot;, line 5, column 0, character 79:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.108</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/hollight.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">   1</span>/* Untrusted predicates called from the kernel:
<span class="linenos">   2</span> * next_object            next object to check
<span class="linenos">   3</span> * callback_proved        proof completed
<span class="linenos">   4</span> * next_tactic            next tactic to use
<span class="linenos">   5</span> * update_certificate     get new certificate after tactic application
<span class="linenos">   6</span> * end_of_proof           is the certificate/proof empty?
<span class="linenos">   7</span> * ppterm                 for pretty-printing messages
<span class="linenos">   8</span> * deftac                 tactic definition
<span class="linenos">   9</span> */
<span class="linenos">  10</span>
<span class="linenos">  11</span>/* Predicates exported from the trusted library:
<span class="linenos">  12</span> * append
<span class="linenos">  13</span> * fold2_append
<span class="linenos">  14</span> * put_binds
<span class="linenos">  15</span> */
<span class="linenos">  16</span> 
<span class="linenos">  17</span>/* Predicates exported from the kernel:
<span class="linenos">  18</span> * proves
<span class="linenos">  19</span> * check
<span class="linenos">  20</span> */
<span class="linenos">  21</span>
<span class="linenos">  22</span>{ /***** Trusted code base *******/
<span class="linenos">  23</span>
<span class="linenos">  24</span>/***** Trusted library functions *****/
<span class="linenos">  25</span>
<span class="linenos">  26</span>/* The names with &#39; at the end are trusted; the ones without are
<span class="linenos">  27</span>   exported and therefore untrusted. */
<span class="linenos">  28</span>local append&#39;, fold2_append&#39;, put_binds&#39;.
<span class="linenos">  29</span>
<span class="linenos">  30</span>append&#39; [] L L.
<span class="linenos">  31</span>append&#39; [ X | XS ] L [ X | RES ] :- append&#39; XS L RES.
<span class="linenos">  32</span>append A B C :- append&#39; A B C.
<span class="linenos">  33</span>
<span class="linenos">  34</span>fold2_append&#39; [] [] _ [].
<span class="linenos">  35</span>fold2_append&#39; [ X | XS ] [ Y | YS ] F OUTS :-
<span class="linenos">  36</span> F X Y OUT, fold2_append&#39; XS YS F OUTS2, append&#39; OUT OUTS2 OUTS.
<span class="linenos">  37</span>fold2_append A B C D :- fold2_append&#39; A B C D.
<span class="linenos">  38</span>
<span class="linenos">  39</span>% put_binds : list &#39;b -&gt; &#39;a -&gt; &#39;c -&gt; list (bounded &#39;b) -&gt; o
<span class="linenos">  40</span>% put_binds [ f1,...,fn ] x t [ bind t x \ f1,...,bind t x fn ]
<span class="linenos">  41</span>% binding all the xs that occur in f1,...,fn
<span class="linenos">  42</span>put_binds&#39; [] _ _ [].
<span class="linenos">  43</span>put_binds&#39; [ YX | YSX ] X A [ bind A Y | YYS ] :-
<span class="linenos">  44</span> YX = Y X, put_binds&#39; YSX X A YYS.
<span class="linenos">  45</span>put_binds A B C D :- put_binds&#39; A B C D.
<span class="linenos">  46</span>
<span class="linenos">  47</span>/***** The HOL kernel *****/
<span class="linenos">  48</span>
<span class="linenos">  49</span>local thm, provable, def0, term, typ, typ&#39;, loop, prove, check1,
<span class="linenos">  50</span> check1def, check1thm, check1axm, check1nbt,
<span class="linenos">  51</span> reterm, not_defined, check_hyps.
<span class="linenos">  52</span>
<span class="linenos">  53</span>proves T TY :- provable T TY.
<span class="linenos">  54</span>
<span class="linenos">  55</span>typ T :- !. % this line temporarily drops checking of well-formedness for types
<span class="linenos">  56</span>            % to avoid too much slow down. It is ultimately due to re-typing
<span class="linenos">  57</span>            % terms that should be recognized as already well typed.
<span class="linenos">  58</span>typ T :- var T, !, declare_constraint (typ T) [ T ].
<span class="linenos">  59</span>typ T :- typ&#39; T.
<span class="linenos">  60</span>typ&#39; prop.
<span class="linenos">  61</span>typ&#39; (univ ## A ## B) :- typ A, typ B.
<span class="linenos">  62</span>typ&#39; (A --&gt; B) :- typ A, typ B.
<span class="linenos">  63</span>typ&#39; (disj_union ## A ## B) :- typ A, typ B.
<span class="linenos">  64</span>
<span class="linenos">  65</span>mode (term i o).
<span class="linenos">  66</span>term (lam A F) (A --&gt; B) :- typ A, pi x\ term x A =&gt; term (F x) B.
<span class="linenos">  67</span>term (F # T) B :- term F (A --&gt; B), term T A.
<span class="linenos">  68</span>term (eq ## A) (A --&gt; A --&gt; prop) :- typ A.
<span class="linenos">  69</span>term (uvar as T) TY :- declare_constraint (term T TY) T.
<span class="linenos">  70</span>
<span class="linenos">  71</span>/* like term, but on terms that are already known to be well-typed */
<span class="linenos">  72</span>mode (reterm i o).
<span class="linenos">  73</span>reterm (lam A F) (A --&gt; B) :- pi x\ reterm x A =&gt; reterm (F x) B.
<span class="linenos">  74</span>reterm (F # T) B :- reterm F (A --&gt; B).
<span class="linenos">  75</span>reterm (eq ## A) (A --&gt; A --&gt; prop).
<span class="linenos">  76</span>reterm (uvar as T) TY :- declare_constraint (reterm T TY) T.
<span class="linenos">  77</span>
<span class="linenos">  78</span>constraint term reterm { /* No propagation rules for now */}
<span class="linenos">  79</span>
<span class="linenos">  80</span>% thm : bounded tactic -&gt; bounded sequent -&gt; list (bounded sequent) -&gt; o
<span class="linenos">  81</span>thm C (seq Gamma G) _ :- debug, print Gamma &quot;|- &quot; G &quot; := &quot; C, fail.
<span class="linenos">  82</span>
<span class="linenos">  83</span>/* &lt;&lt; HACKS FOR DEBUGGING */
<span class="linenos">  84</span>thm daemon (seq Gamma F) [].
<span class="linenos">  85</span>/* &gt;&gt; HACKS FOR DEBUGGING */
<span class="linenos">  86</span>
<span class="linenos">  87</span>thm r (seq Gamma (eq ## _ # X # X)) [].
<span class="linenos">  88</span>thm (t Y) (seq Gamma (eq ## A # X # Z))
<span class="linenos">  89</span> [ seq Gamma (eq ## A # X # Y), seq Gamma (eq ## A # Y # Z) ] :- term Y A.
<span class="linenos">  90</span>thm (m P) (seq Gamma Q) [ seq Gamma (eq ## prop # P # Q), seq Gamma P ] :- term P prop.
<span class="linenos">  91</span>thm b (seq Gamma (eq ## _ # ((lam _ F) # X) # (F X))) [].
<span class="linenos">  92</span>thm c (seq Gamma (eq ## B # (F # X) # (G # Y)))
<span class="linenos">  93</span> [ seq Gamma (eq ## (A --&gt; B) # F # G) , seq Gamma (eq ## A # X # Y) ] :- reterm X A, reterm Y A.
<span class="linenos">  94</span>thm k (seq Gamma (eq ## (A --&gt; B) # (lam A S) # (lam A T)))
<span class="linenos">  95</span> [ bind A x \ seq Gamma (eq ## B # (S x) # (T x)) ].
<span class="linenos">  96</span>thm s (seq Gamma (eq ## prop # P # Q)) [ seq (P :: Gamma) Q, seq (Q :: Gamma) P ].
<span class="linenos">  97</span>thm (h IGN) (seq Gamma P) [] :- append&#39; IGN [ P | Gamma2 ] Gamma.
<span class="linenos">  98</span>
<span class="linenos">  99</span>thm d (seq Gamma (eq ## _ # C # A)) [] :- def0 C A.
<span class="linenos"> 100</span>thm (th NAME) (seq _ G) [] :- provable NAME G.
<span class="linenos"> 101</span>
<span class="linenos"> 102</span>thm (thenll TAC1 TACN) SEQ SEQS :-
<span class="linenos"> 103</span> thm TAC1 SEQ NEW,
<span class="linenos"> 104</span> deftacl TACN NEW TACL,
<span class="linenos"> 105</span> fold2_append&#39; TACL NEW thm SEQS.
<span class="linenos"> 106</span>
<span class="linenos"> 107</span>/*debprint _ (then _ _) :- !.
<span class="linenos"> 108</span>debprint _ (thenl _ _) :- !.
<span class="linenos"> 109</span>debprint O T :- print O T.*/
<span class="linenos"> 110</span>
<span class="linenos"> 111</span>thm TAC SEQ SEQS :-
<span class="linenos"> 112</span> deftac TAC SEQ XTAC,
<span class="linenos"> 113</span> /*debprint &quot;&lt;&lt;&quot; TAC,
<span class="linenos"> 114</span> (*/ thm XTAC SEQ SEQS /*, debprint &quot;&gt;&gt;&quot; TAC
<span class="linenos"> 115</span> ; debprint &quot;XX&quot; TAC, fail)*/.
<span class="linenos"> 116</span>
<span class="linenos"> 117</span>thm (! TAC) SEQ SEQS :-
<span class="linenos"> 118</span> thm TAC SEQ SEQS,
<span class="linenos"> 119</span> !.
<span class="linenos"> 120</span>
<span class="linenos"> 121</span>thm id SEQ [ SEQ ].
<span class="linenos"> 122</span>
<span class="linenos"> 123</span>thm (wl Gamma1) (seq Gamma F) [ seq WGamma F ] :-
<span class="linenos"> 124</span> append&#39; Gamma1 [ P | Gamma2 ] Gamma,
<span class="linenos"> 125</span> append&#39; Gamma1 Gamma2 WGamma.
<span class="linenos"> 126</span>
<span class="linenos"> 127</span>thm (bind A TAC) (bind A SEQ) NEWL :-
<span class="linenos"> 128</span> pi x \ term x A =&gt; reterm x A =&gt; thm (TAC x) (SEQ x) (NEW x), put_binds&#39; (NEW x) x A NEWL.
<span class="linenos"> 129</span>
<span class="linenos"> 130</span>thm ww (bind A x \ SEQ) [ SEQ ].
<span class="linenos"> 131</span>
<span class="linenos"> 132</span>/* debuggin only, remove it */
<span class="linenos"> 133</span>%thm A B C :- print &quot;FAILED &quot; (thm A B C), fail.
<span class="linenos"> 134</span>
<span class="linenos"> 135</span>% loop : list (bounded sequent) -&gt; certificate -&gt; o
<span class="linenos"> 136</span>%loop SEQS TACS :- print &quot;LOOP&quot; (loop SEQS TACS), fail.
<span class="linenos"> 137</span>loop [] CERTIFICATE :- end_of_proof CERTIFICATE.
<span class="linenos"> 138</span>loop [ SEQ | OLD ] CERTIFICATE :-
<span class="linenos"> 139</span> next_tactic [ SEQ | OLD ] CERTIFICATE ITAC,
<span class="linenos"> 140</span> thm ITAC SEQ NEW,
<span class="linenos"> 141</span> append&#39; NEW OLD SEQS,
<span class="linenos"> 142</span> update_certificate CERTIFICATE ITAC NEW NEW_CERTIFICATE,
<span class="linenos"> 143</span> loop SEQS NEW_CERTIFICATE.
<span class="linenos"> 144</span>
<span class="linenos"> 145</span>prove G TACS :-
<span class="linenos"> 146</span> (term G prop, ! ; ppterm PG G, print &quot;Bad statement:&quot; PG, fail),
<span class="linenos"> 147</span>% (TACS = (false,_), ! ;
<span class="linenos"> 148</span> loop [ seq [] G ] TACS
<span class="linenos"> 149</span>. % ).
<span class="linenos"> 150</span>
<span class="linenos"> 151</span>not_defined P NAME :-
<span class="linenos"> 152</span> not (P NAME _) ; print &quot;Error:&quot; NAME already defined, fail.
<span class="linenos"> 153</span>
<span class="linenos"> 154</span>check_hyps HS (typ&#39; TYPE) :-
<span class="linenos"> 155</span> (not (typ&#39; TYPE) ; print &quot;Error:&quot; TYPE already defined, fail), print HS new TYPE.
<span class="linenos"> 156</span>check_hyps HS (def0 NAME DEF) :- ppterm PDEF DEF, print HS NAME &quot;=&quot; PDEF.
<span class="linenos"> 157</span>check_hyps HS (term NAME TYPE) :-
<span class="linenos"> 158</span> not_defined term NAME, ppterm PTYPE TYPE, print HS NAME &quot;:&quot; PTYPE.
<span class="linenos"> 159</span>check_hyps HS (reterm _ _).
<span class="linenos"> 160</span>check_hyps HS (provable NAME TYPE) :-
<span class="linenos"> 161</span> not_defined provable NAME, ppterm PTYPE TYPE, print HS NAME &quot;:&quot; PTYPE.
<span class="linenos"> 162</span>check_hyps HS (H1,H2) :- check_hyps HS H1, check_hyps HS H2.
<span class="linenos"> 163</span>check_hyps HS (pi H) :- pi x \ typ&#39; x =&gt; check_hyps [x | HS] (H x).
<span class="linenos"> 164</span>check_hyps HS (_ =&gt; H2) :- check_hyps HS H2.
<span class="linenos"> 165</span>
<span class="linenos"> 166</span>/* check1 I O
<span class="linenos"> 167</span>   checks the declaration I
<span class="linenos"> 168</span>   returns the new assumption O */
<span class="linenos"> 169</span>check1 (theorem NAME GOALTACTICS) HYPS :- check1thm NAME GOALTACTICS HYPS, !.
<span class="linenos"> 170</span>check1 (axiom NAME ST) HYPS :- check1axm NAME ST HYPS, !.
<span class="linenos"> 171</span>check1 (new_basic_type TYPE REP ABS REPABS ABSREP PREPH P_TACTICS) HYPS :- check1nbt TYPE REP ABS REPABS ABSREP PREPH P_TACTICS true HYPS, !.
<span class="linenos"> 172</span>check1 (def NAME TYPDEF) HYPS :- check1def NAME TYPDEF true HYPS, !.
<span class="linenos"> 173</span>check1 (decl NAME TYP) HYPS :- check1decl NAME TYP true HYPS, !.
<span class="linenos"> 174</span>
<span class="linenos"> 175</span>check1def NAME (pi I) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 176</span> pi x \ typ&#39; x =&gt; check1def (NAME ## x) (I x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 177</span>check1def NAME (TYP,DEF) HYPSUCHTHAT HYPS :-
<span class="linenos"> 178</span> typ TYP, term DEF TYP,
<span class="linenos"> 179</span> HYPS = ((HYPSUCHTHAT =&gt; term NAME TYP), reterm NAME TYP, def0 NAME DEF).
<span class="linenos"> 180</span>
<span class="linenos"> 181</span>check1decl NAME (pi I) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 182</span> pi x \ typ&#39; x =&gt; check1decl (NAME ## x) (I x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 183</span>check1decl NAME TYP HYPSUCHTHAT HYPS :-
<span class="linenos"> 184</span> typ TYP, HYPS = ((HYPSUCHTHAT =&gt; term NAME TYP), reterm NAME TYP).
<span class="linenos"> 185</span>
<span class="linenos"> 186</span>check1thm NAME (pi I) (pi HYPS) :-
<span class="linenos"> 187</span> pi x \ typ&#39; x =&gt; check1thm NAME (I x) (HYPS x).
<span class="linenos"> 188</span>check1thm NAME (GOAL,TACTICS) (provable NAME GOAL) :-
<span class="linenos"> 189</span>  prove GOAL TACTICS,
<span class="linenos"> 190</span>  callback_proved NAME GOAL TACTICS.
<span class="linenos"> 191</span>
<span class="linenos"> 192</span>check1axm NAME (pi I) (pi HYPS) :- !,
<span class="linenos"> 193</span> pi x \ typ&#39; x =&gt; check1axm NAME (I x) (HYPS x).
<span class="linenos"> 194</span>check1axm NAME GOAL (provable NAME GOAL) :-
<span class="linenos"> 195</span> term GOAL prop, ! ; ppterm PGOAL GOAL, print &quot;Bad statement:&quot; PGOAL, fail.
<span class="linenos"> 196</span>
<span class="linenos"> 197</span>check1nbt TYPE REP ABS REPABS ABSREP PREPH (pi P_TACTICS) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 198</span> pi x \ typ&#39; x =&gt; check1nbt (TYPE ## x) (REP ## x) (ABS ## x) REPABS ABSREP PREPH (P_TACTICS x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 199</span>check1nbt TYPE REP ABS REPABS ABSREP PREPH (P,TACTICS) HYPSUCHTHAT HYPS :-
<span class="linenos"> 200</span>  term P (X --&gt; prop),
<span class="linenos"> 201</span>  prove (exists ## _ # P ) TACTICS,
<span class="linenos"> 202</span>  callback_proved existence_condition (exists ## _ # P) TACTICS,
<span class="linenos"> 203</span>  REPTYP = (TYPE --&gt; X),
<span class="linenos"> 204</span>  ABSTYP = (X --&gt; TYPE),
<span class="linenos"> 205</span>  ABSREPTYP = (forall ## TYPE # lam TYPE x \ eq ## TYPE # (ABS # (REP # x)) # x),
<span class="linenos"> 206</span>  REPABSTYP = (forall ## X # lam X x \ impl # (P # x) # (eq ## X # (REP # (ABS # x)) # x)),
<span class="linenos"> 207</span>  PREPHTYP = (forall ## TYPE # lam TYPE x \ (P # (REP # x))),
<span class="linenos"> 208</span>  !,
<span class="linenos"> 209</span>  HYPS =
<span class="linenos"> 210</span>   ( (HYPSUCHTHAT =&gt; typ&#39; TYPE)
<span class="linenos"> 211</span>   , (HYPSUCHTHAT =&gt; term REP REPTYP), reterm REP REPTYP
<span class="linenos"> 212</span>   , (HYPSUCHTHAT =&gt; term ABS ABSTYP), reterm ABS ABSTYP
<span class="linenos"> 213</span>   , provable ABSREP ABSREPTYP
<span class="linenos"> 214</span>   , provable REPABS REPABSTYP, provable PREPH PREPHTYP).
<span class="linenos"> 215</span>
<span class="linenos"> 216</span>check WHAT :-
<span class="linenos"> 217</span> next_object WHAT C CONT,
<span class="linenos"> 218</span> (C = stop, !, K = true ; check1 C H , check_hyps [] H, print_constraints, K = (H =&gt; check CONT)),
<span class="linenos"> 219</span> !, K.
<span class="linenos"> 220</span>
<span class="linenos"> 221</span>}
<span class="linenos"> 222</span>
<span class="linenos"> 223</span>/************ parsing and pretty-printing ********/
<span class="linenos"> 224</span>% ppterm/parseterm
<span class="linenos"> 225</span>%ppterm X Y :- ppp X Y. parseterm X Y :- ppp X Y.
<span class="linenos"> 226</span>%ppp X Y :- var X, var Y, !, X = Y.
<span class="linenos"> 227</span>%ppp X (F # G) :- var X, (var F ; var G), !, X = (F # G).
<span class="linenos"> 228</span>%ppp X (F # G # H) :- var X, (var F ; var G ; var H), !,
<span class="linenos"> 229</span>% X = (F # G # H).
<span class="linenos"> 230</span>
<span class="linenos"> 231</span>mode (ppp o i) xas ppterm, (ppp i o) xas parseterm.
<span class="linenos"> 232</span>
<span class="linenos"> 233</span>ppp (! F2) (forall ## _ # lam _ F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 234</span>ppp (! TY F2) (forall ## TY # lam TY F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 235</span>ppp (? F2) (exists ## _ # lam _ F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 236</span>ppp (? TY F2) (exists ## TY # lam TY F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 237</span>ppp (F2 &lt;=&gt; G2) (eq ## prop # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 238</span>ppp (F2 = G2) (eq ## _ # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 239</span>ppp (F2 &amp;&amp; G2) (and # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 240</span>ppp (F2 || G2) (or # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 241</span>ppp (F2 ==&gt; G2) (impl # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 242</span>ppp (X2 #in S2) (in ## _ # X1 # S1) :- !, ppp X2 X1, ppp S2 S1.
<span class="linenos"> 243</span>ppp (U2 &lt;&lt;= V2) (subseteq ## _ # U1 # V1) :- !, ppp U2 U1, ppp V2 V1.
<span class="linenos"> 244</span>ppp (F2 + G2) (plus # F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 245</span>ppp (F2 # G2) (F1 # G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 246</span>ppp (lam A F2) (lam A F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 247</span>ppp A A.
<span class="linenos"> 248</span>
<span class="linenos"> 249</span>/* safe_list_map that unifies the two lists if they are both flexible
<span class="linenos"> 250</span>   probably only useful for parsing/pretty-printing */
<span class="linenos"> 251</span>safe_list_map L1 _ L2 :- var L1, var L2, !, L1 = L2.
<span class="linenos"> 252</span>safe_list_map L1 F L2 :- list_map L1 F L2.
<span class="linenos"> 253</span>
<span class="linenos"> 254</span>% pptac(ppterm)/parsetac(parseterm)
<span class="linenos"> 255</span>% pptac X Y :- ppptac X Y.  parsetac X Y :- ppptac X Y.
<span class="linenos"> 256</span>
<span class="linenos"> 257</span>mode (ppptac i o) xas parsetac(ppp -&gt; parseterm),
<span class="linenos"> 258</span>     (ppptac o i) xas pptac(ppp -&gt; ppterm).
<span class="linenos"> 259</span>
<span class="linenos"> 260</span>ppptac daemon daemon.
<span class="linenos"> 261</span>ppptac r r.
<span class="linenos"> 262</span>ppptac (t Y) (t PY) :- ppp Y PY.
<span class="linenos"> 263</span>ppptac (m Y) (m PY) :- ppp Y PY.
<span class="linenos"> 264</span>ppptac b b.
<span class="linenos"> 265</span>ppptac c c.
<span class="linenos"> 266</span>ppptac k k.
<span class="linenos"> 267</span>ppptac s s.
<span class="linenos"> 268</span>ppptac (h Gamma) (h PGamma) :- safe_list_map Gamma ppp PGamma.
<span class="linenos"> 269</span>ppptac d d.
<span class="linenos"> 270</span>ppptac (th NAME) (th NAME).
<span class="linenos"> 271</span>ppptac (thenll TAC1 TACN) (thenll PTAC1 PTACN) :-
<span class="linenos"> 272</span> ppptac TAC1 PTAC1, ppptac TACN PTACN.
<span class="linenos"> 273</span>ppptac (! TAC) (! PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 274</span>ppptac id id.
<span class="linenos"> 275</span>ppptac (wl Gamma) (wl PGamma) :- safe_list_map Gamma ppp PGamma.
<span class="linenos"> 276</span>ppptac (bind A TAC) (bind PA PTAC) :-
<span class="linenos"> 277</span> ppp A PA, pi x \ ppptac (TAC x) (PTAC x).
<span class="linenos"> 278</span>ppptac ww ww.
<span class="linenos"> 279</span>
<span class="linenos"> 280</span>/************ interactive and non interactive loops ********/
<span class="linenos"> 281</span>
<span class="linenos"> 282</span>ppptac interactive interactive.
<span class="linenos"> 283</span>
<span class="linenos"> 284</span>parse_obj (theorem NAME PSTTAC) [theorem NAME STTAC] :-
<span class="linenos"> 285</span> parse_thm NAME PSTTAC STTAC.
<span class="linenos"> 286</span>parse_obj (axiom NAME PTYP) [axiom NAME TYP] :- parse_axiom PTYP TYP.
<span class="linenos"> 287</span>parse_obj (new_basic_type TYPE REP ABS REPABS ABSREP PREP PP_TACTICS)
<span class="linenos"> 288</span> [new_basic_type TYPE REP ABS REPABS ABSREP PREP P_TACTICS] :- parse_nbt PP_TACTICS P_TACTICS.
<span class="linenos"> 289</span>parse_obj (def NAME PTYBO) [def NAME TYBO] :- parse_def PTYBO TYBO.
<span class="linenos"> 290</span>parse_obj (decl NAME TY) [decl NAME TY].
<span class="linenos"> 291</span>parse_obj (inductive_def PRED PREDF PREDF_MON PRED_I PRED_E0 PRED_E K) EXP :-
<span class="linenos"> 292</span> inductive_def_pkg PRED PREDF PREDF_MON PRED_I PRED_E0 PRED_E K EXP.
<span class="linenos"> 293</span>parse_obj stop [stop].
<span class="linenos"> 294</span>
<span class="linenos"> 295</span>parse_def (pi I) (pi O) :- pi x \ parse_def (I x) (O x).
<span class="linenos"> 296</span>parse_def (TY,PB) (TY,B) :- parseterm PB B.
<span class="linenos"> 297</span>
<span class="linenos"> 298</span>parse_axiom (pi I) (pi O) :- !, pi x \ parse_axiom (I x) (O x).
<span class="linenos"> 299</span>parse_axiom PST ST :- parseterm PST ST.
<span class="linenos"> 300</span>
<span class="linenos"> 301</span>parse_thm NAME (pi I) (pi O) :- pi x \ parse_thm NAME (I x) (O x).
<span class="linenos"> 302</span>parse_thm _ (PST,TAC) (ST,(false,TAC)) :- !, parseterm PST ST.
<span class="linenos"> 303</span>parse_thm NAME PST (ST,(true,[_])) :-
<span class="linenos"> 304</span> (not (proves NAME _) ; print &quot;Error:&quot; NAME already defined, fail),
<span class="linenos"> 305</span> parseterm PST ST.
<span class="linenos"> 306</span>
<span class="linenos"> 307</span>parse_nbt (pi I) (pi O) :- !, pi x \ parse_nbt (I x) (O x).
<span class="linenos"> 308</span>parse_nbt (PP,TACTICS) (P,(false,TACTICS)) :- parseterm PP P.
<span class="linenos"> 309</span>parse_nbt PP (P,(true,[_])) :- parseterm PP P.
<span class="linenos"> 310</span>
<span class="linenos"> 311</span>next_object [ C | NEXT ] CT CONTNEXT :-
<span class="linenos"> 312</span>  parse_obj C [ CT | CONT ], append CONT NEXT CONTNEXT.
<span class="linenos"> 313</span>next_object [] C CONT :- 
<span class="linenos"> 314</span> print &quot;Welcome to HOL extra-light&quot;,
<span class="linenos"> 315</span> toplevel_loop [ C | CONT ].
<span class="linenos"> 316</span>next_object toplevel C CONT :- toplevel_loop [ C | CONT ].
<span class="linenos"> 317</span>
<span class="linenos"> 318</span>read_cmd H :-
<span class="linenos"> 319</span> print &quot;Enter a command or \&quot;stop.\&quot;&quot;,
<span class="linenos"> 320</span> flush std_out, $readterm std_in H,
<span class="linenos"> 321</span> !.
<span class="linenos"> 322</span>read_cmd H :- read_cmd H.
<span class="linenos"> 323</span>
<span class="linenos"> 324</span>toplevel_loop G :-
<span class="linenos"> 325</span> read_cmd H,
<span class="linenos"> 326</span> ( H = stop, !, G = [stop]
<span class="linenos"> 327</span> ; parse_obj H PH, !, (append PH toplevel G ; print &quot;error&quot;, toplevel_loop G)
<span class="linenos"> 328</span> ; print &quot;bad command&quot;, toplevel_loop G ).
<span class="linenos"> 329</span>
<span class="linenos"> 330</span>callback_proved _ _ (false,_).
<span class="linenos"> 331</span>callback_proved NAME G (true, [ TAC ]) :-
<span class="linenos"> 332</span> canonical TAC CANONICALTAC,
<span class="linenos"> 333</span> pptac PCANONICALTAC CANONICALTAC,
<span class="linenos"> 334</span> ppterm PG G,
<span class="linenos"> 335</span> print (theorem NAME (PG , [ PCANONICALTAC ] )).
<span class="linenos"> 336</span>
<span class="linenos"> 337</span>end_of_proof (true, []) :- print &quot;proof completed&quot;.
<span class="linenos"> 338</span>end_of_proof (false, []).
<span class="linenos"> 339</span>
<span class="linenos"> 340</span>next_tactic0 [ SEQ | OLD ] (true, [ _ | _ ]) ITAC :-
<span class="linenos"> 341</span> print,
<span class="linenos"> 342</span> list_iter_rev [ SEQ | OLD ] print_sequent,
<span class="linenos"> 343</span> read_in_context SEQ ITAC BACKTRACK,
<span class="linenos"> 344</span> BACKTRACK.
<span class="linenos"> 345</span>next_tactic0 SEQS (true, CERT) ITAC :-
<span class="linenos"> 346</span> print &quot;error&quot;,
<span class="linenos"> 347</span> next_tactic SEQS (true, CERT) ITAC.
<span class="linenos"> 348</span>next_tactic0 SEQS (true_then_false, (_,INT_TACS,_)) ITAC :-
<span class="linenos"> 349</span> next_tactic0 SEQS (true, INT_TACS) ITAC.
<span class="linenos"> 350</span>next_tactic0 SEQS (false, [ interactive | _ ]) ITAC :-
<span class="linenos"> 351</span> next_tactic0 SEQS (true, [ _ ]) ITAC.
<span class="linenos"> 352</span>next_tactic0 [ SEQ | OLD ] (false, [ TAC | _ ]) TAC.
<span class="linenos"> 353</span>next_tactic0 _ (false, _) ITAC :-
<span class="linenos"> 354</span> print &quot;aborted&quot;,
<span class="linenos"> 355</span> halt.
<span class="linenos"> 356</span>
<span class="linenos"> 357</span>next_tactic SEQS CERT TAC :- next_tactic0 SEQS CERT PTAC, parsetac PTAC TAC.
<span class="linenos"> 358</span>
<span class="linenos"> 359</span>update_certificate (true, [ TAC | OTHER_TACS ]) ITAC NEW (true, TACS) :-
<span class="linenos"> 360</span> mk_script ITAC NEW NEW_TACS TAC,
<span class="linenos"> 361</span> append NEW_TACS OTHER_TACS TACS.
<span class="linenos"> 362</span>update_certificate (false, [ interactive | NON_INTERACTIVE_TACS ]) ITAC NEW CERTIFICATE :-
<span class="linenos"> 363</span> update_certificate (true_then_false, (SCRIPT, [ SCRIPT ], NON_INTERACTIVE_TACS)) ITAC NEW CERTIFICATE.
<span class="linenos"> 364</span>update_certificate (true_then_false, (SCRIPT,[ TAC | OTHER_TACS ],NON_INTERACTIVE_TACS)) ITAC NEW CERTIFICATE :- !,
<span class="linenos"> 365</span> mk_script ITAC NEW NEW_INTERACTIVE_TACS TAC,
<span class="linenos"> 366</span> append NEW_INTERACTIVE_TACS OTHER_TACS INTERACTIVE_TACS,
<span class="linenos"> 367</span> ( INTERACTIVE_TACS = [ _ | _ ], !,
<span class="linenos"> 368</span>   CERTIFICATE =
<span class="linenos"> 369</span>    (true_then_false, (SCRIPT,INTERACTIVE_TACS,NON_INTERACTIVE_TACS))
<span class="linenos"> 370</span> ; CERTIFICATE = (false, NON_INTERACTIVE_TACS),
<span class="linenos"> 371</span>   print &quot;INTERACTIVE SUBPROOF COMPLETED&quot;,
<span class="linenos"> 372</span>   canonical SCRIPT CSCRIPT,
<span class="linenos"> 373</span>   pptac PSCRIPT CSCRIPT,
<span class="linenos"> 374</span>   print PSCRIPT).
<span class="linenos"> 375</span>update_certificate (false, [ _ | OTHER_TACS ]) _ _ (false, OTHER_TACS).
<span class="linenos"> 376</span>
<span class="linenos"> 377</span>mk_script (bind A T) NEW NEW_TACS (bind A T2) :- !,
<span class="linenos"> 378</span> pi x \
<span class="linenos"> 379</span>  put_binds (NEW2 x) x A NEW,
<span class="linenos"> 380</span>  mk_script (T x) (NEW2 x) (NEWT x) (T2 x),
<span class="linenos"> 381</span>  put_binds (NEWT x) x A NEW_TACS.
<span class="linenos"> 382</span>mk_script ITAC NEW NEW_TACS (thenl ITAC NEW_TACS) :-
<span class="linenos"> 383</span> mk_list_of_bounded_fresh NEW NEW_TACS.
<span class="linenos"> 384</span>
<span class="linenos"> 385</span>read_in_context (bind A K) (bind A TAC) BACKTRACK :-
<span class="linenos"> 386</span> pi x \ /* term x A =&gt; reterm # x A =&gt; */ read_in_context (K x) (TAC x) BACKTRACK.
<span class="linenos"> 387</span>read_in_context (seq A B) TAC BACKTRACK :-
<span class="linenos"> 388</span> flush std_out, $readterm std_in TAC,
<span class="linenos"> 389</span> (TAC = backtrack, !, BACKTRACK = (!, fail) ; BACKTRACK = true).
<span class="linenos"> 390</span>
<span class="linenos"> 391</span>print_sequent (seq Gamma G) :-
<span class="linenos"> 392</span> print,
<span class="linenos"> 393</span> list_iter_rev Gamma (x \ sigma PX \ ppterm PX x, print PX),
<span class="linenos"> 394</span> print &quot;|------------------&quot;,
<span class="linenos"> 395</span> ppterm PG G, print PG.
<span class="linenos"> 396</span>print_sequent (bind A F) :- pi x \ print_sequent (F x).
<span class="linenos"> 397</span>
<span class="linenos"> 398</span>/* turns thenl into then */
<span class="linenos"> 399</span>canonical (bind A T1) (bind A T2) :- !,
<span class="linenos"> 400</span> pi x \ canonical (T1 x) (T2 x).
<span class="linenos"> 401</span>canonical (thenl T L) OTAC :- !,
<span class="linenos"> 402</span> list_map L canonical L2,
<span class="linenos"> 403</span> (mk_constant_list L2 S L2, !,
<span class="linenos"> 404</span>  (S = [], !, OTAC = T ; OTAC = then T S)
<span class="linenos"> 405</span> ; OTAC = thenl T L2).
<span class="linenos"> 406</span>canonical T T.
<span class="linenos"> 407</span>
<span class="linenos"> 408</span>/************ inductive_def package ********/
<span class="linenos"> 409</span>parse_inductive_def_spec (pi F) (pi PF) :- !,
<span class="linenos"> 410</span> pi A \ parse_inductive_def_spec (F A) (PF A).
<span class="linenos"> 411</span>parse_inductive_def_spec (param TY F) (param PTY PF) :- !,
<span class="linenos"> 412</span> ppp TY PTY, pi x \ parse_inductive_def_spec (F x) (PF x).
<span class="linenos"> 413</span>parse_inductive_def_spec L PL :-
<span class="linenos"> 414</span> (pi p \ list_map (L p)
<span class="linenos"> 415</span>  (x \ px \ sigma A \ sigma B \ sigma PB \ x = (A, B), parseterm B PB, px = (A, PB))
<span class="linenos"> 416</span>  (PL p)).
<span class="linenos"> 417</span>
<span class="linenos"> 418</span>build_quantified_predicate (pi I) (pi O) :- !,
<span class="linenos"> 419</span> pi A \ build_quantified_predicate (I A) (O A).
<span class="linenos"> 420</span>build_quantified_predicate (param TY I) (TY --&gt; TYP, lam TY BO) :- !,
<span class="linenos"> 421</span> pi x \ build_quantified_predicate (I x) (TYP, BO x).
<span class="linenos"> 422</span>build_quantified_predicate L (_, lam _ p \ lam _ x \ P p x) :-
<span class="linenos"> 423</span> pi p \ pi x \ build_predicate (L p) p x (P p x).
<span class="linenos"> 424</span>
<span class="linenos"> 425</span>build_predicate [ (_,K) ] P X R :- !,
<span class="linenos"> 426</span> process_constructor K P X R.
<span class="linenos"> 427</span>build_predicate [ (_,K) | REST ] P X (or # Q # R) :-
<span class="linenos"> 428</span> process_constructor K P X Q,
<span class="linenos"> 429</span> build_predicate REST P X R.
<span class="linenos"> 430</span>
<span class="linenos"> 431</span>process_constructor (forall ## TY # lam TY Q) P X (exists ## TY # lam TY R) :-
<span class="linenos"> 432</span> pi y \ process_constructor (Q y) P X (R y).
<span class="linenos"> 433</span>process_constructor (impl # H # K) P X (and # H # R) :-
<span class="linenos"> 434</span> process_constructor K P X R.
<span class="linenos"> 435</span>process_constructor (P # T) P X (eq ## _ # X # T).
<span class="linenos"> 436</span>
<span class="linenos"> 437</span>prove_monotonicity_thm (pi F) PREDF APREDF (pi THM) :- !,
<span class="linenos"> 438</span> pi A \ prove_monotonicity_thm (F A) PREDF (APREDF ## A) (THM A).
<span class="linenos"> 439</span>prove_monotonicity_thm (param TY F) PREDF APREDF (forall ## TY # lam TY STM, PROOF) :- !,
<span class="linenos"> 440</span> pi x \ prove_monotonicity_thm (F x) PREDF (APREDF # x) (STM x, PROOF).
<span class="linenos"> 441</span>prove_monotonicity_thm _ PREDF APREDF THM :-
<span class="linenos"> 442</span> THM =
<span class="linenos"> 443</span>  (monotone ## _ # APREDF,
<span class="linenos"> 444</span>   [ then inv (bind* (then (conv (depth_tac (dd [PREDF]))) auto_monotone)) ]).
<span class="linenos"> 445</span>
<span class="linenos"> 446</span>state_fixpoint_def (pi F) PREDF (pi DEF) :- !,
<span class="linenos"> 447</span> pi A \ state_fixpoint_def (F A) (PREDF ## A) (DEF A).
<span class="linenos"> 448</span>state_fixpoint_def (param TY F) PREDF (_, lam TY BO) :- !,
<span class="linenos"> 449</span> pi x \ state_fixpoint_def (F x) (PREDF # x) (_, BO x).
<span class="linenos"> 450</span>state_fixpoint_def _ PREDF (_, fixpoint ## _ # PREDF).
<span class="linenos"> 451</span>
<span class="linenos"> 452</span>prove_fix_intro_thm (pi F) PREDF PRED PREDF_MONOTONE (pi THM) :- !,
<span class="linenos"> 453</span> pi A \ prove_fix_intro_thm (F A) (PREDF ## A) (PRED ## A) PREDF_MONOTONE (THM A).
<span class="linenos"> 454</span>prove_fix_intro_thm (param TY F) PREDF PRED PREDF_MONOTONE (forall ## TY # lam TY STM, [ then forall_i (bind _ PROOF) ]) :- !,
<span class="linenos"> 455</span> pi x \ prove_fix_intro_thm (F x) (PREDF # x) (PRED # x) PREDF_MONOTONE (STM x, [ PROOF x ]).
<span class="linenos"> 456</span>prove_fix_intro_thm _ PREDF PRED PREDF_MONOTONE THM :-
<span class="linenos"> 457</span> THM =
<span class="linenos"> 458</span>  ((! x \ PREDF # PRED # x ==&gt; PRED # x),
<span class="linenos"> 459</span>   [then forall_i
<span class="linenos"> 460</span>     (bind _ x13 \
<span class="linenos"> 461</span>       then (conv (rand_tac (rator_tac dd)))
<span class="linenos"> 462</span>        (then (conv (land_tac (rator_tac (rand_tac dd))))
<span class="linenos"> 463</span>          (then inv
<span class="linenos"> 464</span>            (then (cutth fixpoint_is_prefixpoint)
<span class="linenos"> 465</span>              (then (lforall PREDF)
<span class="linenos"> 466</span>                (thenl lapply [applyth PREDF_MONOTONE,
<span class="linenos"> 467</span>                  then
<span class="linenos"> 468</span>                   (g
<span class="linenos"> 469</span>                     (subseteq ## _ &#39;
<span class="linenos"> 470</span>                       (PREDF # (fixpoint ## _ # PREDF)) &#39;
<span class="linenos"> 471</span>                       (fixpoint ## _ # PREDF)))
<span class="linenos"> 472</span>                   (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 473</span>                     (then (conv (depth_tac (dd [in])))
<span class="linenos"> 474</span>                       (then (conv (depth_tac (dd [in])))(itaut 4))))]))))))]).
<span class="linenos"> 475</span>
<span class="linenos"> 476</span>prove_fix_elim_thm (pi F) PREDF PRED OPRED (pi THM) :- !,
<span class="linenos"> 477</span> pi A \ prove_fix_elim_thm (F A) (PREDF ## A) (PRED ## A) OPRED (THM A).
<span class="linenos"> 478</span>prove_fix_elim_thm (param TY F) PREDF PRED OPRED (forall ## TY # lam TY STM, [ then forall_i (bind _ PROOF) ]) :- !,
<span class="linenos"> 479</span> pi x \ prove_fix_elim_thm (F x) (PREDF # x) (PRED # x) OPRED (STM x, [ PROOF x ]).
<span class="linenos"> 480</span>prove_fix_elim_thm _ PREDF PRED OPRED THM :-
<span class="linenos"> 481</span> THM =
<span class="linenos"> 482</span>  ((! x13 \
<span class="linenos"> 483</span>     (! x14 \ PREDF # x13 # x14 ==&gt; x13 # x14) ==&gt;
<span class="linenos"> 484</span>      (! x14 \ PRED # x14 ==&gt; x13 # x14)) ,
<span class="linenos"> 485</span>    [then forall_i
<span class="linenos"> 486</span>      (bind _ x23 \
<span class="linenos"> 487</span>        then (cutth fixpoint_subseteq_any_prefixpoint)
<span class="linenos"> 488</span>         (then (lforall PREDF)
<span class="linenos"> 489</span>           (then (lforall x23)
<span class="linenos"> 490</span>             (then (conv (depth_tac (dd [OPRED])))
<span class="linenos"> 491</span>               (then inv
<span class="linenos"> 492</span>                 (bind _ x24 \
<span class="linenos"> 493</span>                   then
<span class="linenos"> 494</span>                    (g
<span class="linenos"> 495</span>                      (impl # (subseteq ## _ # (PREDF # x23) # x23) &#39;
<span class="linenos"> 496</span>                        (subseteq ## _ # (fixpoint ## _ # PREDF) # x23)))
<span class="linenos"> 497</span>                    (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 498</span>                      (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 499</span>                        (then (conv (depth_tac (dd [in])))
<span class="linenos"> 500</span>                          (then (conv (depth_tac (dd [in])))
<span class="linenos"> 501</span>                            (then (conv (depth_tac (dd [in])))
<span class="linenos"> 502</span>                              (then (conv (depth_tac (dd [in])))
<span class="linenos"> 503</span>                                (then
<span class="linenos"> 504</span>                                  (w
<span class="linenos"> 505</span>                                    (impl &#39;
<span class="linenos"> 506</span>                                      (subseteq ## _ # (PREDF # x23) # x23) &#39;
<span class="linenos"> 507</span>                                      (subseteq ## _ &#39;
<span class="linenos"> 508</span>                                        (fixpoint ## _ # PREDF) # x23)))
<span class="linenos"> 509</span>                                  (then inv
<span class="linenos"> 510</span>                                    (thenl lapply_last [h,
<span class="linenos"> 511</span>                                      then (lforall_last x24)
<span class="linenos"> 512</span>                                       (then lapply_last h)])))))))))))))))]).
<span class="linenos"> 513</span>
<span class="linenos"> 514</span>prove_intro_thms (pi F) PRED PRED_I INTROTHMS :- !,
<span class="linenos"> 515</span> pi A \
<span class="linenos"> 516</span>  prove_intro_thms (F A) (PRED ## A) PRED_I (OUT A),
<span class="linenos"> 517</span>  list_map (OUT A)
<span class="linenos"> 518</span>   (i \ o \ sigma Y \ i = (theorem NAME (P A)), o = theorem NAME (pi P))
<span class="linenos"> 519</span>   INTROTHMS.
<span class="linenos"> 520</span>prove_intro_thms (param TY F) PRED PRED_I INTROTHMS :- !,
<span class="linenos"> 521</span> pi x \
<span class="linenos"> 522</span>  prove_intro_thms (F x) (PRED # x) PRED_I (OUT x),
<span class="linenos"> 523</span>  list_map (OUT x)
<span class="linenos"> 524</span>   (i \ o \ sigma Y \
<span class="linenos"> 525</span>     i = (theorem NAME (STM x, [ PROOF x ])),
<span class="linenos"> 526</span>     o = theorem NAME (forall ## TY # lam TY STM, [ then forall_i (bind TY PROOF) ]))
<span class="linenos"> 527</span>   INTROTHMS.
<span class="linenos"> 528</span>prove_intro_thms L PRED PRED_I INTROTHMS :-
<span class="linenos"> 529</span> list_map (L PRED) (mk_intro_thm PRED_I) INTROTHMS.
<span class="linenos"> 530</span>
<span class="linenos"> 531</span>mk_intro_thm PRED_I (NAME,ST)
<span class="linenos"> 532</span> (theorem NAME (ST,
<span class="linenos"> 533</span>   [ daemon /*(then inv (bind* (then (applyth PRED_I) (then (conv dd) (itauteq 6)))))*/ /* TOO MANY GOALS DELAYED ON typ (?): USE daemon INSTEAD */ ])).
<span class="linenos"> 534</span>
<span class="linenos"> 535</span>inductive_def_pkg PRED PREDF PREDF_MONOTONE PRED_I PRED_E0 PRED_E L OUT :-
<span class="linenos"> 536</span> parse_inductive_def_spec L PL,
<span class="linenos"> 537</span> build_quantified_predicate PL F,
<span class="linenos"> 538</span> prove_monotonicity_thm PL PREDF PREDF MONTHM,
<span class="linenos"> 539</span> state_fixpoint_def PL PREDF FIXDEF,
<span class="linenos"> 540</span> prove_fix_intro_thm PL PREDF PRED PREDF_MONOTONE INTROTHM,
<span class="linenos"> 541</span> prove_intro_thms PL PRED PRED_I INTROTHMS,
<span class="linenos"> 542</span> prove_fix_elim_thm PL PREDF PRED PRED ELIMTHM,
<span class="linenos"> 543</span> OUT1 =
<span class="linenos"> 544</span>  [ def PREDF F
<span class="linenos"> 545</span>  , theorem PREDF_MONOTONE MONTHM
<span class="linenos"> 546</span>  , def PRED FIXDEF
<span class="linenos"> 547</span>  , theorem PRED_I INTROTHM
<span class="linenos"> 548</span>  , theorem PRED_E0 ELIMTHM ],
<span class="linenos"> 549</span> append OUT1 INTROTHMS OUT.
<span class="linenos"> 550</span>
<span class="linenos"> 551</span>/************ library of basic data types ********/
<span class="linenos"> 552</span>mk_bounded_fresh (bind _ F) (bind _ G) :- !, pi x\ mk_bounded_fresh (F x) (G x).
<span class="linenos"> 553</span>mk_bounded_fresh _ X.
<span class="linenos"> 554</span>
<span class="linenos"> 555</span>mk_list_of_bounded_fresh [] [].
<span class="linenos"> 556</span>mk_list_of_bounded_fresh [S|L] [X|R] :-
<span class="linenos"> 557</span> mk_bounded_fresh S X, mk_list_of_bounded_fresh L R.
<span class="linenos"> 558</span>
<span class="linenos"> 559</span>/* list functions */
<span class="linenos"> 560</span>
<span class="linenos"> 561</span>list_map [] _ [].
<span class="linenos"> 562</span>list_map [X|XS] F [Y|YS] :- F X Y, list_map XS F YS.
<span class="linenos"> 563</span>
<span class="linenos"> 564</span>list_iter_rev [] _.
<span class="linenos"> 565</span>list_iter_rev [X|XS] F :- list_iter_rev XS F, F X.
<span class="linenos"> 566</span>
<span class="linenos"> 567</span>mem [ X | _ ] X, !.
<span class="linenos"> 568</span>mem [ _ | XS ] X :- mem XS X.
<span class="linenos"> 569</span>
<span class="linenos"> 570</span>mk_constant_list [] _ [].
<span class="linenos"> 571</span>mk_constant_list [_|L] X [X|R] :- mk_constant_list L X R.
<span class="linenos"> 572</span>
<span class="linenos"> 573</span>bang P :- P, !.
<span class="linenos"> 574</span>
<span class="linenos"> 575</span>/********** tacticals ********/
<span class="linenos"> 576</span>
<span class="linenos"> 577</span>% BUG in runtime.ml if the sigma is uncommented out. It does not matter btw.
<span class="linenos"> 578</span>/*sigma ff \*/ deftac fail SEQ ff.
<span class="linenos"> 579</span>
<span class="linenos"> 580</span>ppptac (constant_tacl TACL) (constant_tacl PTACL) :-
<span class="linenos"> 581</span> list_map TACL ppptac PTACL.
<span class="linenos"> 582</span>deftacl (constant_tacl TACL) SEQS TACL.
<span class="linenos"> 583</span>
<span class="linenos"> 584</span>ppptac (thenl TAC TACL) (thenl PTAC PTACL) :-
<span class="linenos"> 585</span> ppptac TAC PTAC, list_map TACL ppptac PTACL. 
<span class="linenos"> 586</span>deftac (thenl TAC TACL) SEQ XTAC :-
<span class="linenos"> 587</span> XTAC = thenll TAC (constant_tacl TACL).
<span class="linenos"> 588</span>
<span class="linenos"> 589</span>ppptac (all_equals_list TAC) (all_equals_list PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 590</span>deftacl (all_equals_list TAC2) SEQS TACL :-
<span class="linenos"> 591</span> mk_constant_list SEQS TAC2 TACL.
<span class="linenos"> 592</span>
<span class="linenos"> 593</span>ppptac (then TAC1 TAC2) (then PTAC1 PTAC2) :-
<span class="linenos"> 594</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 595</span>deftac (then TAC1 TAC2) SEQ XTAC :-
<span class="linenos"> 596</span> XTAC = thenll TAC1 (all_equals_list TAC2).
<span class="linenos"> 597</span>
<span class="linenos"> 598</span>ppptac (then! TAC1 TAC2) (then! PTAC1 PTAC2) :-
<span class="linenos"> 599</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 600</span>deftac (then! TAC1 TAC2) _ (then (! TAC1) TAC2).
<span class="linenos"> 601</span>
<span class="linenos"> 602</span>ppptac (orelse TAC1 TAC2) (orelse PTAC1 PTAC2) :-
<span class="linenos"> 603</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 604</span>deftac (orelse TAC1 TAC2) SEQ XTAC :-
<span class="linenos"> 605</span> XTAC = TAC1 ; XTAC = TAC2.
<span class="linenos"> 606</span>
<span class="linenos"> 607</span>ppptac (orelse! TAC1 TAC2) (orelse! PTAC1 PTAC2) :-
<span class="linenos"> 608</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 609</span>deftac (orelse! TAC1 TAC2) _ (orelse (! TAC1) TAC2).
<span class="linenos"> 610</span>
<span class="linenos"> 611</span>ppptac (bind* TAC) (bind* PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 612</span>deftac (bind* TAC) SEQ (orelse! (bind _ x \ bind* TAC) TAC).
<span class="linenos"> 613</span>
<span class="linenos"> 614</span>ppptac (repeat TAC) (repeat PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 615</span>deftac (repeat TAC) SEQ XTAC :-
<span class="linenos"> 616</span> ( XTAC = then TAC (repeat (bind* TAC))
<span class="linenos"> 617</span> ; XTAC = id).
<span class="linenos"> 618</span>
<span class="linenos"> 619</span>ppptac (repeat! TAC) (repeat! PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 620</span>deftac (repeat! TAC) SEQ (orelse! (then! TAC (repeat! (bind* TAC))) id).
<span class="linenos"> 621</span>
<span class="linenos"> 622</span>ppptac (pptac TAC) (pptac PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 623</span>deftac (pptac TAC) SEQ TAC :-
<span class="linenos"> 624</span> print &quot;SEQ&quot; SEQ &quot;:=&quot; TAC.
<span class="linenos"> 625</span>
<span class="linenos"> 626</span>ppptac (time TAC) (time PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 627</span>deftac (time TAC) SEQ XTAC :-
<span class="linenos"> 628</span> $gettimeofday B,
<span class="linenos"> 629</span> XTAC = thenll TAC (time_after TAC B).
<span class="linenos"> 630</span>
<span class="linenos"> 631</span>ppptac (time_after TAC B) (time_after PTAC B) :- ppptac TAC PTAC.
<span class="linenos"> 632</span>deftacl (time_after TAC B) SEQS TACL :-
<span class="linenos"> 633</span> $gettimeofday A,
<span class="linenos"> 634</span> D is A - B,
<span class="linenos"> 635</span> mk_constant_list SEQS id TACL,
<span class="linenos"> 636</span> print &quot;TIME SPENT &quot; D &quot;FOR&quot; TAC.
<span class="linenos"> 637</span>
<span class="linenos"> 638</span>/* For debugging only (?) For capturing metavariables */
<span class="linenos"> 639</span>ppptac (inspect (seq Gamma F) TAC) (inspect (seq PGamma PF) PTAC) :-
<span class="linenos"> 640</span> list_map SEQ ppp PSEQ, ppp F PF, ppptac TAC PTAC.
<span class="linenos"> 641</span>deftac (inspect SEQ TAC) SEQ TAC.
<span class="linenos"> 642</span>
<span class="linenos"> 643</span>/********** tactics ********/
<span class="linenos"> 644</span>
<span class="linenos"> 645</span>ppptac (w G) (w PG) :- ppp G PG.
<span class="linenos"> 646</span>deftac (w G) (seq Gamma _) (wl Gamma1) :-
<span class="linenos"> 647</span> append Gamma1 [ G | _ ] Gamma.
<span class="linenos"> 648</span>
<span class="linenos"> 649</span>ppptac h h.
<span class="linenos"> 650</span>deftac h SEQ (h L).
<span class="linenos"> 651</span>
<span class="linenos"> 652</span>/*** eq ***/
<span class="linenos"> 653</span>
<span class="linenos"> 654</span>ppptac sym sym.
<span class="linenos"> 655</span>deftac sym (seq Gamma (eq ## T # L # R)) TAC :-
<span class="linenos"> 656</span> TAC = thenl (m (eq ## T # R # R)) [ thenl c [ thenl c [ r , id ] , r ] , r ].
<span class="linenos"> 657</span>
<span class="linenos"> 658</span>ppptac eq_true_intro eq_true_intro.
<span class="linenos"> 659</span>deftac eq_true_intro (seq Gamma (eq ## prop # P # tt)) TAC :-
<span class="linenos"> 660</span> TAC = thenl s [ th tt_intro, wl [] ].
<span class="linenos"> 661</span>
<span class="linenos"> 662</span>/*** true ***/
<span class="linenos"> 663</span>
<span class="linenos"> 664</span>/*** and ***/
<span class="linenos"> 665</span>
<span class="linenos"> 666</span>ppptac conj conj.
<span class="linenos"> 667</span>deftac conj (seq Gamma (and # P # Q)) TAC :-
<span class="linenos"> 668</span> TAC =
<span class="linenos"> 669</span>  then
<span class="linenos"> 670</span>   (then (conv dd)
<span class="linenos"> 671</span>     (then k (bind _ x \
<span class="linenos"> 672</span>       thenl c
<span class="linenos"> 673</span>        [ thenl c [ r, eq_true_intro ] ,
<span class="linenos"> 674</span>          eq_true_intro ])))
<span class="linenos"> 675</span>   ww.
<span class="linenos"> 676</span>
<span class="linenos"> 677</span>/* Gamma  &quot;|-&quot;  q    ---&gt;   Gamma &quot;|-&quot; and # p # q*/
<span class="linenos"> 678</span>ppptac (andr P) (andr PP) :- ppp P PP.
<span class="linenos"> 679</span>deftac (andr P) (seq Gamma Q) TAC :-
<span class="linenos"> 680</span> TAC =
<span class="linenos"> 681</span>  (thenl (m ((lam _ f \ f # P # Q) # (lam _ x \ lam _ y \ y)))
<span class="linenos"> 682</span>    [ then
<span class="linenos"> 683</span>       %(repeat (conv (depth_tac b))) ROBUS VERSION LINE BELOW
<span class="linenos"> 684</span>       (then (conv (land_tac b)) (then (conv (land_tac (rator_tac b))) (conv (land_tac b))))
<span class="linenos"> 685</span>      r
<span class="linenos"> 686</span>    , thenl (conv (rator_tac id))
<span class="linenos"> 687</span>       [ then (thenl (t (lam _ f \ f # tt # tt)) [ id, r ])
<span class="linenos"> 688</span>          (thenl (m (and # P # Q)) [ dd , id ])
<span class="linenos"> 689</span>       , then (repeat (conv (depth_tac b))) (th tt_intro) ]]).
<span class="linenos"> 690</span>
<span class="linenos"> 691</span>/* (and # p # q) :: nil  &quot;|-&quot;  q */
<span class="linenos"> 692</span>ppptac andr andr.
<span class="linenos"> 693</span>deftac andr (seq Gamma Q) TAC :-
<span class="linenos"> 694</span> mem Gamma (and # P # Q),
<span class="linenos"> 695</span> TAC = then (andr P) h.
<span class="linenos"> 696</span>
<span class="linenos"> 697</span>/* Gamma  &quot;|-&quot;  p    ---&gt;   Gamma &quot;|-&quot; and # p # q*/
<span class="linenos"> 698</span>ppptac (andl P) (andl PP) :- ppp P PP.
<span class="linenos"> 699</span>deftac (andl Q) (seq Gamma P) TAC :-
<span class="linenos"> 700</span> TAC =
<span class="linenos"> 701</span>  (thenl (m ((lam _ f \ f # P # Q) # (lam _ x \ lam _ y \ x)))
<span class="linenos"> 702</span>    [ then
<span class="linenos"> 703</span>       %(repeat (conv (depth_tac b))) ROBUS VERSION LINE BELOW
<span class="linenos"> 704</span>       (then (conv (land_tac b)) (then (conv (land_tac (rator_tac b))) (conv (land_tac b))))
<span class="linenos"> 705</span>      r
<span class="linenos"> 706</span>    , thenl (conv (rator_tac id))
<span class="linenos"> 707</span>       [ then (thenl (t (lam _ f \ f # tt # tt)) [ id, r ])
<span class="linenos"> 708</span>          (thenl (m (and # P # Q)) [ dd , id ])
<span class="linenos"> 709</span>       , then (repeat (conv (depth_tac b))) (th tt_intro) ]]).
<span class="linenos"> 710</span>
<span class="linenos"> 711</span>/* (and # p # q) :: nil  &quot;|-&quot;  p */
<span class="linenos"> 712</span>ppptac andl andl.
<span class="linenos"> 713</span>deftac andl (seq Gamma P) TAC :-
<span class="linenos"> 714</span> mem Gamma (and # P # Q),
<span class="linenos"> 715</span> TAC = then (andl Q) h.
<span class="linenos"> 716</span>
<span class="linenos"> 717</span>
<span class="linenos"> 718</span>/*** forall ***/
<span class="linenos"> 719</span>
<span class="linenos"> 720</span>/* |- forall # F  --&gt;   |- F # x */
<span class="linenos"> 721</span>ppptac forall_i forall_i.
<span class="linenos"> 722</span>deftac forall_i (seq Gamma (forall ## _ # lam _ G)) TAC :-
<span class="linenos"> 723</span> TAC = then (conv dd) (then k (bind _ x \ eq_true_intro)).
<span class="linenos"> 724</span>
<span class="linenos"> 725</span>/* forall # F |- F # T */
<span class="linenos"> 726</span>ppptac forall_e forall_e.
<span class="linenos"> 727</span>deftac forall_e (seq Gamma GX) TAC :-
<span class="linenos"> 728</span> mem Gamma (forall ## _ # (lam _ G)), GX = G X,
<span class="linenos"> 729</span> TAC = thenl (m ((lam _ G) # X)) [ b, thenl (m ((lam _ z \ tt) # X))
<span class="linenos"> 730</span>  [ thenl c [ then sym (thenl (m (forall ## _ # lam _ G)) [dd,h ]), r ]
<span class="linenos"> 731</span>  , then (conv b) (th tt_intro) ] ].
<span class="linenos"> 732</span>
<span class="linenos"> 733</span>/* forall # F |- f  --&gt;  F # a, forall # F |- f */
<span class="linenos"> 734</span>ppptac (lforall F A) (lforall PF PA) :- ppp F PF, ppp A PA.
<span class="linenos"> 735</span>deftac (lforall F A) (seq Gamma G) TAC :-
<span class="linenos"> 736</span> TAC = thenl (m (impl # (F A) # G))
<span class="linenos"> 737</span>  [ thenl s [ then mp forall_e, then i h ] , then (w (forall ## _ # lam _ F)) i ].
<span class="linenos"> 738</span>
<span class="linenos"> 739</span>/* forall # F |- f  --&gt;  F # a, forall # F |- f */
<span class="linenos"> 740</span>ppptac (lforall A) (lforall PA) :- ppp A PA.
<span class="linenos"> 741</span>deftac (lforall A) (seq Gamma G) (lforall F A) :-
<span class="linenos"> 742</span> mem Gamma (forall ## _ # lam _ F).
<span class="linenos"> 743</span>
<span class="linenos"> 744</span>/* forall # F |- f  --&gt;  F # a, forall # F |- f */
<span class="linenos"> 745</span>ppptac lforall lforall.
<span class="linenos"> 746</span>deftac lforall (seq Gamma G) (lforall A).
<span class="linenos"> 747</span>
<span class="linenos"> 748</span>/* forall # F |- f  --&gt;  F # a, forall # F |- f */
<span class="linenos"> 749</span>ppptac (lforall_last A) (lforall_last PA) :- ppp A PA.
<span class="linenos"> 750</span>deftac (lforall_last A) (seq ((forall ## _ # lam _ F)::Gamma) G) (lforall F A).
<span class="linenos"> 751</span>
<span class="linenos"> 752</span>/*** false ***/
<span class="linenos"> 753</span>              
<span class="linenos"> 754</span>/*** impl ***/
<span class="linenos"> 755</span>
<span class="linenos"> 756</span>/* |- p=&gt;q  --&gt;  p |- q */
<span class="linenos"> 757</span>ppptac i i.
<span class="linenos"> 758</span>deftac i (seq Gamma (impl # P # Q)) TAC :-
<span class="linenos"> 759</span> TAC = then (conv dd) (thenl s [ andl, thenl conj [ h [], id ]]).
<span class="linenos"> 760</span>
<span class="linenos"> 761</span>/* p=&gt;q |- q  --&gt;  |- p */
<span class="linenos"> 762</span>ppptac (mp P) (mp PP) :- ppp P PP.
<span class="linenos"> 763</span>deftac (mp P) (seq Gamma Q) TAC :-
<span class="linenos"> 764</span> TAC = then (andr P) (thenl (m P) [ then sym (thenl (m (impl # P # Q)) [ dd , h ]) , id ]).
<span class="linenos"> 765</span>
<span class="linenos"> 766</span>/* p=&gt;q |- q  --&gt;  |- p */
<span class="linenos"> 767</span>ppptac mp mp.
<span class="linenos"> 768</span>deftac mp (seq Gamma Q) (mp P) :-
<span class="linenos"> 769</span> mem Gamma (impl # P # Q).
<span class="linenos"> 770</span>
<span class="linenos"> 771</span>/* |- q   --&gt;   p |- q  and  |- p */
<span class="linenos"> 772</span>ppptac (cut P) (cut PP) :- ppp P PP.
<span class="linenos"> 773</span>deftac (cut P) (seq Gamma Q) TAC :-
<span class="linenos"> 774</span> TAC = then (andr P) (thenl (m P) [then sym (thenl (m (impl # P # Q)) [then (conv (land_tac dd)) r, i] ) , id]). 
<span class="linenos"> 775</span>
<span class="linenos"> 776</span>/* |-q  --&gt; p |- q   where the theorem T proves p */
<span class="linenos"> 777</span>ppptac (cutth P) (cutth PP) :- ppp P PP.
<span class="linenos"> 778</span>deftac (cutth T) SEQ TAC :-
<span class="linenos"> 779</span> proves T X,
<span class="linenos"> 780</span> TAC = (thenl (cut X) [ id, th T ]).
<span class="linenos"> 781</span>
<span class="linenos"> 782</span>/* applies the theorem T */
<span class="linenos"> 783</span>ppptac (applyth P) (applyth PP) :- ppp P PP.
<span class="linenos"> 784</span>deftac (applyth T) SEQ (then (cutth T) apply_last).
<span class="linenos"> 785</span>
<span class="linenos"> 786</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 787</span>ppptac (lapply P Q) (lapply PP PQ) :- ppp P PP, ppp Q PQ.
<span class="linenos"> 788</span>deftac (lapply P Q) (seq Gamma F) TAC :-
<span class="linenos"> 789</span> TAC =
<span class="linenos"> 790</span>  thenl (m (impl # Q # F)) [ thenl s [ then (mp Q) (then (w (impl # Q # F)) (then (mp P) (w (impl # P # Q)))) , then i (h [A]) ] , then (w (impl # P # Q)) (then i id) ].
<span class="linenos"> 791</span>
<span class="linenos"> 792</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 793</span>ppptac lapply lapply.
<span class="linenos"> 794</span>deftac lapply (seq Gamma F) (lapply P Q) :-
<span class="linenos"> 795</span> mem Gamma (impl # P # Q).
<span class="linenos"> 796</span>
<span class="linenos"> 797</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 798</span>ppptac lapply_last lapply_last.
<span class="linenos"> 799</span>deftac lapply_last (seq ((impl # P # Q)::Gamma) F) (lapply P Q).
<span class="linenos"> 800</span>
<span class="linenos"> 801</span>/* p |- f ---&gt; p |- p ==&gt; f */
<span class="linenos"> 802</span>ppptac (g P) (g PP) :- ppp P PP.
<span class="linenos"> 803</span>deftac (g P) (seq _ F) TAC :-
<span class="linenos"> 804</span> TAC =
<span class="linenos"> 805</span>  (thenl (m (impl # P # F)) [thenl s [then mp h , then i h] , id ]).
<span class="linenos"> 806</span>
<span class="linenos"> 807</span>/*** not ***/
<span class="linenos"> 808</span>
<span class="linenos"> 809</span>/*** exists ***/
<span class="linenos"> 810</span>
<span class="linenos"> 811</span>/**** apply, i.e. forall + impl ****/
<span class="linenos"> 812</span>
<span class="linenos"> 813</span>ppptac (apply X) (apply PX) :- ppp X PX.
<span class="linenos"> 814</span>deftac (apply X) SEQ h :- var X, !.
<span class="linenos"> 815</span>deftac (apply X) SEQ h.
<span class="linenos"> 816</span>deftac (apply (impl # P # Q)) SEQ TAC :-
<span class="linenos"> 817</span> TAC = thenl (lapply P Q) [ id, apply_last ].
<span class="linenos"> 818</span>deftac (apply (forall ## _ # lam _ G)) SEQ TAC :-
<span class="linenos"> 819</span> TAC = then (lforall G X) apply_last.
<span class="linenos"> 820</span>
<span class="linenos"> 821</span>ppptac apply_last apply_last.
<span class="linenos"> 822</span>deftac apply_last (seq (H::Gamma) F) (apply H).
<span class="linenos"> 823</span>
<span class="linenos"> 824</span>ppptac apply apply.
<span class="linenos"> 825</span>deftac apply (seq Gamma F) (apply H) :-
<span class="linenos"> 826</span> mem Gamma H.
<span class="linenos"> 827</span>
<span class="linenos"> 828</span>/********** conversion(als) ***********/
<span class="linenos"> 829</span>
<span class="linenos"> 830</span>strip_constant (I ## _) H :- !, strip_constant I H.
<span class="linenos"> 831</span>strip_constant H H.
<span class="linenos"> 832</span>
<span class="linenos"> 833</span>/* expands definitions, even if applied to arguments */
<span class="linenos"> 834</span>ppptac (dd L) (dd L).
<span class="linenos"> 835</span>deftac (dd L) (seq _ (eq ## _ # T # X)) d :- strip_constant T H, bang (mem L H).
<span class="linenos"> 836</span>deftac (dd L) (seq _ (eq ## _ # (D # T) # X))
<span class="linenos"> 837</span> (thenl (t A) [thenl c [dd L , r], b]).
<span class="linenos"> 838</span>
<span class="linenos"> 839</span>ppptac dd dd.
<span class="linenos"> 840</span>deftac dd _ (dd L).
<span class="linenos"> 841</span>
<span class="linenos"> 842</span>ppptac beta_expand beta_expand.
<span class="linenos"> 843</span>deftac beta_expand (seq _ (eq ## _ # (lam _ x \ F x) # (lam _ x \ (lam _ F) # x))) TAC :-
<span class="linenos"> 844</span> TAC = then k (bind _ x \ then sym b).
<span class="linenos"> 845</span>
<span class="linenos"> 846</span>/* folds a definition, even if applied to arguments */
<span class="linenos"> 847</span>/* BUG: it seems to fail with restriction errors in some cases */
<span class="linenos"> 848</span>ppptac f f.
<span class="linenos"> 849</span>deftac f SEQ (then sym dd).
<span class="linenos"> 850</span>
<span class="linenos"> 851</span>ppptac (rand_tac C) (rand_tac PC) :- ppptac C PC.
<span class="linenos"> 852</span>deftac (rand_tac C) SEQ TAC :-
<span class="linenos"> 853</span>  TAC = thenl c [ r , C ].
<span class="linenos"> 854</span>
<span class="linenos"> 855</span>ppptac (rator_tac C) (rator_tac PC) :- ppptac C PC.
<span class="linenos"> 856</span>deftac (rator_tac C) SEQ TAC :-
<span class="linenos"> 857</span>  TAC = thenl c [ C , r ].
<span class="linenos"> 858</span>
<span class="linenos"> 859</span>ppptac (abs_tac C) (abs_tac PC) :- ppptac C PC.
<span class="linenos"> 860</span>deftac (abs_tac C) SEQ TAC :-
<span class="linenos"> 861</span>  TAC = then k (bind A x \ C).
<span class="linenos"> 862</span>
<span class="linenos"> 863</span>ppptac (land_tac C) (land_tac PC) :- ppptac C PC.
<span class="linenos"> 864</span>deftac (land_tac C) SEQ TAC :-
<span class="linenos"> 865</span>  TAC = thenl c [ thenl c [ r, C ] , r ].
<span class="linenos"> 866</span>
<span class="linenos"> 867</span>ppptac (sub_tac C) (sub_tac PC) :- ppptac C PC.
<span class="linenos"> 868</span>deftac (sub_tac C) SEQ TAC :-
<span class="linenos"> 869</span>  TAC = orelse (rand_tac C) (orelse (rator_tac C) (abs_tac C)).
<span class="linenos"> 870</span>
<span class="linenos"> 871</span>ppptac (try TAC) (try PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 872</span>deftac (try TAC) SEQ (orelse TAC id).
<span class="linenos"> 873</span>
<span class="linenos"> 874</span>ppptac (depth_tac C) (depth_tac PC) :- ppptac C PC.
<span class="linenos"> 875</span>deftac (depth_tac C) SEQ TAC :-
<span class="linenos"> 876</span>  TAC = then (try C) (sub_tac (depth_tac C)).
<span class="linenos"> 877</span>
<span class="linenos"> 878</span>ppptac (conv C) (conv PC) :- ppptac C PC.
<span class="linenos"> 879</span>deftac (conv C) (seq Gamma F) TAC :-
<span class="linenos"> 880</span> TAC = thenl (m G) [ then sym C , id ].
<span class="linenos"> 881</span>
<span class="linenos"> 882</span>/********** Automation ***********/
<span class="linenos"> 883</span>/* TODO:
<span class="linenos"> 884</span> 1) our lforall gets rid of the hypothesis (bad) */
<span class="linenos"> 885</span>/* left tries to reduce the search space via focusing */
<span class="linenos"> 886</span>ppptac left left.
<span class="linenos"> 887</span>deftac left (seq Gamma _) TAC :-
<span class="linenos"> 888</span> mem Gamma (not # F),
<span class="linenos"> 889</span> TAC =
<span class="linenos"> 890</span>  (!
<span class="linenos"> 891</span>   (then (cutth not_e)
<span class="linenos"> 892</span>    (then (lforall_last F)
<span class="linenos"> 893</span>     (thenl lapply [ h, (w (not # F)) ])))).
<span class="linenos"> 894</span>deftac left (seq Gamma _) TAC :-
<span class="linenos"> 895</span> /* A bit long because we want to beta-reduce the produced hypothesis.
<span class="linenos"> 896</span>    Maybe this should be automatized somewhere else. */
<span class="linenos"> 897</span> mem Gamma (exists ## _ # F),
<span class="linenos"> 898</span> TAC =
<span class="linenos"> 899</span>  (!
<span class="linenos"> 900</span>   (then (cutth exists_e)
<span class="linenos"> 901</span>    (then (lforall_last F)
<span class="linenos"> 902</span>     (thenl lapply [ h, then (w (exists ## _ # F)) (then apply_last (then forall_i (bind _ x \ then (try (conv (land_tac b))) i))) ])))).
<span class="linenos"> 903</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 904</span> mem Gamma (or # F # G),
<span class="linenos"> 905</span> TAC =
<span class="linenos"> 906</span>  (!
<span class="linenos"> 907</span>   (then (cutth or_e)
<span class="linenos"> 908</span>    (then (lforall_last F)
<span class="linenos"> 909</span>     (then (lforall_last G)
<span class="linenos"> 910</span>      (then (lforall_last H)
<span class="linenos"> 911</span>       (thenl lapply [ h, then (w (or # F # G)) (then apply_last i)])))))).
<span class="linenos"> 912</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 913</span> mem Gamma (and # F # G),
<span class="linenos"> 914</span> TAC =
<span class="linenos"> 915</span>  (!
<span class="linenos"> 916</span>   (then (cutth and_e)
<span class="linenos"> 917</span>    (then (lforall_last F)
<span class="linenos"> 918</span>     (then (lforall_last G)
<span class="linenos"> 919</span>      (then (lforall_last H)
<span class="linenos"> 920</span>       (thenl lapply [ h, then (w (and # F # G)) (then apply_last (then i i))])))))).
<span class="linenos"> 921</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 922</span> mem Gamma (eq ## TY # F # G),
<span class="linenos"> 923</span> not (var TY), TY = prop,
<span class="linenos"> 924</span> TAC =
<span class="linenos"> 925</span>  (then (g (eq ## TY # F # G))
<span class="linenos"> 926</span>   (then (conv (land_tac (then (applyth eq_to_impl) h)))
<span class="linenos"> 927</span>     (then i (w (eq ## TY # F # G))))).
<span class="linenos"> 928</span>
<span class="linenos"> 929</span>ppptac not_i not_i.
<span class="linenos"> 930</span>deftac not_i (seq _ (not # _)) (applyth not_i).
<span class="linenos"> 931</span>
<span class="linenos"> 932</span>ppptac inv inv.
<span class="linenos"> 933</span>deftac inv _ TAC :-
<span class="linenos"> 934</span> TAC =
<span class="linenos"> 935</span> (then!
<span class="linenos"> 936</span>  (repeat!
<span class="linenos"> 937</span>   (orelse! conj (orelse! forall_i (orelse! i (orelse! not_i s)))))
<span class="linenos"> 938</span>  (bind* (repeat! left))).
<span class="linenos"> 939</span>
<span class="linenos"> 940</span>ppptac (sync N) (sync N).
<span class="linenos"> 941</span>deftac (sync N) (seq _ tt) (th tt_intro).
<span class="linenos"> 942</span>deftac (sync N) (seq Gamma _) (then (applyth ff_elim) h) :-
<span class="linenos"> 943</span> mem Gamma ff.
<span class="linenos"> 944</span>deftac (sync N) (seq _ (or # _ # _))
<span class="linenos"> 945</span> (orelse (then (applyth orr) (itaut N)) (then (applyth orl) (itaut N))).
<span class="linenos"> 946</span>deftac (sync N) (seq _ (exists ## _ # _)) (then (applyth exists_i) (then (conv b) (itaut N2))) :-
<span class="linenos"> 947</span> N2 is N - 2.
<span class="linenos"> 948</span>
<span class="linenos"> 949</span>ppptac (itaut N) (itaut N).
<span class="linenos"> 950</span>deftac (itaut N) SEQ fail :- N =&lt; 0, !.
<span class="linenos"> 951</span>deftac (itaut N) SEQ TAC :-
<span class="linenos"> 952</span> %print (itaut N) SEQ,
<span class="linenos"> 953</span> N1 is N - 1,
<span class="linenos"> 954</span> N2 is N - 2,
<span class="linenos"> 955</span> TAC =
<span class="linenos"> 956</span> (then! inv
<span class="linenos"> 957</span>  (bind*
<span class="linenos"> 958</span>   (orelse h
<span class="linenos"> 959</span>   (orelse (sync N)
<span class="linenos"> 960</span>   (orelse /* Hypothesis not moved to front */ (then lforall (itaut N2))
<span class="linenos"> 961</span>   (then lapply (itaut N1))))))).
<span class="linenos"> 962</span>
<span class="linenos"> 963</span>ppptac (itauteq N) (itauteq N).
<span class="linenos"> 964</span>deftac (itauteq N) _ (then (cutth eq_reflexive) (itaut N)).
<span class="linenos"> 965</span>
<span class="linenos"> 966</span>/********** inductive predicates package ********/
<span class="linenos"> 967</span>
<span class="linenos"> 968</span>ppptac monotone monotone.
<span class="linenos"> 969</span>deftac monotone (seq _ (impl # X # X)) (! (then i h)) :- !.
<span class="linenos"> 970</span>deftac monotone (seq [forall ## _ # lam _ x \ impl # (F # x) # (G # x)] (impl # (F # T) # (G # T))) (! apply) :- !.
<span class="linenos"> 971</span>deftac monotone (seq _ (impl # (and # _ # _) # _)) TAC :-
<span class="linenos"> 972</span> TAC = then (applyth and_monotone) monotone.
<span class="linenos"> 973</span>deftac monotone (seq _ (impl # (or # _ # _) # _)) TAC :-
<span class="linenos"> 974</span> TAC = then (applyth or_monotone) monotone.
<span class="linenos"> 975</span>deftac monotone (seq _ (impl # (impl # _ # _) # _)) TAC :-
<span class="linenos"> 976</span> TAC = then (applyth impl_monotone) monotone.
<span class="linenos"> 977</span>deftac monotone (seq _ (impl # (not # _) # _)) TAC :-
<span class="linenos"> 978</span> TAC = then (applyth not_monotone) monotone.
<span class="linenos"> 979</span>deftac monotone (seq _ (impl # (forall ## _ # lam _ _) # _)) TAC :-
<span class="linenos"> 980</span> TAC =
<span class="linenos"> 981</span>  then (conv (land_tac (rand_tac beta_expand)))
<span class="linenos"> 982</span>   (then (conv (rand_tac (rand_tac beta_expand)))
<span class="linenos"> 983</span>     (then (applyth forall_monotone) (then forall_i (bind _ x \
<span class="linenos"> 984</span>       then (conv (depth_tac b)) (then (conv (depth_tac b)) monotone))))).
<span class="linenos"> 985</span>deftac monotone (seq _ (impl # (exists ## _ # lam _ _) # _)) TAC :-
<span class="linenos"> 986</span> TAC =
<span class="linenos"> 987</span>  then (conv (land_tac (rand_tac beta_expand)))
<span class="linenos"> 988</span>   (then (conv (rand_tac (rand_tac beta_expand)))
<span class="linenos"> 989</span>     (then (applyth exists_monotone) (then forall_i (bind _ x \
<span class="linenos"> 990</span>       then (conv (depth_tac b)) (then (conv (depth_tac b)) monotone))))).
<span class="linenos"> 991</span>
<span class="linenos"> 992</span>/* expands &quot;monotone # (lam _ f \ lam _ x \ X f x)&quot; into
<span class="linenos"> 993</span>   &quot;! x \ p # x ==&gt; q # x |- X p y ==&gt; X q y&quot;
<span class="linenos"> 994</span>   and then calls the monotone tactic */
<span class="linenos"> 995</span>ppptac auto_monotone auto_monotone.
<span class="linenos"> 996</span>deftac auto_monotone _ TAC :-
<span class="linenos"> 997</span> TAC =
<span class="linenos"> 998</span>  then (conv dd)
<span class="linenos"> 999</span>   (then forall_i (bind _ p \ (then forall_i (bind _ q \
<span class="linenos">1000</span>     then (conv (land_tac dd))
<span class="linenos">1001</span>      (then (conv (land_tac (depth_tac (dd [in]))))
<span class="linenos">1002</span>        (then (conv (land_tac (depth_tac (dd [in]))))
<span class="linenos">1003</span>          (then i
<span class="linenos">1004</span>            (then (conv dd)
<span class="linenos">1005</span>              (then forall_i (bind _ x \
<span class="linenos">1006</span>                (then (conv (land_tac dd))
<span class="linenos">1007</span>                  (then (conv (rand_tac dd))
<span class="linenos">1008</span>                    (then (conv (land_tac (rator_tac b)))
<span class="linenos">1009</span>                      (then (conv (land_tac b))
<span class="linenos">1010</span>                        (then (conv (rand_tac (rator_tac b)))
<span class="linenos">1011</span>                          (then (conv (rand_tac b))
<span class="linenos">1012</span>                            monotone)))))))))))))))).
<span class="linenos">1013</span>
<span class="linenos">1014</span>/********** the library ********/
<span class="linenos">1015</span>
<span class="linenos">1016</span>main :- the_library L, append L [stop] Lstop, check Lstop.
<span class="linenos">1017</span>
<span class="linenos">1018</span>go :- the_library L, check L.
<span class="linenos">1019</span>
<span class="linenos">1020</span>the_library L :-
<span class="linenos">1021</span> L =
<span class="linenos">1022</span>  [ /******** Primivite operators hard-coded in the kernel ******/
<span class="linenos">1023</span>  % decl eq (pi A \ A --&gt; A --&gt; prop)
<span class="linenos">1024</span>
<span class="linenos">1025</span>  /********** Axiomatization of choice over types ********/
<span class="linenos">1026</span>    decl choose (pi A \ A)
<span class="linenos">1027</span>
<span class="linenos">1028</span>  /*********** Connectives and quantifiers ********/
<span class="linenos">1029</span>  , def tt (prop,((lam prop x \ x) = (lam prop x \ x)))
<span class="linenos">1030</span>  , def forall (pi A \ ((A --&gt; prop) --&gt; prop),
<span class="linenos">1031</span>     (lam (A --&gt; prop) f \ f = (lam A g \ tt)))
<span class="linenos">1032</span>  , def ff (prop,(! x \ x))
<span class="linenos">1033</span>  , def and ((prop --&gt; prop --&gt; prop),
<span class="linenos">1034</span>     (lam _ x \ lam _ y \ (lam (prop --&gt; prop --&gt; prop) f \ f # x # y) = (lam _ f \ f # tt # tt)))
<span class="linenos">1035</span>  , def impl ((prop --&gt; prop --&gt; prop),(lam _ a \ lam _ b \ a &amp;&amp; b &lt;=&gt; a))
<span class="linenos">1036</span>  , def exists (pi A \ ((A --&gt; prop) --&gt; prop),
<span class="linenos">1037</span>     (lam (A --&gt; prop) f \ ! c \ (! a \ f # a ==&gt; c) ==&gt; c))
<span class="linenos">1038</span>  , def not ((prop --&gt; prop),(lam _ x \ x ==&gt; ff))
<span class="linenos">1039</span>  , def or ((prop --&gt; prop --&gt; prop),
<span class="linenos">1040</span>     (lam _ x \ lam _ y \ ! c \ (x ==&gt; c) ==&gt; (y ==&gt; c) ==&gt; c))
<span class="linenos">1041</span>  , theorem tt_intro (tt,[then (conv dd) (then k (bind _ x12 \ r))])
<span class="linenos">1042</span>  , theorem ff_elim ((! p \ ff ==&gt; p),
<span class="linenos">1043</span>    [then forall_i (bind prop x3\ then (conv (land_tac dd)) (then i forall_e))])
<span class="linenos">1044</span>  , theorem sym ((! p \ ! q \ p = q ==&gt; q = p),
<span class="linenos">1045</span>    [then forall_i
<span class="linenos">1046</span>     (bind prop x12 \
<span class="linenos">1047</span>       then forall_i
<span class="linenos">1048</span>        (bind prop x13 \
<span class="linenos">1049</span>          then i (then sym h)))])
<span class="linenos">1050</span>  , theorem not_e ((! p \ not # p ==&gt; p ==&gt; ff),
<span class="linenos">1051</span>     [then forall_i (bind prop x3 \ then (conv (land_tac dd)) (then i h))])
<span class="linenos">1052</span>  , theorem conj ((! p \ ! q \ p ==&gt; q ==&gt; p &amp;&amp; q),
<span class="linenos">1053</span>    [then forall_i
<span class="linenos">1054</span>     (bind prop x12 \
<span class="linenos">1055</span>      then forall_i (bind prop x13 \ then i (then i (then conj h))))])
<span class="linenos">1056</span>  , theorem andl ((! p \ ! q \ p &amp;&amp; q ==&gt; p),
<span class="linenos">1057</span>    [then forall_i
<span class="linenos">1058</span>     (bind prop x12 \
<span class="linenos">1059</span>      then forall_i (bind prop x13 \ then i (then (andl x13) h)))])
<span class="linenos">1060</span>  , theorem andr ((! p \ ! q \ p &amp;&amp; q ==&gt; q),
<span class="linenos">1061</span>    [then forall_i
<span class="linenos">1062</span>     (bind prop x12 \
<span class="linenos">1063</span>      then forall_i (bind prop x13 \ then i (then (andr x12) h)))])
<span class="linenos">1064</span>  , theorem and_e ((! p \ ! q \ ! c \ p &amp;&amp; q ==&gt; (p ==&gt; q ==&gt; c) ==&gt; c),
<span class="linenos">1065</span>     [then forall_i
<span class="linenos">1066</span>       (bind prop x12 \
<span class="linenos">1067</span>         then forall_i
<span class="linenos">1068</span>          (bind prop x13 \
<span class="linenos">1069</span>            then forall_i
<span class="linenos">1070</span>             (bind prop x14 \ then i (then i (thenl apply [andl, andr])))))])
<span class="linenos">1071</span>  , theorem not_i ((! p \ (p ==&gt; ff) ==&gt; not # p),
<span class="linenos">1072</span>     [then forall_i (bind prop x2 \ then i (then (conv dd) h))])
<span class="linenos">1073</span>  , theorem orl ((! p \ ! q \ p ==&gt; p || q),
<span class="linenos">1074</span>      [then forall_i
<span class="linenos">1075</span>        (bind prop x12 \
<span class="linenos">1076</span>          then forall_i
<span class="linenos">1077</span>           (bind prop x13 \
<span class="linenos">1078</span>             then i
<span class="linenos">1079</span>              (then (conv dd)
<span class="linenos">1080</span>                (then forall_i (bind prop x14 \ then i (then i (then apply h)))))))])
<span class="linenos">1081</span>  , theorem orr ((! p \ ! q \ q ==&gt; p || q),
<span class="linenos">1082</span>      [then forall_i
<span class="linenos">1083</span>        (bind prop x12 \
<span class="linenos">1084</span>          then forall_i
<span class="linenos">1085</span>           (bind prop x13 \
<span class="linenos">1086</span>             then i
<span class="linenos">1087</span>              (then (conv dd)
<span class="linenos">1088</span>                (then forall_i (bind prop x14 \ then i (then i (then apply h)))))))])
<span class="linenos">1089</span>  , theorem or_e ((! p \ ! q \ ! c \ p || q ==&gt; (p ==&gt; c) ==&gt; (q ==&gt; c) ==&gt; c),
<span class="linenos">1090</span>     [then forall_i
<span class="linenos">1091</span>       (bind prop x12 \
<span class="linenos">1092</span>         then forall_i
<span class="linenos">1093</span>          (bind prop x13 \
<span class="linenos">1094</span>            then forall_i
<span class="linenos">1095</span>             (bind prop x14 \ then (conv (land_tac dd)) (then i forall_e))))])
<span class="linenos">1096</span>  , theorem exists_e (pi T \
<span class="linenos">1097</span>     (! f \ (exists ## T # f) ==&gt; (! c \ (! x \ f # x ==&gt; c) ==&gt; c)),
<span class="linenos">1098</span>     [then forall_i (bind (T --&gt; prop) x12 \ then (conv (land_tac dd)) (then i h))])
<span class="linenos">1099</span> , theorem exists_i (pi T \ (! f \ ! w \ f # w ==&gt; (exists ## T # f)),
<span class="linenos">1100</span>    [then forall_i
<span class="linenos">1101</span>     (bind (T --&gt; prop) x12 \
<span class="linenos">1102</span>       then forall_i
<span class="linenos">1103</span>        (bind T x13 \
<span class="linenos">1104</span>          then i
<span class="linenos">1105</span>           (then (conv dd)
<span class="linenos">1106</span>             (then forall_i
<span class="linenos">1107</span>               (bind prop x14 \ then i (then (lforall x13) (then apply h)))))))])
<span class="linenos">1108</span>  , theorem eq_to_impl
<span class="linenos">1109</span>     ((! x13 \ ! x14 \ (x13 = x14) = ((x13 ==&gt; x14) &amp;&amp; (x14 ==&gt; x13))),
<span class="linenos">1110</span>     [thenl inv [(bind prop x13 \ bind prop x14 \ then (conv (then sym h)) h),
<span class="linenos">1111</span>       (bind prop x13 \ bind prop x14 \ then (conv h) h),
<span class="linenos">1112</span>       (bind prop x13 \ bind prop x14 \ itaut 2),
<span class="linenos">1113</span>       (bind prop x13 \ bind prop x14 \ itaut 2)]])
<span class="linenos">1114</span>
<span class="linenos">1115</span> /*********** Axiomatization of disjoint union ********/
<span class="linenos">1116</span>  , decl inj1_disj_union (pi A \pi B \ A --&gt; disj_union ## A ## B)
<span class="linenos">1117</span>  , decl inj2_disj_union (pi A \ pi B \ B --&gt; disj_union ## A ## B)
<span class="linenos">1118</span>  , decl case_disj_union (pi A \pi B \ pi C \ disj_union ## A ## B --&gt; (A --&gt; C) --&gt; (B --&gt; C) --&gt; C)
<span class="linenos">1119</span>  , axiom case_disj_union_inj1 (pi A \ pi B \ pi C \ (! b \ ! (A --&gt; C) e1 \ ! (B --&gt; C) e2  \
<span class="linenos">1120</span>    case_disj_union ## A ## B ## C # (inj1_disj_union ## A ## B # b) # e1 # e2 = e1 # b))
<span class="linenos">1121</span>  , axiom case_disj_union_inj2 (pi A \ pi B \ pi C \ (! b \ ! (A --&gt; C) e1 \ ! (B --&gt; C) e2  \
<span class="linenos">1122</span>    case_disj_union ## A ## B ## C # (inj2_disj_union ## A ## B # b) # e1 # e2 = e2 # b))
<span class="linenos">1123</span>
<span class="linenos">1124</span> /*********** Axiomatization of the universe ********/
<span class="linenos">1125</span> , decl injection_univ (pi A \pi B \ A --&gt; univ ## A ## B)
<span class="linenos">1126</span> , decl ejection_univ (pi A \pi B \ univ ## A ## B --&gt; A)
<span class="linenos">1127</span> , decl inject_limit_univ (pi A \pi B \ (B --&gt; univ ## A ## B) --&gt; univ ## A ## B)
<span class="linenos">1128</span> , decl eject_limit_univ (pi A \ pi B \ univ ## A ## B --&gt; (B --&gt; univ ## A ## B))
<span class="linenos">1129</span> , decl pair_univ (pi A \pi B \ univ ## A ## B --&gt; univ ## A ## B --&gt; univ ## A ## B)
<span class="linenos">1130</span> , decl proj1_univ (pi A \ pi B \ univ ## A ## B --&gt; univ ## A ## B)
<span class="linenos">1131</span> , decl proj2_univ (pi A \pi B \ univ ## A ## B --&gt; univ ## A ## B)
<span class="linenos">1132</span> , decl inj1_univ (pi A \pi B \ univ ## A ## B --&gt; univ ## A ## B)
<span class="linenos">1133</span> , decl inj2_univ (pi A \pi B \ univ ## A ## B --&gt; univ ## A ## B)
<span class="linenos">1134</span> , decl case_univ (pi A \pi B \ pi C \ univ ## A ## B --&gt; (univ ## A ## B --&gt; C) --&gt; (univ ## A ## B --&gt; C) --&gt; C)
<span class="linenos">1135</span> , axiom ejection_injection_univ (pi A \ pi B \
<span class="linenos">1136</span>    ! A p \ ejection_univ ## A ## B # (injection_univ ## A ## B # p) = p)
<span class="linenos">1137</span> , axiom eject_inject_limit_univ (pi A \ pi B \
<span class="linenos">1138</span>    ! (B --&gt; univ ## A ## B) p \ eject_limit_univ ## A ## B # (inject_limit_univ ## A ## B # p) = p)
<span class="linenos">1139</span> , axiom proj1_pair_univ (pi A \ pi B \ ! (univ ## A ## B) p1 \ ! p2 \
<span class="linenos">1140</span>    proj1_univ ## A ## B # (pair_univ ## A ## B # p1 # p2) = p1)
<span class="linenos">1141</span> , axiom proj2_pair_univ (pi A \ pi B \ ! p1 \ ! (univ ## A ## B) p2 \
<span class="linenos">1142</span>    proj2_univ ## A ## B # (pair_univ ## A ## B # p1 # p2) = p2)
<span class="linenos">1143</span> , axiom case_univ_inj1 (pi A \ pi B \ pi C \ (! b \ ! (univ ## A ## B --&gt; C) e1 \ ! e2  \
<span class="linenos">1144</span>    case_univ ## A ## B ## C # (inj1_univ ## A ## B # b) # e1 # e2 = e1 # b))
<span class="linenos">1145</span> , axiom case_univ_inj2 (pi A \ pi B \ pi C \ (! b \ ! (univ ## A ## B --&gt; C) e1 \ ! e2 \
<span class="linenos">1146</span>    case_univ ## A ## B ## C # (inj2_univ ## A ## B # b) # e1 # e2 = e2 # b))
<span class="linenos">1147</span>
<span class="linenos">1148</span> /******************* Equality *****************/
<span class="linenos">1149</span> , theorem eq_reflexive (pi A \ ((! A a \ a = a),
<span class="linenos">1150</span>   [ then forall_i (bind A x \ r) ]))
<span class="linenos">1151</span>
<span class="linenos">1152</span> /******************* Logic *****************/
<span class="linenos">1153</span> , theorem or_commutative ((! a \ ! b \ a || b &lt;=&gt; b || a),
<span class="linenos">1154</span>   [itaut 1])
<span class="linenos">1155</span> , theorem or_ff ((! a \ a || ff &lt;=&gt; a),
<span class="linenos">1156</span>   [itaut 1])
<span class="linenos">1157</span> , theorem or_tt ((! a \ a || tt &lt;=&gt; tt),
<span class="linenos">1158</span>   [itaut 1])
<span class="linenos">1159</span> , theorem or_idempotent ((! a \ a || a &lt;=&gt; a),
<span class="linenos">1160</span>   [itaut 1])
<span class="linenos">1161</span> , theorem or_associative ((! a \ ! b \ ! c \ a || (b || c) &lt;=&gt; (a || b) || c),
<span class="linenos">1162</span>   [itaut 1])
<span class="linenos">1163</span> , theorem and_commutative ((! a \ ! b \ a &amp;&amp; b &lt;=&gt; b &amp;&amp; a),
<span class="linenos">1164</span>   [itaut 1])
<span class="linenos">1165</span> , theorem and_tt ((! a \ a &amp;&amp; tt &lt;=&gt; a),
<span class="linenos">1166</span>   [itaut 1])
<span class="linenos">1167</span> , theorem and_ff ((! a \ a &amp;&amp; ff &lt;=&gt; ff),
<span class="linenos">1168</span>   [itaut 1])
<span class="linenos">1169</span> , theorem and_idempotent ((! a \ a &amp;&amp; a &lt;=&gt; a),
<span class="linenos">1170</span>   [itaut 1])
<span class="linenos">1171</span> , theorem and_associative ((! a \ ! b \ ! c \ a &amp;&amp; (b &amp;&amp; c) &lt;=&gt; (a &amp;&amp; b) &amp;&amp; c),
<span class="linenos">1172</span>   [itaut 1])
<span class="linenos">1173</span> , theorem and_or ((! a \ ! b \ ! c \ a &amp;&amp; (b || c) &lt;=&gt; (a &amp;&amp; b) || (a &amp;&amp; c)),
<span class="linenos">1174</span>   [itaut 1])
<span class="linenos">1175</span> , theorem or_and ((! a \ ! b \ ! c \ a || (b &amp;&amp; c) &lt;=&gt; (a || b) &amp;&amp; (a || c)),
<span class="linenos">1176</span>   [itaut 1])
<span class="linenos">1177</span> , theorem ads_or_and ((! a \ ! b \ (a &amp;&amp; b) || b &lt;=&gt; b),
<span class="linenos">1178</span>   [itaut 1])
<span class="linenos">1179</span> , theorem ads_and_or ((! a \ ! b \ (a || b) &amp;&amp; b &lt;=&gt; b),
<span class="linenos">1180</span>   [itaut 1])
<span class="linenos">1181</span> , theorem not_or ((! a \ ! b \ not # a &amp;&amp; not # b &lt;=&gt; not # (a || b)),
<span class="linenos">1182</span>   [itaut 2])
<span class="linenos">1183</span> , theorem not_and ((! a \ ! b \ not # a || not # b ==&gt; not # (a &amp;&amp; b)),
<span class="linenos">1184</span>   [itaut 2])
<span class="linenos">1185</span> , theorem not_not_not ((! p \ not # (not # (not # p)) &lt;=&gt; not # p),
<span class="linenos">1186</span>   [itaut 3])
<span class="linenos">1187</span> , theorem impl_not_not ((! a \ ! b \ (a ==&gt; b) ==&gt; (not # b ==&gt; not # a)),
<span class="linenos">1188</span>   [itaut 3])
<span class="linenos">1189</span> , theorem eq_to_impl_f ((! p \ ! q \ (p &lt;=&gt; q) ==&gt; p ==&gt; q),
<span class="linenos">1190</span>    [itaut 2])
<span class="linenos">1191</span> , theorem eq_to_impl_b ((! p \ ! q \ (p &lt;=&gt; q) ==&gt; q ==&gt; p),
<span class="linenos">1192</span>    [itaut 2])
<span class="linenos">1193</span>
<span class="linenos">1194</span>/*************** Properties inj/disj/univ ***********/
<span class="linenos">1195</span> , theorem pair_univ_inj_l 
<span class="linenos">1196</span>   (pi A \ pi B \ (! (univ ## A ## B) x20 \ ! x21 \ ! x22 \ ! x23 \ pair_univ ## A ## B # x20 # x22 = pair_univ ## A ## B # x21 # x23 ==&gt; x20 = x21) ,
<span class="linenos">1197</span>   [then (repeat forall_i)
<span class="linenos">1198</span>     (bind (univ ## A ## B) x22 \
<span class="linenos">1199</span>       bind (univ ## A ## B) x23 \
<span class="linenos">1200</span>        bind (univ ## A ## B) x24 \
<span class="linenos">1201</span>         bind (univ ## A ## B) x25 \
<span class="linenos">1202</span>          then i
<span class="linenos">1203</span>           (then (cutth proj1_pair_univ)
<span class="linenos">1204</span>             (then (lforall x22)
<span class="linenos">1205</span>               (then (conv (land_tac (then sym apply)))
<span class="linenos">1206</span>                 (then (conv (depth_tac h)) (applyth proj1_pair_univ))))))])
<span class="linenos">1207</span> , theorem pair_univ_inj_r 
<span class="linenos">1208</span>   (pi A \ pi B \ (! (univ ## A ## B) x20 \ ! x21 \ ! x22 \ ! x23 \ pair_univ ## A ## B # x20 # x22 = pair_univ ## A ## B # x21 # x23 ==&gt; x22 = x23) ,
<span class="linenos">1209</span>   [then (repeat forall_i)
<span class="linenos">1210</span>     (bind (univ ## A ## B) x22 \
<span class="linenos">1211</span>       bind (univ ## A ## B) x23 \
<span class="linenos">1212</span>        bind (univ ## A ## B) x24 \
<span class="linenos">1213</span>         bind (univ ## A ## B) x25 \
<span class="linenos">1214</span>          then i
<span class="linenos">1215</span>           (then (cutth proj2_pair_univ)
<span class="linenos">1216</span>             (then (lforall x22)
<span class="linenos">1217</span>               (then (conv (land_tac (then sym apply)))
<span class="linenos">1218</span>                 (then (conv (depth_tac h)) (applyth proj2_pair_univ))))))])
<span class="linenos">1219</span> , theorem injection_univ_inj
<span class="linenos">1220</span>   (pi A \ pi B \ (! A x20 \ ! x21 \ injection_univ ## A ## B # x20 = injection_univ ## A ## B # x21 ==&gt; x20 = x21) ,
<span class="linenos">1221</span>    [then forall_i
<span class="linenos">1222</span>     (bind A x20 \
<span class="linenos">1223</span>       then forall_i
<span class="linenos">1224</span>        (bind A x21 \
<span class="linenos">1225</span>          then (then (cutth ejection_injection_univ) (lforall x21))
<span class="linenos">1226</span>           (then (then (cutth ejection_injection_univ) (lforall x20))
<span class="linenos">1227</span>             (then i
<span class="linenos">1228</span>               (thenl
<span class="linenos">1229</span>                 (cut
<span class="linenos">1230</span>                   (ejection_univ ## A ## B # (injection_univ ## A ## B # x20) =
<span class="linenos">1231</span>                     ejection_univ ## A ## B # (injection_univ ## A ## B # x21)))
<span class="linenos">1232</span>                 [thenl
<span class="linenos">1233</span>                   (cut
<span class="linenos">1234</span>                     ((ejection_univ ## A ## B # (injection_univ ## A ## B # x20) =
<span class="linenos">1235</span>                        ejection_univ ## A ## B # (injection_univ ## A ## B # x21)) =
<span class="linenos">1236</span>                       (x20 = x21)))
<span class="linenos">1237</span>                   [then (conv (depth_tac (then sym h))) h,
<span class="linenos">1238</span>                   thenl c [thenl c [r, h], h]], thenl c [r, h]])))))])
<span class="linenos">1239</span> , theorem inj1_univ_inj
<span class="linenos">1240</span>   (pi A \ pi B \ (! (univ ## A ## B) x20 \ ! x21 \ inj1_univ ## A ## B # x20 = inj1_univ ## A ## B # x21 ==&gt; x20 = x21) ,
<span class="linenos">1241</span>    [then inv
<span class="linenos">1242</span>     (bind (univ ## A ## B) x20 \ bind (univ ## A ## B) x21 \
<span class="linenos">1243</span>        thenl (t (case_univ ## A ## B ## (univ ## A ## B) # (inj1_univ ## A ## B # x20) &#39;
<span class="linenos">1244</span>             (lam (univ ## A ## B) x22 \ x22) &#39;
<span class="linenos">1245</span>             (lam (univ ## A ## B) x22 \ x22)))
<span class="linenos">1246</span>         [then sym
<span class="linenos">1247</span>           (then (conv (land_tac (applyth case_univ_inj1)))
<span class="linenos">1248</span>             (then (conv (land_tac b)) r)),
<span class="linenos">1249</span>         then (conv (depth_tac h))
<span class="linenos">1250</span>          (then (conv (land_tac (applyth case_univ_inj1)))
<span class="linenos">1251</span>            (then (conv (land_tac b)) r))])])
<span class="linenos">1252</span> , theorem inj2_univ_inj
<span class="linenos">1253</span>   (pi A \ pi B \ (! (univ ## A ## B) x22 \ ! x23 \ inj2_univ ## A ## B # x22 = inj2_univ ## A ## B # x23 ==&gt; x22 = x23) ,
<span class="linenos">1254</span>    [then inv
<span class="linenos">1255</span>     (bind (univ ## A ## B) x20 \ bind (univ ## A ## B) x21 \
<span class="linenos">1256</span>        thenl (t (case_univ ## A ## B ## (univ ## A ## B) # (inj2_univ ## A ## B # x20) &#39;
<span class="linenos">1257</span>             (lam (univ ## A ## B) x22 \ x22) &#39;
<span class="linenos">1258</span>             (lam (univ ## A ## B) x22 \ x22)))
<span class="linenos">1259</span>         [then sym
<span class="linenos">1260</span>           (then (conv (land_tac (applyth case_univ_inj2)))
<span class="linenos">1261</span>             (then (conv (land_tac b)) r)),
<span class="linenos">1262</span>         then (conv (depth_tac h))
<span class="linenos">1263</span>          (then (conv (land_tac (applyth case_univ_inj2)))
<span class="linenos">1264</span>            (then (conv (land_tac b)) r))])])
<span class="linenos">1265</span> , theorem not_eq_inj1_inj2_univ 
<span class="linenos">1266</span>   (pi A \ pi B \ (! (univ ## A ## B) x22 \ ! x23 \ inj1_univ ## A ## B # x22 = inj2_univ ## A ## B # x23 ==&gt; ff) ,
<span class="linenos">1267</span>    [then inv
<span class="linenos">1268</span>     (bind (univ ## A ## B) x22 \
<span class="linenos">1269</span>       bind (univ ## A ## B) x23 \
<span class="linenos">1270</span>        then (cutth case_univ_inj1)
<span class="linenos">1271</span>         (then (lforall x22)
<span class="linenos">1272</span>           (then (lforall (lam (univ ## A ## B) x24 \ ff))
<span class="linenos">1273</span>             (then (lforall (lam (univ ## A ## B) x24 \ tt))
<span class="linenos">1274</span>               (thenl (m ((lam (univ ## A ## B) x24 \ ff) # x22)) [b,
<span class="linenos">1275</span>                 then (conv (then sym h))
<span class="linenos">1276</span>                  (then (wl [])
<span class="linenos">1277</span>                    (then (conv (depth_tac h))
<span class="linenos">1278</span>                      (then (wl [])
<span class="linenos">1279</span>                        (then (conv (applyth case_univ_inj2))
<span class="linenos">1280</span>                          (then (conv b) (itaut 1))))))])))))])
<span class="linenos">1281</span> , theorem inj1_disj_union_inj (pi A \ pi B \
<span class="linenos">1282</span>    ((! x \ ! y \
<span class="linenos">1283</span>     inj1_disj_union ## A ## B # x = inj1_disj_union ## A ## B # y ==&gt; x = y) ,
<span class="linenos">1284</span>    [then inv
<span class="linenos">1285</span>      (bind A x23 \
<span class="linenos">1286</span>        bind A x24 \
<span class="linenos">1287</span>         then (cutth case_disj_union_inj1)
<span class="linenos">1288</span>          (then (lforall x23)
<span class="linenos">1289</span>            (then (lforall (lam A x25 \ x25))
<span class="linenos">1290</span>              (then (lforall (lam B x25 \ choose ## A))
<span class="linenos">1291</span>                (thenl (t ((lam A x25 \ x25) # x23))
<span class="linenos">1292</span>                  [then (conv (rand_tac b)) r,
<span class="linenos">1293</span>                  then (conv (land_tac (then sym h)))
<span class="linenos">1294</span>                   (then (wl [])
<span class="linenos">1295</span>                     (then (conv (depth_tac h))
<span class="linenos">1296</span>                       (then (wl [])
<span class="linenos">1297</span>                         (then (conv (land_tac (applyth case_disj_union_inj1)))
<span class="linenos">1298</span>                           b))))])))))]))
<span class="linenos">1299</span> , theorem inj2_disj_union_inj (pi A \ pi B \
<span class="linenos">1300</span>    ((! x \ ! y \
<span class="linenos">1301</span>     inj2_disj_union ## A ## B # x = inj2_disj_union ## A ## B # y ==&gt; x = y) ,
<span class="linenos">1302</span>    [then inv
<span class="linenos">1303</span>      (bind B x23 \
<span class="linenos">1304</span>        bind B x24 \
<span class="linenos">1305</span>         then (cutth case_disj_union_inj2)
<span class="linenos">1306</span>          (then (lforall x23)
<span class="linenos">1307</span>            (then (lforall (lam A x25 \ choose ## B))
<span class="linenos">1308</span>              (then (lforall (lam B x25 \ x25))
<span class="linenos">1309</span>                (thenl (t ((lam B x25 \ x25) # x23))
<span class="linenos">1310</span>                  [then (conv (rand_tac b)) r,
<span class="linenos">1311</span>                  then (conv (land_tac (then sym h)))
<span class="linenos">1312</span>                   (then (wl [])
<span class="linenos">1313</span>                     (then (conv (depth_tac h))
<span class="linenos">1314</span>                       (then (wl [])
<span class="linenos">1315</span>                         (then (conv (land_tac (applyth case_disj_union_inj2)))
<span class="linenos">1316</span>                           b))))])))))]))
<span class="linenos">1317</span>
<span class="linenos">1318</span> /********** Monotonicity of logical connectives *********/
<span class="linenos">1319</span> , theorem and_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1320</span>    (a1 ==&gt; b1) ==&gt; (a2 ==&gt; b2) ==&gt; a1 &amp;&amp; a2 ==&gt; b1 &amp;&amp; b2),
<span class="linenos">1321</span>    [itaut 2])
<span class="linenos">1322</span> , theorem or_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1323</span>    (a1 ==&gt; b1) ==&gt; (a2 ==&gt; b2) ==&gt; a1 || a2 ==&gt; b1 || b2),
<span class="linenos">1324</span>    [itaut 2])
<span class="linenos">1325</span> , theorem impl_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1326</span>    (b1 ==&gt; a1) ==&gt; (a2 ==&gt; b2) ==&gt; (a1 ==&gt; a2) ==&gt; (b1 ==&gt; b2)),
<span class="linenos">1327</span>    [itaut 3])
<span class="linenos">1328</span> , theorem not_monotone ((! p \ ! q \ (p ==&gt; q) ==&gt; (not # q) ==&gt; (not # p)),
<span class="linenos">1329</span>    [itaut 3])
<span class="linenos">1330</span> , theorem forall_monotone (pi A \ (! p \ ! q \
<span class="linenos">1331</span>    (! A x \ p # x ==&gt; q # x) ==&gt; (! x \ p # x) ==&gt; (! x \ q # x)),
<span class="linenos">1332</span>    [itaut 6])
<span class="linenos">1333</span> , theorem exists_monotone (pi A \ (! p \ ! q \
<span class="linenos">1334</span>    (! A x \ p # x ==&gt; q # x) ==&gt; (? x \ p # x) ==&gt; (? x \ q # x)),
<span class="linenos">1335</span>    [itaut 6])
<span class="linenos">1336</span>
<span class="linenos">1337</span> /********** Knaster-Tarski theorem *********/
<span class="linenos">1338</span>  , def in (pi A \ (A --&gt; (A --&gt; prop) --&gt; prop),
<span class="linenos">1339</span>     (lam A x \ lam (A --&gt; prop) j \ j # x))
<span class="linenos">1340</span>  , def subseteq (pi A \ ((A --&gt; prop) --&gt; (A --&gt; prop) --&gt; prop),
<span class="linenos">1341</span>     (lam (A --&gt; prop) x \ lam (A --&gt; prop) y \ ! z \ z #in x ==&gt; z #in y))
<span class="linenos">1342</span>  , theorem in_subseteq (pi A \ 
<span class="linenos">1343</span>     (! s \ ! t \ ! x \ s &lt;&lt;= t ==&gt; x #in s ==&gt; x #in t),
<span class="linenos">1344</span>     [then forall_i
<span class="linenos">1345</span>       (bind (A --&gt; prop) x9 \
<span class="linenos">1346</span>         then forall_i
<span class="linenos">1347</span>          (bind (A --&gt; prop) x10 \
<span class="linenos">1348</span>            then forall_i (bind A x11 \ then (conv (land_tac dd)) (itaut 4))))])
<span class="linenos">1349</span>  , def monotone (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; prop),
<span class="linenos">1350</span>      (lam (_ A) f \ ! x \ ! y \ x &lt;&lt;= y ==&gt; f # x &lt;&lt;= f # y))
<span class="linenos">1351</span>  , def is_fixpoint (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; ((A --&gt; prop) --&gt; prop)),
<span class="linenos">1352</span>     (lam (_ A) f \ lam (_ A) x \ (f # x) &lt;&lt;= x &amp;&amp; x &lt;&lt;= (f # x)))
<span class="linenos">1353</span>  , def fixpoint (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; (A --&gt; prop)),
<span class="linenos">1354</span>     (lam (_ A) f \ lam A a \ ! e \ f # e &lt;&lt;= e ==&gt; a #in e))
<span class="linenos">1355</span>  , theorem fixpoint_subseteq_any_prefixpoint (pi A \
<span class="linenos">1356</span>     (! f \ ! x\ f # x &lt;&lt;= x ==&gt; fixpoint ## A # f &lt;&lt;= x),
<span class="linenos">1357</span>     [then inv
<span class="linenos">1358</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1359</span>         (bind (A --&gt; prop) x10 \
<span class="linenos">1360</span>           then (conv (land_tac dd))
<span class="linenos">1361</span>            (then (conv dd)
<span class="linenos">1362</span>              (then forall_i
<span class="linenos">1363</span>                (bind A x11 \
<span class="linenos">1364</span>                  then (conv (land_tac dd))
<span class="linenos">1365</span>                   (then (conv (land_tac b)) (itaut 4)))))))])
<span class="linenos">1366</span>  , theorem fixpoint_subseteq_any_fixpoint (pi A \
<span class="linenos">1367</span>     (! f \ ! x\ is_fixpoint ## A # f # x ==&gt; fixpoint ## A # f &lt;&lt;= x),
<span class="linenos">1368</span>     [then forall_i
<span class="linenos">1369</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1370</span>         then forall_i
<span class="linenos">1371</span>          (bind (A --&gt; prop) x10 \
<span class="linenos">1372</span>            then (conv (land_tac dd))
<span class="linenos">1373</span>             (then (cutth fixpoint_subseteq_any_prefixpoint) (itaut 8))))])
<span class="linenos">1374</span>  , theorem prefixpoint_to_prefixpoint (pi A \
<span class="linenos">1375</span>     (! f \ ! x \ monotone ## A # f ==&gt; f # x &lt;&lt;= x ==&gt; f # (f # x) &lt;&lt;= f # x),
<span class="linenos">1376</span>    [then forall_i
<span class="linenos">1377</span>      (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1378</span>        then forall_i
<span class="linenos">1379</span>         (bind (A --&gt; prop) x10 \ then (conv (land_tac dd)) (itaut 6)))])
<span class="linenos">1380</span>  , theorem fixpoint_is_prefixpoint (pi A \
<span class="linenos">1381</span>     (! f \ monotone ## A # f ==&gt; f # (fixpoint ## A # f)&lt;&lt;= fixpoint ## A # f),
<span class="linenos">1382</span>     [then inv
<span class="linenos">1383</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1384</span>         then (conv dd)
<span class="linenos">1385</span>          (then inv
<span class="linenos">1386</span>            (bind A x10 \
<span class="linenos">1387</span>              then (conv (depth_tac (dd [fixpoint])))
<span class="linenos">1388</span>               (then (conv dd)
<span class="linenos">1389</span>                 (then (conv b)
<span class="linenos">1390</span>                   (then inv
<span class="linenos">1391</span>                     (bind (A --&gt; prop) x11 \
<span class="linenos">1392</span>                       thenl (cut (fixpoint ## A # x9 &lt;&lt;= x11))
<span class="linenos">1393</span>                        [thenl
<span class="linenos">1394</span>                          (cut (x9 # (fixpoint ## A # x9) &lt;&lt;= x9 # x11))
<span class="linenos">1395</span>                          [then (cutth in_subseteq)
<span class="linenos">1396</span>                            (then (lforall_last (x9 # x11))
<span class="linenos">1397</span>                              (then (lforall_last x11)
<span class="linenos">1398</span>                                (thenl apply_last [h,
<span class="linenos">1399</span>                                  then (cutth in_subseteq) (itaut 10)]))),
<span class="linenos">1400</span>                          thenl
<span class="linenos">1401</span>                           (m (monotone ## A # x9 ==&gt; x9 # (fixpoint ## A # x9) &lt;&lt;= x9 # x11))
<span class="linenos">1402</span>                           [itaut 10, then (conv (land_tac dd)) (itaut 10)]],
<span class="linenos">1403</span>                        then (applyth fixpoint_subseteq_any_prefixpoint) h])))))))])
<span class="linenos">1404</span>  , theorem fixpoint_is_fixpoint (pi A \
<span class="linenos">1405</span>    (! f \ monotone ## A # f ==&gt; is_fixpoint ## A # f # (fixpoint ## A # f)),
<span class="linenos">1406</span>    [then inv
<span class="linenos">1407</span>      (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1408</span>        then (conv (depth_tac (dd [is_fixpoint])))
<span class="linenos">1409</span>         (thenl inv [then (applyth fixpoint_is_prefixpoint) h,
<span class="linenos">1410</span>           then (applyth fixpoint_subseteq_any_prefixpoint)
<span class="linenos">1411</span>            (then (g (monotone ## A # x9))
<span class="linenos">1412</span>              (then (conv (land_tac dd))
<span class="linenos">1413</span>                (then inv
<span class="linenos">1414</span>                  (then apply (then (applyth fixpoint_is_prefixpoint) h)))))]))])
<span class="linenos">1415</span>
<span class="linenos">1416</span> /*********** Axiomatization of well-founded recursion ********/
<span class="linenos">1417</span> , decl rec (pi A \pi B \ ((A --&gt; B) --&gt; (A --&gt; B)) --&gt; (A --&gt; B))
<span class="linenos">1418</span> , inductive_def acc accF accF_monotone acc_i0 acc_e0 acc_e
<span class="linenos">1419</span>    (pi A \ param (A --&gt; A --&gt; prop) lt \ acc \
<span class="linenos">1420</span>     [ (acc_i, ! x \ (! y \ lt # y # x ==&gt; acc # y) ==&gt; acc # x) ])
<span class="linenos">1421</span>
<span class="linenos">1422</span> , def well_founded (pi A \ ((A --&gt; A --&gt; prop) --&gt; prop,
<span class="linenos">1423</span>    lam (_ A) lt \ ! x \ acc ## A # lt # x))
<span class="linenos">1424</span>
<span class="linenos">1425</span> , axiom rec_is_fixpoint (pi A \ pi B \
<span class="linenos">1426</span>   (! lt \ well_founded ## A # lt ==&gt;
<span class="linenos">1427</span>    ! ((A --&gt; B) --&gt; (A --&gt; B)) h \
<span class="linenos">1428</span>     (! f \ ! g \ ! i \
<span class="linenos">1429</span>       (! p \ lt # p # i ==&gt; f # p = g # p) ==&gt; h # f # i = h # g # i) ==&gt;
<span class="linenos">1430</span>     rec ## A ## B # h = h # (rec ## A ## B # h)))
<span class="linenos">1431</span> /******************* TESTS *****************/
<span class="linenos">1432</span> /* The first three tests are commented out because they require extra-hacks
<span class="linenos">1433</span>    in the kernel to avoid quantifying over p, q and g.
<span class="linenos">1434</span> , theorem test_apply (p ==&gt; (p ==&gt; p ==&gt; q) ==&gt; q,
<span class="linenos">1435</span>    [then i (then i (then apply h))])
<span class="linenos">1436</span> , theorem test_apply2 (p ==&gt; (! x \ ! y \ x ==&gt; x ==&gt; y) ==&gt; q,
<span class="linenos">1437</span>    [then i (then i (then apply h))])
<span class="linenos">1438</span> , theorem test_itaut_1 (((? x \ g x) ==&gt; ! x \ (! y \ g y ==&gt; x) ==&gt; x),
<span class="linenos">1439</span>   [itaut 4])*/
<span class="linenos">1440</span> , theorem test_monotone1 (monotone ## _ # (lam _ p \ lam _ x \ not # (p # x) ==&gt; tt &amp;&amp; p # tt || p # x),
<span class="linenos">1441</span>   [ auto_monotone ])
<span class="linenos">1442</span> , theorem test_monotone2 (monotone ## _ # (lam _ p \ lam _ x \ ? z \ not # (p # x) ==&gt; tt &amp;&amp; p # tt || z),
<span class="linenos">1443</span>   [ auto_monotone ])
<span class="linenos">1444</span> , theorem test_monotone3 (monotone ## _ # (lam _ p \ lam _ x \ ! z \ ? y \ (not # (p # x) ==&gt; z &amp;&amp; p # y || y)),
<span class="linenos">1445</span>   [ auto_monotone ])
<span class="linenos">1446</span> , inductive_def pnn pnnF pnnF_monotone pnn_i pnn_e0 pnn_e (pnn \
<span class="linenos">1447</span>     [ (pnn_tt, pnn # tt)
<span class="linenos">1448</span>     , (pnn_not, ! x \ pnn # x ==&gt; pnn # (not # x))])
<span class="linenos">1449</span> , theorem pnn_e
<span class="linenos">1450</span>    ((! x13 \
<span class="linenos">1451</span>       x13 # tt &amp;&amp; (! x14 \ x13 # x14 ==&gt; x13 # (not # x14)) ==&gt;
<span class="linenos">1452</span>        (! x14 \ pnn # x14 ==&gt; x13 # x14)) ,
<span class="linenos">1453</span>   [then forall_i
<span class="linenos">1454</span>     (bind (prop --&gt; prop) x13 \
<span class="linenos">1455</span>       then (cutth pnn_e0)
<span class="linenos">1456</span>        (then (lforall x13)
<span class="linenos">1457</span>          (then i
<span class="linenos">1458</span>            (thenl lapply
<span class="linenos">1459</span>              [then (conv (depth_tac (dd [pnnF])))
<span class="linenos">1460</span>                (then forall_i
<span class="linenos">1461</span>                  (bind prop x14 \
<span class="linenos">1462</span>                    then i
<span class="linenos">1463</span>                     % from now on the proof is ad-hoc + fragile
<span class="linenos">1464</span>                     (thenl left [then (conv (depth_tac h)) (itaut 1),
<span class="linenos">1465</span>                       then left
<span class="linenos">1466</span>                        (bind prop x15 \
<span class="linenos">1467</span>                          then left (then (conv (depth_tac h)) (itaut 8)))]))),
<span class="linenos">1468</span>              h]))))])
<span class="linenos">1469</span> , theorem pnn_has_two_values
<span class="linenos">1470</span>    ((! x13 \ pnn # x13 ==&gt; x13 = tt || x13 = ff) ,
<span class="linenos">1471</span>    % applying an elimination principle is hard: it should be automatized
<span class="linenos">1472</span>    [then (cutth pnn_e)
<span class="linenos">1473</span>      (then (lforall (lam prop x13 \ or # (eq ## prop # x13 # tt) # (eq ## prop # x13 # ff)))
<span class="linenos">1474</span>        (thenl lapply
<span class="linenos">1475</span>          [thenl conj [then (conv b) (itaut 1),
<span class="linenos">1476</span>            then (repeat (conv (depth_tac b)))
<span class="linenos">1477</span>             (then forall_i (bind prop x13 \ then i (then left (itaut 8))))],
<span class="linenos">1478</span>          then inv
<span class="linenos">1479</span>           (bind prop x13 \
<span class="linenos">1480</span>             then (lforall x13)
<span class="linenos">1481</span>              (thenl lapply [h,
<span class="linenos">1482</span>                then
<span class="linenos">1483</span>                 (g
<span class="linenos">1484</span>                   ((lam prop x14 \ or # (eq ## prop # x14 # tt) # (eq ## prop # x14 # ff)) &#39;
<span class="linenos">1485</span>                     x13))
<span class="linenos">1486</span>                 (then (repeat (conv (depth_tac b)))
<span class="linenos">1487</span>                   (then
<span class="linenos">1488</span>                     (w
<span class="linenos">1489</span>                       ((lam prop x14 \ or # (eq ## prop # x14 # tt) # (eq ## prop # x14 # ff))
<span class="linenos">1490</span>                         # x13)) (then (w (pnn # x13)) (itaut 2))))]))]))])
<span class="linenos">1491</span> , inductive_def in_two in_twoF in_twoF_monotone in_two_i in_two_e0 in_two_e (in_two \
<span class="linenos">1492</span>     [ (in_two_tt, in_two # tt)
<span class="linenos">1493</span>     , (in_two_ff, in_two # ff) ])
<span class="linenos">1494</span> , new_basic_type bool2 myrep2 myabs2 myrepabs2 myabsrep2 myproprep2
<span class="linenos">1495</span>    (pnn,
<span class="linenos">1496</span>    [then (cutth pnn_tt) (then (applyth exists_i) h)])
<span class="linenos">1497</span> , def mytt (bool2,(myabs2 # tt))
<span class="linenos">1498</span> , def mynot ((bool2 --&gt; bool2),(lam _ x \ myabs2 # (not # (myrep2 # x))))
<span class="linenos">1499</span> , theorem mytt_transfer
<span class="linenos">1500</span>   (myrep2 # mytt = tt ,
<span class="linenos">1501</span>     [then (conv (depth_tac (dd [mytt])))
<span class="linenos">1502</span>       (then (applyth myrepabs2) (applyth pnn_tt))])
<span class="linenos">1503</span> , theorem mynot_transfer
<span class="linenos">1504</span>   ((! x18 \ myrep2 # (mynot # x18) = not # (myrep2 # x18)) ,
<span class="linenos">1505</span>     [then (conv (depth_tac (dd [mynot])))
<span class="linenos">1506</span>       (then forall_i
<span class="linenos">1507</span>         (bind bool2 x18 \
<span class="linenos">1508</span>           then (applyth myrepabs2)
<span class="linenos">1509</span>            (then (applyth pnn_not) (applyth myproprep2))))])
<span class="linenos">1510</span> , theorem mybool2_e
<span class="linenos">1511</span> ((! x18 \
<span class="linenos">1512</span>    x18 # mytt &amp;&amp; (! x19 \ x18 # x19 ==&gt; x18 # (mynot # x19)) ==&gt;
<span class="linenos">1513</span>     (! x19 \ x18 # x19)) ,
<span class="linenos">1514</span>   [thenl
<span class="linenos">1515</span>     (cut
<span class="linenos">1516</span>       (forall ## (bool2 --&gt; prop) &#39;
<span class="linenos">1517</span>         (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1518</span>           impl &#39;
<span class="linenos">1519</span>            (and # (x18 # (myabs2 # (myrep2 # mytt))) &#39;
<span class="linenos">1520</span>              (forall ## bool2 &#39;
<span class="linenos">1521</span>                (lam bool2 x19 \
<span class="linenos">1522</span>                  impl # (x18 # (myabs2 # (myrep2 # x19))) &#39;
<span class="linenos">1523</span>                   (x18 &#39;
<span class="linenos">1524</span>                     (myabs2 &#39;
<span class="linenos">1525</span>                       (myrep2 # (mynot # (myabs2 # (myrep2 # x19)))))))))
<span class="linenos">1526</span>            &#39;
<span class="linenos">1527</span>            (forall ## bool2 &#39;
<span class="linenos">1528</span>              (lam bool2 x19 \ x18 # (myabs2 # (myrep2 # x19)))))))
<span class="linenos">1529</span>     [then
<span class="linenos">1530</span>       (g
<span class="linenos">1531</span>         (forall ## (bool2 --&gt; prop) &#39;
<span class="linenos">1532</span>           (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1533</span>             impl &#39;
<span class="linenos">1534</span>              (and # (x18 # (myabs2 # (myrep2 # mytt))) &#39;
<span class="linenos">1535</span>                (forall ## bool2 &#39;
<span class="linenos">1536</span>                  (lam bool2 x19 \
<span class="linenos">1537</span>                    impl # (x18 # (myabs2 # (myrep2 # x19))) &#39;
<span class="linenos">1538</span>                     (x18 &#39;
<span class="linenos">1539</span>                       (myabs2 &#39;
<span class="linenos">1540</span>                         (myrep2 # (mynot # (myabs2 # (myrep2 # x19)))))))))
<span class="linenos">1541</span>              &#39;
<span class="linenos">1542</span>              (forall ## bool2 &#39;
<span class="linenos">1543</span>                (lam bool2 x19 \ x18 # (myabs2 # (myrep2 # x19)))))))
<span class="linenos">1544</span>       (then
<span class="linenos">1545</span>         (w
<span class="linenos">1546</span>           (forall ## (bool2 --&gt; prop) &#39;
<span class="linenos">1547</span>             (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1548</span>               impl &#39;
<span class="linenos">1549</span>                (and # (x18 # (myabs2 # (myrep2 # mytt))) &#39;
<span class="linenos">1550</span>                  (forall ## bool2 &#39;
<span class="linenos">1551</span>                    (lam bool2 x19 \
<span class="linenos">1552</span>                      impl # (x18 # (myabs2 # (myrep2 # x19))) &#39;
<span class="linenos">1553</span>                       (x18 &#39;
<span class="linenos">1554</span>                         (myabs2 &#39;
<span class="linenos">1555</span>                           (myrep2 # (mynot # (myabs2 # (myrep2 # x19)))))))))
<span class="linenos">1556</span>                &#39;
<span class="linenos">1557</span>                (forall ## bool2 &#39;
<span class="linenos">1558</span>                  (lam bool2 x19 \ x18 # (myabs2 # (myrep2 # x19)))))))
<span class="linenos">1559</span>         (then (repeat (conv (depth_tac (applyth myabsrep2)))) (then i h))),
<span class="linenos">1560</span>     then forall_i
<span class="linenos">1561</span>      (bind (bool2 --&gt; prop) x18 \
<span class="linenos">1562</span>        then (cutth pnn_e)
<span class="linenos">1563</span>         (then
<span class="linenos">1564</span>           (lforall
<span class="linenos">1565</span>             (lam prop x19 \
<span class="linenos">1566</span>               exists ## bool2 &#39;
<span class="linenos">1567</span>                (lam bool2 x20 \
<span class="linenos">1568</span>                  and # (eq ## _ # x19 # (myrep2 # x20)) &#39;
<span class="linenos">1569</span>                   (x18 # (myabs2 # x19)))))
<span class="linenos">1570</span>           (then inv
<span class="linenos">1571</span>             (bind bool2 x19 \
<span class="linenos">1572</span>               thenl
<span class="linenos">1573</span>                (cut
<span class="linenos">1574</span>                  ((lam prop x20 \
<span class="linenos">1575</span>                     exists ## bool2 &#39;
<span class="linenos">1576</span>                      (lam bool2 x21 \
<span class="linenos">1577</span>                        and # (eq ## _ # x20 # (myrep2 # x21)) &#39;
<span class="linenos">1578</span>                         (x18 # (myabs2 # x20)))) # (myrep2 # x19)))
<span class="linenos">1579</span>                [then
<span class="linenos">1580</span>                  (g
<span class="linenos">1581</span>                    ((lam prop x20 \
<span class="linenos">1582</span>                       exists ## bool2 &#39;
<span class="linenos">1583</span>                        (lam bool2 x21 \
<span class="linenos">1584</span>                          and # (eq ## _ # x20 # (myrep2 # x21)) &#39;
<span class="linenos">1585</span>                           (x18 # (myabs2 # x20)))) # (myrep2 # x19)))
<span class="linenos">1586</span>                  (then (conv (depth_tac b)) inv),
<span class="linenos">1587</span>                thenl apply
<span class="linenos">1588</span>                 [then (repeat (conv (depth_tac b)))
<span class="linenos">1589</span>                   (thenl inv
<span class="linenos">1590</span>                     [then (cutth exists_i)
<span class="linenos">1591</span>                       (then
<span class="linenos">1592</span>                         (lforall_last
<span class="linenos">1593</span>                           (lam bool2 x20 \
<span class="linenos">1594</span>                             and # (eq ## _ # tt # (myrep2 # x20)) &#39;
<span class="linenos">1595</span>                              (x18 # (myabs2 # tt))))
<span class="linenos">1596</span>                         (then (lforall_last mytt)
<span class="linenos">1597</span>                           (then apply_last (then (conv b)
<span class="linenos">1598</span>                            (thenl inv
<span class="linenos">1599</span>                             [then (cutth mytt_transfer)
<span class="linenos">1600</span>                               (then (conv (depth_tac h)) (applyth tt_intro)),
<span class="linenos">1601</span>                             (applyth tt_intro),
<span class="linenos">1602</span>                             then (cutth mytt_transfer)
<span class="linenos">1603</span>                              (then (g (x18 # (myabs2 # (myrep2 # mytt))))
<span class="linenos">1604</span>                                (then (conv (depth_tac h)) (then i h)))]))))),
<span class="linenos">1605</span>                     (bind prop x20 \
<span class="linenos">1606</span>                       bind bool2 x21 \
<span class="linenos">1607</span>                        then (cutth exists_i)
<span class="linenos">1608</span>                         (then
<span class="linenos">1609</span>                           (lforall_last
<span class="linenos">1610</span>                             (lam bool2 x22 \
<span class="linenos">1611</span>                               and # (eq ## _ # (not # x20) # (myrep2 # x22)) &#39;
<span class="linenos">1612</span>                                (x18 # (myabs2 # (not # x20)))))
<span class="linenos">1613</span>                           (then (lforall_last (mynot # x21))
<span class="linenos">1614</span>                             (then apply_last (then (conv b)
<span class="linenos">1615</span>    (thenl inv
<span class="linenos">1616</span>     [then (conv (applyth mynot_transfer))
<span class="linenos">1617</span>       (then (conv (depth_tac (dd [not]))) (then inv (itaut 3))),
<span class="linenos">1618</span>     then (g (myrep2 # (mynot # x21)))
<span class="linenos">1619</span>      (then (conv (land_tac (applyth mynot_transfer)))
<span class="linenos">1620</span>        (then (conv (depth_tac (dd [not]))) (then inv (itaut 3)))),
<span class="linenos">1621</span>     then (lforall (myabs2 # x20))
<span class="linenos">1622</span>      (thenl lapply [then (conv (depth_tac (applyth myabsrep2))) h,
<span class="linenos">1623</span>        then
<span class="linenos">1624</span>         (g
<span class="linenos">1625</span>           (x18 &#39;
<span class="linenos">1626</span>             (myabs2 &#39;
<span class="linenos">1627</span>               (myrep2 # (mynot # (myabs2 # (myrep2 # (myabs2 # x20))))))))
<span class="linenos">1628</span>         (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1629</span>           (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1630</span>             (thenl (cut (x20 = myrep2 # x21))
<span class="linenos">1631</span>               [then (conv (depth_tac h))
<span class="linenos">1632</span>                 (then (conv (depth_tac h))
<span class="linenos">1633</span>                   (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1634</span>                     (then i
<span class="linenos">1635</span>                       (then
<span class="linenos">1636</span>                         (conv
<span class="linenos">1637</span>                           (rand_tac
<span class="linenos">1638</span>                             (rand_tac (then sym (applyth mynot_transfer)))))
<span class="linenos">1639</span>                         (then (conv (depth_tac (applyth myabsrep2))) h))))),
<span class="linenos">1640</span>               itaut 2])))])]))))))]),
<span class="linenos">1641</span>                 applyth myproprep2]]))))]])
<span class="linenos">1642</span>
<span class="linenos">1643</span>, theorem step0
<span class="linenos">1644</span>    ((! x13 \ mynot # (mynot # (mynot # x13)) = mynot # x13) ,
<span class="linenos">1645</span>     [then inv
<span class="linenos">1646</span>      (bind bool2 x13 \
<span class="linenos">1647</span>        then (repeat (conv (depth_tac (dd [mynot]))))
<span class="linenos">1648</span>         (thenl (conv (land_tac (rand_tac (rand_tac (applyth myrepabs2)))))
<span class="linenos">1649</span>          [then (cutth pnn_not)
<span class="linenos">1650</span>            (then (lforall (myrep2 # (myabs2 # (not # (myrep2 # x13)))))
<span class="linenos">1651</span>              (then (cutth myproprep2)
<span class="linenos">1652</span>                (then (lforall (myabs2 # (not # (myrep2 # x13))))
<span class="linenos">1653</span>                  (then apply h)))),
<span class="linenos">1654</span>          thenl
<span class="linenos">1655</span>           (conv
<span class="linenos">1656</span>             (land_tac
<span class="linenos">1657</span>               (rand_tac (rand_tac (rand_tac (applyth myrepabs2))))))
<span class="linenos">1658</span>           [then (cutth pnn_not)
<span class="linenos">1659</span>             (then (lforall (myrep2 # x13))
<span class="linenos">1660</span>               (then (cutth myproprep2)
<span class="linenos">1661</span>                 (then (lforall x13) (then apply h)))),
<span class="linenos">1662</span>           then (conv (land_tac (rand_tac (applyth not_not_not)))) r]]))])
<span class="linenos">1663</span> , theorem mynot_mynot_mytt
<span class="linenos">1664</span>    (mynot # (mynot # mytt) = mytt ,
<span class="linenos">1665</span>     [then (conv (depth_tac (dd [mynot])))
<span class="linenos">1666</span>      (then (cutth mynot_transfer)
<span class="linenos">1667</span>        (then (lforall mytt)
<span class="linenos">1668</span>          (then (conv (depth_tac h))
<span class="linenos">1669</span>            (then (cutth mytt_transfer)
<span class="linenos">1670</span>              (then (conv (depth_tac h))
<span class="linenos">1671</span>                (then (conv (depth_tac (dd [mytt]))) (thenl c [r, itaut 3])))))))])
<span class="linenos">1672</span> , theorem step1
<span class="linenos">1673</span>    ((! x18 \ x18 = mytt || x18 = mynot # mytt) ,
<span class="linenos">1674</span>     [then forall_i
<span class="linenos">1675</span>      (bind bool2 x18 \
<span class="linenos">1676</span>       then (cutth mybool2_e)
<span class="linenos">1677</span>        (thenl
<span class="linenos">1678</span>          (cut
<span class="linenos">1679</span>            ((lam bool2 x19 \
<span class="linenos">1680</span>               or # (eq ## _ # x19 # mytt) # (eq ## _ # x19 # (mynot # mytt))) # x18))
<span class="linenos">1681</span>          [then
<span class="linenos">1682</span>            (g
<span class="linenos">1683</span>              ((lam bool2 x19 \
<span class="linenos">1684</span>                 or # (eq ## _ # x19 # mytt) # (eq ## _ # x19 # (mynot # mytt))) &#39;
<span class="linenos">1685</span>                x18)) (then (conv (depth_tac b)) (then i h)),
<span class="linenos">1686</span>          then apply
<span class="linenos">1687</span>           (then (repeat (conv (depth_tac b)))
<span class="linenos">1688</span>             (thenl conj [then (applyth orl) r,
<span class="linenos">1689</span>               thenl inv
<span class="linenos">1690</span>                [(bind bool2 x19 \
<span class="linenos">1691</span>                   then (applyth orr) (then (conv (depth_tac h)) r)),
<span class="linenos">1692</span>                (bind bool2 x19 \
<span class="linenos">1693</span>                  then (applyth orl) (then (conv (depth_tac h)) (applyth mynot_mynot_mytt)))]]))]))])
<span class="linenos">1694</span>
<span class="linenos">1695</span> /******* Cartesian product of types ******/
<span class="linenos">1696</span> /* TODO: this is an inductive type as well: generalize
<span class="linenos">1697</span>    inductive_type to type abstractions */
<span class="linenos">1698</span> , def is_pair (pi A \ pi B \
<span class="linenos">1699</span>  (univ ## (disj_union ## A ## B) ## prop --&gt; prop),
<span class="linenos">1700</span>  lam (_ A B) p \ ? A a \ ? B b \
<span class="linenos">1701</span>   p =
<span class="linenos">1702</span>    pair_univ ## (_ A B) ## _ &#39;
<span class="linenos">1703</span>     (injection_univ ## (_ A B) ## _ # (inj1_disj_union ## A ## B # a)) &#39;
<span class="linenos">1704</span>     (injection_univ ## (_ A B) ## _ # (inj2_disj_union ## A ## B # b)))
<span class="linenos">1705</span> , new_basic_type prod prod_rep prod_abs prod_repabs prod_absrep prod_proprep
<span class="linenos">1706</span>    (pi A \ pi B \ is_pair ## A ## B, [daemon])
<span class="linenos">1707</span> , def pair (pi A \ pi B \
<span class="linenos">1708</span>    (A --&gt; B --&gt; prod ## A ## B,
<span class="linenos">1709</span>    lam A a \ lam B b \
<span class="linenos">1710</span>     prod_abs ## A ## B &#39;
<span class="linenos">1711</span>      (pair_univ ## (_ A B) ## _ &#39;
<span class="linenos">1712</span>       (injection_univ ## (_ A B) ## _ # (inj1_disj_union ## A ## B # a)) &#39;
<span class="linenos">1713</span>       (injection_univ ## (_ A B) ## _ # (inj2_disj_union ## A ## B # b)))
<span class="linenos">1714</span>    ))
<span class="linenos">1715</span> /* TODO: define fst and snd and prove the usual lemmas
<span class="linenos">1716</span>    fst # (pair # a # b) = a */
<span class="linenos">1717</span>
<span class="linenos">1718</span>  /************* Natural numbers ***************/
<span class="linenos">1719</span> , inductive_def is_nat is_natF is_nat_monotone is_nat_i is_nat_e0 is_nat_e
<span class="linenos">1720</span>   (is_nat \
<span class="linenos">1721</span>     [ (is_nat_z, is_nat # (inj1_univ ## prop ## prop # (injection_univ ## prop ## prop # ff)))
<span class="linenos">1722</span>     , (is_nat_s, ! x \ is_nat # x ==&gt; is_nat # (inj2_univ ## prop ## prop # x))])
<span class="linenos">1723</span> , new_basic_type nat nat_rep nat_abs nat_repabs nat_absrep nat_proprep
<span class="linenos">1724</span>    (is_nat,
<span class="linenos">1725</span>    [then (cutth is_nat_z) (then (applyth exists_i) h)])
<span class="linenos">1726</span> , def z (nat, nat_abs # (inj1_univ ## prop ## prop # (injection_univ ## prop ## prop # ff)))
<span class="linenos">1727</span> , def s (nat --&gt; nat,
<span class="linenos">1728</span>    (lam _ x \ nat_abs # (inj2_univ ## prop ## prop # (nat_rep # x))))
<span class="linenos">1729</span> /* TODO: consequence of is_nat_e by transfer principles */
<span class="linenos">1730</span> , theorem nat_e ((! p \ p # z ==&gt; (! n \ p # n ==&gt; p # (s # n)) ==&gt; ! n \ p # n), [ daemon ])
<span class="linenos">1731</span> , theorem nat_abs_inj
<span class="linenos">1732</span>   ((! x18 \
<span class="linenos">1733</span>      ! x19 \
<span class="linenos">1734</span>       is_nat # x18 ==&gt;
<span class="linenos">1735</span>        is_nat # x19 ==&gt; nat_abs # x18 = nat_abs # x19 ==&gt; x18 = x19) ,
<span class="linenos">1736</span>     [then inv
<span class="linenos">1737</span>       (bind _ x18 \
<span class="linenos">1738</span>         bind _ x19 \
<span class="linenos">1739</span>          thenl (conv (land_tac (then sym (applyth nat_repabs)))) [h,
<span class="linenos">1740</span>           thenl (conv (rand_tac (then sym (applyth nat_repabs)))) [h,
<span class="linenos">1741</span>            then (conv (depth_tac h)) r]])])
<span class="linenos">1742</span> , theorem nat_rep_inj
<span class="linenos">1743</span>   ((! x18 \ ! x19 \ nat_rep # x18 = nat_rep # x19 ==&gt; x18 = x19) ,
<span class="linenos">1744</span>     [then inv
<span class="linenos">1745</span>       (bind nat x18 \
<span class="linenos">1746</span>         bind nat x19 \
<span class="linenos">1747</span>          then (conv (land_tac (then sym (applyth nat_absrep))))
<span class="linenos">1748</span>           (then (conv (rand_tac (then sym (applyth nat_absrep))))
<span class="linenos">1749</span>             (then (conv (depth_tac h)) r)))])
<span class="linenos">1750</span> , theorem s_inj ((! x18 \ ! x19 \ s # x18 = s # x19 ==&gt; x18 = x19) ,
<span class="linenos">1751</span>     [then (repeat (conv (depth_tac (dd [s]))))
<span class="linenos">1752</span>       (then inv
<span class="linenos">1753</span>         (bind nat x18 \
<span class="linenos">1754</span>           bind nat x19 \
<span class="linenos">1755</span>            then (applyth nat_rep_inj)
<span class="linenos">1756</span>             (then (applyth inj2_univ_inj)
<span class="linenos">1757</span>               (thenl (applyth nat_abs_inj)
<span class="linenos">1758</span>                 [then (applyth is_nat_s) (applyth nat_proprep),
<span class="linenos">1759</span>                 then (applyth is_nat_s) (applyth nat_proprep), h]))))])
<span class="linenos">1760</span> , theorem not_equal_z_s ((! x20 \ not # (z = s # x20)) ,
<span class="linenos">1761</span>     [then (repeat (conv (depth_tac (dd [z]))))
<span class="linenos">1762</span>       (then (repeat (conv (depth_tac (dd [s]))))
<span class="linenos">1763</span>         (then (repeat (conv (depth_tac (dd [not]))))
<span class="linenos">1764</span>           (then inv
<span class="linenos">1765</span>             (bind nat x20 \
<span class="linenos">1766</span>               then (applyth not_eq_inj1_inj2_univ)
<span class="linenos">1767</span>                (thenl (thenl (applyth nat_abs_inj) [id, id, h])
<span class="linenos">1768</span>                  [applyth is_nat_z,
<span class="linenos">1769</span>                  then (applyth is_nat_s) (applyth nat_proprep)])))))])
<span class="linenos">1770</span> , def nat_case (pi A \ (nat --&gt; A --&gt; (nat --&gt; A) --&gt; A,
<span class="linenos">1771</span>    lam _ n \ lam (_ A) a \ lam (_ A) f \
<span class="linenos">1772</span>     case_univ ## prop ## prop ## A # (nat_rep # n) # (lam _ x \ a) # (lam _ p \ f # (nat_abs # p))))
<span class="linenos">1773</span> , theorem nat_case_z (pi A \ ((! x21 \ ! x22 \ nat_case ## A # z # x21 # x22 = x21) ,
<span class="linenos">1774</span>      [then (conv (depth_tac (dd [nat_case])))
<span class="linenos">1775</span>        (then (conv (depth_tac (dd [z])))
<span class="linenos">1776</span>          (then forall_i
<span class="linenos">1777</span>            (bind A x21 \
<span class="linenos">1778</span>              then forall_i
<span class="linenos">1779</span>               (bind (nat --&gt; A) x22 \
<span class="linenos">1780</span>                 thenl
<span class="linenos">1781</span>                  (conv (land_tac (rator_tac (land_tac (applyth nat_repabs)))))
<span class="linenos">1782</span>                  [applyth is_nat_z,
<span class="linenos">1783</span>                   then (conv (depth_tac (applyth case_univ_inj1)))
<span class="linenos">1784</span>                    (then (conv (depth_tac b)) r)]))))]))
<span class="linenos">1785</span> , theorem nat_case_s
<span class="linenos">1786</span>   (pi A \ (! x21 \ ! x22 \ ! x23 \
<span class="linenos">1787</span>     nat_case ## A # (s # x21) # x22 # x23 = x23 # x21),
<span class="linenos">1788</span>     [then (conv (depth_tac (dd [nat_case])))
<span class="linenos">1789</span>       (then (conv (depth_tac (dd [s])))
<span class="linenos">1790</span>         (then forall_i
<span class="linenos">1791</span>           (bind nat x21 \
<span class="linenos">1792</span>             then forall_i
<span class="linenos">1793</span>              (bind A x22 \
<span class="linenos">1794</span>                then forall_i
<span class="linenos">1795</span>                 (bind (nat --&gt; A) x23 \
<span class="linenos">1796</span>                   thenl
<span class="linenos">1797</span>                    (conv (land_tac (rator_tac (land_tac (applyth nat_repabs)))))
<span class="linenos">1798</span>                    [then (applyth is_nat_s) (applyth nat_proprep),
<span class="linenos">1799</span>                     then (conv (depth_tac (applyth case_univ_inj2)))
<span class="linenos">1800</span>                     (then (conv (depth_tac b))
<span class="linenos">1801</span>                       (then (conv (depth_tac (applyth nat_absrep))) r))])))))])
<span class="linenos">1802</span>
<span class="linenos">1803</span>
<span class="linenos">1804</span> , theorem pred_well_founded
<span class="linenos">1805</span>   (well_founded ## nat # (lam nat x21 \ lam nat x22 \ x22 = s # x21) ,
<span class="linenos">1806</span>   [then (conv dd)
<span class="linenos">1807</span>     (then forall_i
<span class="linenos">1808</span>       (bind nat x21 \
<span class="linenos">1809</span>         thenl (applyth nat_e)
<span class="linenos">1810</span>          [then (applyth acc_i)
<span class="linenos">1811</span>            (then (repeat (conv (depth_tac b)))
<span class="linenos">1812</span>              (then inv
<span class="linenos">1813</span>                (bind nat x22 \
<span class="linenos">1814</span>                  then (applyth ff_elim) (then (cutth not_equal_z_s) (itaut 4))))),
<span class="linenos">1815</span>          then inv
<span class="linenos">1816</span>           (bind nat x22 \
<span class="linenos">1817</span>             then (applyth acc_i)
<span class="linenos">1818</span>              (then (repeat (conv (depth_tac b)))
<span class="linenos">1819</span>                (then inv
<span class="linenos">1820</span>                  (bind nat x23 \
<span class="linenos">1821</span>                    then (cutth s_inj)
<span class="linenos">1822</span>                     (then (lforall x22)
<span class="linenos">1823</span>                       (then (lforall x23)
<span class="linenos">1824</span>                         (thenl lapply [h,
<span class="linenos">1825</span>                           then (conv (rand_tac (then sym h))) h])))))))]))])
<span class="linenos">1826</span> , def nat_recF (pi A \
<span class="linenos">1827</span>    A --&gt; (nat --&gt; A --&gt; A) --&gt; (nat --&gt; A) --&gt; (nat --&gt; A)
<span class="linenos">1828</span>    , lam A a \ lam (_ A) f \ lam (_ A) rec \ lam _ n \
<span class="linenos">1829</span>       nat_case ## A # n # a # (lam _ p \ f # p # (rec # p)))
<span class="linenos">1830</span> , def nat_rec (pi A \
<span class="linenos">1831</span>    A --&gt; (nat --&gt; A --&gt; A) --&gt; nat --&gt; A
<span class="linenos">1832</span>    , lam A a \ lam (_ A) f \ rec ## nat ## A # (nat_recF ## A # a # f))
<span class="linenos">1833</span> , theorem nat_rec_ok0 (pi A \
<span class="linenos">1834</span>   ((! a \ ! f \
<span class="linenos">1835</span>     nat_rec ## A # a # f = nat_recF ## A # a # f # (nat_rec ## A # a # f)) ,
<span class="linenos">1836</span>   [then inv
<span class="linenos">1837</span>     (bind A x22 \
<span class="linenos">1838</span>       bind (nat --&gt; A --&gt; A) x23 \
<span class="linenos">1839</span>        then (repeat (conv (depth_tac (dd [nat_rec]))))
<span class="linenos">1840</span>         (thenl (applyth rec_is_fixpoint) [applyth pred_well_founded,
<span class="linenos">1841</span>           then (repeat (conv (depth_tac b)))
<span class="linenos">1842</span>            (then (repeat (conv (depth_tac (dd [nat_recF]))))
<span class="linenos">1843</span>              (then forall_i
<span class="linenos">1844</span>                (bind (nat --&gt; A) x24 \
<span class="linenos">1845</span>                  then forall_i
<span class="linenos">1846</span>                   (bind (nat --&gt; A) x25 \
<span class="linenos">1847</span>                     then (conv (rand_tac beta_expand))
<span class="linenos">1848</span>                      (thenl (applyth nat_e)
<span class="linenos">1849</span>                        [then (conv (depth_tac b))
<span class="linenos">1850</span>                          (then inv
<span class="linenos">1851</span>                            (then (conv (land_tac (applyth nat_case_z)))
<span class="linenos">1852</span>                              (then (conv (rand_tac (applyth nat_case_z))) r))),
<span class="linenos">1853</span>                        then (repeat (conv (depth_tac b)))
<span class="linenos">1854</span>                         (then inv
<span class="linenos">1855</span>                           (bind nat x26 \
<span class="linenos">1856</span>                             then (conv (rand_tac (applyth nat_case_s)))
<span class="linenos">1857</span>                              (then (conv (land_tac (applyth nat_case_s)))
<span class="linenos">1858</span>                                (then (repeat (conv (depth_tac b)))
<span class="linenos">1859</span>                                  (then (lforall x26)
<span class="linenos">1860</span>                                    (thenl lapply [r,
<span class="linenos">1861</span>                                      then (conv (land_tac (rand_tac h))) r]))))))])))))]))]))
<span class="linenos">1862</span> , theorem nat_rec_ok (pi A \
<span class="linenos">1863</span>   (! a \ ! f \ ! n \
<span class="linenos">1864</span>     nat_rec ## A # a # f # n =
<span class="linenos">1865</span>      nat_case ## A # n # a # (lam _ p \ f # p # (nat_rec ## A # a # f # p))),
<span class="linenos">1866</span>   [then inv
<span class="linenos">1867</span>     (bind A x22 \
<span class="linenos">1868</span>       bind (nat --&gt; A --&gt; A) x23 \
<span class="linenos">1869</span>        bind nat x24 \
<span class="linenos">1870</span>         then (conv (land_tac (rator_tac (applyth nat_rec_ok0))))
<span class="linenos">1871</span>          (then (conv (depth_tac (dd [nat_recF]))) r))])
<span class="linenos">1872</span>
<span class="linenos">1873</span> /************* Arithmetics: plus ***************/
<span class="linenos">1874</span> , def plus (nat --&gt; nat --&gt; nat,
<span class="linenos">1875</span>    lam _ n \ lam _ m \
<span class="linenos">1876</span>     nat_rec ## _ # m # (lam _ p \ lam _ sum \ s # sum)&#39; n)
<span class="linenos">1877</span> , theorem plus_z ((! n \ z + n = n),
<span class="linenos">1878</span>   [then (conv (depth_tac (dd [plus])))
<span class="linenos">1879</span>     (then inv
<span class="linenos">1880</span>       (bind nat x21 \
<span class="linenos">1881</span>         then (conv (land_tac (applyth nat_rec_ok)))
<span class="linenos">1882</span>          (then (conv (land_tac (applyth nat_case_z))) r)))])
<span class="linenos">1883</span> , theorem plus_s ((! n \ ! m \  s # n + m = s # (n + m)),
<span class="linenos">1884</span>   [then (repeat (conv (depth_tac (dd [plus]))))
<span class="linenos">1885</span>     (then inv
<span class="linenos">1886</span>       (bind nat x21 \
<span class="linenos">1887</span>         bind nat x22 \
<span class="linenos">1888</span>          then (conv (land_tac (applyth nat_rec_ok)))
<span class="linenos">1889</span>           (then (conv (land_tac (applyth nat_case_s)))
<span class="linenos">1890</span>             (then (repeat (conv (depth_tac b))) r))))])
<span class="linenos">1891</span> , theorem plus_n_z ((! n \ n + z = n),
<span class="linenos">1892</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1893</span>     (thenl (applyth nat_e) [then (conv b) (applyth plus_z),
<span class="linenos">1894</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1895</span>        (then inv
<span class="linenos">1896</span>          (bind nat x21 \
<span class="linenos">1897</span>            then (conv (land_tac (applyth plus_s)))
<span class="linenos">1898</span>             (then (conv (depth_tac h)) r)))])])
<span class="linenos">1899</span> , theorem plus_n_s ((! n \ ! m \ n + (s # m) = s # (n + m)),
<span class="linenos">1900</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1901</span>     (thenl (applyth nat_e)
<span class="linenos">1902</span>       [then (conv b)
<span class="linenos">1903</span>         (then inv
<span class="linenos">1904</span>           (bind nat x21 \ then (repeat (conv (depth_tac (applyth plus_z)))) r)),
<span class="linenos">1905</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1906</span>        (then inv
<span class="linenos">1907</span>          (bind nat x21 \
<span class="linenos">1908</span>            bind nat x22 \
<span class="linenos">1909</span>             then (conv (land_tac (applyth plus_s)))
<span class="linenos">1910</span>              (thenl c [r,
<span class="linenos">1911</span>                then (conv (land_tac apply)) (then sym (applyth plus_s))])))])])
<span class="linenos">1912</span> , theorem plus_comm ((! n \ ! m \ n + m = m + n),
<span class="linenos">1913</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1914</span>     (thenl (applyth nat_e)
<span class="linenos">1915</span>       [then (conv b)
<span class="linenos">1916</span>         (then inv
<span class="linenos">1917</span>           (bind nat x21 \
<span class="linenos">1918</span>             then (conv (land_tac (applyth plus_z)))
<span class="linenos">1919</span>              (then sym (applyth plus_n_z)))),
<span class="linenos">1920</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1921</span>        (then inv
<span class="linenos">1922</span>          (bind nat x21 \
<span class="linenos">1923</span>            bind nat x22 \
<span class="linenos">1924</span>             then (conv (land_tac (applyth plus_s)))
<span class="linenos">1925</span>              (then sym
<span class="linenos">1926</span>                (then (conv (land_tac (applyth plus_n_s)))
<span class="linenos">1927</span>                  (thenl c [r, then sym apply])))))])])
<span class="linenos">1928</span>
<span class="linenos">1929</span> ].
<span class="linenos">1930</span>
<span class="linenos">1931</span>/* Status and dependencies of the tactics:
<span class="linenos">1932</span>+dd:
<span class="linenos">1933</span>+sym:
<span class="linenos">1934</span>+eq_true_intro: (th tt_intro)
<span class="linenos">1935</span>+forall_i: dd eq_true_intro
<span class="linenos">1936</span>+conj: dd eq_true_intro
<span class="linenos">1937</span>+andr: dd tt_intro
<span class="linenos">1938</span>+andl: dd tt_intro
<span class="linenos">1939</span>+forall_e: sym dd
<span class="linenos">1940</span>+mp: andr sym dd
<span class="linenos">1941</span>+i: dd andl conj
<span class="linenos">1942</span>+cut: andr sym dd i
<span class="linenos">1943</span>+cutth: cut
<span class="linenos">1944</span>+lapply*: mp
<span class="linenos">1945</span>+lforall*: mp forall_e
<span class="linenos">1946</span>+apply*: lapply lforall
<span class="linenos">1947</span>+applyth: cutth apply*
<span class="linenos">1948</span>
<span class="linenos">1949</span>- f converional sometimes fails
<span class="linenos">1950</span>- conv (depth_tac) diverges when applied to terms that contain
<span class="linenos">1951</span>  metavariables
<span class="linenos">1952</span>- repeat is not implemented using progress, that is not even there
<span class="linenos">1953</span>*/
<span class="linenos">1954</span>
<span class="linenos">1955</span>/*
<span class="linenos">1956</span>-2.5) in the proof for myprop, at the end I provide the
<span class="linenos">1957</span>  witness (and X X) where X remains free (and it is not even pi-quantified).
<span class="linenos">1958</span>  If prop was empty, then X could not exist. On the other hand, if X was
<span class="linenos">1959</span>  empty, then there would be no need to provide the proof at all.
<span class="linenos">1960</span>  In any case, the symptom for X remaining free at the end of a proof is
<span class="linenos">1961</span>  one or more goals delayed on it. We never check for them and we have
<span class="linenos">1962</span>  no way atm to do that. See bug -3)
<span class="linenos">1963</span>
<span class="linenos">1964</span>-2) the test apply_2 is very slow: why?
<span class="linenos">1965</span>    same for the witness for myprop
<span class="linenos">1966</span>
<span class="linenos">1967</span>0) definitions must not be recursive; typing should capture it
<span class="linenos">1968</span>   (but not if declare_constraint is commented out...)
<span class="linenos">1969</span>
<span class="linenos">1970</span>0.25) occurr check in bind case still missing :-(
<span class="linenos">1971</span>
<span class="linenos">1972</span>0.50) case AppUvar vs AppUVar in unification is bugged (e.g.)
<span class="linenos">1973</span>      X^2 x0 x1 = X^2 x0 x1
<span class="linenos">1974</span>
<span class="linenos">1975</span>2) we need to fix the ELPI problems about handling of metavariables.
<span class="linenos">1976</span> I have already discussed with Enrico about them and he could have a
<span class="linenos">1977</span> shot at them. Namely:
<span class="linenos">1978</span> a) occur check + optimization to avoid it when possible (IN PROGRESS)
<span class="linenos">1979</span> b) unimplemented cases of restriction (IN PROGRESS)
<span class="linenos">1980</span>
<span class="linenos">1981</span>3) once we let metavariables reach the goals, the current HOL-light 
<span class="linenos">1982</span> tactic implementation becomes too fragile. We should let the user 
<span class="linenos">1983</span> refer to hypotheses at least by number if not by name. But we better
<span class="linenos">1984</span> have a bidirectional successor/predecessor via declare_constraint
<span class="linenos">1985</span>
<span class="linenos">1986</span>5) we could implement an automated theorem prover in lambdaProlog
<span class="linenos">1987</span> that works or is interfaced with the HOL-light code. There are
<span class="linenos">1988</span> complete provers like leanCOP 2.0 that are only 10 lines of code,
<span class="linenos">1989</span> but use some Prolog tricks.
<span class="linenos">1990</span>
<span class="linenos">1991</span>6) we should do a small formalization, possibly developing a tactic,
<span class="linenos">1992</span> to prove that everything is working. For example, a decision procedure
<span class="linenos">1993</span> for rings or for linear inequations.
<span class="linenos">1994</span>
<span class="linenos">1995</span>*/
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hollight.elpi&quot;, line 231, column 18, character 8433:</span>
<span class="go">Malformed mode declaration. Example:</span>
<span class="go">mode (foo i i o).</span>
</pre></div>
</div>
<p><strong>../../tests/sources/hollight_legacy.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">   1</span>% vim: set ft=lprolog:
<span class="linenos">   2</span>
<span class="linenos">   3</span>infixr --&gt; 126. % type arrow
<span class="linenos">   4</span>infixl &#39;   255. % infix application
<span class="linenos">   5</span>infixl &#39;&#39;  255. % infix System-F application
<span class="linenos">   6</span>infixl &amp;&amp;  128. % and
<span class="linenos">   7</span>infixl `or  127. % or
<span class="linenos">   8</span>infixr ==&gt; 126. % implication
<span class="linenos">   9</span>infixr &lt;=&gt; 125. % iff
<span class="linenos">  10</span>infix  #in 135. % membership
<span class="linenos">  11</span>infix  &lt;&lt;= 130. % subseteq
<span class="linenos">  12</span>
<span class="linenos">  13</span>/* Untrusted predicates called from the kernel:
<span class="linenos">  14</span> * next_object            next object to check
<span class="linenos">  15</span> * callback_proved        proof completed
<span class="linenos">  16</span> * next_tactic            next tactic to use
<span class="linenos">  17</span> * update_certificate     get new certificate after tactic application
<span class="linenos">  18</span> * end_of_proof           is the certificate/proof empty?
<span class="linenos">  19</span> * ppterm                 for pretty-printing messages
<span class="linenos">  20</span> * deftac                 tactic definition
<span class="linenos">  21</span> */
<span class="linenos">  22</span>
<span class="linenos">  23</span>/* Predicates exported from the trusted library:
<span class="linenos">  24</span> * append
<span class="linenos">  25</span> * fold2_append
<span class="linenos">  26</span> * put_binds
<span class="linenos">  27</span> */
<span class="linenos">  28</span> 
<span class="linenos">  29</span>/* Predicates exported from the kernel:
<span class="linenos">  30</span> * proves
<span class="linenos">  31</span> * check
<span class="linenos">  32</span> */
<span class="linenos">  33</span>
<span class="linenos">  34</span>{ /***** Trusted code base *******/
<span class="linenos">  35</span>
<span class="linenos">  36</span>/***** Trusted library functions *****/
<span class="linenos">  37</span>
<span class="linenos">  38</span>/* The names with &#39; at the end are trusted; the ones without are
<span class="linenos">  39</span>   exported and therefore untrusted. */
<span class="linenos">  40</span>local append&#39;, fold2_append&#39;, put_binds&#39;.
<span class="linenos">  41</span>
<span class="linenos">  42</span>append&#39; [] L L.
<span class="linenos">  43</span>append&#39; [ X | XS ] L [ X | RES ] :- append&#39; XS L RES.
<span class="linenos">  44</span>append A B C :- append&#39; A B C.
<span class="linenos">  45</span>
<span class="linenos">  46</span>fold2_append&#39; [] [] _ [].
<span class="linenos">  47</span>fold2_append&#39; [ X | XS ] [ Y | YS ] F OUTS :-
<span class="linenos">  48</span> F X Y OUT, fold2_append&#39; XS YS F OUTS2, append&#39; OUT OUTS2 OUTS.
<span class="linenos">  49</span>fold2_append A B C D :- fold2_append&#39; A B C D.
<span class="linenos">  50</span>
<span class="linenos">  51</span>% put_binds : list &#39;b -&gt; &#39;a -&gt; &#39;c -&gt; list (bounded &#39;b) -&gt; o
<span class="linenos">  52</span>% put_binds [ f1,...,fn ] x t [ bind t x \ f1,...,bind t x fn ]
<span class="linenos">  53</span>% binding all the xs that occur in f1,...,fn
<span class="linenos">  54</span>put_binds&#39; [] _ _ [].
<span class="linenos">  55</span>put_binds&#39; [ YX | YSX ] X A [ bind A Y | YYS ] :-
<span class="linenos">  56</span> YX = Y X, put_binds&#39; YSX X A YYS.
<span class="linenos">  57</span>put_binds A B C D :- put_binds&#39; A B C D.
<span class="linenos">  58</span>
<span class="linenos">  59</span>/***** The HOL kernel *****/
<span class="linenos">  60</span>
<span class="linenos">  61</span>local thm, provable, def0, term, typ, typ&#39;, loop, prove, check1,
<span class="linenos">  62</span> check1def, check1thm, check1axm, check1nbt,
<span class="linenos">  63</span> reterm, not_defined, check_hyps.
<span class="linenos">  64</span>
<span class="linenos">  65</span>proves T TY :- provable T TY.
<span class="linenos">  66</span>
<span class="linenos">  67</span>typ T :- !. % this line temporarily drops checking of well-formedness for types
<span class="linenos">  68</span>            % to avoid too much slow down. It is ultimately due to re-typing
<span class="linenos">  69</span>            % terms that should be recognized as already well typed.
<span class="linenos">  70</span>typ T :- var T, !, declare_constraint (typ T) [ T ].
<span class="linenos">  71</span>typ T :- typ&#39; T.
<span class="linenos">  72</span>typ&#39; prop.
<span class="linenos">  73</span>typ&#39; (univ &#39;&#39; A &#39;&#39; B) :- typ A, typ B.
<span class="linenos">  74</span>typ&#39; (A --&gt; B) :- typ A, typ B.
<span class="linenos">  75</span>typ&#39; (disj_union &#39;&#39; A &#39;&#39; B) :- typ A, typ B.
<span class="linenos">  76</span>
<span class="linenos">  77</span>mode (term i o).
<span class="linenos">  78</span>term (lam A F) (A --&gt; B) :- typ A, pi x\ term x A =&gt; term (F x) B.
<span class="linenos">  79</span>term (F &#39; T) B :- term F (A --&gt; B), term T A.
<span class="linenos">  80</span>term (eq &#39;&#39; A) (A --&gt; A --&gt; prop) :- typ A.
<span class="linenos">  81</span>term (uvar as T) TY :- declare_constraint (term T TY) T.
<span class="linenos">  82</span>
<span class="linenos">  83</span>/* like term, but on terms that are already known to be well-typed */
<span class="linenos">  84</span>mode (reterm i o).
<span class="linenos">  85</span>reterm (lam A F) (A --&gt; B) :- pi x\ reterm x A =&gt; reterm (F x) B.
<span class="linenos">  86</span>reterm (F &#39; T) B :- reterm F (A --&gt; B).
<span class="linenos">  87</span>reterm (eq &#39;&#39; A) (A --&gt; A --&gt; prop).
<span class="linenos">  88</span>reterm (uvar as T) TY :- declare_constraint (reterm T TY) T.
<span class="linenos">  89</span>
<span class="linenos">  90</span>constraint term reterm { /* No propagation rules for now */}
<span class="linenos">  91</span>
<span class="linenos">  92</span>% thm : bounded tactic -&gt; bounded sequent -&gt; list (bounded sequent) -&gt; o
<span class="linenos">  93</span>thm C (seq Gamma G) _ :- debug, print Gamma &quot;|- &quot; G &quot; := &quot; C, fail.
<span class="linenos">  94</span>
<span class="linenos">  95</span>/* &lt;&lt; HACKS FOR DEBUGGING */
<span class="linenos">  96</span>thm daemon (seq Gamma F) [].
<span class="linenos">  97</span>/* &gt;&gt; HACKS FOR DEBUGGING */
<span class="linenos">  98</span>
<span class="linenos">  99</span>thm r (seq Gamma (eq &#39;&#39; _ &#39; X &#39; X)) [].
<span class="linenos"> 100</span>thm (t Y) (seq Gamma (eq &#39;&#39; A &#39; X &#39; Z))
<span class="linenos"> 101</span> [ seq Gamma (eq &#39;&#39; A &#39; X &#39; Y), seq Gamma (eq &#39;&#39; A &#39; Y &#39; Z) ] :- term Y A.
<span class="linenos"> 102</span>thm (m P) (seq Gamma Q) [ seq Gamma (eq &#39;&#39; prop &#39; P &#39; Q), seq Gamma P ] :- term P prop.
<span class="linenos"> 103</span>thm b (seq Gamma (eq &#39;&#39; _ &#39; ((lam _ F) &#39; X) &#39; (F X))) [].
<span class="linenos"> 104</span>thm c (seq Gamma (eq &#39;&#39; B &#39; (F &#39; X) &#39; (G &#39; Y)))
<span class="linenos"> 105</span> [ seq Gamma (eq &#39;&#39; (A --&gt; B) &#39; F &#39; G) , seq Gamma (eq &#39;&#39; A &#39; X &#39; Y) ] :- reterm X A, reterm Y A.
<span class="linenos"> 106</span>thm k (seq Gamma (eq &#39;&#39; (A --&gt; B) &#39; (lam A S) &#39; (lam A T)))
<span class="linenos"> 107</span> [ bind A x \ seq Gamma (eq &#39;&#39; B &#39; (S x) &#39; (T x)) ].
<span class="linenos"> 108</span>thm s (seq Gamma (eq &#39;&#39; prop &#39; P &#39; Q)) [ seq (P :: Gamma) Q, seq (Q :: Gamma) P ].
<span class="linenos"> 109</span>thm (h IGN) (seq Gamma P) [] :- append&#39; IGN [ P | Gamma2 ] Gamma.
<span class="linenos"> 110</span>
<span class="linenos"> 111</span>thm d (seq Gamma (eq &#39;&#39; _ &#39; C &#39; A)) [] :- def0 C A.
<span class="linenos"> 112</span>thm (th NAME) (seq _ G) [] :- provable NAME G.
<span class="linenos"> 113</span>
<span class="linenos"> 114</span>thm (thenll TAC1 TACN) SEQ SEQS :-
<span class="linenos"> 115</span> thm TAC1 SEQ NEW,
<span class="linenos"> 116</span> deftacl TACN NEW TACL,
<span class="linenos"> 117</span> fold2_append&#39; TACL NEW thm SEQS.
<span class="linenos"> 118</span>
<span class="linenos"> 119</span>/*debprint _ (then _ _) :- !.
<span class="linenos"> 120</span>debprint _ (thenl _ _) :- !.
<span class="linenos"> 121</span>debprint O T :- print O T.*/
<span class="linenos"> 122</span>
<span class="linenos"> 123</span>thm TAC SEQ SEQS :-
<span class="linenos"> 124</span> deftac TAC SEQ XTAC,
<span class="linenos"> 125</span> /*debprint &quot;&lt;&lt;&quot; TAC,
<span class="linenos"> 126</span> (*/ thm XTAC SEQ SEQS /*, debprint &quot;&gt;&gt;&quot; TAC
<span class="linenos"> 127</span> ; debprint &quot;XX&quot; TAC, fail)*/.
<span class="linenos"> 128</span>
<span class="linenos"> 129</span>thm (! TAC) SEQ SEQS :-
<span class="linenos"> 130</span> thm TAC SEQ SEQS,
<span class="linenos"> 131</span> !.
<span class="linenos"> 132</span>
<span class="linenos"> 133</span>thm id SEQ [ SEQ ].
<span class="linenos"> 134</span>
<span class="linenos"> 135</span>thm (wl Gamma1) (seq Gamma F) [ seq WGamma F ] :-
<span class="linenos"> 136</span> append&#39; Gamma1 [ P | Gamma2 ] Gamma,
<span class="linenos"> 137</span> append&#39; Gamma1 Gamma2 WGamma.
<span class="linenos"> 138</span>
<span class="linenos"> 139</span>thm (bind A TAC) (bind A SEQ) NEWL :-
<span class="linenos"> 140</span> pi x \ term x A =&gt; reterm x A =&gt; thm (TAC x) (SEQ x) (NEW x), put_binds&#39; (NEW x) x A NEWL.
<span class="linenos"> 141</span>
<span class="linenos"> 142</span>thm ww (bind A x \ SEQ) [ SEQ ].
<span class="linenos"> 143</span>
<span class="linenos"> 144</span>/* debuggin only, remove it */
<span class="linenos"> 145</span>%thm A B C :- print &quot;FAILED &quot; (thm A B C), fail.
<span class="linenos"> 146</span>
<span class="linenos"> 147</span>% loop : list (bounded sequent) -&gt; certificate -&gt; o
<span class="linenos"> 148</span>%loop SEQS TACS :- print &quot;LOOP&quot; (loop SEQS TACS), fail.
<span class="linenos"> 149</span>loop [] CERTIFICATE :- end_of_proof CERTIFICATE.
<span class="linenos"> 150</span>loop [ SEQ | OLD ] CERTIFICATE :-
<span class="linenos"> 151</span> next_tactic [ SEQ | OLD ] CERTIFICATE ITAC,
<span class="linenos"> 152</span> thm ITAC SEQ NEW,
<span class="linenos"> 153</span> append&#39; NEW OLD SEQS,
<span class="linenos"> 154</span> update_certificate CERTIFICATE ITAC NEW NEW_CERTIFICATE,
<span class="linenos"> 155</span> loop SEQS NEW_CERTIFICATE.
<span class="linenos"> 156</span>
<span class="linenos"> 157</span>prove G TACS :-
<span class="linenos"> 158</span> (term G prop, ! ; ppterm PG G, print &quot;Bad statement:&quot; PG, fail),
<span class="linenos"> 159</span>% (TACS = (false,_), ! ;
<span class="linenos"> 160</span> loop [ seq [] G ] TACS
<span class="linenos"> 161</span>. % ).
<span class="linenos"> 162</span>
<span class="linenos"> 163</span>not_defined P NAME :-
<span class="linenos"> 164</span> not (P NAME _) ; print &quot;Error:&quot; NAME already defined, fail.
<span class="linenos"> 165</span>
<span class="linenos"> 166</span>check_hyps HS (typ&#39; TYPE) :-
<span class="linenos"> 167</span> (not (typ&#39; TYPE) ; print &quot;Error:&quot; TYPE already defined, fail), print HS new TYPE.
<span class="linenos"> 168</span>check_hyps HS (def0 NAME DEF) :- ppterm PDEF DEF, print HS NAME &quot;=&quot; PDEF.
<span class="linenos"> 169</span>check_hyps HS (term NAME TYPE) :-
<span class="linenos"> 170</span> not_defined term NAME, ppterm PTYPE TYPE, print HS NAME &quot;:&quot; PTYPE.
<span class="linenos"> 171</span>check_hyps HS (reterm _ _).
<span class="linenos"> 172</span>check_hyps HS (provable NAME TYPE) :-
<span class="linenos"> 173</span> not_defined provable NAME, ppterm PTYPE TYPE, print HS NAME &quot;:&quot; PTYPE.
<span class="linenos"> 174</span>check_hyps HS (H1,H2) :- check_hyps HS H1, check_hyps HS H2.
<span class="linenos"> 175</span>check_hyps HS (pi H) :- pi x \ typ&#39; x =&gt; check_hyps [x | HS] (H x).
<span class="linenos"> 176</span>check_hyps HS (_ =&gt; H2) :- check_hyps HS H2.
<span class="linenos"> 177</span>
<span class="linenos"> 178</span>/* check1 I O
<span class="linenos"> 179</span>   checks the declaration I
<span class="linenos"> 180</span>   returns the new assumption O */
<span class="linenos"> 181</span>check1 (theorem NAME GOALTACTICS) HYPS :- check1thm NAME GOALTACTICS HYPS, !.
<span class="linenos"> 182</span>check1 (axiom NAME ST) HYPS :- check1axm NAME ST HYPS, !.
<span class="linenos"> 183</span>check1 (new_basic_type TYPE REP ABS REPABS ABSREP PREPH P_TACTICS) HYPS :- check1nbt TYPE REP ABS REPABS ABSREP PREPH P_TACTICS true HYPS, !.
<span class="linenos"> 184</span>check1 (def NAME TYPDEF) HYPS :- check1def NAME TYPDEF true HYPS, !.
<span class="linenos"> 185</span>check1 (decl NAME TYP) HYPS :- check1decl NAME TYP true HYPS, !.
<span class="linenos"> 186</span>
<span class="linenos"> 187</span>check1def NAME (pi I) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 188</span> pi x \ typ&#39; x =&gt; check1def (NAME &#39;&#39; x) (I x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 189</span>check1def NAME (TYP,DEF) HYPSUCHTHAT HYPS :-
<span class="linenos"> 190</span> typ TYP, term DEF TYP,
<span class="linenos"> 191</span> HYPS = ((HYPSUCHTHAT =&gt; term NAME TYP), reterm NAME TYP, def0 NAME DEF).
<span class="linenos"> 192</span>
<span class="linenos"> 193</span>check1decl NAME (pi I) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 194</span> pi x \ typ&#39; x =&gt; check1decl (NAME &#39;&#39; x) (I x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 195</span>check1decl NAME TYP HYPSUCHTHAT HYPS :-
<span class="linenos"> 196</span> typ TYP, HYPS = ((HYPSUCHTHAT =&gt; term NAME TYP), reterm NAME TYP).
<span class="linenos"> 197</span>
<span class="linenos"> 198</span>check1thm NAME (pi I) (pi HYPS) :-
<span class="linenos"> 199</span> pi x \ typ&#39; x =&gt; check1thm NAME (I x) (HYPS x).
<span class="linenos"> 200</span>check1thm NAME (GOAL,TACTICS) (provable NAME GOAL) :-
<span class="linenos"> 201</span>  prove GOAL TACTICS,
<span class="linenos"> 202</span>  callback_proved NAME GOAL TACTICS.
<span class="linenos"> 203</span>
<span class="linenos"> 204</span>check1axm NAME (pi I) (pi HYPS) :- !,
<span class="linenos"> 205</span> pi x \ typ&#39; x =&gt; check1axm NAME (I x) (HYPS x).
<span class="linenos"> 206</span>check1axm NAME GOAL (provable NAME GOAL) :-
<span class="linenos"> 207</span> term GOAL prop, ! ; ppterm PGOAL GOAL, print &quot;Bad statement:&quot; PGOAL, fail.
<span class="linenos"> 208</span>
<span class="linenos"> 209</span>check1nbt TYPE REP ABS REPABS ABSREP PREPH (pi P_TACTICS) HYPSUCHTHAT (pi HYPS) :-
<span class="linenos"> 210</span> pi x \ typ&#39; x =&gt; check1nbt (TYPE &#39;&#39; x) (REP &#39;&#39; x) (ABS &#39;&#39; x) REPABS ABSREP PREPH (P_TACTICS x) (HYPSUCHTHAT, typ x) (HYPS x).
<span class="linenos"> 211</span>check1nbt TYPE REP ABS REPABS ABSREP PREPH (P,TACTICS) HYPSUCHTHAT HYPS :-
<span class="linenos"> 212</span>  term P (X --&gt; prop),
<span class="linenos"> 213</span>  prove (exists &#39;&#39; _ &#39; P ) TACTICS,
<span class="linenos"> 214</span>  callback_proved existence_condition (exists &#39;&#39; _ &#39; P) TACTICS,
<span class="linenos"> 215</span>  REPTYP = (TYPE --&gt; X),
<span class="linenos"> 216</span>  ABSTYP = (X --&gt; TYPE),
<span class="linenos"> 217</span>  ABSREPTYP = (forall &#39;&#39; TYPE &#39; lam TYPE x \ eq &#39;&#39; TYPE &#39; (ABS &#39; (REP &#39; x)) &#39; x),
<span class="linenos"> 218</span>  REPABSTYP = (forall &#39;&#39; X &#39; lam X x \ impl &#39; (P &#39; x) &#39; (eq &#39;&#39; X &#39; (REP &#39; (ABS &#39; x)) &#39; x)),
<span class="linenos"> 219</span>  PREPHTYP = (forall &#39;&#39; TYPE &#39; lam TYPE x \ (P &#39; (REP &#39; x))),
<span class="linenos"> 220</span>  !,
<span class="linenos"> 221</span>  HYPS =
<span class="linenos"> 222</span>   ( (HYPSUCHTHAT =&gt; typ&#39; TYPE)
<span class="linenos"> 223</span>   , (HYPSUCHTHAT =&gt; term REP REPTYP), reterm REP REPTYP
<span class="linenos"> 224</span>   , (HYPSUCHTHAT =&gt; term ABS ABSTYP), reterm ABS ABSTYP
<span class="linenos"> 225</span>   , provable ABSREP ABSREPTYP
<span class="linenos"> 226</span>   , provable REPABS REPABSTYP, provable PREPH PREPHTYP).
<span class="linenos"> 227</span>
<span class="linenos"> 228</span>check WHAT :-
<span class="linenos"> 229</span> next_object WHAT C CONT,
<span class="linenos"> 230</span> (C = stop, !, K = true ; check1 C H , check_hyps [] H, print_constraints, K = (H =&gt; check CONT)),
<span class="linenos"> 231</span> !, K.
<span class="linenos"> 232</span>
<span class="linenos"> 233</span>}
<span class="linenos"> 234</span>
<span class="linenos"> 235</span>/************ parsing and pretty-printing ********/
<span class="linenos"> 236</span>% ppterm/parseterm
<span class="linenos"> 237</span>%ppterm X Y :- ppp X Y. parseterm X Y :- ppp X Y.
<span class="linenos"> 238</span>%ppp X Y :- var X, var Y, !, X = Y.
<span class="linenos"> 239</span>%ppp X (F &#39; G) :- var X, (var F ; var G), !, X = (F &#39; G).
<span class="linenos"> 240</span>%ppp X (F &#39; G &#39; H) :- var X, (var F ; var G ; var H), !,
<span class="linenos"> 241</span>% X = (F &#39; G &#39; H).
<span class="linenos"> 242</span>
<span class="linenos"> 243</span>mode (ppp o i) xas ppterm, (ppp i o) xas parseterm.
<span class="linenos"> 244</span>
<span class="linenos"> 245</span>ppp (! F2) (forall &#39;&#39; _ &#39; lam _ F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 246</span>ppp (! TY F2) (forall &#39;&#39; TY &#39; lam TY F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 247</span>ppp (? F2) (exists &#39;&#39; _ &#39; lam _ F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 248</span>ppp (? TY F2) (exists &#39;&#39; TY &#39; lam TY F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 249</span>ppp (F2 &lt;=&gt; G2) (eq &#39;&#39; prop &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 250</span>ppp (F2 = G2) (eq &#39;&#39; _ &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 251</span>ppp (F2 &amp;&amp; G2) (and &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 252</span>ppp (F2 `or G2) (or &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 253</span>ppp (F2 ==&gt; G2) (impl &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 254</span>ppp (X2 #in S2) (in &#39;&#39; _ &#39; X1 &#39; S1) :- !, ppp X2 X1, ppp S2 S1.
<span class="linenos"> 255</span>ppp (U2 &lt;&lt;= V2) (subseteq &#39;&#39; _ &#39; U1 &#39; V1) :- !, ppp U2 U1, ppp V2 V1.
<span class="linenos"> 256</span>ppp (F2 + G2) (plus &#39; F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 257</span>ppp (F2 &#39; G2) (F1 &#39; G1) :- !, ppp F2 F1, ppp G2 G1.
<span class="linenos"> 258</span>ppp (lam A F2) (lam A F1) :- !, pi x \ ppp (F2 x) (F1 x).
<span class="linenos"> 259</span>ppp A A.
<span class="linenos"> 260</span>
<span class="linenos"> 261</span>/* safe_list_map that unifies the two lists if they are both flexible
<span class="linenos"> 262</span>   probably only useful for parsing/pretty-printing */
<span class="linenos"> 263</span>safe_list_map L1 _ L2 :- var L1, var L2, !, L1 = L2.
<span class="linenos"> 264</span>safe_list_map L1 F L2 :- list_map L1 F L2.
<span class="linenos"> 265</span>
<span class="linenos"> 266</span>% pptac(ppterm)/parsetac(parseterm)
<span class="linenos"> 267</span>% pptac X Y :- ppptac X Y.  parsetac X Y :- ppptac X Y.
<span class="linenos"> 268</span>
<span class="linenos"> 269</span>mode (ppptac i o) xas parsetac(ppp -&gt; parseterm),
<span class="linenos"> 270</span>     (ppptac o i) xas pptac(ppp -&gt; ppterm).
<span class="linenos"> 271</span>
<span class="linenos"> 272</span>ppptac daemon daemon.
<span class="linenos"> 273</span>ppptac r r.
<span class="linenos"> 274</span>ppptac (t Y) (t PY) :- ppp Y PY.
<span class="linenos"> 275</span>ppptac (m Y) (m PY) :- ppp Y PY.
<span class="linenos"> 276</span>ppptac b b.
<span class="linenos"> 277</span>ppptac c c.
<span class="linenos"> 278</span>ppptac k k.
<span class="linenos"> 279</span>ppptac s s.
<span class="linenos"> 280</span>ppptac (h Gamma) (h PGamma) :- safe_list_map Gamma ppp PGamma.
<span class="linenos"> 281</span>ppptac d d.
<span class="linenos"> 282</span>ppptac (th NAME) (th NAME).
<span class="linenos"> 283</span>ppptac (thenll TAC1 TACN) (thenll PTAC1 PTACN) :-
<span class="linenos"> 284</span> ppptac TAC1 PTAC1, ppptac TACN PTACN.
<span class="linenos"> 285</span>ppptac (! TAC) (! PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 286</span>ppptac id id.
<span class="linenos"> 287</span>ppptac (wl Gamma) (wl PGamma) :- safe_list_map Gamma ppp PGamma.
<span class="linenos"> 288</span>ppptac (bind A TAC) (bind PA PTAC) :-
<span class="linenos"> 289</span> ppp A PA, pi x \ ppptac (TAC x) (PTAC x).
<span class="linenos"> 290</span>ppptac ww ww.
<span class="linenos"> 291</span>
<span class="linenos"> 292</span>/************ interactive and non interactive loops ********/
<span class="linenos"> 293</span>
<span class="linenos"> 294</span>ppptac interactive interactive.
<span class="linenos"> 295</span>
<span class="linenos"> 296</span>parse_obj (theorem NAME PSTTAC) [theorem NAME STTAC] :-
<span class="linenos"> 297</span> parse_thm NAME PSTTAC STTAC.
<span class="linenos"> 298</span>parse_obj (axiom NAME PTYP) [axiom NAME TYP] :- parse_axiom PTYP TYP.
<span class="linenos"> 299</span>parse_obj (new_basic_type TYPE REP ABS REPABS ABSREP PREP PP_TACTICS)
<span class="linenos"> 300</span> [new_basic_type TYPE REP ABS REPABS ABSREP PREP P_TACTICS] :- parse_nbt PP_TACTICS P_TACTICS.
<span class="linenos"> 301</span>parse_obj (def NAME PTYBO) [def NAME TYBO] :- parse_def PTYBO TYBO.
<span class="linenos"> 302</span>parse_obj (decl NAME TY) [decl NAME TY].
<span class="linenos"> 303</span>parse_obj (inductive_def PRED PREDF PREDF_MON PRED_I PRED_E0 PRED_E K) EXP :-
<span class="linenos"> 304</span> inductive_def_pkg PRED PREDF PREDF_MON PRED_I PRED_E0 PRED_E K EXP.
<span class="linenos"> 305</span>parse_obj stop [stop].
<span class="linenos"> 306</span>
<span class="linenos"> 307</span>parse_def (pi I) (pi O) :- pi x \ parse_def (I x) (O x).
<span class="linenos"> 308</span>parse_def (TY,PB) (TY,B) :- parseterm PB B.
<span class="linenos"> 309</span>
<span class="linenos"> 310</span>parse_axiom (pi I) (pi O) :- !, pi x \ parse_axiom (I x) (O x).
<span class="linenos"> 311</span>parse_axiom PST ST :- parseterm PST ST.
<span class="linenos"> 312</span>
<span class="linenos"> 313</span>parse_thm NAME (pi I) (pi O) :- pi x \ parse_thm NAME (I x) (O x).
<span class="linenos"> 314</span>parse_thm _ (PST,TAC) (ST,(false,TAC)) :- !, parseterm PST ST.
<span class="linenos"> 315</span>parse_thm NAME PST (ST,(true,[_])) :-
<span class="linenos"> 316</span> (not (proves NAME _) ; print &quot;Error:&quot; NAME already defined, fail),
<span class="linenos"> 317</span> parseterm PST ST.
<span class="linenos"> 318</span>
<span class="linenos"> 319</span>parse_nbt (pi I) (pi O) :- !, pi x \ parse_nbt (I x) (O x).
<span class="linenos"> 320</span>parse_nbt (PP,TACTICS) (P,(false,TACTICS)) :- parseterm PP P.
<span class="linenos"> 321</span>parse_nbt PP (P,(true,[_])) :- parseterm PP P.
<span class="linenos"> 322</span>
<span class="linenos"> 323</span>next_object [ C | NEXT ] CT CONTNEXT :-
<span class="linenos"> 324</span>  parse_obj C [ CT | CONT ], append CONT NEXT CONTNEXT.
<span class="linenos"> 325</span>next_object [] C CONT :- 
<span class="linenos"> 326</span> print &quot;Welcome to HOL extra-light&quot;,
<span class="linenos"> 327</span> toplevel_loop [ C | CONT ].
<span class="linenos"> 328</span>next_object toplevel C CONT :- toplevel_loop [ C | CONT ].
<span class="linenos"> 329</span>
<span class="linenos"> 330</span>read_cmd H :-
<span class="linenos"> 331</span> print &quot;Enter a command or \&quot;stop.\&quot;&quot;,
<span class="linenos"> 332</span> flush std_out, $readterm std_in H,
<span class="linenos"> 333</span> !.
<span class="linenos"> 334</span>read_cmd H :- read_cmd H.
<span class="linenos"> 335</span>
<span class="linenos"> 336</span>toplevel_loop G :-
<span class="linenos"> 337</span> read_cmd H,
<span class="linenos"> 338</span> ( H = stop, !, G = [stop]
<span class="linenos"> 339</span> ; parse_obj H PH, !, (append PH toplevel G ; print &quot;error&quot;, toplevel_loop G)
<span class="linenos"> 340</span> ; print &quot;bad command&quot;, toplevel_loop G ).
<span class="linenos"> 341</span>
<span class="linenos"> 342</span>callback_proved _ _ (false,_).
<span class="linenos"> 343</span>callback_proved NAME G (true, [ TAC ]) :-
<span class="linenos"> 344</span> canonical TAC CANONICALTAC,
<span class="linenos"> 345</span> pptac PCANONICALTAC CANONICALTAC,
<span class="linenos"> 346</span> ppterm PG G,
<span class="linenos"> 347</span> print (theorem NAME (PG , [ PCANONICALTAC ] )).
<span class="linenos"> 348</span>
<span class="linenos"> 349</span>end_of_proof (true, []) :- print &quot;proof completed&quot;.
<span class="linenos"> 350</span>end_of_proof (false, []).
<span class="linenos"> 351</span>
<span class="linenos"> 352</span>next_tactic0 [ SEQ | OLD ] (true, [ _ | _ ]) ITAC :-
<span class="linenos"> 353</span> print,
<span class="linenos"> 354</span> list_iter_rev [ SEQ | OLD ] print_sequent,
<span class="linenos"> 355</span> read_in_context SEQ ITAC BACKTRACK,
<span class="linenos"> 356</span> BACKTRACK.
<span class="linenos"> 357</span>next_tactic0 SEQS (true, CERT) ITAC :-
<span class="linenos"> 358</span> print &quot;error&quot;,
<span class="linenos"> 359</span> next_tactic SEQS (true, CERT) ITAC.
<span class="linenos"> 360</span>next_tactic0 SEQS (true_then_false, (_,INT_TACS,_)) ITAC :-
<span class="linenos"> 361</span> next_tactic0 SEQS (true, INT_TACS) ITAC.
<span class="linenos"> 362</span>next_tactic0 SEQS (false, [ interactive | _ ]) ITAC :-
<span class="linenos"> 363</span> next_tactic0 SEQS (true, [ _ ]) ITAC.
<span class="linenos"> 364</span>next_tactic0 [ SEQ | OLD ] (false, [ TAC | _ ]) TAC.
<span class="linenos"> 365</span>next_tactic0 _ (false, _) ITAC :-
<span class="linenos"> 366</span> print &quot;aborted&quot;,
<span class="linenos"> 367</span> halt.
<span class="linenos"> 368</span>
<span class="linenos"> 369</span>next_tactic SEQS CERT TAC :- next_tactic0 SEQS CERT PTAC, parsetac PTAC TAC.
<span class="linenos"> 370</span>
<span class="linenos"> 371</span>update_certificate (true, [ TAC | OTHER_TACS ]) ITAC NEW (true, TACS) :-
<span class="linenos"> 372</span> mk_script ITAC NEW NEW_TACS TAC,
<span class="linenos"> 373</span> append NEW_TACS OTHER_TACS TACS.
<span class="linenos"> 374</span>update_certificate (false, [ interactive | NON_INTERACTIVE_TACS ]) ITAC NEW CERTIFICATE :-
<span class="linenos"> 375</span> update_certificate (true_then_false, (SCRIPT, [ SCRIPT ], NON_INTERACTIVE_TACS)) ITAC NEW CERTIFICATE.
<span class="linenos"> 376</span>update_certificate (true_then_false, (SCRIPT,[ TAC | OTHER_TACS ],NON_INTERACTIVE_TACS)) ITAC NEW CERTIFICATE :- !,
<span class="linenos"> 377</span> mk_script ITAC NEW NEW_INTERACTIVE_TACS TAC,
<span class="linenos"> 378</span> append NEW_INTERACTIVE_TACS OTHER_TACS INTERACTIVE_TACS,
<span class="linenos"> 379</span> ( INTERACTIVE_TACS = [ _ | _ ], !,
<span class="linenos"> 380</span>   CERTIFICATE =
<span class="linenos"> 381</span>    (true_then_false, (SCRIPT,INTERACTIVE_TACS,NON_INTERACTIVE_TACS))
<span class="linenos"> 382</span> ; CERTIFICATE = (false, NON_INTERACTIVE_TACS),
<span class="linenos"> 383</span>   print &quot;INTERACTIVE SUBPROOF COMPLETED&quot;,
<span class="linenos"> 384</span>   canonical SCRIPT CSCRIPT,
<span class="linenos"> 385</span>   pptac PSCRIPT CSCRIPT,
<span class="linenos"> 386</span>   print PSCRIPT).
<span class="linenos"> 387</span>update_certificate (false, [ _ | OTHER_TACS ]) _ _ (false, OTHER_TACS).
<span class="linenos"> 388</span>
<span class="linenos"> 389</span>mk_script (bind A T) NEW NEW_TACS (bind A T2) :- !,
<span class="linenos"> 390</span> pi x \
<span class="linenos"> 391</span>  put_binds (NEW2 x) x A NEW,
<span class="linenos"> 392</span>  mk_script (T x) (NEW2 x) (NEWT x) (T2 x),
<span class="linenos"> 393</span>  put_binds (NEWT x) x A NEW_TACS.
<span class="linenos"> 394</span>mk_script ITAC NEW NEW_TACS (thenl ITAC NEW_TACS) :-
<span class="linenos"> 395</span> mk_list_of_bounded_fresh NEW NEW_TACS.
<span class="linenos"> 396</span>
<span class="linenos"> 397</span>read_in_context (bind A K) (bind A TAC) BACKTRACK :-
<span class="linenos"> 398</span> pi x \ /* term x A =&gt; reterm &#39; x A =&gt; */ read_in_context (K x) (TAC x) BACKTRACK.
<span class="linenos"> 399</span>read_in_context (seq A B) TAC BACKTRACK :-
<span class="linenos"> 400</span> flush std_out, $readterm std_in TAC,
<span class="linenos"> 401</span> (TAC = backtrack, !, BACKTRACK = (!, fail) ; BACKTRACK = true).
<span class="linenos"> 402</span>
<span class="linenos"> 403</span>print_sequent (seq Gamma G) :-
<span class="linenos"> 404</span> print,
<span class="linenos"> 405</span> list_iter_rev Gamma (x \ sigma PX \ ppterm PX x, print PX),
<span class="linenos"> 406</span> print &quot;|------------------&quot;,
<span class="linenos"> 407</span> ppterm PG G, print PG.
<span class="linenos"> 408</span>print_sequent (bind A F) :- pi x \ print_sequent (F x).
<span class="linenos"> 409</span>
<span class="linenos"> 410</span>/* turns thenl into then */
<span class="linenos"> 411</span>canonical (bind A T1) (bind A T2) :- !,
<span class="linenos"> 412</span> pi x \ canonical (T1 x) (T2 x).
<span class="linenos"> 413</span>canonical (thenl T L) OTAC :- !,
<span class="linenos"> 414</span> list_map L canonical L2,
<span class="linenos"> 415</span> (mk_constant_list L2 S L2, !,
<span class="linenos"> 416</span>  (S = [], !, OTAC = T ; OTAC = then T S)
<span class="linenos"> 417</span> ; OTAC = thenl T L2).
<span class="linenos"> 418</span>canonical T T.
<span class="linenos"> 419</span>
<span class="linenos"> 420</span>/************ inductive_def package ********/
<span class="linenos"> 421</span>parse_inductive_def_spec (pi F) (pi PF) :- !,
<span class="linenos"> 422</span> pi A \ parse_inductive_def_spec (F A) (PF A).
<span class="linenos"> 423</span>parse_inductive_def_spec (param TY F) (param PTY PF) :- !,
<span class="linenos"> 424</span> ppp TY PTY, pi x \ parse_inductive_def_spec (F x) (PF x).
<span class="linenos"> 425</span>parse_inductive_def_spec L PL :-
<span class="linenos"> 426</span> (pi p \ list_map (L p)
<span class="linenos"> 427</span>  (x \ px \ sigma A \ sigma B \ sigma PB \ x = (A, B), parseterm B PB, px = (A, PB))
<span class="linenos"> 428</span>  (PL p)).
<span class="linenos"> 429</span>
<span class="linenos"> 430</span>build_quantified_predicate (pi I) (pi O) :- !,
<span class="linenos"> 431</span> pi A \ build_quantified_predicate (I A) (O A).
<span class="linenos"> 432</span>build_quantified_predicate (param TY I) (TY --&gt; TYP, lam TY BO) :- !,
<span class="linenos"> 433</span> pi x \ build_quantified_predicate (I x) (TYP, BO x).
<span class="linenos"> 434</span>build_quantified_predicate L (_, lam _ p \ lam _ x \ P p x) :-
<span class="linenos"> 435</span> pi p \ pi x \ build_predicate (L p) p x (P p x).
<span class="linenos"> 436</span>
<span class="linenos"> 437</span>build_predicate [ (_,K) ] P X R :- !,
<span class="linenos"> 438</span> process_constructor K P X R.
<span class="linenos"> 439</span>build_predicate [ (_,K) | REST ] P X (or &#39; Q &#39; R) :-
<span class="linenos"> 440</span> process_constructor K P X Q,
<span class="linenos"> 441</span> build_predicate REST P X R.
<span class="linenos"> 442</span>
<span class="linenos"> 443</span>process_constructor (forall &#39;&#39; TY &#39; lam TY Q) P X (exists &#39;&#39; TY &#39; lam TY R) :-
<span class="linenos"> 444</span> pi y \ process_constructor (Q y) P X (R y).
<span class="linenos"> 445</span>process_constructor (impl &#39; H &#39; K) P X (and &#39; H &#39; R) :-
<span class="linenos"> 446</span> process_constructor K P X R.
<span class="linenos"> 447</span>process_constructor (P &#39; T) P X (eq &#39;&#39; _ &#39; X &#39; T).
<span class="linenos"> 448</span>
<span class="linenos"> 449</span>prove_monotonicity_thm (pi F) PREDF APREDF (pi THM) :- !,
<span class="linenos"> 450</span> pi A \ prove_monotonicity_thm (F A) PREDF (APREDF &#39;&#39; A) (THM A).
<span class="linenos"> 451</span>prove_monotonicity_thm (param TY F) PREDF APREDF (forall &#39;&#39; TY &#39; lam TY STM, PROOF) :- !,
<span class="linenos"> 452</span> pi x \ prove_monotonicity_thm (F x) PREDF (APREDF &#39; x) (STM x, PROOF).
<span class="linenos"> 453</span>prove_monotonicity_thm _ PREDF APREDF THM :-
<span class="linenos"> 454</span> THM =
<span class="linenos"> 455</span>  (monotone &#39;&#39; _ &#39; APREDF,
<span class="linenos"> 456</span>   [ then inv (bind* (then (conv (depth_tac (dd [PREDF]))) auto_monotone)) ]).
<span class="linenos"> 457</span>
<span class="linenos"> 458</span>state_fixpoint_def (pi F) PREDF (pi DEF) :- !,
<span class="linenos"> 459</span> pi A \ state_fixpoint_def (F A) (PREDF &#39;&#39; A) (DEF A).
<span class="linenos"> 460</span>state_fixpoint_def (param TY F) PREDF (_, lam TY BO) :- !,
<span class="linenos"> 461</span> pi x \ state_fixpoint_def (F x) (PREDF &#39; x) (_, BO x).
<span class="linenos"> 462</span>state_fixpoint_def _ PREDF (_, fixpoint &#39;&#39; _ &#39; PREDF).
<span class="linenos"> 463</span>
<span class="linenos"> 464</span>prove_fix_intro_thm (pi F) PREDF PRED PREDF_MONOTONE (pi THM) :- !,
<span class="linenos"> 465</span> pi A \ prove_fix_intro_thm (F A) (PREDF &#39;&#39; A) (PRED &#39;&#39; A) PREDF_MONOTONE (THM A).
<span class="linenos"> 466</span>prove_fix_intro_thm (param TY F) PREDF PRED PREDF_MONOTONE (forall &#39;&#39; TY &#39; lam TY STM, [ then forall_i (bind _ PROOF) ]) :- !,
<span class="linenos"> 467</span> pi x \ prove_fix_intro_thm (F x) (PREDF &#39; x) (PRED &#39; x) PREDF_MONOTONE (STM x, [ PROOF x ]).
<span class="linenos"> 468</span>prove_fix_intro_thm _ PREDF PRED PREDF_MONOTONE THM :-
<span class="linenos"> 469</span> THM =
<span class="linenos"> 470</span>  ((! x \ PREDF &#39; PRED &#39; x ==&gt; PRED &#39; x),
<span class="linenos"> 471</span>   [then forall_i
<span class="linenos"> 472</span>     (bind _ x13 \
<span class="linenos"> 473</span>       then (conv (rand_tac (rator_tac dd)))
<span class="linenos"> 474</span>        (then (conv (land_tac (rator_tac (rand_tac dd))))
<span class="linenos"> 475</span>          (then inv
<span class="linenos"> 476</span>            (then (cutth fixpoint_is_prefixpoint)
<span class="linenos"> 477</span>              (then (lforall PREDF)
<span class="linenos"> 478</span>                (thenl lapply [applyth PREDF_MONOTONE,
<span class="linenos"> 479</span>                  then
<span class="linenos"> 480</span>                   (g
<span class="linenos"> 481</span>                     (subseteq &#39;&#39; _ &#39;
<span class="linenos"> 482</span>                       (PREDF &#39; (fixpoint &#39;&#39; _ &#39; PREDF)) &#39;
<span class="linenos"> 483</span>                       (fixpoint &#39;&#39; _ &#39; PREDF)))
<span class="linenos"> 484</span>                   (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 485</span>                     (then (conv (depth_tac (dd [in])))
<span class="linenos"> 486</span>                       (then (conv (depth_tac (dd [in])))(itaut 4))))]))))))]).
<span class="linenos"> 487</span>
<span class="linenos"> 488</span>prove_fix_elim_thm (pi F) PREDF PRED OPRED (pi THM) :- !,
<span class="linenos"> 489</span> pi A \ prove_fix_elim_thm (F A) (PREDF &#39;&#39; A) (PRED &#39;&#39; A) OPRED (THM A).
<span class="linenos"> 490</span>prove_fix_elim_thm (param TY F) PREDF PRED OPRED (forall &#39;&#39; TY &#39; lam TY STM, [ then forall_i (bind _ PROOF) ]) :- !,
<span class="linenos"> 491</span> pi x \ prove_fix_elim_thm (F x) (PREDF &#39; x) (PRED &#39; x) OPRED (STM x, [ PROOF x ]).
<span class="linenos"> 492</span>prove_fix_elim_thm _ PREDF PRED OPRED THM :-
<span class="linenos"> 493</span> THM =
<span class="linenos"> 494</span>  ((! x13 \
<span class="linenos"> 495</span>     (! x14 \ PREDF &#39; x13 &#39; x14 ==&gt; x13 &#39; x14) ==&gt;
<span class="linenos"> 496</span>      (! x14 \ PRED &#39; x14 ==&gt; x13 &#39; x14)) ,
<span class="linenos"> 497</span>    [then forall_i
<span class="linenos"> 498</span>      (bind _ x23 \
<span class="linenos"> 499</span>        then (cutth fixpoint_subseteq_any_prefixpoint)
<span class="linenos"> 500</span>         (then (lforall PREDF)
<span class="linenos"> 501</span>           (then (lforall x23)
<span class="linenos"> 502</span>             (then (conv (depth_tac (dd [OPRED])))
<span class="linenos"> 503</span>               (then inv
<span class="linenos"> 504</span>                 (bind _ x24 \
<span class="linenos"> 505</span>                   then
<span class="linenos"> 506</span>                    (g
<span class="linenos"> 507</span>                      (impl &#39; (subseteq &#39;&#39; _ &#39; (PREDF &#39; x23) &#39; x23) &#39;
<span class="linenos"> 508</span>                        (subseteq &#39;&#39; _ &#39; (fixpoint &#39;&#39; _ &#39; PREDF) &#39; x23)))
<span class="linenos"> 509</span>                    (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 510</span>                      (then (conv (depth_tac (dd [subseteq])))
<span class="linenos"> 511</span>                        (then (conv (depth_tac (dd [in])))
<span class="linenos"> 512</span>                          (then (conv (depth_tac (dd [in])))
<span class="linenos"> 513</span>                            (then (conv (depth_tac (dd [in])))
<span class="linenos"> 514</span>                              (then (conv (depth_tac (dd [in])))
<span class="linenos"> 515</span>                                (then
<span class="linenos"> 516</span>                                  (w
<span class="linenos"> 517</span>                                    (impl &#39;
<span class="linenos"> 518</span>                                      (subseteq &#39;&#39; _ &#39; (PREDF &#39; x23) &#39; x23) &#39;
<span class="linenos"> 519</span>                                      (subseteq &#39;&#39; _ &#39;
<span class="linenos"> 520</span>                                        (fixpoint &#39;&#39; _ &#39; PREDF) &#39; x23)))
<span class="linenos"> 521</span>                                  (then inv
<span class="linenos"> 522</span>                                    (thenl lapply_last [h,
<span class="linenos"> 523</span>                                      then (lforall_last x24)
<span class="linenos"> 524</span>                                       (then lapply_last h)])))))))))))))))]).
<span class="linenos"> 525</span>
<span class="linenos"> 526</span>prove_intro_thms (pi F) PRED PRED_I INTROTHMS :- !,
<span class="linenos"> 527</span> pi A \
<span class="linenos"> 528</span>  prove_intro_thms (F A) (PRED &#39;&#39; A) PRED_I (OUT A),
<span class="linenos"> 529</span>  list_map (OUT A)
<span class="linenos"> 530</span>   (i \ o \ sigma Y \ i = (theorem NAME (P A)), o = theorem NAME (pi P))
<span class="linenos"> 531</span>   INTROTHMS.
<span class="linenos"> 532</span>prove_intro_thms (param TY F) PRED PRED_I INTROTHMS :- !,
<span class="linenos"> 533</span> pi x \
<span class="linenos"> 534</span>  prove_intro_thms (F x) (PRED &#39; x) PRED_I (OUT x),
<span class="linenos"> 535</span>  list_map (OUT x)
<span class="linenos"> 536</span>   (i \ o \ sigma Y \
<span class="linenos"> 537</span>     i = (theorem NAME (STM x, [ PROOF x ])),
<span class="linenos"> 538</span>     o = theorem NAME (forall &#39;&#39; TY &#39; lam TY STM, [ then forall_i (bind TY PROOF) ]))
<span class="linenos"> 539</span>   INTROTHMS.
<span class="linenos"> 540</span>prove_intro_thms L PRED PRED_I INTROTHMS :-
<span class="linenos"> 541</span> list_map (L PRED) (mk_intro_thm PRED_I) INTROTHMS.
<span class="linenos"> 542</span>
<span class="linenos"> 543</span>mk_intro_thm PRED_I (NAME,ST)
<span class="linenos"> 544</span> (theorem NAME (ST,
<span class="linenos"> 545</span>   [ daemon /*(then inv (bind* (then (applyth PRED_I) (then (conv dd) (itauteq 6)))))*/ /* TOO MANY GOALS DELAYED ON typ (?): USE daemon INSTEAD */ ])).
<span class="linenos"> 546</span>
<span class="linenos"> 547</span>inductive_def_pkg PRED PREDF PREDF_MONOTONE PRED_I PRED_E0 PRED_E L OUT :-
<span class="linenos"> 548</span> parse_inductive_def_spec L PL,
<span class="linenos"> 549</span> build_quantified_predicate PL F,
<span class="linenos"> 550</span> prove_monotonicity_thm PL PREDF PREDF MONTHM,
<span class="linenos"> 551</span> state_fixpoint_def PL PREDF FIXDEF,
<span class="linenos"> 552</span> prove_fix_intro_thm PL PREDF PRED PREDF_MONOTONE INTROTHM,
<span class="linenos"> 553</span> prove_intro_thms PL PRED PRED_I INTROTHMS,
<span class="linenos"> 554</span> prove_fix_elim_thm PL PREDF PRED PRED ELIMTHM,
<span class="linenos"> 555</span> OUT1 =
<span class="linenos"> 556</span>  [ def PREDF F
<span class="linenos"> 557</span>  , theorem PREDF_MONOTONE MONTHM
<span class="linenos"> 558</span>  , def PRED FIXDEF
<span class="linenos"> 559</span>  , theorem PRED_I INTROTHM
<span class="linenos"> 560</span>  , theorem PRED_E0 ELIMTHM ],
<span class="linenos"> 561</span> append OUT1 INTROTHMS OUT.
<span class="linenos"> 562</span>
<span class="linenos"> 563</span>/************ library of basic data types ********/
<span class="linenos"> 564</span>mk_bounded_fresh (bind _ F) (bind _ G) :- !, pi x\ mk_bounded_fresh (F x) (G x).
<span class="linenos"> 565</span>mk_bounded_fresh _ X.
<span class="linenos"> 566</span>
<span class="linenos"> 567</span>mk_list_of_bounded_fresh [] [].
<span class="linenos"> 568</span>mk_list_of_bounded_fresh [S|L] [X|R] :-
<span class="linenos"> 569</span> mk_bounded_fresh S X, mk_list_of_bounded_fresh L R.
<span class="linenos"> 570</span>
<span class="linenos"> 571</span>/* list functions */
<span class="linenos"> 572</span>
<span class="linenos"> 573</span>list_map [] _ [].
<span class="linenos"> 574</span>list_map [X|XS] F [Y|YS] :- F X Y, list_map XS F YS.
<span class="linenos"> 575</span>
<span class="linenos"> 576</span>list_iter_rev [] _.
<span class="linenos"> 577</span>list_iter_rev [X|XS] F :- list_iter_rev XS F, F X.
<span class="linenos"> 578</span>
<span class="linenos"> 579</span>mem [ X | _ ] X, !.
<span class="linenos"> 580</span>mem [ _ | XS ] X :- mem XS X.
<span class="linenos"> 581</span>
<span class="linenos"> 582</span>mk_constant_list [] _ [].
<span class="linenos"> 583</span>mk_constant_list [_|L] X [X|R] :- mk_constant_list L X R.
<span class="linenos"> 584</span>
<span class="linenos"> 585</span>bang P :- P, !.
<span class="linenos"> 586</span>
<span class="linenos"> 587</span>/********** tacticals ********/
<span class="linenos"> 588</span>
<span class="linenos"> 589</span>% BUG in runtime.ml if the sigma is uncommented out. It does not matter btw.
<span class="linenos"> 590</span>/*sigma ff \*/ deftac fail SEQ ff.
<span class="linenos"> 591</span>
<span class="linenos"> 592</span>ppptac (constant_tacl TACL) (constant_tacl PTACL) :-
<span class="linenos"> 593</span> list_map TACL ppptac PTACL.
<span class="linenos"> 594</span>deftacl (constant_tacl TACL) SEQS TACL.
<span class="linenos"> 595</span>
<span class="linenos"> 596</span>ppptac (thenl TAC TACL) (thenl PTAC PTACL) :-
<span class="linenos"> 597</span> ppptac TAC PTAC, list_map TACL ppptac PTACL. 
<span class="linenos"> 598</span>deftac (thenl TAC TACL) SEQ XTAC :-
<span class="linenos"> 599</span> XTAC = thenll TAC (constant_tacl TACL).
<span class="linenos"> 600</span>
<span class="linenos"> 601</span>ppptac (all_equals_list TAC) (all_equals_list PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 602</span>deftacl (all_equals_list TAC2) SEQS TACL :-
<span class="linenos"> 603</span> mk_constant_list SEQS TAC2 TACL.
<span class="linenos"> 604</span>
<span class="linenos"> 605</span>ppptac (then TAC1 TAC2) (then PTAC1 PTAC2) :-
<span class="linenos"> 606</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 607</span>deftac (then TAC1 TAC2) SEQ XTAC :-
<span class="linenos"> 608</span> XTAC = thenll TAC1 (all_equals_list TAC2).
<span class="linenos"> 609</span>
<span class="linenos"> 610</span>ppptac (then! TAC1 TAC2) (then! PTAC1 PTAC2) :-
<span class="linenos"> 611</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 612</span>deftac (then! TAC1 TAC2) _ (then (! TAC1) TAC2).
<span class="linenos"> 613</span>
<span class="linenos"> 614</span>ppptac (orelse TAC1 TAC2) (orelse PTAC1 PTAC2) :-
<span class="linenos"> 615</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 616</span>deftac (orelse TAC1 TAC2) SEQ XTAC :-
<span class="linenos"> 617</span> XTAC = TAC1 ; XTAC = TAC2.
<span class="linenos"> 618</span>
<span class="linenos"> 619</span>ppptac (orelse! TAC1 TAC2) (orelse! PTAC1 PTAC2) :-
<span class="linenos"> 620</span> ppptac TAC1 PTAC1, ppptac TAC2 PTAC2.
<span class="linenos"> 621</span>deftac (orelse! TAC1 TAC2) _ (orelse (! TAC1) TAC2).
<span class="linenos"> 622</span>
<span class="linenos"> 623</span>ppptac (bind* TAC) (bind* PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 624</span>deftac (bind* TAC) SEQ (orelse! (bind _ x \ bind* TAC) TAC).
<span class="linenos"> 625</span>
<span class="linenos"> 626</span>ppptac (repeat TAC) (repeat PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 627</span>deftac (repeat TAC) SEQ XTAC :-
<span class="linenos"> 628</span> ( XTAC = then TAC (repeat (bind* TAC))
<span class="linenos"> 629</span> ; XTAC = id).
<span class="linenos"> 630</span>
<span class="linenos"> 631</span>ppptac (repeat! TAC) (repeat! PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 632</span>deftac (repeat! TAC) SEQ (orelse! (then! TAC (repeat! (bind* TAC))) id).
<span class="linenos"> 633</span>
<span class="linenos"> 634</span>ppptac (pptac TAC) (pptac PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 635</span>deftac (pptac TAC) SEQ TAC :-
<span class="linenos"> 636</span> print &quot;SEQ&quot; SEQ &quot;:=&quot; TAC.
<span class="linenos"> 637</span>
<span class="linenos"> 638</span>ppptac (time TAC) (time PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 639</span>deftac (time TAC) SEQ XTAC :-
<span class="linenos"> 640</span> $gettimeofday B,
<span class="linenos"> 641</span> XTAC = thenll TAC (time_after TAC B).
<span class="linenos"> 642</span>
<span class="linenos"> 643</span>ppptac (time_after TAC B) (time_after PTAC B) :- ppptac TAC PTAC.
<span class="linenos"> 644</span>deftacl (time_after TAC B) SEQS TACL :-
<span class="linenos"> 645</span> $gettimeofday A,
<span class="linenos"> 646</span> D is A - B,
<span class="linenos"> 647</span> mk_constant_list SEQS id TACL,
<span class="linenos"> 648</span> print &quot;TIME SPENT &quot; D &quot;FOR&quot; TAC.
<span class="linenos"> 649</span>
<span class="linenos"> 650</span>/* For debugging only (?) For capturing metavariables */
<span class="linenos"> 651</span>ppptac (inspect (seq Gamma F) TAC) (inspect (seq PGamma PF) PTAC) :-
<span class="linenos"> 652</span> list_map SEQ ppp PSEQ, ppp F PF, ppptac TAC PTAC.
<span class="linenos"> 653</span>deftac (inspect SEQ TAC) SEQ TAC.
<span class="linenos"> 654</span>
<span class="linenos"> 655</span>/********** tactics ********/
<span class="linenos"> 656</span>
<span class="linenos"> 657</span>ppptac (w G) (w PG) :- ppp G PG.
<span class="linenos"> 658</span>deftac (w G) (seq Gamma _) (wl Gamma1) :-
<span class="linenos"> 659</span> append Gamma1 [ G | _ ] Gamma.
<span class="linenos"> 660</span>
<span class="linenos"> 661</span>ppptac h h.
<span class="linenos"> 662</span>deftac h SEQ (h L).
<span class="linenos"> 663</span>
<span class="linenos"> 664</span>/*** eq ***/
<span class="linenos"> 665</span>
<span class="linenos"> 666</span>ppptac sym sym.
<span class="linenos"> 667</span>deftac sym (seq Gamma (eq &#39;&#39; T &#39; L &#39; R)) TAC :-
<span class="linenos"> 668</span> TAC = thenl (m (eq &#39;&#39; T &#39; R &#39; R)) [ thenl c [ thenl c [ r , id ] , r ] , r ].
<span class="linenos"> 669</span>
<span class="linenos"> 670</span>ppptac eq_true_intro eq_true_intro.
<span class="linenos"> 671</span>deftac eq_true_intro (seq Gamma (eq &#39;&#39; prop &#39; P &#39; tt)) TAC :-
<span class="linenos"> 672</span> TAC = thenl s [ th tt_intro, wl [] ].
<span class="linenos"> 673</span>
<span class="linenos"> 674</span>/*** true ***/
<span class="linenos"> 675</span>
<span class="linenos"> 676</span>/*** and ***/
<span class="linenos"> 677</span>
<span class="linenos"> 678</span>ppptac conj conj.
<span class="linenos"> 679</span>deftac conj (seq Gamma (and &#39; P &#39; Q)) TAC :-
<span class="linenos"> 680</span> TAC =
<span class="linenos"> 681</span>  then
<span class="linenos"> 682</span>   (then (conv dd)
<span class="linenos"> 683</span>     (then k (bind _ x \
<span class="linenos"> 684</span>       thenl c
<span class="linenos"> 685</span>        [ thenl c [ r, eq_true_intro ] ,
<span class="linenos"> 686</span>          eq_true_intro ])))
<span class="linenos"> 687</span>   ww.
<span class="linenos"> 688</span>
<span class="linenos"> 689</span>/* Gamma  &quot;|-&quot;  q    ---&gt;   Gamma &quot;|-&quot; and &#39; p &#39; q*/
<span class="linenos"> 690</span>ppptac (andr P) (andr PP) :- ppp P PP.
<span class="linenos"> 691</span>deftac (andr P) (seq Gamma Q) TAC :-
<span class="linenos"> 692</span> TAC =
<span class="linenos"> 693</span>  (thenl (m ((lam _ f \ f &#39; P &#39; Q) &#39; (lam _ x \ lam _ y \ y)))
<span class="linenos"> 694</span>    [ then
<span class="linenos"> 695</span>       %(repeat (conv (depth_tac b))) ROBUS VERSION LINE BELOW
<span class="linenos"> 696</span>       (then (conv (land_tac b)) (then (conv (land_tac (rator_tac b))) (conv (land_tac b))))
<span class="linenos"> 697</span>      r
<span class="linenos"> 698</span>    , thenl (conv (rator_tac id))
<span class="linenos"> 699</span>       [ then (thenl (t (lam _ f \ f &#39; tt &#39; tt)) [ id, r ])
<span class="linenos"> 700</span>          (thenl (m (and &#39; P &#39; Q)) [ dd , id ])
<span class="linenos"> 701</span>       , then (repeat (conv (depth_tac b))) (th tt_intro) ]]).
<span class="linenos"> 702</span>
<span class="linenos"> 703</span>/* (and &#39; p &#39; q) :: nil  &quot;|-&quot;  q */
<span class="linenos"> 704</span>ppptac andr andr.
<span class="linenos"> 705</span>deftac andr (seq Gamma Q) TAC :-
<span class="linenos"> 706</span> mem Gamma (and &#39; P &#39; Q),
<span class="linenos"> 707</span> TAC = then (andr P) h.
<span class="linenos"> 708</span>
<span class="linenos"> 709</span>/* Gamma  &quot;|-&quot;  p    ---&gt;   Gamma &quot;|-&quot; and &#39; p &#39; q*/
<span class="linenos"> 710</span>ppptac (andl P) (andl PP) :- ppp P PP.
<span class="linenos"> 711</span>deftac (andl Q) (seq Gamma P) TAC :-
<span class="linenos"> 712</span> TAC =
<span class="linenos"> 713</span>  (thenl (m ((lam _ f \ f &#39; P &#39; Q) &#39; (lam _ x \ lam _ y \ x)))
<span class="linenos"> 714</span>    [ then
<span class="linenos"> 715</span>       %(repeat (conv (depth_tac b))) ROBUS VERSION LINE BELOW
<span class="linenos"> 716</span>       (then (conv (land_tac b)) (then (conv (land_tac (rator_tac b))) (conv (land_tac b))))
<span class="linenos"> 717</span>      r
<span class="linenos"> 718</span>    , thenl (conv (rator_tac id))
<span class="linenos"> 719</span>       [ then (thenl (t (lam _ f \ f &#39; tt &#39; tt)) [ id, r ])
<span class="linenos"> 720</span>          (thenl (m (and &#39; P &#39; Q)) [ dd , id ])
<span class="linenos"> 721</span>       , then (repeat (conv (depth_tac b))) (th tt_intro) ]]).
<span class="linenos"> 722</span>
<span class="linenos"> 723</span>/* (and &#39; p &#39; q) :: nil  &quot;|-&quot;  p */
<span class="linenos"> 724</span>ppptac andl andl.
<span class="linenos"> 725</span>deftac andl (seq Gamma P) TAC :-
<span class="linenos"> 726</span> mem Gamma (and &#39; P &#39; Q),
<span class="linenos"> 727</span> TAC = then (andl Q) h.
<span class="linenos"> 728</span>
<span class="linenos"> 729</span>
<span class="linenos"> 730</span>/*** forall ***/
<span class="linenos"> 731</span>
<span class="linenos"> 732</span>/* |- forall &#39; F  --&gt;   |- F &#39; x */
<span class="linenos"> 733</span>ppptac forall_i forall_i.
<span class="linenos"> 734</span>deftac forall_i (seq Gamma (forall &#39;&#39; _ &#39; lam _ G)) TAC :-
<span class="linenos"> 735</span> TAC = then (conv dd) (then k (bind _ x \ eq_true_intro)).
<span class="linenos"> 736</span>
<span class="linenos"> 737</span>/* forall &#39; F |- F &#39; T */
<span class="linenos"> 738</span>ppptac forall_e forall_e.
<span class="linenos"> 739</span>deftac forall_e (seq Gamma GX) TAC :-
<span class="linenos"> 740</span> mem Gamma (forall &#39;&#39; _ &#39; (lam _ G)), GX = G X,
<span class="linenos"> 741</span> TAC = thenl (m ((lam _ G) &#39; X)) [ b, thenl (m ((lam _ z \ tt) &#39; X))
<span class="linenos"> 742</span>  [ thenl c [ then sym (thenl (m (forall &#39;&#39; _ &#39; lam _ G)) [dd,h ]), r ]
<span class="linenos"> 743</span>  , then (conv b) (th tt_intro) ] ].
<span class="linenos"> 744</span>
<span class="linenos"> 745</span>/* forall &#39; F |- f  --&gt;  F &#39; a, forall &#39; F |- f */
<span class="linenos"> 746</span>ppptac (lforall F A) (lforall PF PA) :- ppp F PF, ppp A PA.
<span class="linenos"> 747</span>deftac (lforall F A) (seq Gamma G) TAC :-
<span class="linenos"> 748</span> TAC = thenl (m (impl &#39; (F A) &#39; G))
<span class="linenos"> 749</span>  [ thenl s [ then mp forall_e, then i h ] , then (w (forall &#39;&#39; _ &#39; lam _ F)) i ].
<span class="linenos"> 750</span>
<span class="linenos"> 751</span>/* forall &#39; F |- f  --&gt;  F &#39; a, forall &#39; F |- f */
<span class="linenos"> 752</span>ppptac (lforall A) (lforall PA) :- ppp A PA.
<span class="linenos"> 753</span>deftac (lforall A) (seq Gamma G) (lforall F A) :-
<span class="linenos"> 754</span> mem Gamma (forall &#39;&#39; _ &#39; lam _ F).
<span class="linenos"> 755</span>
<span class="linenos"> 756</span>/* forall &#39; F |- f  --&gt;  F &#39; a, forall &#39; F |- f */
<span class="linenos"> 757</span>ppptac lforall lforall.
<span class="linenos"> 758</span>deftac lforall (seq Gamma G) (lforall A).
<span class="linenos"> 759</span>
<span class="linenos"> 760</span>/* forall &#39; F |- f  --&gt;  F &#39; a, forall &#39; F |- f */
<span class="linenos"> 761</span>ppptac (lforall_last A) (lforall_last PA) :- ppp A PA.
<span class="linenos"> 762</span>deftac (lforall_last A) (seq ((forall &#39;&#39; _ &#39; lam _ F)::Gamma) G) (lforall F A).
<span class="linenos"> 763</span>
<span class="linenos"> 764</span>/*** false ***/
<span class="linenos"> 765</span>              
<span class="linenos"> 766</span>/*** impl ***/
<span class="linenos"> 767</span>
<span class="linenos"> 768</span>/* |- p=&gt;q  --&gt;  p |- q */
<span class="linenos"> 769</span>ppptac i i.
<span class="linenos"> 770</span>deftac i (seq Gamma (impl &#39; P &#39; Q)) TAC :-
<span class="linenos"> 771</span> TAC = then (conv dd) (thenl s [ andl, thenl conj [ h [], id ]]).
<span class="linenos"> 772</span>
<span class="linenos"> 773</span>/* p=&gt;q |- q  --&gt;  |- p */
<span class="linenos"> 774</span>ppptac (mp P) (mp PP) :- ppp P PP.
<span class="linenos"> 775</span>deftac (mp P) (seq Gamma Q) TAC :-
<span class="linenos"> 776</span> TAC = then (andr P) (thenl (m P) [ then sym (thenl (m (impl &#39; P &#39; Q)) [ dd , h ]) , id ]).
<span class="linenos"> 777</span>
<span class="linenos"> 778</span>/* p=&gt;q |- q  --&gt;  |- p */
<span class="linenos"> 779</span>ppptac mp mp.
<span class="linenos"> 780</span>deftac mp (seq Gamma Q) (mp P) :-
<span class="linenos"> 781</span> mem Gamma (impl &#39; P &#39; Q).
<span class="linenos"> 782</span>
<span class="linenos"> 783</span>/* |- q   --&gt;   p |- q  and  |- p */
<span class="linenos"> 784</span>ppptac (cut P) (cut PP) :- ppp P PP.
<span class="linenos"> 785</span>deftac (cut P) (seq Gamma Q) TAC :-
<span class="linenos"> 786</span> TAC = then (andr P) (thenl (m P) [then sym (thenl (m (impl &#39; P &#39; Q)) [then (conv (land_tac dd)) r, i] ) , id]). 
<span class="linenos"> 787</span>
<span class="linenos"> 788</span>/* |-q  --&gt; p |- q   where the theorem T proves p */
<span class="linenos"> 789</span>ppptac (cutth P) (cutth PP) :- ppp P PP.
<span class="linenos"> 790</span>deftac (cutth T) SEQ TAC :-
<span class="linenos"> 791</span> proves T X,
<span class="linenos"> 792</span> TAC = (thenl (cut X) [ id, th T ]).
<span class="linenos"> 793</span>
<span class="linenos"> 794</span>/* applies the theorem T */
<span class="linenos"> 795</span>ppptac (applyth P) (applyth PP) :- ppp P PP.
<span class="linenos"> 796</span>deftac (applyth T) SEQ (then (cutth T) apply_last).
<span class="linenos"> 797</span>
<span class="linenos"> 798</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 799</span>ppptac (lapply P Q) (lapply PP PQ) :- ppp P PP, ppp Q PQ.
<span class="linenos"> 800</span>deftac (lapply P Q) (seq Gamma F) TAC :-
<span class="linenos"> 801</span> TAC =
<span class="linenos"> 802</span>  thenl (m (impl &#39; Q &#39; F)) [ thenl s [ then (mp Q) (then (w (impl &#39; Q &#39; F)) (then (mp P) (w (impl &#39; P &#39; Q)))) , then i (h [A]) ] , then (w (impl &#39; P &#39; Q)) (then i id) ].
<span class="linenos"> 803</span>
<span class="linenos"> 804</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 805</span>ppptac lapply lapply.
<span class="linenos"> 806</span>deftac lapply (seq Gamma F) (lapply P Q) :-
<span class="linenos"> 807</span> mem Gamma (impl &#39; P &#39; Q).
<span class="linenos"> 808</span>
<span class="linenos"> 809</span>/* impl p q, Gamma |- f   ---&gt;   /*impl q f*/ Gamma |- p  ,  q, Gamma |- f */
<span class="linenos"> 810</span>ppptac lapply_last lapply_last.
<span class="linenos"> 811</span>deftac lapply_last (seq ((impl &#39; P &#39; Q)::Gamma) F) (lapply P Q).
<span class="linenos"> 812</span>
<span class="linenos"> 813</span>/* p |- f ---&gt; p |- p ==&gt; f */
<span class="linenos"> 814</span>ppptac (g P) (g PP) :- ppp P PP.
<span class="linenos"> 815</span>deftac (g P) (seq _ F) TAC :-
<span class="linenos"> 816</span> TAC =
<span class="linenos"> 817</span>  (thenl (m (impl &#39; P &#39; F)) [thenl s [then mp h , then i h] , id ]).
<span class="linenos"> 818</span>
<span class="linenos"> 819</span>/*** not ***/
<span class="linenos"> 820</span>
<span class="linenos"> 821</span>/*** exists ***/
<span class="linenos"> 822</span>
<span class="linenos"> 823</span>/**** apply, i.e. forall + impl ****/
<span class="linenos"> 824</span>
<span class="linenos"> 825</span>ppptac (apply X) (apply PX) :- ppp X PX.
<span class="linenos"> 826</span>deftac (apply X) SEQ h :- var X, !.
<span class="linenos"> 827</span>deftac (apply X) SEQ h.
<span class="linenos"> 828</span>deftac (apply (impl &#39; P &#39; Q)) SEQ TAC :-
<span class="linenos"> 829</span> TAC = thenl (lapply P Q) [ id, apply_last ].
<span class="linenos"> 830</span>deftac (apply (forall &#39;&#39; _ &#39; lam _ G)) SEQ TAC :-
<span class="linenos"> 831</span> TAC = then (lforall G X) apply_last.
<span class="linenos"> 832</span>
<span class="linenos"> 833</span>ppptac apply_last apply_last.
<span class="linenos"> 834</span>deftac apply_last (seq (H::Gamma) F) (apply H).
<span class="linenos"> 835</span>
<span class="linenos"> 836</span>ppptac apply apply.
<span class="linenos"> 837</span>deftac apply (seq Gamma F) (apply H) :-
<span class="linenos"> 838</span> mem Gamma H.
<span class="linenos"> 839</span>
<span class="linenos"> 840</span>/********** conversion(als) ***********/
<span class="linenos"> 841</span>
<span class="linenos"> 842</span>strip_constant (I &#39;&#39; _) H :- !, strip_constant I H.
<span class="linenos"> 843</span>strip_constant H H.
<span class="linenos"> 844</span>
<span class="linenos"> 845</span>/* expands definitions, even if applied to arguments */
<span class="linenos"> 846</span>ppptac (dd L) (dd L).
<span class="linenos"> 847</span>deftac (dd L) (seq _ (eq &#39;&#39; _ &#39; T &#39; X)) d :- strip_constant T H, bang (mem L H).
<span class="linenos"> 848</span>deftac (dd L) (seq _ (eq &#39;&#39; _ &#39; (D &#39; T) &#39; X))
<span class="linenos"> 849</span> (thenl (t A) [thenl c [dd L , r], b]).
<span class="linenos"> 850</span>
<span class="linenos"> 851</span>ppptac dd dd.
<span class="linenos"> 852</span>deftac dd _ (dd L).
<span class="linenos"> 853</span>
<span class="linenos"> 854</span>ppptac beta_expand beta_expand.
<span class="linenos"> 855</span>deftac beta_expand (seq _ (eq &#39;&#39; _ &#39; (lam _ x \ F x) &#39; (lam _ x \ (lam _ F) &#39; x))) TAC :-
<span class="linenos"> 856</span> TAC = then k (bind _ x \ then sym b).
<span class="linenos"> 857</span>
<span class="linenos"> 858</span>/* folds a definition, even if applied to arguments */
<span class="linenos"> 859</span>/* BUG: it seems to fail with restriction errors in some cases */
<span class="linenos"> 860</span>ppptac f f.
<span class="linenos"> 861</span>deftac f SEQ (then sym dd).
<span class="linenos"> 862</span>
<span class="linenos"> 863</span>ppptac (rand_tac C) (rand_tac PC) :- ppptac C PC.
<span class="linenos"> 864</span>deftac (rand_tac C) SEQ TAC :-
<span class="linenos"> 865</span>  TAC = thenl c [ r , C ].
<span class="linenos"> 866</span>
<span class="linenos"> 867</span>ppptac (rator_tac C) (rator_tac PC) :- ppptac C PC.
<span class="linenos"> 868</span>deftac (rator_tac C) SEQ TAC :-
<span class="linenos"> 869</span>  TAC = thenl c [ C , r ].
<span class="linenos"> 870</span>
<span class="linenos"> 871</span>ppptac (abs_tac C) (abs_tac PC) :- ppptac C PC.
<span class="linenos"> 872</span>deftac (abs_tac C) SEQ TAC :-
<span class="linenos"> 873</span>  TAC = then k (bind A x \ C).
<span class="linenos"> 874</span>
<span class="linenos"> 875</span>ppptac (land_tac C) (land_tac PC) :- ppptac C PC.
<span class="linenos"> 876</span>deftac (land_tac C) SEQ TAC :-
<span class="linenos"> 877</span>  TAC = thenl c [ thenl c [ r, C ] , r ].
<span class="linenos"> 878</span>
<span class="linenos"> 879</span>ppptac (sub_tac C) (sub_tac PC) :- ppptac C PC.
<span class="linenos"> 880</span>deftac (sub_tac C) SEQ TAC :-
<span class="linenos"> 881</span>  TAC = orelse (rand_tac C) (orelse (rator_tac C) (abs_tac C)).
<span class="linenos"> 882</span>
<span class="linenos"> 883</span>ppptac (try TAC) (try PTAC) :- ppptac TAC PTAC.
<span class="linenos"> 884</span>deftac (try TAC) SEQ (orelse TAC id).
<span class="linenos"> 885</span>
<span class="linenos"> 886</span>ppptac (depth_tac C) (depth_tac PC) :- ppptac C PC.
<span class="linenos"> 887</span>deftac (depth_tac C) SEQ TAC :-
<span class="linenos"> 888</span>  TAC = then (try C) (sub_tac (depth_tac C)).
<span class="linenos"> 889</span>
<span class="linenos"> 890</span>ppptac (conv C) (conv PC) :- ppptac C PC.
<span class="linenos"> 891</span>deftac (conv C) (seq Gamma F) TAC :-
<span class="linenos"> 892</span> TAC = thenl (m G) [ then sym C , id ].
<span class="linenos"> 893</span>
<span class="linenos"> 894</span>/********** Automation ***********/
<span class="linenos"> 895</span>/* TODO:
<span class="linenos"> 896</span> 1) our lforall gets rid of the hypothesis (bad) */
<span class="linenos"> 897</span>/* left tries to reduce the search space via focusing */
<span class="linenos"> 898</span>ppptac left left.
<span class="linenos"> 899</span>deftac left (seq Gamma _) TAC :-
<span class="linenos"> 900</span> mem Gamma (not &#39; F),
<span class="linenos"> 901</span> TAC =
<span class="linenos"> 902</span>  (!
<span class="linenos"> 903</span>   (then (cutth not_e)
<span class="linenos"> 904</span>    (then (lforall_last F)
<span class="linenos"> 905</span>     (thenl lapply [ h, (w (not &#39; F)) ])))).
<span class="linenos"> 906</span>deftac left (seq Gamma _) TAC :-
<span class="linenos"> 907</span> /* A bit long because we want to beta-reduce the produced hypothesis.
<span class="linenos"> 908</span>    Maybe this should be automatized somewhere else. */
<span class="linenos"> 909</span> mem Gamma (exists &#39;&#39; _ &#39; F),
<span class="linenos"> 910</span> TAC =
<span class="linenos"> 911</span>  (!
<span class="linenos"> 912</span>   (then (cutth exists_e)
<span class="linenos"> 913</span>    (then (lforall_last F)
<span class="linenos"> 914</span>     (thenl lapply [ h, then (w (exists &#39;&#39; _ &#39; F)) (then apply_last (then forall_i (bind _ x \ then (try (conv (land_tac b))) i))) ])))).
<span class="linenos"> 915</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 916</span> mem Gamma (or &#39; F &#39; G),
<span class="linenos"> 917</span> TAC =
<span class="linenos"> 918</span>  (!
<span class="linenos"> 919</span>   (then (cutth or_e)
<span class="linenos"> 920</span>    (then (lforall_last F)
<span class="linenos"> 921</span>     (then (lforall_last G)
<span class="linenos"> 922</span>      (then (lforall_last H)
<span class="linenos"> 923</span>       (thenl lapply [ h, then (w (or &#39; F &#39; G)) (then apply_last i)])))))).
<span class="linenos"> 924</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 925</span> mem Gamma (and &#39; F &#39; G),
<span class="linenos"> 926</span> TAC =
<span class="linenos"> 927</span>  (!
<span class="linenos"> 928</span>   (then (cutth and_e)
<span class="linenos"> 929</span>    (then (lforall_last F)
<span class="linenos"> 930</span>     (then (lforall_last G)
<span class="linenos"> 931</span>      (then (lforall_last H)
<span class="linenos"> 932</span>       (thenl lapply [ h, then (w (and &#39; F &#39; G)) (then apply_last (then i i))])))))).
<span class="linenos"> 933</span>deftac left (seq Gamma H) TAC :-
<span class="linenos"> 934</span> mem Gamma (eq &#39;&#39; TY &#39; F &#39; G),
<span class="linenos"> 935</span> not (var TY), TY = prop,
<span class="linenos"> 936</span> TAC =
<span class="linenos"> 937</span>  (then (g (eq &#39;&#39; TY &#39; F &#39; G))
<span class="linenos"> 938</span>   (then (conv (land_tac (then (applyth eq_to_impl) h)))
<span class="linenos"> 939</span>     (then i (w (eq &#39;&#39; TY &#39; F &#39; G))))).
<span class="linenos"> 940</span>
<span class="linenos"> 941</span>ppptac not_i not_i.
<span class="linenos"> 942</span>deftac not_i (seq _ (not &#39; _)) (applyth not_i).
<span class="linenos"> 943</span>
<span class="linenos"> 944</span>ppptac inv inv.
<span class="linenos"> 945</span>deftac inv _ TAC :-
<span class="linenos"> 946</span> TAC =
<span class="linenos"> 947</span> (then!
<span class="linenos"> 948</span>  (repeat!
<span class="linenos"> 949</span>   (orelse! conj (orelse! forall_i (orelse! i (orelse! not_i s)))))
<span class="linenos"> 950</span>  (bind* (repeat! left))).
<span class="linenos"> 951</span>
<span class="linenos"> 952</span>ppptac (sync N) (sync N).
<span class="linenos"> 953</span>deftac (sync N) (seq _ tt) (th tt_intro).
<span class="linenos"> 954</span>deftac (sync N) (seq Gamma _) (then (applyth ff_elim) h) :-
<span class="linenos"> 955</span> mem Gamma ff.
<span class="linenos"> 956</span>deftac (sync N) (seq _ (or &#39; _ &#39; _))
<span class="linenos"> 957</span> (orelse (then (applyth orr) (itaut N)) (then (applyth orl) (itaut N))).
<span class="linenos"> 958</span>deftac (sync N) (seq _ (exists &#39;&#39; _ &#39; _)) (then (applyth exists_i) (then (conv b) (itaut N2))) :-
<span class="linenos"> 959</span> N2 is N - 2.
<span class="linenos"> 960</span>
<span class="linenos"> 961</span>ppptac (itaut N) (itaut N).
<span class="linenos"> 962</span>deftac (itaut N) SEQ fail :- N =&lt; 0, !.
<span class="linenos"> 963</span>deftac (itaut N) SEQ TAC :-
<span class="linenos"> 964</span> %print (itaut N) SEQ,
<span class="linenos"> 965</span> N1 is N - 1,
<span class="linenos"> 966</span> N2 is N - 2,
<span class="linenos"> 967</span> TAC =
<span class="linenos"> 968</span> (then! inv
<span class="linenos"> 969</span>  (bind*
<span class="linenos"> 970</span>   (orelse h
<span class="linenos"> 971</span>   (orelse (sync N)
<span class="linenos"> 972</span>   (orelse /* Hypothesis not moved to front */ (then lforall (itaut N2))
<span class="linenos"> 973</span>   (then lapply (itaut N1))))))).
<span class="linenos"> 974</span>
<span class="linenos"> 975</span>ppptac (itauteq N) (itauteq N).
<span class="linenos"> 976</span>deftac (itauteq N) _ (then (cutth eq_reflexive) (itaut N)).
<span class="linenos"> 977</span>
<span class="linenos"> 978</span>/********** inductive predicates package ********/
<span class="linenos"> 979</span>
<span class="linenos"> 980</span>ppptac monotone monotone.
<span class="linenos"> 981</span>deftac monotone (seq _ (impl &#39; X &#39; X)) (! (then i h)) :- !.
<span class="linenos"> 982</span>deftac monotone (seq [forall &#39;&#39; _ &#39; lam _ x \ impl &#39; (F &#39; x) &#39; (G &#39; x)] (impl &#39; (F &#39; T) &#39; (G &#39; T))) (! apply) :- !.
<span class="linenos"> 983</span>deftac monotone (seq _ (impl &#39; (and &#39; _ &#39; _) &#39; _)) TAC :-
<span class="linenos"> 984</span> TAC = then (applyth and_monotone) monotone.
<span class="linenos"> 985</span>deftac monotone (seq _ (impl &#39; (or &#39; _ &#39; _) &#39; _)) TAC :-
<span class="linenos"> 986</span> TAC = then (applyth or_monotone) monotone.
<span class="linenos"> 987</span>deftac monotone (seq _ (impl &#39; (impl &#39; _ &#39; _) &#39; _)) TAC :-
<span class="linenos"> 988</span> TAC = then (applyth impl_monotone) monotone.
<span class="linenos"> 989</span>deftac monotone (seq _ (impl &#39; (not &#39; _) &#39; _)) TAC :-
<span class="linenos"> 990</span> TAC = then (applyth not_monotone) monotone.
<span class="linenos"> 991</span>deftac monotone (seq _ (impl &#39; (forall &#39;&#39; _ &#39; lam _ _) &#39; _)) TAC :-
<span class="linenos"> 992</span> TAC =
<span class="linenos"> 993</span>  then (conv (land_tac (rand_tac beta_expand)))
<span class="linenos"> 994</span>   (then (conv (rand_tac (rand_tac beta_expand)))
<span class="linenos"> 995</span>     (then (applyth forall_monotone) (then forall_i (bind _ x \
<span class="linenos"> 996</span>       then (conv (depth_tac b)) (then (conv (depth_tac b)) monotone))))).
<span class="linenos"> 997</span>deftac monotone (seq _ (impl &#39; (exists &#39;&#39; _ &#39; lam _ _) &#39; _)) TAC :-
<span class="linenos"> 998</span> TAC =
<span class="linenos"> 999</span>  then (conv (land_tac (rand_tac beta_expand)))
<span class="linenos">1000</span>   (then (conv (rand_tac (rand_tac beta_expand)))
<span class="linenos">1001</span>     (then (applyth exists_monotone) (then forall_i (bind _ x \
<span class="linenos">1002</span>       then (conv (depth_tac b)) (then (conv (depth_tac b)) monotone))))).
<span class="linenos">1003</span>
<span class="linenos">1004</span>/* expands &quot;monotone &#39; (lam _ f \ lam _ x \ X f x)&quot; into
<span class="linenos">1005</span>   &quot;! x \ p &#39; x ==&gt; q &#39; x |- X p y ==&gt; X q y&quot;
<span class="linenos">1006</span>   and then calls the monotone tactic */
<span class="linenos">1007</span>ppptac auto_monotone auto_monotone.
<span class="linenos">1008</span>deftac auto_monotone _ TAC :-
<span class="linenos">1009</span> TAC =
<span class="linenos">1010</span>  then (conv dd)
<span class="linenos">1011</span>   (then forall_i (bind _ p \ (then forall_i (bind _ q \
<span class="linenos">1012</span>     then (conv (land_tac dd))
<span class="linenos">1013</span>      (then (conv (land_tac (depth_tac (dd [in]))))
<span class="linenos">1014</span>        (then (conv (land_tac (depth_tac (dd [in]))))
<span class="linenos">1015</span>          (then i
<span class="linenos">1016</span>            (then (conv dd)
<span class="linenos">1017</span>              (then forall_i (bind _ x \
<span class="linenos">1018</span>                (then (conv (land_tac dd))
<span class="linenos">1019</span>                  (then (conv (rand_tac dd))
<span class="linenos">1020</span>                    (then (conv (land_tac (rator_tac b)))
<span class="linenos">1021</span>                      (then (conv (land_tac b))
<span class="linenos">1022</span>                        (then (conv (rand_tac (rator_tac b)))
<span class="linenos">1023</span>                          (then (conv (rand_tac b))
<span class="linenos">1024</span>                            monotone)))))))))))))))).
<span class="linenos">1025</span>
<span class="linenos">1026</span>/********** the library ********/
<span class="linenos">1027</span>
<span class="linenos">1028</span>main :- the_library L, append L [stop] Lstop, check Lstop.
<span class="linenos">1029</span>
<span class="linenos">1030</span>go :- the_library L, check L.
<span class="linenos">1031</span>
<span class="linenos">1032</span>the_library L :-
<span class="linenos">1033</span> L =
<span class="linenos">1034</span>  [ /******** Primivite operators hard-coded in the kernel ******/
<span class="linenos">1035</span>  % decl eq (pi A \ A --&gt; A --&gt; prop)
<span class="linenos">1036</span>
<span class="linenos">1037</span>  /********** Axiomatization of choice over types ********/
<span class="linenos">1038</span>    decl choose (pi A \ A)
<span class="linenos">1039</span>
<span class="linenos">1040</span>  /*********** Connectives and quantifiers ********/
<span class="linenos">1041</span>  , def tt (prop,((lam prop x \ x) = (lam prop x \ x)))
<span class="linenos">1042</span>  , def forall (pi A \ ((A --&gt; prop) --&gt; prop),
<span class="linenos">1043</span>     (lam (A --&gt; prop) f \ f = (lam A g \ tt)))
<span class="linenos">1044</span>  , def ff (prop,(! x \ x))
<span class="linenos">1045</span>  , def and ((prop --&gt; prop --&gt; prop),
<span class="linenos">1046</span>     (lam _ x \ lam _ y \ (lam (prop --&gt; prop --&gt; prop) f \ f &#39; x &#39; y) = (lam _ f \ f &#39; tt &#39; tt)))
<span class="linenos">1047</span>  , def impl ((prop --&gt; prop --&gt; prop),(lam _ a \ lam _ b \ a &amp;&amp; b &lt;=&gt; a))
<span class="linenos">1048</span>  , def exists (pi A \ ((A --&gt; prop) --&gt; prop),
<span class="linenos">1049</span>     (lam (A --&gt; prop) f \ ! c \ (! a \ f &#39; a ==&gt; c) ==&gt; c))
<span class="linenos">1050</span>  , def not ((prop --&gt; prop),(lam _ x \ x ==&gt; ff))
<span class="linenos">1051</span>  , def or ((prop --&gt; prop --&gt; prop),
<span class="linenos">1052</span>     (lam _ x \ lam _ y \ ! c \ (x ==&gt; c) ==&gt; (y ==&gt; c) ==&gt; c))
<span class="linenos">1053</span>  , theorem tt_intro (tt,[then (conv dd) (then k (bind _ x12 \ r))])
<span class="linenos">1054</span>  , theorem ff_elim ((! p \ ff ==&gt; p),
<span class="linenos">1055</span>    [then forall_i (bind prop x3\ then (conv (land_tac dd)) (then i forall_e))])
<span class="linenos">1056</span>  , theorem sym ((! p \ ! q \ p = q ==&gt; q = p),
<span class="linenos">1057</span>    [then forall_i
<span class="linenos">1058</span>     (bind prop x12 \
<span class="linenos">1059</span>       then forall_i
<span class="linenos">1060</span>        (bind prop x13 \
<span class="linenos">1061</span>          then i (then sym h)))])
<span class="linenos">1062</span>  , theorem not_e ((! p \ not &#39; p ==&gt; p ==&gt; ff),
<span class="linenos">1063</span>     [then forall_i (bind prop x3 \ then (conv (land_tac dd)) (then i h))])
<span class="linenos">1064</span>  , theorem conj ((! p \ ! q \ p ==&gt; q ==&gt; p &amp;&amp; q),
<span class="linenos">1065</span>    [then forall_i
<span class="linenos">1066</span>     (bind prop x12 \
<span class="linenos">1067</span>      then forall_i (bind prop x13 \ then i (then i (then conj h))))])
<span class="linenos">1068</span>  , theorem andl ((! p \ ! q \ p &amp;&amp; q ==&gt; p),
<span class="linenos">1069</span>    [then forall_i
<span class="linenos">1070</span>     (bind prop x12 \
<span class="linenos">1071</span>      then forall_i (bind prop x13 \ then i (then (andl x13) h)))])
<span class="linenos">1072</span>  , theorem andr ((! p \ ! q \ p &amp;&amp; q ==&gt; q),
<span class="linenos">1073</span>    [then forall_i
<span class="linenos">1074</span>     (bind prop x12 \
<span class="linenos">1075</span>      then forall_i (bind prop x13 \ then i (then (andr x12) h)))])
<span class="linenos">1076</span>  , theorem and_e ((! p \ ! q \ ! c \ p &amp;&amp; q ==&gt; (p ==&gt; q ==&gt; c) ==&gt; c),
<span class="linenos">1077</span>     [then forall_i
<span class="linenos">1078</span>       (bind prop x12 \
<span class="linenos">1079</span>         then forall_i
<span class="linenos">1080</span>          (bind prop x13 \
<span class="linenos">1081</span>            then forall_i
<span class="linenos">1082</span>             (bind prop x14 \ then i (then i (thenl apply [andl, andr])))))])
<span class="linenos">1083</span>  , theorem not_i ((! p \ (p ==&gt; ff) ==&gt; not &#39; p),
<span class="linenos">1084</span>     [then forall_i (bind prop x2 \ then i (then (conv dd) h))])
<span class="linenos">1085</span>  , theorem orl ((! p \ ! q \ p ==&gt; p `or q),
<span class="linenos">1086</span>      [then forall_i
<span class="linenos">1087</span>        (bind prop x12 \
<span class="linenos">1088</span>          then forall_i
<span class="linenos">1089</span>           (bind prop x13 \
<span class="linenos">1090</span>             then i
<span class="linenos">1091</span>              (then (conv dd)
<span class="linenos">1092</span>                (then forall_i (bind prop x14 \ then i (then i (then apply h)))))))])
<span class="linenos">1093</span>  , theorem orr ((! p \ ! q \ q ==&gt; p `or q),
<span class="linenos">1094</span>      [then forall_i
<span class="linenos">1095</span>        (bind prop x12 \
<span class="linenos">1096</span>          then forall_i
<span class="linenos">1097</span>           (bind prop x13 \
<span class="linenos">1098</span>             then i
<span class="linenos">1099</span>              (then (conv dd)
<span class="linenos">1100</span>                (then forall_i (bind prop x14 \ then i (then i (then apply h)))))))])
<span class="linenos">1101</span>  , theorem or_e ((! p \ ! q \ ! c \ p `or q ==&gt; (p ==&gt; c) ==&gt; (q ==&gt; c) ==&gt; c),
<span class="linenos">1102</span>     [then forall_i
<span class="linenos">1103</span>       (bind prop x12 \
<span class="linenos">1104</span>         then forall_i
<span class="linenos">1105</span>          (bind prop x13 \
<span class="linenos">1106</span>            then forall_i
<span class="linenos">1107</span>             (bind prop x14 \ then (conv (land_tac dd)) (then i forall_e))))])
<span class="linenos">1108</span>  , theorem exists_e (pi T \
<span class="linenos">1109</span>     (! f \ (exists &#39;&#39; T &#39; f) ==&gt; (! c \ (! x \ f &#39; x ==&gt; c) ==&gt; c)),
<span class="linenos">1110</span>     [then forall_i (bind (T --&gt; prop) x12 \ then (conv (land_tac dd)) (then i h))])
<span class="linenos">1111</span> , theorem exists_i (pi T \ (! f \ ! w \ f &#39; w ==&gt; (exists &#39;&#39; T &#39; f)),
<span class="linenos">1112</span>    [then forall_i
<span class="linenos">1113</span>     (bind (T --&gt; prop) x12 \
<span class="linenos">1114</span>       then forall_i
<span class="linenos">1115</span>        (bind T x13 \
<span class="linenos">1116</span>          then i
<span class="linenos">1117</span>           (then (conv dd)
<span class="linenos">1118</span>             (then forall_i
<span class="linenos">1119</span>               (bind prop x14 \ then i (then (lforall x13) (then apply h)))))))])
<span class="linenos">1120</span>  , theorem eq_to_impl
<span class="linenos">1121</span>     ((! x13 \ ! x14 \ (x13 = x14) = ((x13 ==&gt; x14) &amp;&amp; (x14 ==&gt; x13))),
<span class="linenos">1122</span>     [thenl inv [(bind prop x13 \ bind prop x14 \ then (conv (then sym h)) h),
<span class="linenos">1123</span>       (bind prop x13 \ bind prop x14 \ then (conv h) h),
<span class="linenos">1124</span>       (bind prop x13 \ bind prop x14 \ itaut 2),
<span class="linenos">1125</span>       (bind prop x13 \ bind prop x14 \ itaut 2)]])
<span class="linenos">1126</span>
<span class="linenos">1127</span> /*********** Axiomatization of disjoint union ********/
<span class="linenos">1128</span>  , decl inj1_disj_union (pi A \pi B \ A --&gt; disj_union &#39;&#39; A &#39;&#39; B)
<span class="linenos">1129</span>  , decl inj2_disj_union (pi A \ pi B \ B --&gt; disj_union &#39;&#39; A &#39;&#39; B)
<span class="linenos">1130</span>  , decl case_disj_union (pi A \pi B \ pi C \ disj_union &#39;&#39; A &#39;&#39; B --&gt; (A --&gt; C) --&gt; (B --&gt; C) --&gt; C)
<span class="linenos">1131</span>  , axiom case_disj_union_inj1 (pi A \ pi B \ pi C \ (! b \ ! (A --&gt; C) e1 \ ! (B --&gt; C) e2  \
<span class="linenos">1132</span>    case_disj_union &#39;&#39; A &#39;&#39; B &#39;&#39; C &#39; (inj1_disj_union &#39;&#39; A &#39;&#39; B &#39; b) &#39; e1 &#39; e2 = e1 &#39; b))
<span class="linenos">1133</span>  , axiom case_disj_union_inj2 (pi A \ pi B \ pi C \ (! b \ ! (A --&gt; C) e1 \ ! (B --&gt; C) e2  \
<span class="linenos">1134</span>    case_disj_union &#39;&#39; A &#39;&#39; B &#39;&#39; C &#39; (inj2_disj_union &#39;&#39; A &#39;&#39; B &#39; b) &#39; e1 &#39; e2 = e2 &#39; b))
<span class="linenos">1135</span>
<span class="linenos">1136</span> /*********** Axiomatization of the universe ********/
<span class="linenos">1137</span> , decl injection_univ (pi A \pi B \ A --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1138</span> , decl ejection_univ (pi A \pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; A)
<span class="linenos">1139</span> , decl inject_limit_univ (pi A \pi B \ (B --&gt; univ &#39;&#39; A &#39;&#39; B) --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1140</span> , decl eject_limit_univ (pi A \ pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; (B --&gt; univ &#39;&#39; A &#39;&#39; B))
<span class="linenos">1141</span> , decl pair_univ (pi A \pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1142</span> , decl proj1_univ (pi A \ pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1143</span> , decl proj2_univ (pi A \pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1144</span> , decl inj1_univ (pi A \pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1145</span> , decl inj2_univ (pi A \pi B \ univ &#39;&#39; A &#39;&#39; B --&gt; univ &#39;&#39; A &#39;&#39; B)
<span class="linenos">1146</span> , decl case_univ (pi A \pi B \ pi C \ univ &#39;&#39; A &#39;&#39; B --&gt; (univ &#39;&#39; A &#39;&#39; B --&gt; C) --&gt; (univ &#39;&#39; A &#39;&#39; B --&gt; C) --&gt; C)
<span class="linenos">1147</span> , axiom ejection_injection_univ (pi A \ pi B \
<span class="linenos">1148</span>    ! A p \ ejection_univ &#39;&#39; A &#39;&#39; B &#39; (injection_univ &#39;&#39; A &#39;&#39; B &#39; p) = p)
<span class="linenos">1149</span> , axiom eject_inject_limit_univ (pi A \ pi B \
<span class="linenos">1150</span>    ! (B --&gt; univ &#39;&#39; A &#39;&#39; B) p \ eject_limit_univ &#39;&#39; A &#39;&#39; B &#39; (inject_limit_univ &#39;&#39; A &#39;&#39; B &#39; p) = p)
<span class="linenos">1151</span> , axiom proj1_pair_univ (pi A \ pi B \ ! (univ &#39;&#39; A &#39;&#39; B) p1 \ ! p2 \
<span class="linenos">1152</span>    proj1_univ &#39;&#39; A &#39;&#39; B &#39; (pair_univ &#39;&#39; A &#39;&#39; B &#39; p1 &#39; p2) = p1)
<span class="linenos">1153</span> , axiom proj2_pair_univ (pi A \ pi B \ ! p1 \ ! (univ &#39;&#39; A &#39;&#39; B) p2 \
<span class="linenos">1154</span>    proj2_univ &#39;&#39; A &#39;&#39; B &#39; (pair_univ &#39;&#39; A &#39;&#39; B &#39; p1 &#39; p2) = p2)
<span class="linenos">1155</span> , axiom case_univ_inj1 (pi A \ pi B \ pi C \ (! b \ ! (univ &#39;&#39; A &#39;&#39; B --&gt; C) e1 \ ! e2  \
<span class="linenos">1156</span>    case_univ &#39;&#39; A &#39;&#39; B &#39;&#39; C &#39; (inj1_univ &#39;&#39; A &#39;&#39; B &#39; b) &#39; e1 &#39; e2 = e1 &#39; b))
<span class="linenos">1157</span> , axiom case_univ_inj2 (pi A \ pi B \ pi C \ (! b \ ! (univ &#39;&#39; A &#39;&#39; B --&gt; C) e1 \ ! e2 \
<span class="linenos">1158</span>    case_univ &#39;&#39; A &#39;&#39; B &#39;&#39; C &#39; (inj2_univ &#39;&#39; A &#39;&#39; B &#39; b) &#39; e1 &#39; e2 = e2 &#39; b))
<span class="linenos">1159</span>
<span class="linenos">1160</span> /******************* Equality *****************/
<span class="linenos">1161</span> , theorem eq_reflexive (pi A \ ((! A a \ a = a),
<span class="linenos">1162</span>   [ then forall_i (bind A x \ r) ]))
<span class="linenos">1163</span>
<span class="linenos">1164</span> /******************* Logic *****************/
<span class="linenos">1165</span> , theorem or_commutative ((! a \ ! b \ a `or b &lt;=&gt; b `or a),
<span class="linenos">1166</span>   [itaut 1])
<span class="linenos">1167</span> , theorem or_ff ((! a \ a `or ff &lt;=&gt; a),
<span class="linenos">1168</span>   [itaut 1])
<span class="linenos">1169</span> , theorem or_tt ((! a \ a `or tt &lt;=&gt; tt),
<span class="linenos">1170</span>   [itaut 1])
<span class="linenos">1171</span> , theorem or_idempotent ((! a \ a `or a &lt;=&gt; a),
<span class="linenos">1172</span>   [itaut 1])
<span class="linenos">1173</span> , theorem or_associative ((! a \ ! b \ ! c \ a `or (b `or c) &lt;=&gt; (a `or b) `or c),
<span class="linenos">1174</span>   [itaut 1])
<span class="linenos">1175</span> , theorem and_commutative ((! a \ ! b \ a &amp;&amp; b &lt;=&gt; b &amp;&amp; a),
<span class="linenos">1176</span>   [itaut 1])
<span class="linenos">1177</span> , theorem and_tt ((! a \ a &amp;&amp; tt &lt;=&gt; a),
<span class="linenos">1178</span>   [itaut 1])
<span class="linenos">1179</span> , theorem and_ff ((! a \ a &amp;&amp; ff &lt;=&gt; ff),
<span class="linenos">1180</span>   [itaut 1])
<span class="linenos">1181</span> , theorem and_idempotent ((! a \ a &amp;&amp; a &lt;=&gt; a),
<span class="linenos">1182</span>   [itaut 1])
<span class="linenos">1183</span> , theorem and_associative ((! a \ ! b \ ! c \ a &amp;&amp; (b &amp;&amp; c) &lt;=&gt; (a &amp;&amp; b) &amp;&amp; c),
<span class="linenos">1184</span>   [itaut 1])
<span class="linenos">1185</span> , theorem and_or ((! a \ ! b \ ! c \ a &amp;&amp; (b `or c) &lt;=&gt; (a &amp;&amp; b) `or (a &amp;&amp; c)),
<span class="linenos">1186</span>   [itaut 1])
<span class="linenos">1187</span> , theorem or_and ((! a \ ! b \ ! c \ a `or (b &amp;&amp; c) &lt;=&gt; (a `or b) &amp;&amp; (a `or c)),
<span class="linenos">1188</span>   [itaut 1])
<span class="linenos">1189</span> , theorem ads_or_and ((! a \ ! b \ (a &amp;&amp; b) `or b &lt;=&gt; b),
<span class="linenos">1190</span>   [itaut 1])
<span class="linenos">1191</span> , theorem ads_and_or ((! a \ ! b \ (a `or b) &amp;&amp; b &lt;=&gt; b),
<span class="linenos">1192</span>   [itaut 1])
<span class="linenos">1193</span> , theorem not_or ((! a \ ! b \ not &#39; a &amp;&amp; not &#39; b &lt;=&gt; not &#39; (a `or b)),
<span class="linenos">1194</span>   [itaut 2])
<span class="linenos">1195</span> , theorem not_and ((! a \ ! b \ not &#39; a `or not &#39; b ==&gt; not &#39; (a &amp;&amp; b)),
<span class="linenos">1196</span>   [itaut 2])
<span class="linenos">1197</span> , theorem not_not_not ((! p \ not &#39; (not &#39; (not &#39; p)) &lt;=&gt; not &#39; p),
<span class="linenos">1198</span>   [itaut 3])
<span class="linenos">1199</span> , theorem impl_not_not ((! a \ ! b \ (a ==&gt; b) ==&gt; (not &#39; b ==&gt; not &#39; a)),
<span class="linenos">1200</span>   [itaut 3])
<span class="linenos">1201</span> , theorem eq_to_impl_f ((! p \ ! q \ (p &lt;=&gt; q) ==&gt; p ==&gt; q),
<span class="linenos">1202</span>    [itaut 2])
<span class="linenos">1203</span> , theorem eq_to_impl_b ((! p \ ! q \ (p &lt;=&gt; q) ==&gt; q ==&gt; p),
<span class="linenos">1204</span>    [itaut 2])
<span class="linenos">1205</span>
<span class="linenos">1206</span>/*************** Properties inj/disj/univ ***********/
<span class="linenos">1207</span> , theorem pair_univ_inj_l 
<span class="linenos">1208</span>   (pi A \ pi B \ (! (univ &#39;&#39; A &#39;&#39; B) x20 \ ! x21 \ ! x22 \ ! x23 \ pair_univ &#39;&#39; A &#39;&#39; B &#39; x20 &#39; x22 = pair_univ &#39;&#39; A &#39;&#39; B &#39; x21 &#39; x23 ==&gt; x20 = x21) ,
<span class="linenos">1209</span>   [then (repeat forall_i)
<span class="linenos">1210</span>     (bind (univ &#39;&#39; A &#39;&#39; B) x22 \
<span class="linenos">1211</span>       bind (univ &#39;&#39; A &#39;&#39; B) x23 \
<span class="linenos">1212</span>        bind (univ &#39;&#39; A &#39;&#39; B) x24 \
<span class="linenos">1213</span>         bind (univ &#39;&#39; A &#39;&#39; B) x25 \
<span class="linenos">1214</span>          then i
<span class="linenos">1215</span>           (then (cutth proj1_pair_univ)
<span class="linenos">1216</span>             (then (lforall x22)
<span class="linenos">1217</span>               (then (conv (land_tac (then sym apply)))
<span class="linenos">1218</span>                 (then (conv (depth_tac h)) (applyth proj1_pair_univ))))))])
<span class="linenos">1219</span> , theorem pair_univ_inj_r 
<span class="linenos">1220</span>   (pi A \ pi B \ (! (univ &#39;&#39; A &#39;&#39; B) x20 \ ! x21 \ ! x22 \ ! x23 \ pair_univ &#39;&#39; A &#39;&#39; B &#39; x20 &#39; x22 = pair_univ &#39;&#39; A &#39;&#39; B &#39; x21 &#39; x23 ==&gt; x22 = x23) ,
<span class="linenos">1221</span>   [then (repeat forall_i)
<span class="linenos">1222</span>     (bind (univ &#39;&#39; A &#39;&#39; B) x22 \
<span class="linenos">1223</span>       bind (univ &#39;&#39; A &#39;&#39; B) x23 \
<span class="linenos">1224</span>        bind (univ &#39;&#39; A &#39;&#39; B) x24 \
<span class="linenos">1225</span>         bind (univ &#39;&#39; A &#39;&#39; B) x25 \
<span class="linenos">1226</span>          then i
<span class="linenos">1227</span>           (then (cutth proj2_pair_univ)
<span class="linenos">1228</span>             (then (lforall x22)
<span class="linenos">1229</span>               (then (conv (land_tac (then sym apply)))
<span class="linenos">1230</span>                 (then (conv (depth_tac h)) (applyth proj2_pair_univ))))))])
<span class="linenos">1231</span> , theorem injection_univ_inj
<span class="linenos">1232</span>   (pi A \ pi B \ (! A x20 \ ! x21 \ injection_univ &#39;&#39; A &#39;&#39; B &#39; x20 = injection_univ &#39;&#39; A &#39;&#39; B &#39; x21 ==&gt; x20 = x21) ,
<span class="linenos">1233</span>    [then forall_i
<span class="linenos">1234</span>     (bind A x20 \
<span class="linenos">1235</span>       then forall_i
<span class="linenos">1236</span>        (bind A x21 \
<span class="linenos">1237</span>          then (then (cutth ejection_injection_univ) (lforall x21))
<span class="linenos">1238</span>           (then (then (cutth ejection_injection_univ) (lforall x20))
<span class="linenos">1239</span>             (then i
<span class="linenos">1240</span>               (thenl
<span class="linenos">1241</span>                 (cut
<span class="linenos">1242</span>                   (ejection_univ &#39;&#39; A &#39;&#39; B &#39; (injection_univ &#39;&#39; A &#39;&#39; B &#39; x20) =
<span class="linenos">1243</span>                     ejection_univ &#39;&#39; A &#39;&#39; B &#39; (injection_univ &#39;&#39; A &#39;&#39; B &#39; x21)))
<span class="linenos">1244</span>                 [thenl
<span class="linenos">1245</span>                   (cut
<span class="linenos">1246</span>                     ((ejection_univ &#39;&#39; A &#39;&#39; B &#39; (injection_univ &#39;&#39; A &#39;&#39; B &#39; x20) =
<span class="linenos">1247</span>                        ejection_univ &#39;&#39; A &#39;&#39; B &#39; (injection_univ &#39;&#39; A &#39;&#39; B &#39; x21)) =
<span class="linenos">1248</span>                       (x20 = x21)))
<span class="linenos">1249</span>                   [then (conv (depth_tac (then sym h))) h,
<span class="linenos">1250</span>                   thenl c [thenl c [r, h], h]], thenl c [r, h]])))))])
<span class="linenos">1251</span> , theorem inj1_univ_inj
<span class="linenos">1252</span>   (pi A \ pi B \ (! (univ &#39;&#39; A &#39;&#39; B) x20 \ ! x21 \ inj1_univ &#39;&#39; A &#39;&#39; B &#39; x20 = inj1_univ &#39;&#39; A &#39;&#39; B &#39; x21 ==&gt; x20 = x21) ,
<span class="linenos">1253</span>    [then inv
<span class="linenos">1254</span>     (bind (univ &#39;&#39; A &#39;&#39; B) x20 \ bind (univ &#39;&#39; A &#39;&#39; B) x21 \
<span class="linenos">1255</span>        thenl (t (case_univ &#39;&#39; A &#39;&#39; B &#39;&#39; (univ &#39;&#39; A &#39;&#39; B) &#39; (inj1_univ &#39;&#39; A &#39;&#39; B &#39; x20) &#39;
<span class="linenos">1256</span>             (lam (univ &#39;&#39; A &#39;&#39; B) x22 \ x22) &#39;
<span class="linenos">1257</span>             (lam (univ &#39;&#39; A &#39;&#39; B) x22 \ x22)))
<span class="linenos">1258</span>         [then sym
<span class="linenos">1259</span>           (then (conv (land_tac (applyth case_univ_inj1)))
<span class="linenos">1260</span>             (then (conv (land_tac b)) r)),
<span class="linenos">1261</span>         then (conv (depth_tac h))
<span class="linenos">1262</span>          (then (conv (land_tac (applyth case_univ_inj1)))
<span class="linenos">1263</span>            (then (conv (land_tac b)) r))])])
<span class="linenos">1264</span> , theorem inj2_univ_inj
<span class="linenos">1265</span>   (pi A \ pi B \ (! (univ &#39;&#39; A &#39;&#39; B) x22 \ ! x23 \ inj2_univ &#39;&#39; A &#39;&#39; B &#39; x22 = inj2_univ &#39;&#39; A &#39;&#39; B &#39; x23 ==&gt; x22 = x23) ,
<span class="linenos">1266</span>    [then inv
<span class="linenos">1267</span>     (bind (univ &#39;&#39; A &#39;&#39; B) x20 \ bind (univ &#39;&#39; A &#39;&#39; B) x21 \
<span class="linenos">1268</span>        thenl (t (case_univ &#39;&#39; A &#39;&#39; B &#39;&#39; (univ &#39;&#39; A &#39;&#39; B) &#39; (inj2_univ &#39;&#39; A &#39;&#39; B &#39; x20) &#39;
<span class="linenos">1269</span>             (lam (univ &#39;&#39; A &#39;&#39; B) x22 \ x22) &#39;
<span class="linenos">1270</span>             (lam (univ &#39;&#39; A &#39;&#39; B) x22 \ x22)))
<span class="linenos">1271</span>         [then sym
<span class="linenos">1272</span>           (then (conv (land_tac (applyth case_univ_inj2)))
<span class="linenos">1273</span>             (then (conv (land_tac b)) r)),
<span class="linenos">1274</span>         then (conv (depth_tac h))
<span class="linenos">1275</span>          (then (conv (land_tac (applyth case_univ_inj2)))
<span class="linenos">1276</span>            (then (conv (land_tac b)) r))])])
<span class="linenos">1277</span> , theorem not_eq_inj1_inj2_univ 
<span class="linenos">1278</span>   (pi A \ pi B \ (! (univ &#39;&#39; A &#39;&#39; B) x22 \ ! x23 \ inj1_univ &#39;&#39; A &#39;&#39; B &#39; x22 = inj2_univ &#39;&#39; A &#39;&#39; B &#39; x23 ==&gt; ff) ,
<span class="linenos">1279</span>    [then inv
<span class="linenos">1280</span>     (bind (univ &#39;&#39; A &#39;&#39; B) x22 \
<span class="linenos">1281</span>       bind (univ &#39;&#39; A &#39;&#39; B) x23 \
<span class="linenos">1282</span>        then (cutth case_univ_inj1)
<span class="linenos">1283</span>         (then (lforall x22)
<span class="linenos">1284</span>           (then (lforall (lam (univ &#39;&#39; A &#39;&#39; B) x24 \ ff))
<span class="linenos">1285</span>             (then (lforall (lam (univ &#39;&#39; A &#39;&#39; B) x24 \ tt))
<span class="linenos">1286</span>               (thenl (m ((lam (univ &#39;&#39; A &#39;&#39; B) x24 \ ff) &#39; x22)) [b,
<span class="linenos">1287</span>                 then (conv (then sym h))
<span class="linenos">1288</span>                  (then (wl [])
<span class="linenos">1289</span>                    (then (conv (depth_tac h))
<span class="linenos">1290</span>                      (then (wl [])
<span class="linenos">1291</span>                        (then (conv (applyth case_univ_inj2))
<span class="linenos">1292</span>                          (then (conv b) (itaut 1))))))])))))])
<span class="linenos">1293</span> , theorem inj1_disj_union_inj (pi A \ pi B \
<span class="linenos">1294</span>    ((! x \ ! y \
<span class="linenos">1295</span>     inj1_disj_union &#39;&#39; A &#39;&#39; B &#39; x = inj1_disj_union &#39;&#39; A &#39;&#39; B &#39; y ==&gt; x = y) ,
<span class="linenos">1296</span>    [then inv
<span class="linenos">1297</span>      (bind A x23 \
<span class="linenos">1298</span>        bind A x24 \
<span class="linenos">1299</span>         then (cutth case_disj_union_inj1)
<span class="linenos">1300</span>          (then (lforall x23)
<span class="linenos">1301</span>            (then (lforall (lam A x25 \ x25))
<span class="linenos">1302</span>              (then (lforall (lam B x25 \ choose &#39;&#39; A))
<span class="linenos">1303</span>                (thenl (t ((lam A x25 \ x25) &#39; x23))
<span class="linenos">1304</span>                  [then (conv (rand_tac b)) r,
<span class="linenos">1305</span>                  then (conv (land_tac (then sym h)))
<span class="linenos">1306</span>                   (then (wl [])
<span class="linenos">1307</span>                     (then (conv (depth_tac h))
<span class="linenos">1308</span>                       (then (wl [])
<span class="linenos">1309</span>                         (then (conv (land_tac (applyth case_disj_union_inj1)))
<span class="linenos">1310</span>                           b))))])))))]))
<span class="linenos">1311</span> , theorem inj2_disj_union_inj (pi A \ pi B \
<span class="linenos">1312</span>    ((! x \ ! y \
<span class="linenos">1313</span>     inj2_disj_union &#39;&#39; A &#39;&#39; B &#39; x = inj2_disj_union &#39;&#39; A &#39;&#39; B &#39; y ==&gt; x = y) ,
<span class="linenos">1314</span>    [then inv
<span class="linenos">1315</span>      (bind B x23 \
<span class="linenos">1316</span>        bind B x24 \
<span class="linenos">1317</span>         then (cutth case_disj_union_inj2)
<span class="linenos">1318</span>          (then (lforall x23)
<span class="linenos">1319</span>            (then (lforall (lam A x25 \ choose &#39;&#39; B))
<span class="linenos">1320</span>              (then (lforall (lam B x25 \ x25))
<span class="linenos">1321</span>                (thenl (t ((lam B x25 \ x25) &#39; x23))
<span class="linenos">1322</span>                  [then (conv (rand_tac b)) r,
<span class="linenos">1323</span>                  then (conv (land_tac (then sym h)))
<span class="linenos">1324</span>                   (then (wl [])
<span class="linenos">1325</span>                     (then (conv (depth_tac h))
<span class="linenos">1326</span>                       (then (wl [])
<span class="linenos">1327</span>                         (then (conv (land_tac (applyth case_disj_union_inj2)))
<span class="linenos">1328</span>                           b))))])))))]))
<span class="linenos">1329</span>
<span class="linenos">1330</span> /********** Monotonicity of logical connectives *********/
<span class="linenos">1331</span> , theorem and_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1332</span>    (a1 ==&gt; b1) ==&gt; (a2 ==&gt; b2) ==&gt; a1 &amp;&amp; a2 ==&gt; b1 &amp;&amp; b2),
<span class="linenos">1333</span>    [itaut 2])
<span class="linenos">1334</span> , theorem or_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1335</span>    (a1 ==&gt; b1) ==&gt; (a2 ==&gt; b2) ==&gt; a1 `or a2 ==&gt; b1 `or b2),
<span class="linenos">1336</span>    [itaut 2])
<span class="linenos">1337</span> , theorem impl_monotone ((! a1 \ ! b1 \ ! a2 \ ! b2 \
<span class="linenos">1338</span>    (b1 ==&gt; a1) ==&gt; (a2 ==&gt; b2) ==&gt; (a1 ==&gt; a2) ==&gt; (b1 ==&gt; b2)),
<span class="linenos">1339</span>    [itaut 3])
<span class="linenos">1340</span> , theorem not_monotone ((! p \ ! q \ (p ==&gt; q) ==&gt; (not &#39; q) ==&gt; (not &#39; p)),
<span class="linenos">1341</span>    [itaut 3])
<span class="linenos">1342</span> , theorem forall_monotone (pi A \ (! p \ ! q \
<span class="linenos">1343</span>    (! A x \ p &#39; x ==&gt; q &#39; x) ==&gt; (! x \ p &#39; x) ==&gt; (! x \ q &#39; x)),
<span class="linenos">1344</span>    [itaut 6])
<span class="linenos">1345</span> , theorem exists_monotone (pi A \ (! p \ ! q \
<span class="linenos">1346</span>    (! A x \ p &#39; x ==&gt; q &#39; x) ==&gt; (? x \ p &#39; x) ==&gt; (? x \ q &#39; x)),
<span class="linenos">1347</span>    [itaut 6])
<span class="linenos">1348</span>
<span class="linenos">1349</span> /********** Knaster-Tarski theorem *********/
<span class="linenos">1350</span>  , def in (pi A \ (A --&gt; (A --&gt; prop) --&gt; prop),
<span class="linenos">1351</span>     (lam A x \ lam (A --&gt; prop) j \ j &#39; x))
<span class="linenos">1352</span>  , def subseteq (pi A \ ((A --&gt; prop) --&gt; (A --&gt; prop) --&gt; prop),
<span class="linenos">1353</span>     (lam (A --&gt; prop) x \ lam (A --&gt; prop) y \ ! z \ z #in x ==&gt; z #in y))
<span class="linenos">1354</span>  , theorem in_subseteq (pi A \ 
<span class="linenos">1355</span>     (! s \ ! t \ ! x \ s &lt;&lt;= t ==&gt; x #in s ==&gt; x #in t),
<span class="linenos">1356</span>     [then forall_i
<span class="linenos">1357</span>       (bind (A --&gt; prop) x9 \
<span class="linenos">1358</span>         then forall_i
<span class="linenos">1359</span>          (bind (A --&gt; prop) x10 \
<span class="linenos">1360</span>            then forall_i (bind A x11 \ then (conv (land_tac dd)) (itaut 4))))])
<span class="linenos">1361</span>  , def monotone (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; prop),
<span class="linenos">1362</span>      (lam (_ A) f \ ! x \ ! y \ x &lt;&lt;= y ==&gt; f &#39; x &lt;&lt;= f &#39; y))
<span class="linenos">1363</span>  , def is_fixpoint (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; ((A --&gt; prop) --&gt; prop)),
<span class="linenos">1364</span>     (lam (_ A) f \ lam (_ A) x \ (f &#39; x) &lt;&lt;= x &amp;&amp; x &lt;&lt;= (f &#39; x)))
<span class="linenos">1365</span>  , def fixpoint (pi A \ (((A --&gt; prop) --&gt; (A --&gt; prop)) --&gt; (A --&gt; prop)),
<span class="linenos">1366</span>     (lam (_ A) f \ lam A a \ ! e \ f &#39; e &lt;&lt;= e ==&gt; a #in e))
<span class="linenos">1367</span>  , theorem fixpoint_subseteq_any_prefixpoint (pi A \
<span class="linenos">1368</span>     (! f \ ! x\ f &#39; x &lt;&lt;= x ==&gt; fixpoint &#39;&#39; A &#39; f &lt;&lt;= x),
<span class="linenos">1369</span>     [then inv
<span class="linenos">1370</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1371</span>         (bind (A --&gt; prop) x10 \
<span class="linenos">1372</span>           then (conv (land_tac dd))
<span class="linenos">1373</span>            (then (conv dd)
<span class="linenos">1374</span>              (then forall_i
<span class="linenos">1375</span>                (bind A x11 \
<span class="linenos">1376</span>                  then (conv (land_tac dd))
<span class="linenos">1377</span>                   (then (conv (land_tac b)) (itaut 4)))))))])
<span class="linenos">1378</span>  , theorem fixpoint_subseteq_any_fixpoint (pi A \
<span class="linenos">1379</span>     (! f \ ! x\ is_fixpoint &#39;&#39; A &#39; f &#39; x ==&gt; fixpoint &#39;&#39; A &#39; f &lt;&lt;= x),
<span class="linenos">1380</span>     [then forall_i
<span class="linenos">1381</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1382</span>         then forall_i
<span class="linenos">1383</span>          (bind (A --&gt; prop) x10 \
<span class="linenos">1384</span>            then (conv (land_tac dd))
<span class="linenos">1385</span>             (then (cutth fixpoint_subseteq_any_prefixpoint) (itaut 8))))])
<span class="linenos">1386</span>  , theorem prefixpoint_to_prefixpoint (pi A \
<span class="linenos">1387</span>     (! f \ ! x \ monotone &#39;&#39; A &#39; f ==&gt; f &#39; x &lt;&lt;= x ==&gt; f &#39; (f &#39; x) &lt;&lt;= f &#39; x),
<span class="linenos">1388</span>    [then forall_i
<span class="linenos">1389</span>      (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1390</span>        then forall_i
<span class="linenos">1391</span>         (bind (A --&gt; prop) x10 \ then (conv (land_tac dd)) (itaut 6)))])
<span class="linenos">1392</span>  , theorem fixpoint_is_prefixpoint (pi A \
<span class="linenos">1393</span>     (! f \ monotone &#39;&#39; A &#39; f ==&gt; f &#39; (fixpoint &#39;&#39; A &#39; f)&lt;&lt;= fixpoint &#39;&#39; A &#39; f),
<span class="linenos">1394</span>     [then inv
<span class="linenos">1395</span>       (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1396</span>         then (conv dd)
<span class="linenos">1397</span>          (then inv
<span class="linenos">1398</span>            (bind A x10 \
<span class="linenos">1399</span>              then (conv (depth_tac (dd [fixpoint])))
<span class="linenos">1400</span>               (then (conv dd)
<span class="linenos">1401</span>                 (then (conv b)
<span class="linenos">1402</span>                   (then inv
<span class="linenos">1403</span>                     (bind (A --&gt; prop) x11 \
<span class="linenos">1404</span>                       thenl (cut (fixpoint &#39;&#39; A &#39; x9 &lt;&lt;= x11))
<span class="linenos">1405</span>                        [thenl
<span class="linenos">1406</span>                          (cut (x9 &#39; (fixpoint &#39;&#39; A &#39; x9) &lt;&lt;= x9 &#39; x11))
<span class="linenos">1407</span>                          [then (cutth in_subseteq)
<span class="linenos">1408</span>                            (then (lforall_last (x9 &#39; x11))
<span class="linenos">1409</span>                              (then (lforall_last x11)
<span class="linenos">1410</span>                                (thenl apply_last [h,
<span class="linenos">1411</span>                                  then (cutth in_subseteq) (itaut 10)]))),
<span class="linenos">1412</span>                          thenl
<span class="linenos">1413</span>                           (m (monotone &#39;&#39; A &#39; x9 ==&gt; x9 &#39; (fixpoint &#39;&#39; A &#39; x9) &lt;&lt;= x9 &#39; x11))
<span class="linenos">1414</span>                           [itaut 10, then (conv (land_tac dd)) (itaut 10)]],
<span class="linenos">1415</span>                        then (applyth fixpoint_subseteq_any_prefixpoint) h])))))))])
<span class="linenos">1416</span>  , theorem fixpoint_is_fixpoint (pi A \
<span class="linenos">1417</span>    (! f \ monotone &#39;&#39; A &#39; f ==&gt; is_fixpoint &#39;&#39; A &#39; f &#39; (fixpoint &#39;&#39; A &#39; f)),
<span class="linenos">1418</span>    [then inv
<span class="linenos">1419</span>      (bind ((A --&gt; prop) --&gt; (A --&gt; prop)) x9 \
<span class="linenos">1420</span>        then (conv (depth_tac (dd [is_fixpoint])))
<span class="linenos">1421</span>         (thenl inv [then (applyth fixpoint_is_prefixpoint) h,
<span class="linenos">1422</span>           then (applyth fixpoint_subseteq_any_prefixpoint)
<span class="linenos">1423</span>            (then (g (monotone &#39;&#39; A &#39; x9))
<span class="linenos">1424</span>              (then (conv (land_tac dd))
<span class="linenos">1425</span>                (then inv
<span class="linenos">1426</span>                  (then apply (then (applyth fixpoint_is_prefixpoint) h)))))]))])
<span class="linenos">1427</span>
<span class="linenos">1428</span> /*********** Axiomatization of well-founded recursion ********/
<span class="linenos">1429</span> , decl rec (pi A \pi B \ ((A --&gt; B) --&gt; (A --&gt; B)) --&gt; (A --&gt; B))
<span class="linenos">1430</span> , inductive_def acc accF accF_monotone acc_i0 acc_e0 acc_e
<span class="linenos">1431</span>    (pi A \ param (A --&gt; A --&gt; prop) lt \ acc \
<span class="linenos">1432</span>     [ (acc_i, ! x \ (! y \ lt &#39; y &#39; x ==&gt; acc &#39; y) ==&gt; acc &#39; x) ])
<span class="linenos">1433</span>
<span class="linenos">1434</span> , def well_founded (pi A \ ((A --&gt; A --&gt; prop) --&gt; prop,
<span class="linenos">1435</span>    lam (_ A) lt \ ! x \ acc &#39;&#39; A &#39; lt &#39; x))
<span class="linenos">1436</span>
<span class="linenos">1437</span> , axiom rec_is_fixpoint (pi A \ pi B \
<span class="linenos">1438</span>   (! lt \ well_founded &#39;&#39; A &#39; lt ==&gt;
<span class="linenos">1439</span>    ! ((A --&gt; B) --&gt; (A --&gt; B)) h \
<span class="linenos">1440</span>     (! f \ ! g \ ! i \
<span class="linenos">1441</span>       (! p \ lt &#39; p &#39; i ==&gt; f &#39; p = g &#39; p) ==&gt; h &#39; f &#39; i = h &#39; g &#39; i) ==&gt;
<span class="linenos">1442</span>     rec &#39;&#39; A &#39;&#39; B &#39; h = h &#39; (rec &#39;&#39; A &#39;&#39; B &#39; h)))
<span class="linenos">1443</span> /******************* TESTS *****************/
<span class="linenos">1444</span> /* The first three tests are commented out because they require extra-hacks
<span class="linenos">1445</span>    in the kernel to avoid quantifying over p, q and g.
<span class="linenos">1446</span> , theorem test_apply (p ==&gt; (p ==&gt; p ==&gt; q) ==&gt; q,
<span class="linenos">1447</span>    [then i (then i (then apply h))])
<span class="linenos">1448</span> , theorem test_apply2 (p ==&gt; (! x \ ! y \ x ==&gt; x ==&gt; y) ==&gt; q,
<span class="linenos">1449</span>    [then i (then i (then apply h))])
<span class="linenos">1450</span> , theorem test_itaut_1 (((? x \ g x) ==&gt; ! x \ (! y \ g y ==&gt; x) ==&gt; x),
<span class="linenos">1451</span>   [itaut 4])*/
<span class="linenos">1452</span> , theorem test_monotone1 (monotone &#39;&#39; _ &#39; (lam _ p \ lam _ x \ not &#39; (p &#39; x) ==&gt; tt &amp;&amp; p &#39; tt `or p &#39; x),
<span class="linenos">1453</span>   [ auto_monotone ])
<span class="linenos">1454</span> , theorem test_monotone2 (monotone &#39;&#39; _ &#39; (lam _ p \ lam _ x \ ? z \ not &#39; (p &#39; x) ==&gt; tt &amp;&amp; p &#39; tt `or z),
<span class="linenos">1455</span>   [ auto_monotone ])
<span class="linenos">1456</span> , theorem test_monotone3 (monotone &#39;&#39; _ &#39; (lam _ p \ lam _ x \ ! z \ ? y \ (not &#39; (p &#39; x) ==&gt; z &amp;&amp; p &#39; y `or y)),
<span class="linenos">1457</span>   [ auto_monotone ])
<span class="linenos">1458</span> , inductive_def pnn pnnF pnnF_monotone pnn_i pnn_e0 pnn_e (pnn \
<span class="linenos">1459</span>     [ (pnn_tt, pnn &#39; tt)
<span class="linenos">1460</span>     , (pnn_not, ! x \ pnn &#39; x ==&gt; pnn &#39; (not &#39; x))])
<span class="linenos">1461</span> , theorem pnn_e
<span class="linenos">1462</span>    ((! x13 \
<span class="linenos">1463</span>       x13 &#39; tt &amp;&amp; (! x14 \ x13 &#39; x14 ==&gt; x13 &#39; (not &#39; x14)) ==&gt;
<span class="linenos">1464</span>        (! x14 \ pnn &#39; x14 ==&gt; x13 &#39; x14)) ,
<span class="linenos">1465</span>   [then forall_i
<span class="linenos">1466</span>     (bind (prop --&gt; prop) x13 \
<span class="linenos">1467</span>       then (cutth pnn_e0)
<span class="linenos">1468</span>        (then (lforall x13)
<span class="linenos">1469</span>          (then i
<span class="linenos">1470</span>            (thenl lapply
<span class="linenos">1471</span>              [then (conv (depth_tac (dd [pnnF])))
<span class="linenos">1472</span>                (then forall_i
<span class="linenos">1473</span>                  (bind prop x14 \
<span class="linenos">1474</span>                    then i
<span class="linenos">1475</span>                     % from now on the proof is ad-hoc + fragile
<span class="linenos">1476</span>                     (thenl left [then (conv (depth_tac h)) (itaut 1),
<span class="linenos">1477</span>                       then left
<span class="linenos">1478</span>                        (bind prop x15 \
<span class="linenos">1479</span>                          then left (then (conv (depth_tac h)) (itaut 8)))]))),
<span class="linenos">1480</span>              h]))))])
<span class="linenos">1481</span> , theorem pnn_has_two_values
<span class="linenos">1482</span>    ((! x13 \ pnn &#39; x13 ==&gt; x13 = tt `or x13 = ff) ,
<span class="linenos">1483</span>    % applying an elimination principle is hard: it should be automatized
<span class="linenos">1484</span>    [then (cutth pnn_e)
<span class="linenos">1485</span>      (then (lforall (lam prop x13 \ or &#39; (eq &#39;&#39; prop &#39; x13 &#39; tt) &#39; (eq &#39;&#39; prop &#39; x13 &#39; ff)))
<span class="linenos">1486</span>        (thenl lapply
<span class="linenos">1487</span>          [thenl conj [then (conv b) (itaut 1),
<span class="linenos">1488</span>            then (repeat (conv (depth_tac b)))
<span class="linenos">1489</span>             (then forall_i (bind prop x13 \ then i (then left (itaut 8))))],
<span class="linenos">1490</span>          then inv
<span class="linenos">1491</span>           (bind prop x13 \
<span class="linenos">1492</span>             then (lforall x13)
<span class="linenos">1493</span>              (thenl lapply [h,
<span class="linenos">1494</span>                then
<span class="linenos">1495</span>                 (g
<span class="linenos">1496</span>                   ((lam prop x14 \ or &#39; (eq &#39;&#39; prop &#39; x14 &#39; tt) &#39; (eq &#39;&#39; prop &#39; x14 &#39; ff)) &#39;
<span class="linenos">1497</span>                     x13))
<span class="linenos">1498</span>                 (then (repeat (conv (depth_tac b)))
<span class="linenos">1499</span>                   (then
<span class="linenos">1500</span>                     (w
<span class="linenos">1501</span>                       ((lam prop x14 \ or &#39; (eq &#39;&#39; prop &#39; x14 &#39; tt) &#39; (eq &#39;&#39; prop &#39; x14 &#39; ff))
<span class="linenos">1502</span>                         &#39; x13)) (then (w (pnn &#39; x13)) (itaut 2))))]))]))])
<span class="linenos">1503</span> , inductive_def in_two in_twoF in_twoF_monotone in_two_i in_two_e0 in_two_e (in_two \
<span class="linenos">1504</span>     [ (in_two_tt, in_two &#39; tt)
<span class="linenos">1505</span>     , (in_two_ff, in_two &#39; ff) ])
<span class="linenos">1506</span> , new_basic_type bool2 myrep2 myabs2 myrepabs2 myabsrep2 myproprep2
<span class="linenos">1507</span>    (pnn,
<span class="linenos">1508</span>    [then (cutth pnn_tt) (then (applyth exists_i) h)])
<span class="linenos">1509</span> , def mytt (bool2,(myabs2 &#39; tt))
<span class="linenos">1510</span> , def mynot ((bool2 --&gt; bool2),(lam _ x \ myabs2 &#39; (not &#39; (myrep2 &#39; x))))
<span class="linenos">1511</span> , theorem mytt_transfer
<span class="linenos">1512</span>   (myrep2 &#39; mytt = tt ,
<span class="linenos">1513</span>     [then (conv (depth_tac (dd [mytt])))
<span class="linenos">1514</span>       (then (applyth myrepabs2) (applyth pnn_tt))])
<span class="linenos">1515</span> , theorem mynot_transfer
<span class="linenos">1516</span>   ((! x18 \ myrep2 &#39; (mynot &#39; x18) = not &#39; (myrep2 &#39; x18)) ,
<span class="linenos">1517</span>     [then (conv (depth_tac (dd [mynot])))
<span class="linenos">1518</span>       (then forall_i
<span class="linenos">1519</span>         (bind bool2 x18 \
<span class="linenos">1520</span>           then (applyth myrepabs2)
<span class="linenos">1521</span>            (then (applyth pnn_not) (applyth myproprep2))))])
<span class="linenos">1522</span> , theorem mybool2_e
<span class="linenos">1523</span> ((! x18 \
<span class="linenos">1524</span>    x18 &#39; mytt &amp;&amp; (! x19 \ x18 &#39; x19 ==&gt; x18 &#39; (mynot &#39; x19)) ==&gt;
<span class="linenos">1525</span>     (! x19 \ x18 &#39; x19)) ,
<span class="linenos">1526</span>   [thenl
<span class="linenos">1527</span>     (cut
<span class="linenos">1528</span>       (forall &#39;&#39; (bool2 --&gt; prop) &#39;
<span class="linenos">1529</span>         (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1530</span>           impl &#39;
<span class="linenos">1531</span>            (and &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; mytt))) &#39;
<span class="linenos">1532</span>              (forall &#39;&#39; bool2 &#39;
<span class="linenos">1533</span>                (lam bool2 x19 \
<span class="linenos">1534</span>                  impl &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; x19))) &#39;
<span class="linenos">1535</span>                   (x18 &#39;
<span class="linenos">1536</span>                     (myabs2 &#39;
<span class="linenos">1537</span>                       (myrep2 &#39; (mynot &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))))
<span class="linenos">1538</span>            &#39;
<span class="linenos">1539</span>            (forall &#39;&#39; bool2 &#39;
<span class="linenos">1540</span>              (lam bool2 x19 \ x18 &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))
<span class="linenos">1541</span>     [then
<span class="linenos">1542</span>       (g
<span class="linenos">1543</span>         (forall &#39;&#39; (bool2 --&gt; prop) &#39;
<span class="linenos">1544</span>           (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1545</span>             impl &#39;
<span class="linenos">1546</span>              (and &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; mytt))) &#39;
<span class="linenos">1547</span>                (forall &#39;&#39; bool2 &#39;
<span class="linenos">1548</span>                  (lam bool2 x19 \
<span class="linenos">1549</span>                    impl &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; x19))) &#39;
<span class="linenos">1550</span>                     (x18 &#39;
<span class="linenos">1551</span>                       (myabs2 &#39;
<span class="linenos">1552</span>                         (myrep2 &#39; (mynot &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))))
<span class="linenos">1553</span>              &#39;
<span class="linenos">1554</span>              (forall &#39;&#39; bool2 &#39;
<span class="linenos">1555</span>                (lam bool2 x19 \ x18 &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))
<span class="linenos">1556</span>       (then
<span class="linenos">1557</span>         (w
<span class="linenos">1558</span>           (forall &#39;&#39; (bool2 --&gt; prop) &#39;
<span class="linenos">1559</span>             (lam (bool2 --&gt; prop) x18 \
<span class="linenos">1560</span>               impl &#39;
<span class="linenos">1561</span>                (and &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; mytt))) &#39;
<span class="linenos">1562</span>                  (forall &#39;&#39; bool2 &#39;
<span class="linenos">1563</span>                    (lam bool2 x19 \
<span class="linenos">1564</span>                      impl &#39; (x18 &#39; (myabs2 &#39; (myrep2 &#39; x19))) &#39;
<span class="linenos">1565</span>                       (x18 &#39;
<span class="linenos">1566</span>                         (myabs2 &#39;
<span class="linenos">1567</span>                           (myrep2 &#39; (mynot &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))))
<span class="linenos">1568</span>                &#39;
<span class="linenos">1569</span>                (forall &#39;&#39; bool2 &#39;
<span class="linenos">1570</span>                  (lam bool2 x19 \ x18 &#39; (myabs2 &#39; (myrep2 &#39; x19)))))))
<span class="linenos">1571</span>         (then (repeat (conv (depth_tac (applyth myabsrep2)))) (then i h))),
<span class="linenos">1572</span>     then forall_i
<span class="linenos">1573</span>      (bind (bool2 --&gt; prop) x18 \
<span class="linenos">1574</span>        then (cutth pnn_e)
<span class="linenos">1575</span>         (then
<span class="linenos">1576</span>           (lforall
<span class="linenos">1577</span>             (lam prop x19 \
<span class="linenos">1578</span>               exists &#39;&#39; bool2 &#39;
<span class="linenos">1579</span>                (lam bool2 x20 \
<span class="linenos">1580</span>                  and &#39; (eq &#39;&#39; _ &#39; x19 &#39; (myrep2 &#39; x20)) &#39;
<span class="linenos">1581</span>                   (x18 &#39; (myabs2 &#39; x19)))))
<span class="linenos">1582</span>           (then inv
<span class="linenos">1583</span>             (bind bool2 x19 \
<span class="linenos">1584</span>               thenl
<span class="linenos">1585</span>                (cut
<span class="linenos">1586</span>                  ((lam prop x20 \
<span class="linenos">1587</span>                     exists &#39;&#39; bool2 &#39;
<span class="linenos">1588</span>                      (lam bool2 x21 \
<span class="linenos">1589</span>                        and &#39; (eq &#39;&#39; _ &#39; x20 &#39; (myrep2 &#39; x21)) &#39;
<span class="linenos">1590</span>                         (x18 &#39; (myabs2 &#39; x20)))) &#39; (myrep2 &#39; x19)))
<span class="linenos">1591</span>                [then
<span class="linenos">1592</span>                  (g
<span class="linenos">1593</span>                    ((lam prop x20 \
<span class="linenos">1594</span>                       exists &#39;&#39; bool2 &#39;
<span class="linenos">1595</span>                        (lam bool2 x21 \
<span class="linenos">1596</span>                          and &#39; (eq &#39;&#39; _ &#39; x20 &#39; (myrep2 &#39; x21)) &#39;
<span class="linenos">1597</span>                           (x18 &#39; (myabs2 &#39; x20)))) &#39; (myrep2 &#39; x19)))
<span class="linenos">1598</span>                  (then (conv (depth_tac b)) inv),
<span class="linenos">1599</span>                thenl apply
<span class="linenos">1600</span>                 [then (repeat (conv (depth_tac b)))
<span class="linenos">1601</span>                   (thenl inv
<span class="linenos">1602</span>                     [then (cutth exists_i)
<span class="linenos">1603</span>                       (then
<span class="linenos">1604</span>                         (lforall_last
<span class="linenos">1605</span>                           (lam bool2 x20 \
<span class="linenos">1606</span>                             and &#39; (eq &#39;&#39; _ &#39; tt &#39; (myrep2 &#39; x20)) &#39;
<span class="linenos">1607</span>                              (x18 &#39; (myabs2 &#39; tt))))
<span class="linenos">1608</span>                         (then (lforall_last mytt)
<span class="linenos">1609</span>                           (then apply_last (then (conv b)
<span class="linenos">1610</span>                            (thenl inv
<span class="linenos">1611</span>                             [then (cutth mytt_transfer)
<span class="linenos">1612</span>                               (then (conv (depth_tac h)) (applyth tt_intro)),
<span class="linenos">1613</span>                             (applyth tt_intro),
<span class="linenos">1614</span>                             then (cutth mytt_transfer)
<span class="linenos">1615</span>                              (then (g (x18 &#39; (myabs2 &#39; (myrep2 &#39; mytt))))
<span class="linenos">1616</span>                                (then (conv (depth_tac h)) (then i h)))]))))),
<span class="linenos">1617</span>                     (bind prop x20 \
<span class="linenos">1618</span>                       bind bool2 x21 \
<span class="linenos">1619</span>                        then (cutth exists_i)
<span class="linenos">1620</span>                         (then
<span class="linenos">1621</span>                           (lforall_last
<span class="linenos">1622</span>                             (lam bool2 x22 \
<span class="linenos">1623</span>                               and &#39; (eq &#39;&#39; _ &#39; (not &#39; x20) &#39; (myrep2 &#39; x22)) &#39;
<span class="linenos">1624</span>                                (x18 &#39; (myabs2 &#39; (not &#39; x20)))))
<span class="linenos">1625</span>                           (then (lforall_last (mynot &#39; x21))
<span class="linenos">1626</span>                             (then apply_last (then (conv b)
<span class="linenos">1627</span>    (thenl inv
<span class="linenos">1628</span>     [then (conv (applyth mynot_transfer))
<span class="linenos">1629</span>       (then (conv (depth_tac (dd [not]))) (then inv (itaut 3))),
<span class="linenos">1630</span>     then (g (myrep2 &#39; (mynot &#39; x21)))
<span class="linenos">1631</span>      (then (conv (land_tac (applyth mynot_transfer)))
<span class="linenos">1632</span>        (then (conv (depth_tac (dd [not]))) (then inv (itaut 3)))),
<span class="linenos">1633</span>     then (lforall (myabs2 &#39; x20))
<span class="linenos">1634</span>      (thenl lapply [then (conv (depth_tac (applyth myabsrep2))) h,
<span class="linenos">1635</span>        then
<span class="linenos">1636</span>         (g
<span class="linenos">1637</span>           (x18 &#39;
<span class="linenos">1638</span>             (myabs2 &#39;
<span class="linenos">1639</span>               (myrep2 &#39; (mynot &#39; (myabs2 &#39; (myrep2 &#39; (myabs2 &#39; x20))))))))
<span class="linenos">1640</span>         (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1641</span>           (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1642</span>             (thenl (cut (x20 = myrep2 &#39; x21))
<span class="linenos">1643</span>               [then (conv (depth_tac h))
<span class="linenos">1644</span>                 (then (conv (depth_tac h))
<span class="linenos">1645</span>                   (then (conv (depth_tac (applyth myabsrep2)))
<span class="linenos">1646</span>                     (then i
<span class="linenos">1647</span>                       (then
<span class="linenos">1648</span>                         (conv
<span class="linenos">1649</span>                           (rand_tac
<span class="linenos">1650</span>                             (rand_tac (then sym (applyth mynot_transfer)))))
<span class="linenos">1651</span>                         (then (conv (depth_tac (applyth myabsrep2))) h))))),
<span class="linenos">1652</span>               itaut 2])))])]))))))]),
<span class="linenos">1653</span>                 applyth myproprep2]]))))]])
<span class="linenos">1654</span>
<span class="linenos">1655</span>, theorem step0
<span class="linenos">1656</span>    ((! x13 \ mynot &#39; (mynot &#39; (mynot &#39; x13)) = mynot &#39; x13) ,
<span class="linenos">1657</span>     [then inv
<span class="linenos">1658</span>      (bind bool2 x13 \
<span class="linenos">1659</span>        then (repeat (conv (depth_tac (dd [mynot]))))
<span class="linenos">1660</span>         (thenl (conv (land_tac (rand_tac (rand_tac (applyth myrepabs2)))))
<span class="linenos">1661</span>          [then (cutth pnn_not)
<span class="linenos">1662</span>            (then (lforall (myrep2 &#39; (myabs2 &#39; (not &#39; (myrep2 &#39; x13)))))
<span class="linenos">1663</span>              (then (cutth myproprep2)
<span class="linenos">1664</span>                (then (lforall (myabs2 &#39; (not &#39; (myrep2 &#39; x13))))
<span class="linenos">1665</span>                  (then apply h)))),
<span class="linenos">1666</span>          thenl
<span class="linenos">1667</span>           (conv
<span class="linenos">1668</span>             (land_tac
<span class="linenos">1669</span>               (rand_tac (rand_tac (rand_tac (applyth myrepabs2))))))
<span class="linenos">1670</span>           [then (cutth pnn_not)
<span class="linenos">1671</span>             (then (lforall (myrep2 &#39; x13))
<span class="linenos">1672</span>               (then (cutth myproprep2)
<span class="linenos">1673</span>                 (then (lforall x13) (then apply h)))),
<span class="linenos">1674</span>           then (conv (land_tac (rand_tac (applyth not_not_not)))) r]]))])
<span class="linenos">1675</span> , theorem mynot_mynot_mytt
<span class="linenos">1676</span>    (mynot &#39; (mynot &#39; mytt) = mytt ,
<span class="linenos">1677</span>     [then (conv (depth_tac (dd [mynot])))
<span class="linenos">1678</span>      (then (cutth mynot_transfer)
<span class="linenos">1679</span>        (then (lforall mytt)
<span class="linenos">1680</span>          (then (conv (depth_tac h))
<span class="linenos">1681</span>            (then (cutth mytt_transfer)
<span class="linenos">1682</span>              (then (conv (depth_tac h))
<span class="linenos">1683</span>                (then (conv (depth_tac (dd [mytt]))) (thenl c [r, itaut 3])))))))])
<span class="linenos">1684</span> , theorem step1
<span class="linenos">1685</span>    ((! x18 \ x18 = mytt `or x18 = mynot &#39; mytt) ,
<span class="linenos">1686</span>     [then forall_i
<span class="linenos">1687</span>      (bind bool2 x18 \
<span class="linenos">1688</span>       then (cutth mybool2_e)
<span class="linenos">1689</span>        (thenl
<span class="linenos">1690</span>          (cut
<span class="linenos">1691</span>            ((lam bool2 x19 \
<span class="linenos">1692</span>               or &#39; (eq &#39;&#39; _ &#39; x19 &#39; mytt) &#39; (eq &#39;&#39; _ &#39; x19 &#39; (mynot &#39; mytt))) &#39; x18))
<span class="linenos">1693</span>          [then
<span class="linenos">1694</span>            (g
<span class="linenos">1695</span>              ((lam bool2 x19 \
<span class="linenos">1696</span>                 or &#39; (eq &#39;&#39; _ &#39; x19 &#39; mytt) &#39; (eq &#39;&#39; _ &#39; x19 &#39; (mynot &#39; mytt))) &#39;
<span class="linenos">1697</span>                x18)) (then (conv (depth_tac b)) (then i h)),
<span class="linenos">1698</span>          then apply
<span class="linenos">1699</span>           (then (repeat (conv (depth_tac b)))
<span class="linenos">1700</span>             (thenl conj [then (applyth orl) r,
<span class="linenos">1701</span>               thenl inv
<span class="linenos">1702</span>                [(bind bool2 x19 \
<span class="linenos">1703</span>                   then (applyth orr) (then (conv (depth_tac h)) r)),
<span class="linenos">1704</span>                (bind bool2 x19 \
<span class="linenos">1705</span>                  then (applyth orl) (then (conv (depth_tac h)) (applyth mynot_mynot_mytt)))]]))]))])
<span class="linenos">1706</span>
<span class="linenos">1707</span> /******* Cartesian product of types ******/
<span class="linenos">1708</span> /* TODO: this is an inductive type as well: generalize
<span class="linenos">1709</span>    inductive_type to type abstractions */
<span class="linenos">1710</span> , def is_pair (pi A \ pi B \
<span class="linenos">1711</span>  (univ &#39;&#39; (disj_union &#39;&#39; A &#39;&#39; B) &#39;&#39; prop --&gt; prop),
<span class="linenos">1712</span>  lam (_ A B) p \ ? A a \ ? B b \
<span class="linenos">1713</span>   p =
<span class="linenos">1714</span>    pair_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39;
<span class="linenos">1715</span>     (injection_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39; (inj1_disj_union &#39;&#39; A &#39;&#39; B &#39; a)) &#39;
<span class="linenos">1716</span>     (injection_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39; (inj2_disj_union &#39;&#39; A &#39;&#39; B &#39; b)))
<span class="linenos">1717</span> , new_basic_type prod prod_rep prod_abs prod_repabs prod_absrep prod_proprep
<span class="linenos">1718</span>    (pi A \ pi B \ is_pair &#39;&#39; A &#39;&#39; B, [daemon])
<span class="linenos">1719</span> , def pair (pi A \ pi B \
<span class="linenos">1720</span>    (A --&gt; B --&gt; prod &#39;&#39; A &#39;&#39; B,
<span class="linenos">1721</span>    lam A a \ lam B b \
<span class="linenos">1722</span>     prod_abs &#39;&#39; A &#39;&#39; B &#39;
<span class="linenos">1723</span>      (pair_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39;
<span class="linenos">1724</span>       (injection_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39; (inj1_disj_union &#39;&#39; A &#39;&#39; B &#39; a)) &#39;
<span class="linenos">1725</span>       (injection_univ &#39;&#39; (_ A B) &#39;&#39; _ &#39; (inj2_disj_union &#39;&#39; A &#39;&#39; B &#39; b)))
<span class="linenos">1726</span>    ))
<span class="linenos">1727</span> /* TODO: define fst and snd and prove the usual lemmas
<span class="linenos">1728</span>    fst &#39; (pair &#39; a &#39; b) = a */
<span class="linenos">1729</span>
<span class="linenos">1730</span>  /************* Natural numbers ***************/
<span class="linenos">1731</span> , inductive_def is_nat is_natF is_nat_monotone is_nat_i is_nat_e0 is_nat_e
<span class="linenos">1732</span>   (is_nat \
<span class="linenos">1733</span>     [ (is_nat_z, is_nat &#39; (inj1_univ &#39;&#39; prop &#39;&#39; prop &#39; (injection_univ &#39;&#39; prop &#39;&#39; prop &#39; ff)))
<span class="linenos">1734</span>     , (is_nat_s, ! x \ is_nat &#39; x ==&gt; is_nat &#39; (inj2_univ &#39;&#39; prop &#39;&#39; prop &#39; x))])
<span class="linenos">1735</span> , new_basic_type nat nat_rep nat_abs nat_repabs nat_absrep nat_proprep
<span class="linenos">1736</span>    (is_nat,
<span class="linenos">1737</span>    [then (cutth is_nat_z) (then (applyth exists_i) h)])
<span class="linenos">1738</span> , def z (nat, nat_abs &#39; (inj1_univ &#39;&#39; prop &#39;&#39; prop &#39; (injection_univ &#39;&#39; prop &#39;&#39; prop &#39; ff)))
<span class="linenos">1739</span> , def s (nat --&gt; nat,
<span class="linenos">1740</span>    (lam _ x \ nat_abs &#39; (inj2_univ &#39;&#39; prop &#39;&#39; prop &#39; (nat_rep &#39; x))))
<span class="linenos">1741</span> /* TODO: consequence of is_nat_e by transfer principles */
<span class="linenos">1742</span> , theorem nat_e ((! p \ p &#39; z ==&gt; (! n \ p &#39; n ==&gt; p &#39; (s &#39; n)) ==&gt; ! n \ p &#39; n), [ daemon ])
<span class="linenos">1743</span> , theorem nat_abs_inj
<span class="linenos">1744</span>   ((! x18 \
<span class="linenos">1745</span>      ! x19 \
<span class="linenos">1746</span>       is_nat &#39; x18 ==&gt;
<span class="linenos">1747</span>        is_nat &#39; x19 ==&gt; nat_abs &#39; x18 = nat_abs &#39; x19 ==&gt; x18 = x19) ,
<span class="linenos">1748</span>     [then inv
<span class="linenos">1749</span>       (bind _ x18 \
<span class="linenos">1750</span>         bind _ x19 \
<span class="linenos">1751</span>          thenl (conv (land_tac (then sym (applyth nat_repabs)))) [h,
<span class="linenos">1752</span>           thenl (conv (rand_tac (then sym (applyth nat_repabs)))) [h,
<span class="linenos">1753</span>            then (conv (depth_tac h)) r]])])
<span class="linenos">1754</span> , theorem nat_rep_inj
<span class="linenos">1755</span>   ((! x18 \ ! x19 \ nat_rep &#39; x18 = nat_rep &#39; x19 ==&gt; x18 = x19) ,
<span class="linenos">1756</span>     [then inv
<span class="linenos">1757</span>       (bind nat x18 \
<span class="linenos">1758</span>         bind nat x19 \
<span class="linenos">1759</span>          then (conv (land_tac (then sym (applyth nat_absrep))))
<span class="linenos">1760</span>           (then (conv (rand_tac (then sym (applyth nat_absrep))))
<span class="linenos">1761</span>             (then (conv (depth_tac h)) r)))])
<span class="linenos">1762</span> , theorem s_inj ((! x18 \ ! x19 \ s &#39; x18 = s &#39; x19 ==&gt; x18 = x19) ,
<span class="linenos">1763</span>     [then (repeat (conv (depth_tac (dd [s]))))
<span class="linenos">1764</span>       (then inv
<span class="linenos">1765</span>         (bind nat x18 \
<span class="linenos">1766</span>           bind nat x19 \
<span class="linenos">1767</span>            then (applyth nat_rep_inj)
<span class="linenos">1768</span>             (then (applyth inj2_univ_inj)
<span class="linenos">1769</span>               (thenl (applyth nat_abs_inj)
<span class="linenos">1770</span>                 [then (applyth is_nat_s) (applyth nat_proprep),
<span class="linenos">1771</span>                 then (applyth is_nat_s) (applyth nat_proprep), h]))))])
<span class="linenos">1772</span> , theorem not_equal_z_s ((! x20 \ not &#39; (z = s &#39; x20)) ,
<span class="linenos">1773</span>     [then (repeat (conv (depth_tac (dd [z]))))
<span class="linenos">1774</span>       (then (repeat (conv (depth_tac (dd [s]))))
<span class="linenos">1775</span>         (then (repeat (conv (depth_tac (dd [not]))))
<span class="linenos">1776</span>           (then inv
<span class="linenos">1777</span>             (bind nat x20 \
<span class="linenos">1778</span>               then (applyth not_eq_inj1_inj2_univ)
<span class="linenos">1779</span>                (thenl (thenl (applyth nat_abs_inj) [id, id, h])
<span class="linenos">1780</span>                  [applyth is_nat_z,
<span class="linenos">1781</span>                  then (applyth is_nat_s) (applyth nat_proprep)])))))])
<span class="linenos">1782</span> , def nat_case (pi A \ (nat --&gt; A --&gt; (nat --&gt; A) --&gt; A,
<span class="linenos">1783</span>    lam _ n \ lam (_ A) a \ lam (_ A) f \
<span class="linenos">1784</span>     case_univ &#39;&#39; prop &#39;&#39; prop &#39;&#39; A &#39; (nat_rep &#39; n) &#39; (lam _ x \ a) &#39; (lam _ p \ f &#39; (nat_abs &#39; p))))
<span class="linenos">1785</span> , theorem nat_case_z (pi A \ ((! x21 \ ! x22 \ nat_case &#39;&#39; A &#39; z &#39; x21 &#39; x22 = x21) ,
<span class="linenos">1786</span>      [then (conv (depth_tac (dd [nat_case])))
<span class="linenos">1787</span>        (then (conv (depth_tac (dd [z])))
<span class="linenos">1788</span>          (then forall_i
<span class="linenos">1789</span>            (bind A x21 \
<span class="linenos">1790</span>              then forall_i
<span class="linenos">1791</span>               (bind (nat --&gt; A) x22 \
<span class="linenos">1792</span>                 thenl
<span class="linenos">1793</span>                  (conv (land_tac (rator_tac (land_tac (applyth nat_repabs)))))
<span class="linenos">1794</span>                  [applyth is_nat_z,
<span class="linenos">1795</span>                   then (conv (depth_tac (applyth case_univ_inj1)))
<span class="linenos">1796</span>                    (then (conv (depth_tac b)) r)]))))]))
<span class="linenos">1797</span> , theorem nat_case_s
<span class="linenos">1798</span>   (pi A \ (! x21 \ ! x22 \ ! x23 \
<span class="linenos">1799</span>     nat_case &#39;&#39; A &#39; (s &#39; x21) &#39; x22 &#39; x23 = x23 &#39; x21),
<span class="linenos">1800</span>     [then (conv (depth_tac (dd [nat_case])))
<span class="linenos">1801</span>       (then (conv (depth_tac (dd [s])))
<span class="linenos">1802</span>         (then forall_i
<span class="linenos">1803</span>           (bind nat x21 \
<span class="linenos">1804</span>             then forall_i
<span class="linenos">1805</span>              (bind A x22 \
<span class="linenos">1806</span>                then forall_i
<span class="linenos">1807</span>                 (bind (nat --&gt; A) x23 \
<span class="linenos">1808</span>                   thenl
<span class="linenos">1809</span>                    (conv (land_tac (rator_tac (land_tac (applyth nat_repabs)))))
<span class="linenos">1810</span>                    [then (applyth is_nat_s) (applyth nat_proprep),
<span class="linenos">1811</span>                     then (conv (depth_tac (applyth case_univ_inj2)))
<span class="linenos">1812</span>                     (then (conv (depth_tac b))
<span class="linenos">1813</span>                       (then (conv (depth_tac (applyth nat_absrep))) r))])))))])
<span class="linenos">1814</span>
<span class="linenos">1815</span>
<span class="linenos">1816</span> , theorem pred_well_founded
<span class="linenos">1817</span>   (well_founded &#39;&#39; nat &#39; (lam nat x21 \ lam nat x22 \ x22 = s &#39; x21) ,
<span class="linenos">1818</span>   [then (conv dd)
<span class="linenos">1819</span>     (then forall_i
<span class="linenos">1820</span>       (bind nat x21 \
<span class="linenos">1821</span>         thenl (applyth nat_e)
<span class="linenos">1822</span>          [then (applyth acc_i)
<span class="linenos">1823</span>            (then (repeat (conv (depth_tac b)))
<span class="linenos">1824</span>              (then inv
<span class="linenos">1825</span>                (bind nat x22 \
<span class="linenos">1826</span>                  then (applyth ff_elim) (then (cutth not_equal_z_s) (itaut 4))))),
<span class="linenos">1827</span>          then inv
<span class="linenos">1828</span>           (bind nat x22 \
<span class="linenos">1829</span>             then (applyth acc_i)
<span class="linenos">1830</span>              (then (repeat (conv (depth_tac b)))
<span class="linenos">1831</span>                (then inv
<span class="linenos">1832</span>                  (bind nat x23 \
<span class="linenos">1833</span>                    then (cutth s_inj)
<span class="linenos">1834</span>                     (then (lforall x22)
<span class="linenos">1835</span>                       (then (lforall x23)
<span class="linenos">1836</span>                         (thenl lapply [h,
<span class="linenos">1837</span>                           then (conv (rand_tac (then sym h))) h])))))))]))])
<span class="linenos">1838</span> , def nat_recF (pi A \
<span class="linenos">1839</span>    A --&gt; (nat --&gt; A --&gt; A) --&gt; (nat --&gt; A) --&gt; (nat --&gt; A)
<span class="linenos">1840</span>    , lam A a \ lam (_ A) f \ lam (_ A) rec \ lam _ n \
<span class="linenos">1841</span>       nat_case &#39;&#39; A &#39; n &#39; a &#39; (lam _ p \ f &#39; p &#39; (rec &#39; p)))
<span class="linenos">1842</span> , def nat_rec (pi A \
<span class="linenos">1843</span>    A --&gt; (nat --&gt; A --&gt; A) --&gt; nat --&gt; A
<span class="linenos">1844</span>    , lam A a \ lam (_ A) f \ rec &#39;&#39; nat &#39;&#39; A &#39; (nat_recF &#39;&#39; A &#39; a &#39; f))
<span class="linenos">1845</span> , theorem nat_rec_ok0 (pi A \
<span class="linenos">1846</span>   ((! a \ ! f \
<span class="linenos">1847</span>     nat_rec &#39;&#39; A &#39; a &#39; f = nat_recF &#39;&#39; A &#39; a &#39; f &#39; (nat_rec &#39;&#39; A &#39; a &#39; f)) ,
<span class="linenos">1848</span>   [then inv
<span class="linenos">1849</span>     (bind A x22 \
<span class="linenos">1850</span>       bind (nat --&gt; A --&gt; A) x23 \
<span class="linenos">1851</span>        then (repeat (conv (depth_tac (dd [nat_rec]))))
<span class="linenos">1852</span>         (thenl (applyth rec_is_fixpoint) [applyth pred_well_founded,
<span class="linenos">1853</span>           then (repeat (conv (depth_tac b)))
<span class="linenos">1854</span>            (then (repeat (conv (depth_tac (dd [nat_recF]))))
<span class="linenos">1855</span>              (then forall_i
<span class="linenos">1856</span>                (bind (nat --&gt; A) x24 \
<span class="linenos">1857</span>                  then forall_i
<span class="linenos">1858</span>                   (bind (nat --&gt; A) x25 \
<span class="linenos">1859</span>                     then (conv (rand_tac beta_expand))
<span class="linenos">1860</span>                      (thenl (applyth nat_e)
<span class="linenos">1861</span>                        [then (conv (depth_tac b))
<span class="linenos">1862</span>                          (then inv
<span class="linenos">1863</span>                            (then (conv (land_tac (applyth nat_case_z)))
<span class="linenos">1864</span>                              (then (conv (rand_tac (applyth nat_case_z))) r))),
<span class="linenos">1865</span>                        then (repeat (conv (depth_tac b)))
<span class="linenos">1866</span>                         (then inv
<span class="linenos">1867</span>                           (bind nat x26 \
<span class="linenos">1868</span>                             then (conv (rand_tac (applyth nat_case_s)))
<span class="linenos">1869</span>                              (then (conv (land_tac (applyth nat_case_s)))
<span class="linenos">1870</span>                                (then (repeat (conv (depth_tac b)))
<span class="linenos">1871</span>                                  (then (lforall x26)
<span class="linenos">1872</span>                                    (thenl lapply [r,
<span class="linenos">1873</span>                                      then (conv (land_tac (rand_tac h))) r]))))))])))))]))]))
<span class="linenos">1874</span> , theorem nat_rec_ok (pi A \
<span class="linenos">1875</span>   (! a \ ! f \ ! n \
<span class="linenos">1876</span>     nat_rec &#39;&#39; A &#39; a &#39; f &#39; n =
<span class="linenos">1877</span>      nat_case &#39;&#39; A &#39; n &#39; a &#39; (lam _ p \ f &#39; p &#39; (nat_rec &#39;&#39; A &#39; a &#39; f &#39; p))),
<span class="linenos">1878</span>   [then inv
<span class="linenos">1879</span>     (bind A x22 \
<span class="linenos">1880</span>       bind (nat --&gt; A --&gt; A) x23 \
<span class="linenos">1881</span>        bind nat x24 \
<span class="linenos">1882</span>         then (conv (land_tac (rator_tac (applyth nat_rec_ok0))))
<span class="linenos">1883</span>          (then (conv (depth_tac (dd [nat_recF]))) r))])
<span class="linenos">1884</span>
<span class="linenos">1885</span> /************* Arithmetics: plus ***************/
<span class="linenos">1886</span> , def plus (nat --&gt; nat --&gt; nat,
<span class="linenos">1887</span>    lam _ n \ lam _ m \
<span class="linenos">1888</span>     nat_rec &#39;&#39; _ &#39; m &#39; (lam _ p \ lam _ sum \ s &#39; sum)&#39; n)
<span class="linenos">1889</span> , theorem plus_z ((! n \ z + n = n),
<span class="linenos">1890</span>   [then (conv (depth_tac (dd [plus])))
<span class="linenos">1891</span>     (then inv
<span class="linenos">1892</span>       (bind nat x21 \
<span class="linenos">1893</span>         then (conv (land_tac (applyth nat_rec_ok)))
<span class="linenos">1894</span>          (then (conv (land_tac (applyth nat_case_z))) r)))])
<span class="linenos">1895</span> , theorem plus_s ((! n \ ! m \  s &#39; n + m = s &#39; (n + m)),
<span class="linenos">1896</span>   [then (repeat (conv (depth_tac (dd [plus]))))
<span class="linenos">1897</span>     (then inv
<span class="linenos">1898</span>       (bind nat x21 \
<span class="linenos">1899</span>         bind nat x22 \
<span class="linenos">1900</span>          then (conv (land_tac (applyth nat_rec_ok)))
<span class="linenos">1901</span>           (then (conv (land_tac (applyth nat_case_s)))
<span class="linenos">1902</span>             (then (repeat (conv (depth_tac b))) r))))])
<span class="linenos">1903</span> , theorem plus_n_z ((! n \ n + z = n),
<span class="linenos">1904</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1905</span>     (thenl (applyth nat_e) [then (conv b) (applyth plus_z),
<span class="linenos">1906</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1907</span>        (then inv
<span class="linenos">1908</span>          (bind nat x21 \
<span class="linenos">1909</span>            then (conv (land_tac (applyth plus_s)))
<span class="linenos">1910</span>             (then (conv (depth_tac h)) r)))])])
<span class="linenos">1911</span> , theorem plus_n_s ((! n \ ! m \ n + (s &#39; m) = s &#39; (n + m)),
<span class="linenos">1912</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1913</span>     (thenl (applyth nat_e)
<span class="linenos">1914</span>       [then (conv b)
<span class="linenos">1915</span>         (then inv
<span class="linenos">1916</span>           (bind nat x21 \ then (repeat (conv (depth_tac (applyth plus_z)))) r)),
<span class="linenos">1917</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1918</span>        (then inv
<span class="linenos">1919</span>          (bind nat x21 \
<span class="linenos">1920</span>            bind nat x22 \
<span class="linenos">1921</span>             then (conv (land_tac (applyth plus_s)))
<span class="linenos">1922</span>              (thenl c [r,
<span class="linenos">1923</span>                then (conv (land_tac apply)) (then sym (applyth plus_s))])))])])
<span class="linenos">1924</span> , theorem plus_comm ((! n \ ! m \ n + m = m + n),
<span class="linenos">1925</span>   [then (conv (rand_tac beta_expand))
<span class="linenos">1926</span>     (thenl (applyth nat_e)
<span class="linenos">1927</span>       [then (conv b)
<span class="linenos">1928</span>         (then inv
<span class="linenos">1929</span>           (bind nat x21 \
<span class="linenos">1930</span>             then (conv (land_tac (applyth plus_z)))
<span class="linenos">1931</span>              (then sym (applyth plus_n_z)))),
<span class="linenos">1932</span>       then (repeat (conv (depth_tac b)))
<span class="linenos">1933</span>        (then inv
<span class="linenos">1934</span>          (bind nat x21 \
<span class="linenos">1935</span>            bind nat x22 \
<span class="linenos">1936</span>             then (conv (land_tac (applyth plus_s)))
<span class="linenos">1937</span>              (then sym
<span class="linenos">1938</span>                (then (conv (land_tac (applyth plus_n_s)))
<span class="linenos">1939</span>                  (thenl c [r, then sym apply])))))])])
<span class="linenos">1940</span>
<span class="linenos">1941</span> ].
<span class="linenos">1942</span>
<span class="linenos">1943</span>/* Status and dependencies of the tactics:
<span class="linenos">1944</span>+dd:
<span class="linenos">1945</span>+sym:
<span class="linenos">1946</span>+eq_true_intro: (th tt_intro)
<span class="linenos">1947</span>+forall_i: dd eq_true_intro
<span class="linenos">1948</span>+conj: dd eq_true_intro
<span class="linenos">1949</span>+andr: dd tt_intro
<span class="linenos">1950</span>+andl: dd tt_intro
<span class="linenos">1951</span>+forall_e: sym dd
<span class="linenos">1952</span>+mp: andr sym dd
<span class="linenos">1953</span>+i: dd andl conj
<span class="linenos">1954</span>+cut: andr sym dd i
<span class="linenos">1955</span>+cutth: cut
<span class="linenos">1956</span>+lapply*: mp
<span class="linenos">1957</span>+lforall*: mp forall_e
<span class="linenos">1958</span>+apply*: lapply lforall
<span class="linenos">1959</span>+applyth: cutth apply*
<span class="linenos">1960</span>
<span class="linenos">1961</span>- f converional sometimes fails
<span class="linenos">1962</span>- conv (depth_tac) diverges when applied to terms that contain
<span class="linenos">1963</span>  metavariables
<span class="linenos">1964</span>- repeat is not implemented using progress, that is not even there
<span class="linenos">1965</span>*/
<span class="linenos">1966</span>
<span class="linenos">1967</span>/*
<span class="linenos">1968</span>-2.5) in the proof for myprop, at the end I provide the
<span class="linenos">1969</span>  witness (and X X) where X remains free (and it is not even pi-quantified).
<span class="linenos">1970</span>  If prop was empty, then X could not exist. On the other hand, if X was
<span class="linenos">1971</span>  empty, then there would be no need to provide the proof at all.
<span class="linenos">1972</span>  In any case, the symptom for X remaining free at the end of a proof is
<span class="linenos">1973</span>  one or more goals delayed on it. We never check for them and we have
<span class="linenos">1974</span>  no way atm to do that. See bug -3)
<span class="linenos">1975</span>
<span class="linenos">1976</span>-2) the test apply_2 is very slow: why?
<span class="linenos">1977</span>    same for the witness for myprop
<span class="linenos">1978</span>
<span class="linenos">1979</span>0) definitions must not be recursive; typing should capture it
<span class="linenos">1980</span>   (but not if declare_constraint is commented out...)
<span class="linenos">1981</span>
<span class="linenos">1982</span>0.25) occurr check in bind case still missing :-(
<span class="linenos">1983</span>
<span class="linenos">1984</span>0.50) case AppUvar vs AppUVar in unification is bugged (e.g.)
<span class="linenos">1985</span>      X^2 x0 x1 = X^2 x0 x1
<span class="linenos">1986</span>
<span class="linenos">1987</span>2) we need to fix the ELPI problems about handling of metavariables.
<span class="linenos">1988</span> I have already discussed with Enrico about them and he could have a
<span class="linenos">1989</span> shot at them. Namely:
<span class="linenos">1990</span> a) occur check + optimization to avoid it when possible (IN PROGRESS)
<span class="linenos">1991</span> b) unimplemented cases of restriction (IN PROGRESS)
<span class="linenos">1992</span>
<span class="linenos">1993</span>3) once we let metavariables reach the goals, the current HOL-light 
<span class="linenos">1994</span> tactic implementation becomes too fragile. We should let the user 
<span class="linenos">1995</span> refer to hypotheses at least by number if not by name. But we better
<span class="linenos">1996</span> have a bidirectional successor/predecessor via declare_constraint
<span class="linenos">1997</span>
<span class="linenos">1998</span>5) we could implement an automated theorem prover in lambdaProlog
<span class="linenos">1999</span> that works or is interfaced with the HOL-light code. There are
<span class="linenos">2000</span> complete provers like leanCOP 2.0 that are only 10 lines of code,
<span class="linenos">2001</span> but use some Prolog tricks.
<span class="linenos">2002</span>
<span class="linenos">2003</span>6) we should do a small formalization, possibly developing a tactic,
<span class="linenos">2004</span> to prove that everything is working. For example, a decision procedure
<span class="linenos">2005</span> for rings or for linear inequations.
<span class="linenos">2006</span>
<span class="linenos">2007</span>*/
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/hollight_legacy.elpi&quot;, line 3, column 0, character 24:</span>
<span class="go">Mixfix directives are not supported by this parser.</span>

<span class="go">The parser is based on token families.</span>
<span class="go">A family is identified by some starting characters, for example</span>
<span class="go">a token &#39;+--&gt;&#39; belongs to the family of &#39;+&#39;. There is no need</span>
<span class="go">to declare it.</span>

<span class="go">All the tokens of a family are parsed with the same precedence and</span>
<span class="go">associativity, for example &#39;x +--&gt; y *--&gt; z&#39; is parsed as</span>
<span class="go">&#39;x +--&gt; (y *--&gt; z)&#39; since the family of &#39;*&#39; has higher precedence</span>
<span class="go">than the family of &#39;+&#39;.</span>

<span class="go">Here the table of tokens and token families.</span>
<span class="go">Token families are represented by the start symbols followed by &#39;..&#39;.</span>
<span class="go">Tokens of families marked with [*] cannot end with the starting symbol,</span>
<span class="go">eg `foo` is not an infix, while `foo is.</span>
<span class="go">The listing is ordered by increasing precedence.</span>

<span class="go">fixity                     | tokens / token families</span>
<span class="go">-------------------------- + -----------------------------------</span>
<span class="go">Infix   not   associative  | :-  ?-</span>
<span class="go">Infix   right associative  | ;</span>
<span class="go">Infix   right associative  | ,  &amp;</span>
<span class="go">Infix   right associative  | -&gt;</span>
<span class="go">Infix   right associative  | =&gt;</span>
<span class="go">Infix   not   associative  | =  ==  =&lt;  r&lt;  i&lt;  s&lt;  r=&lt;  i=&lt;  s=&lt;</span>
<span class="go">                             &lt;..  r&gt;  i&gt;  s&gt;  r&gt;=  i&gt;=  s&gt;=  &gt;..</span>
<span class="go">                             is</span>
<span class="go">Infix   right associative  | ::</span>
<span class="go">Infix   not   associative  | &#39;.. [*]</span>
<span class="go">Infix   left  associative  | ^..  r+  i+  s+  +..  -  r-  i-  s-</span>
<span class="go">Infix   left  associative  | r*  i*  s*  *..  /  div  mod</span>
<span class="go">Infix   right associative  | --..</span>
<span class="go">Infix   not   associative  | `.. [*]</span>
<span class="go">Infix   right associative  | ==..</span>
<span class="go">Infix   right associative  | ||..</span>
<span class="go">Infix   right associative  | &amp;&amp;..</span>
<span class="go">Infix   left  associative  | #..</span>
<span class="go">Prefix  not   associative  | r~  i~  ~..</span>
<span class="go">Postfix not   associative  | ?..</span>

<span class="go">If the token is a valid mixfix, and you want the file to stay compatible</span>
<span class="go">with Teyjus, you can ask Elpi to skip the directive. Eg:</span>

<span class="gp">% </span>elpi:skip<span class="w"> </span><span class="m">2</span><span class="w">  </span>//<span class="w"> </span>skips<span class="w"> </span>the<span class="w"> </span>next<span class="w"> </span>two<span class="w"> </span>lines
<span class="go">infixr ==&gt; 120.</span>
<span class="go">infixr || 120.</span>

<span class="go">As a debugging facility one can ask Elpi to print the AST in order to</span>
<span class="go">verify how the text was parsed. Eg:</span>

<span class="go">echo &#39;MyFormula = a || b ==&gt; c &amp;&amp; d&#39; | elpi -parse-term</span>
</pre></div>
</div>
<p><strong>../../tests/sources/hyp_uvar.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">any</span>.
<span class="linenos">2</span>
<span class="linenos">3</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">4</span><span class="w">  </span>(f<span class="w"> </span><span class="kd">uvar</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>(f<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>not<span class="o">(</span>f<span class="w"> </span><span class="mi">1</span><span class="o">))</span><span class="kd">,</span><span class="w"> </span>var<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ok</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.110</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/impl.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% q X Y shoud yield X=ok Y=ok</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(r<span class="w"> </span>a<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>p<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>f<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>f<span class="w"> </span>ok<span class="w"> </span>ko<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span>a<span class="o">.</span>
<span class="linenos"> 6</span>f<span class="w"> </span>ok<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>p<span class="w"> </span>ko<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span>a<span class="o">.</span>
<span class="linenos"> 9</span>p<span class="w"> </span>ok<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span>a<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 5, column 0, character 62:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.135</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/impl2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q X yields X=ok</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(a<span class="kd">,</span><span class="w"> </span><span class="o">(</span>b<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="o">(</span>a<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>c<span class="o">))</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>(b<span class="kd">,</span>c<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>r<span class="w"> </span>ok<span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/impl2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.140</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/index2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c">% to be traced</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="k k-Mode">:index</span><span class="w">(</span><span class="mi">_ _ _ _ _ _ _ _ 1</span>)
<span class="linenos">  4</span><span class="kd">pred</span><span class="w"> </span><span class="nf">p</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>.
<span class="linenos">  5</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">  6</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">  7</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">  8</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">  9</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 10</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 11</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 12</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 13</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 14</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 15</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 16</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 17</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 18</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 19</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 20</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 21</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 22</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 23</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 24</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 25</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 26</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 27</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 28</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 29</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 30</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 31</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 32</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 33</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 34</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 35</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 36</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 37</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 38</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 39</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 40</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 41</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 42</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 43</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 44</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 45</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 46</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 47</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 48</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 49</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 50</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 51</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 52</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 53</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 54</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 55</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 56</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 57</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 58</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 59</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 60</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 61</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 62</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 63</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 64</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 65</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 66</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 67</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 68</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 69</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 70</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 71</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 72</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 73</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 74</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 75</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 76</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 77</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 78</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 79</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 80</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 81</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 82</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 83</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 84</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 85</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 86</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 87</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 88</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 89</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 90</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 91</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 92</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 93</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 94</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 95</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 96</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 97</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 98</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos"> 99</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">100</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">101</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">102</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">103</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">104</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">105</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">106</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">107</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">108</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">109</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span>
<span class="linenos">110</span>
<span class="linenos">111</span>iter<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">P</span><span class="kd">,</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">-</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>iter<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">P</span><span class="o">.</span>
<span class="linenos">112</span>iter<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">113</span>
<span class="linenos">114</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">115</span><span class="w">  </span>iter<span class="w"> </span><span class="mi">999999</span><span class="w"> </span>(p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/index2.elpi&quot;, line 111, column 0, character 2318:</span>
<span class="go"> Warning: constant iter has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.119</span>

<span class="go">Success:</span>

<span class="go">Time: 2.201</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/io_colon.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">i</span>\<span class="w"> </span>f<span class="w"> </span>i<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>f<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/io_colon.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.107</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/lambda.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% test Z yields Z=impl(impl A B) (impl A B)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c">% Type inference for simply typed lambda terms</span>
<span class="linenos"> 4</span><span class="c">% Syntax: t ::= appl t t | abs F    where F is a function t -&gt; t</span>
<span class="linenos"> 5</span><span class="c">% Syntax: ty ::= impl ty ty</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>of<span class="w"> </span>(appl<span class="w"> </span><span class="nv">T1</span><span class="w"> </span><span class="nv">T2</span><span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span><span class="nv">T1</span><span class="w"> </span>(impl<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>of<span class="w"> </span><span class="nv">T2</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos"> 8</span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(impl<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>of<span class="w"> </span>x<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>of<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>test<span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">f\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">a\</span><span class="w"> </span>appl<span class="w"> </span>f<span class="w"> </span>a<span class="o">)</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">11</span>
<span class="linenos">12</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>test<span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>impl<span class="w"> </span>(impl<span class="w"> </span>a<span class="w"> </span>b<span class="o">)</span><span class="w"> </span>(impl<span class="w"> </span>a<span class="w"> </span>b<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 10, column 0, character 288:</span>
<span class="go"> Warning: constant test has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 7, column 0, character 186:</span>
<span class="go"> Warning: constant of has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 8, column 0, character 234:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 7, column 0, character 186:</span>
<span class="go"> Warning: constant impl has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 12, column 0, character 330:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 7, column 0, character 186:</span>
<span class="go"> Warning: constant appl has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda.elpi&quot;, line 12, column 0, character 330:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.137</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/lambda2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q X yields X=ok</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>p<span class="w"> </span>x<span class="o">).</span>
<span class="linenos">4</span>
<span class="linenos">5</span>r<span class="w"> </span>ko<span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>g<span class="w"> </span>x<span class="o">).</span>
<span class="linenos">6</span>r<span class="w"> </span>ok<span class="w"> </span>(<span class="nv">y\</span><span class="w"> </span>p<span class="w"> </span>y<span class="o">).</span>
<span class="linenos">7</span>
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda2.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda2.elpi&quot;, line 5, column 0, character 41:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda2.elpi&quot;, line 5, column 0, character 41:</span>
<span class="go"> Warning: constant g has no declared type. Did you mean gc.get ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.129</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/lambda3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">%%%module lambda3.</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>of<span class="w"> </span>(appl<span class="w"> </span><span class="nv">T1</span><span class="w"> </span><span class="nv">T2</span><span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span><span class="nv">T1</span><span class="w"> </span>(impl<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>of<span class="w"> </span><span class="nv">T2</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos"> 4</span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(impl<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>of<span class="w"> </span>x<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>of<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="nv">B</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>append<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>append<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="o">.</span>
<span class="linenos"> 7</span>append<span class="w"> </span>xnil<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="o">.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>termify<span class="w"> </span>xnil<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span>x<span class="o">).</span>
<span class="linenos">10</span>termify<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span>termify<span class="w"> </span><span class="nv">XS</span><span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>c<span class="o">).</span>
<span class="linenos">11</span>
<span class="linenos">12</span>test<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>
<span class="linenos">13</span><span class="w">  </span><span class="nv">X1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(xcons<span class="w"> </span>x0<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x1<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x2<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x3<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x4<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x5<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x6<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x7<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x8<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x9<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x10<span class="w"> </span>xnil<span class="o">)))))))))))</span><span class="kd">,</span><span class="w"> </span>
<span class="linenos">14</span><span class="w">  </span>append<span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">15</span><span class="w">  </span>append<span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">16</span><span class="w">  </span>append<span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">17</span><span class="w">  </span>append<span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">18</span><span class="w">  </span>append<span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">19</span><span class="w">  </span><span class="c">% append X6 X6 X7 ,</span>
<span class="linenos">20</span><span class="w">  </span><span class="c">% append X7 X7 X8 ,</span>
<span class="linenos">21</span><span class="w">  </span><span class="c">% append X8 X8 X9 ,</span>
<span class="linenos">22</span><span class="w">  </span><span class="c">% append X9 X9 X10 ,</span>
<span class="linenos">23</span><span class="w">  </span><span class="c">% append X10 X10 X11 ,</span>
<span class="linenos">24</span><span class="w">  </span><span class="c">% append X11 X11 X12 ,</span>
<span class="linenos">25</span><span class="w">  </span><span class="c">% append X12 X12 X13 ,</span>
<span class="linenos">26</span><span class="w">  </span><span class="c">% append X13 X13 X14 ,</span>
<span class="linenos">27</span><span class="w">   </span><span class="c">% append X14 X14 X15 ,</span>
<span class="linenos">28</span><span class="w">   </span><span class="c">% append X15 X15 X16 ,</span>
<span class="linenos">29</span><span class="w">   </span><span class="c">% append X16 X16 X17 ,</span>
<span class="linenos">30</span><span class="w">   </span><span class="c">% append X17 X17 X18 ,</span>
<span class="linenos">31</span><span class="w">   </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">32</span><span class="w">   </span>termify<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos">33</span>
<span class="linenos">34</span>once<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">35</span>
<span class="linenos">36</span>iter<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">37</span>iter<span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>iter<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">38</span>
<span class="linenos">39</span>plus<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">40</span>plus<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">S</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>plus<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">S</span><span class="o">.</span>
<span class="linenos">41</span>
<span class="linenos">42</span>mult<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span>zero<span class="o">.</span>
<span class="linenos">43</span>mult<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>mult<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="kd">,</span><span class="w"> </span>plus<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">44</span>
<span class="linenos">45</span>exp<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">).</span>
<span class="linenos">46</span>exp<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>exp<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="kd">,</span><span class="w"> </span>mult<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">47</span>
<span class="linenos">48</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">49</span><span class="w"> </span><span class="nv">TEN</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>s<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))))))))</span><span class="kd">,</span>
<span class="linenos">50</span><span class="w"> </span>exp<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))</span><span class="w"> </span><span class="nv">TEN</span><span class="w"> </span><span class="nv">THOUSAND</span><span class="kd">,</span>
<span class="linenos">51</span><span class="w"> </span>test<span class="w"> </span><span class="nv">L</span><span class="kd">,</span>
<span class="linenos">52</span><span class="w"> </span>iter<span class="w"> </span><span class="nv">THOUSAND</span><span class="w"> </span>(once<span class="w"> </span><span class="nv">L</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 36, column 0, character 866:</span>
<span class="go"> Warning: constant zero has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 7, column 0, character 178:</span>
<span class="go"> Warning: constant xnil has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 6, column 0, character 122:</span>
<span class="go"> Warning: constant xcons has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x9 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x8 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x7 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x6 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x5 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x4 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: constant x3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 12, column 0, character 278:</span>
<span class="go"> Warning: [suppressing 29 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 10, column 0, character 221:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 34, column 0, character 847:</span>
<span class="go"> Warning: Z is linear: name it _Z (discard) or Z_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 36, column 0, character 866:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 42, column 0, character 959:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/lambda3.elpi&quot;, line 45, column 0, character 1020:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.158</span>

<span class="go">Success:</span>

<span class="go">Time: 0.489</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/list_as_conj.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">type</span><span class="w"> </span><span class="nf">a,b</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">2</span>f<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">[</span>print<span class="w"> </span>a<span class="kd">,</span><span class="w"> </span>print<span class="w"> </span>b<span class="kd">,</span><span class="w"> </span>a<span class="kd">]</span><span class="o">.</span>
<span class="linenos">3</span>a<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(b<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">[</span>print<span class="w"> </span><span class="s2">&quot;done&quot;</span><span class="kd">]</span><span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>b<span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/list_as_conj.elpi&quot;, line 2, column 0, character 15:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">a</span>
<span class="go">b</span>
<span class="go">done</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.104</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/list_comma.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="mi">1</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">3</span><span class="kd">,],</span>
<span class="linenos">3</span><span class="w">  </span><span class="nv">L2</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="mi">1</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">3</span><span class="kd">],</span>
<span class="linenos">4</span><span class="w">  </span>std.length<span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>std.length<span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.098</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/llam.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>spy X :-  counter &quot;run&quot; N, print N &quot;test &quot; X, 
<span class="linenos"> 2</span>  not(not(X)).
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>type test ((A -&gt; A -&gt; prop) -&gt; B -&gt; prop) -&gt; B -&gt; prop.
<span class="linenos"> 5</span>test P T :-
<span class="linenos"> 6</span>  spy(P (x\y\x = y) F, F = T),
<span class="linenos"> 7</span>  spy(P (x\y\y = x) F, F = T),
<span class="linenos"> 8</span>  spy(pi dummy\ sigma F\ P (x\y\x = y) F, F = T),
<span class="linenos"> 9</span>  spy(pi dummy\ sigma F\ P (x\y\y = x) F, F = T)
<span class="linenos">10</span>  , print &quot;----------------------------------------&quot;
<span class="linenos">11</span>  .
<span class="linenos">12</span>
<span class="linenos">13</span>clause (x\y\F y x) :- F = a\b\b.
<span class="linenos">14</span>clause1 (x\y\x).
<span class="linenos">15</span>clause2 (x\y\X x, F y (X x)) :- F = a\b\b.
<span class="linenos">16</span>
<span class="linenos">17</span>type r A -&gt; B.
<span class="linenos">18</span>prune_arg (r F).
<span class="linenos">19</span>prune_arg2 (r (x\F x)).
<span class="linenos">20</span>prune_arg3 (r (x\y\F y x)).
<span class="linenos">21</span>
<span class="linenos">22</span>main :-
<span class="linenos">23</span>  test (eq\F\        pi x\ pi y\ eq (F y x) x)             (a\b\b),
<span class="linenos">24</span>  test (eq\F\   not (pi x\ pi y\ eq (F x) y))              whatever,
<span class="linenos">25</span>  test (eq\F\        pi x\ pi y\ eq (F y x) (r (w\h w x))) (a\b\r (x\h x b)),
<span class="linenos">26</span>  test (eq\F\        pi x\ pi y\ sigma R\ R = x, eq (F y x) R)             (a\b\b),
<span class="linenos">27</span>  test (eq\F\   not (pi x\ pi y\ sigma R\ R = x, eq (F R) y))              whatever,
<span class="linenos">28</span>  test (eq\F\        pi x\ pi y\ sigma R\ R = x, eq (F y x) (r (w\h w R))) (a\b\r (x\h x b)),
<span class="linenos">29</span>  spy (pi dummy\ clause (x\y\x)),
<span class="linenos">30</span>  (pi dummy\ clause1 (x\y\F y x), F = a\b\b),
<span class="linenos">31</span>  (pi dummy\ clause2 (x\y\x,x)),
<span class="linenos">32</span>  (clause3 (x\y\G y x) =&gt; pi dummy\ clause3 (x\y\x)), (G = a\b\b),
<span class="linenos">33</span>  test (eq\F\        sigma H\pi x\ pi y\ eq (F y) (r (H y x)), H x x = x, H x y = x)   (a\r a),
<span class="linenos">34</span>
<span class="linenos">35</span>  % this is hard because F&lt;H but is applied to y that H can see, so H is restricted to the
<span class="linenos">36</span>  % level of F (that alone would prune y) but applied to y, so H 1 = y works
<span class="linenos">37</span>  test (eq\F\        pi x\ pi y\ sigma H\ pi z\pi w\eq (F y) (r (H w)),
<span class="linenos">38</span>                                                    spy(H 1 = y), not(H 2 = x))
<span class="linenos">39</span>       (a\r whatever),
<span class="linenos">40</span>  test (eq\F\        pi x\ pi y\ sigma H\ pi w\eq (F y x) (r (H w)),
<span class="linenos">41</span>                                               H 1 = f x y)
<span class="linenos">42</span>       (a\b\r (f b a)),
<span class="linenos">43</span> 
<span class="linenos">44</span>  test (eq\F\        pi x\pi y\prune_arg (F y x))  (a\b\r (v a b)),
<span class="linenos">45</span>  test (eq\F\        pi x\pi y\prune_arg2 (F y x)) (a\b\r (x\v a b)),
<span class="linenos">46</span>  test (eq\F\        pi x\pi y\prune_arg3 (F y x)) (a\b\r (x\y\v a b)),
<span class="linenos">47</span> 
<span class="linenos">48</span>  true.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 22, column 0, character 529:</span>
<span class="go"> Warning: constant whatever has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 22, column 0, character 529:</span>
<span class="go"> Warning: constant v has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant spy has no declared type. Did you mean std.spy std.spy! std.spy-do! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 20, column 0, character 500:</span>
<span class="go"> Warning: constant prune_arg3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 19, column 0, character 476:</span>
<span class="go"> Warning: constant prune_arg2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 18, column 0, character 459:</span>
<span class="go"> Warning: constant prune_arg has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 22, column 0, character 529:</span>
<span class="go"> Warning:</span>
<span class="go"> constant h has no declared type. Did you mean std.map.private.height std.set.private.height ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 22, column 0, character 529:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 22, column 0, character 529:</span>
<span class="go"> Warning: constant clause3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 15, column 0, character 400:</span>
<span class="go"> Warning: constant clause2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 14, column 0, character 383:</span>
<span class="go"> Warning: [suppressing 2 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 18, column 0, character 459:</span>
<span class="go"> Warning: F is linear: name it _F (discard) or F_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 19, column 0, character 476:</span>
<span class="go"> Warning: F is linear: name it _F (discard) or F_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llam.elpi&quot;, line 20, column 0, character 500:</span>
<span class="go"> Warning: F is linear: name it _F (discard) or F_ (fresh variable)</span>
<span class="go">0 test  pi c0 \ pi c1 \ X0 c1 c0 = c0 , X0 = (c0 \ c1 \ c1)</span>
<span class="go">0 test  pi c0 \ pi c1 \ c0 = X0 c1 c0 , X0 = (c0 \ c1 \ c1)</span>
<span class="go">0 test  pi c0 \ sigma c1 \ pi c2 \ pi c3 \ c1 c3 c2 = c2 , c1 = (c2 \ c3 \ c3)</span>
<span class="go">0 test  pi c0 \ sigma c1 \ pi c2 \ pi c3 \ c2 = c1 c3 c2 , c1 = (c2 \ c3 \ c3)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test  not (pi c0 \ pi c1 \ X1 c0 = c1) , X1 = whatever</span>
<span class="go">0 test  not (pi c0 \ pi c1 \ c1 = X1 c0) , X1 = whatever</span>
<span class="go">0 test  pi c0 \ sigma c1 \ not (pi c2 \ pi c3 \ c1 c2 = c3) , c1 = whatever</span>
<span class="go">0 test  pi c0 \ sigma c1 \ not (pi c2 \ pi c3 \ c3 = c1 c2) , c1 = whatever</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ X2 c1 c0 = r c2 \ h c2 c0 , X2 = (c0 \ c1 \ r c2 \ h c2 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ r c2 \ h c2 c0 = X2 c1 c0 , X2 = (c0 \ c1 \ r c2 \ h c2 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ c1 c3 c2 = r c4 \ h c4 c2 , c1 = (c2 \ c3 \ r c4 \ h c4 c3)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ r c4 \ h c4 c2 = c1 c3 c2 , c1 = (c2 \ c3 \ r c4 \ h c4 c3)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , X3 c1 c0 = c2 , X3 = (c0 \ c1 \ c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , c2 = X3 c1 c0 , X3 = (c0 \ c1 \ c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , c1 c3 c2 = c4 , c1 = (c2 \ c3 \ c3)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , c4 = c1 c3 c2 , c1 = (c2 \ c3 \ c3)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test  not (pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , X4 c2 = c1) , X4 = whatever</span>
<span class="go">0 test  not (pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , c1 = X4 c2) , X4 = whatever</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   not (pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , c1 c4 = c3) , c1 = whatever</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   not (pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , c3 = c1 c4) , c1 = whatever</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , X5 c1 c0 = r c3 \ h c3 c2 ,</span>
<span class="go">  X5 = (c0 \ c1 \ r c2 \ h c2 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ c2 = c0 , r c3 \ h c3 c2 = X5 c1 c0 ,</span>
<span class="go">  X5 = (c0 \ c1 \ r c2 \ h c2 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , c1 c3 c2 = r c5 \ h c5 c4 ,</span>
<span class="go">    c1 = (c2 \ c3 \ r c4 \ h c4 c3)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ c4 = c2 , r c5 \ h c5 c4 = c1 c3 c2 ,</span>
<span class="go">    c1 = (c2 \ c3 \ r c4 \ h c4 c3)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test  pi c0 \ clause c1 \ c2 \ c1</span>
<span class="go">0 test</span>
<span class="go"> sigma c0 \</span>
<span class="go">  pi c1 \ pi c2 \ , (X6 c2 = r (c0 c2 c1)) (c0 c1 c1 = c1) (c0 c1 c2 = c1) ,</span>
<span class="go">  X6 = (c0 \ r c0)</span>
<span class="go">0 test</span>
<span class="go"> sigma c0 \</span>
<span class="go">  pi c1 \ pi c2 \ , (r (c0 c2 c1) = X6 c2) (c0 c1 c1 = c1) (c0 c1 c2 = c1) ,</span>
<span class="go">  X6 = (c0 \ r c0)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   sigma c2 \</span>
<span class="go">    pi c3 \ pi c4 \ , (c1 c4 = r (c2 c4 c3)) (c2 c3 c3 = c3) (c2 c3 c4 = c3) ,</span>
<span class="go">    c1 = (c2 \ r c2)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   sigma c2 \</span>
<span class="go">    pi c3 \ pi c4 \ , (r (c2 c4 c3) = c1 c4) (c2 c3 c3 = c3) (c2 c3 c4 = c3) ,</span>
<span class="go">    c1 = (c2 \ r c2)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  pi c1 \</span>
<span class="go">   sigma c2 \</span>
<span class="go">    pi c3 \ pi c4 \ , (X7 c1 = r (c2 c4)) (spy (c2 1 = c1)) (not (c2 2 = c0)) ,</span>
<span class="go">  X7 = (c0 \ r whatever)</span>
<span class="go">0 test  X8 c1 = c1</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  pi c1 \</span>
<span class="go">   sigma c2 \</span>
<span class="go">    pi c3 \ pi c4 \ , (r (c2 c4) = X7 c1) (spy (c2 1 = c1)) (not (c2 2 = c0)) ,</span>
<span class="go">  X7 = (c0 \ r whatever)</span>
<span class="go">0 test  X9 c1 = c1</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \</span>
<span class="go">    pi c3 \</span>
<span class="go">     sigma c4 \</span>
<span class="go">      pi c5 \ pi c6 \ , (c1 c3 = r (c4 c6)) (spy (c4 1 = c3)) (not (c4 2 = c2))</span>
<span class="go">    , c1 = (c2 \ r whatever)</span>
<span class="go">0 test  X10^1 c2 = c2</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \</span>
<span class="go">    pi c3 \</span>
<span class="go">     sigma c4 \</span>
<span class="go">      pi c5 \ pi c6 \ , (r (c4 c6) = c1 c3) (spy (c4 1 = c3)) (not (c4 2 = c2))</span>
<span class="go">    , c1 = (c2 \ r whatever)</span>
<span class="go">0 test  X11^1 c2 = c2</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ pi c3 \ X12 c1 c0 = r (c2 c3) , c2 1 = f c0 c1 ,</span>
<span class="go">  X12 = (c0 \ c1 \ r (f c1 c0))</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ sigma c2 \ pi c3 \ r (c2 c3) = X12 c1 c0 , c2 1 = f c0 c1 ,</span>
<span class="go">  X12 = (c0 \ c1 \ r (f c1 c0))</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ pi c5 \ c1 c3 c2 = r (c4 c5) , c4 1 = f c2 c3 ,</span>
<span class="go">    c1 = (c2 \ c3 \ r (f c3 c2))</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ sigma c4 \ pi c5 \ r (c4 c5) = c1 c3 c2 , c4 1 = f c2 c3 ,</span>
<span class="go">    c1 = (c2 \ c3 \ r (f c3 c2))</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test  pi c0 \ pi c1 \ prune_arg (X13 c1 c0) , X13 = (c0 \ c1 \ r (v c0 c1))</span>
<span class="go">0 test  pi c0 \ pi c1 \ prune_arg (X13 c1 c0) , X13 = (c0 \ c1 \ r (v c0 c1))</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg (c1 c3 c2) , c1 = (c2 \ c3 \ r (v c2 c3))</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg (c1 c3 c2) , c1 = (c2 \ c3 \ r (v c2 c3))</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ prune_arg2 (X14 c1 c0) , X14 = (c0 \ c1 \ r c2 \ v c0 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ prune_arg2 (X14 c1 c0) , X14 = (c0 \ c1 \ r c2 \ v c0 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg2 (c1 c3 c2) , c1 = (c2 \ c3 \ r c4 \ v c2 c3)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg2 (c1 c3 c2) , c1 = (c2 \ c3 \ r c4 \ v c2 c3)</span>
<span class="go">----------------------------------------</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ prune_arg3 (X15 c1 c0) , X15 = (c0 \ c1 \ r c2 \ c3 \ v c0 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \ pi c1 \ prune_arg3 (X15 c1 c0) , X15 = (c0 \ c1 \ r c2 \ c3 \ v c0 c1)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg3 (c1 c3 c2) , c1 = (c2 \ c3 \ r c4 \ c5 \ v c2 c3)</span>
<span class="go">0 test</span>
<span class="go"> pi c0 \</span>
<span class="go">  sigma c1 \</span>
<span class="go">   pi c2 \ pi c3 \ prune_arg3 (c1 c3 c2) , c1 = (c2 \ c3 \ r c4 \ c5 \ v c2 c3)</span>
<span class="go">----------------------------------------</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.172</span>

<span class="go">Success:</span>

<span class="go">Time: 0.008</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/llamchr.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>mode (term i o).
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>term (app X Y) B :- term X (arr A B), term Y A.
<span class="linenos"> 4</span>term (lam A F) (arr A B) :- pi x\ term x A =&gt; term (F x) B.
<span class="linenos"> 5</span>term (uvar as X) A :- declare_constraint (term X A) [X].
<span class="linenos"> 6</span>term true bool.
<span class="linenos"> 7</span>term false bool.
<span class="linenos"> 8</span>term zero nat.
<span class="linenos"> 9</span>term succ (arr nat nat).
<span class="linenos">10</span>
<span class="linenos">11</span>constraint term {
<span class="linenos">12</span>  rule (GX ?- term (uvar K LX) TX)
<span class="linenos">13</span>     \ (GY ?- term (uvar K LY) TY)
<span class="linenos">14</span>     | (compatible GX LX GY LY CTXCONSTR)
<span class="linenos">15</span>   &lt;=&gt; [ TX = TY , CTXCONSTR ].
<span class="linenos">16</span>}
<span class="linenos">17</span>
<span class="linenos">18</span>% resilient to dummy ctx variables
<span class="linenos">19</span>both_or_none P Q :- P, !, Q.
<span class="linenos">20</span>both_or_none P Q :- not P, not Q.
<span class="linenos">21</span>
<span class="linenos">22</span>compatible _ [] _ [] [] :- !.
<span class="linenos">23</span>compatible GX [X|XS] GY [Y|YS] [TX = TY | K] :-
<span class="linenos">24</span> both_or_none (GX =&gt; term X TX) (GY =&gt; term Y TY),
<span class="linenos">25</span> !,
<span class="linenos">26</span> compatible GX XS GY YS K.
<span class="linenos">27</span>compatible _ _ _ _ [false].
<span class="linenos">28</span>
<span class="linenos">29</span>spy P :- print &quot;[&quot; P, P, print &quot;]ok&quot;, !.
<span class="linenos">30</span>spy P :- print &quot;]fail&quot;, fail.
<span class="linenos">31</span>
<span class="linenos">32</span>mode (watch i).
<span class="linenos">33</span>watch (uvar as X) :- declare_constraint (print &quot;watch&quot; X) [X], !.
<span class="linenos">34</span>watch X :- print &quot;watch&quot; X.
<span class="linenos">35</span>
<span class="linenos">36</span>main :- 
<span class="linenos">37</span>  % this is tricky becasuse X sees w, so CHR has to deal with a dirty context
<span class="linenos">38</span>  pi w\ (sigma X A B C A&#39; B&#39; T1 T2 \ pi v\
<span class="linenos">39</span>    term b2n (arr bool nat) =&gt;
<span class="linenos">40</span>      (T1 = (lam _ x \ lam _ y\ X x y),
<span class="linenos">41</span>       T2 = (lam _ x \ lam _ y\ X y x),
<span class="linenos">42</span>       term T1 (arr A (arr B nat)),
<span class="linenos">43</span>       term T2 (arr A&#39; (arr B&#39; C)),
<span class="linenos">44</span>       print A A&#39; B B&#39; C &quot;|&quot; T1 &quot;|&quot; T2,
<span class="linenos">45</span>       spy (X = x\y\ x),
<span class="linenos">46</span>       print A A&#39; B B&#39; C &quot;|&quot; T1 &quot;|&quot; T2,
<span class="linenos">47</span>       spy (term (app T2 false) _),
<span class="linenos">48</span>       print A A&#39; B B&#39; C &quot;|&quot; T1 &quot;|&quot; T2)),
<span class="linenos">49</span>  true.
<span class="linenos">50</span>
<span class="linenos">51</span>% vim: set ft=lprolog:
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 8, column 0, character 216:</span>
<span class="go"> Warning: constant zero has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 33, column 0, character 798:</span>
<span class="go"> Warning: constant watch has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 3, column 0, character 18:</span>
<span class="go"> Warning: constant term has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 9, column 0, character 231:</span>
<span class="go"> Warning: constant succ has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 29, column 0, character 710:</span>
<span class="go"> Warning:</span>
<span class="go"> constant spy has no declared type. Did you mean std.spy std.spy! std.spy-do! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 8, column 0, character 216:</span>
<span class="go"> Warning: constant nat has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 4, column 0, character 66:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 22, column 0, character 521:</span>
<span class="go"> Warning: constant compatible has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 19, column 0, character 457:</span>
<span class="go"> Warning: constant both_or_none has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 36, column 0, character 893:</span>
<span class="go"> Warning: constant b2n has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 3, column 0, character 18:</span>
<span class="go"> Warning: [suppressing 2 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/llamchr.elpi&quot;, line 30, column 0, character 751:</span>
<span class="go"> Warning: P is linear: name it _P (discard) or P_ (fresh variable)</span>
<span class="go">X0 X1 X1 X0 nat | lam X0 c2 \ lam X1 c3 \ X2 c0 c2 c3 |</span>
<span class="go"> lam X1 c2 \ lam X0 c3 \ X2 c0 c3 c2</span>
<span class="go">[ (c2 \ c3 \ X2 c0 c2 c3) = (c2 \ c3 \ c2)</span>
<span class="go">]ok</span>
<span class="go">nat X1 X1 nat nat | lam nat c2 \ lam X1 c3 \ c2 | lam X1 c2 \ lam nat c3 \ c3</span>
<span class="go">[ term (app (lam X1 c2 \ lam nat c3 \ c3) false) _</span>
<span class="go">]ok</span>
<span class="go">nat bool bool nat nat | lam nat c2 \ lam bool c3 \ c2 |</span>
<span class="go"> lam bool c2 \ lam nat c3 \ c3</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.002</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.169</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/map.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">build</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">std.map</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">std.map</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos"> 2</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 3</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos"> 5</span><span class="w">  </span>std.map.add<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XR</span><span class="kd">,</span>
<span class="linenos"> 6</span><span class="w">  </span>build<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">XR</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos"> 9</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">10</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">11</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">12</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">13</span><span class="w">  </span>test<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test2</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos">16</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">17</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">18</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">19</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">20</span><span class="w">  </span>test2<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">21</span>
<span class="linenos">22</span>macro<span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="mi">4096</span><span class="o">.</span>
<span class="linenos">23</span>
<span class="linenos">24</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">25</span><span class="w">  </span>std.time<span class="w"> </span>(build<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>{std.map.make<span class="w"> </span>cmp_term} <span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time0</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">26</span><span class="w">  </span>std.time<span class="w"> </span>(test<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>std.map.find<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time1</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">27</span><span class="w">  </span>std.map.bindings<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w">  </span>std.assert!<span class="w"> </span>({std.length<span class="w"> </span><span class="nv">B</span>} <span class="kd">=</span><span class="w"> </span><span class="kd">@</span>iters<span class="kd">,</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;bindings broken&quot;</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">29</span><span class="w">  </span>std.time<span class="w"> </span>(test2<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>std.map.remove<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time2</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">30</span><span class="w">  </span>print<span class="w"> </span><span class="nv">Time0</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time1</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1.994990 + 0.074122 + 1.505325</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.104</span>

<span class="go">Success:</span>

<span class="go">Time: 3.918</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/map_list.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">kind</span><span class="w"> </span><span class="nf">l</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 2</span><span class="kd">type</span><span class="w"> </span><span class="nf">n</span><span class="w"> </span><span class="kt">l</span>.
<span class="linenos"> 3</span><span class="kd">type</span><span class="w"> </span><span class="nf">c</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">l</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">l</span>.
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">add</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">l</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">l</span>.
<span class="linenos"> 6</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span>n<span class="w"> </span>(c<span class="w"> </span><span class="o">(</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="o">)</span><span class="w"> </span>n<span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 7</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span>(c<span class="w"> </span><span class="o">(</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(c<span class="w"> </span><span class="o">(</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 8</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span>(c<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(c<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kd">pred</span><span class="w"> </span><span class="nf">bindings</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">l</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos">11</span>bindings<span class="w"> </span>n<span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
<span class="linenos">12</span>bindings<span class="w"> </span>(c<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">L1</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>bindings<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="kd">pred</span><span class="w"> </span><span class="nf">assoc</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">l</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos">15</span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span>(c<span class="w"> </span><span class="o">(</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="o">)</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">16</span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span>(c<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="kd">pred</span><span class="w"> </span><span class="nf">remove</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">l</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">l</span>.
<span class="linenos">19</span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span>(c<span class="w"> </span><span class="o">(</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">20</span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span>(c<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(c<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="kd">pred</span><span class="w"> </span><span class="nf">build</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">l</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">l</span>.
<span class="linenos">23</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">24</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">25</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">26</span><span class="w">  </span>add<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XR</span><span class="kd">,</span>
<span class="linenos">27</span><span class="w">  </span>build<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">XR</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos">30</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">31</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">32</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">33</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">34</span><span class="w">  </span>test<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test2</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos">37</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">38</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">39</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">40</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">41</span><span class="w">  </span>test2<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">42</span>
<span class="linenos">43</span>macro<span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="mi">4096</span><span class="o">.</span>
<span class="linenos">44</span>
<span class="linenos">45</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">46</span><span class="w">  </span>std.time<span class="w"> </span>(build<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>n<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time0</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">47</span><span class="w">  </span>std.time<span class="w"> </span>(test<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>assoc<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time1</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">48</span><span class="w">  </span>bindings<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span>
<span class="linenos">49</span><span class="w">  </span>std.assert!<span class="w"> </span>({std.length<span class="w"> </span><span class="nv">B</span>} <span class="kd">=</span><span class="w"> </span><span class="kd">@</span>iters<span class="kd">,</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;bindings broken&quot;</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">50</span><span class="w">  </span>std.time<span class="w"> </span>(test2<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>remove<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time2</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">51</span><span class="w">  </span>print<span class="w"> </span><span class="nv">Time0</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time1</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">9.282315 + 4.204655 + 0.602691</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.120</span>

<span class="go">Success:</span>

<span class="go">Time: 14.104</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/map_list_opt.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">add</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos"> 2</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 3</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">_</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 4</span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="w"> </span><span class="nv">L1</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>add<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kd">pred</span><span class="w"> </span><span class="nf">bindings</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos"> 7</span>bindings<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">pred</span><span class="w"> </span><span class="nf">assoc</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos">10</span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">V</span><span class="kd">|</span><span class="w"> </span><span class="nv">_</span><span class="kd">]</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">11</span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="nv">V</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>assoc<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">V</span><span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="kd">pred</span><span class="w"> </span><span class="nf">remove</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos">14</span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">_</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">15</span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="w"> </span><span class="nv">L</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="w"> </span><span class="nv">L1</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>remove<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="kd">pred</span><span class="w"> </span><span class="nf">build</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">(pair</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos">18</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">19</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">20</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">21</span><span class="w">  </span>add<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XR</span><span class="kd">,</span>
<span class="linenos">22</span><span class="w">  </span>build<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">XR</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos">25</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">26</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">27</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">29</span><span class="w">  </span>test<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test2</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos">32</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">33</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">34</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">35</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">36</span><span class="w">  </span>test2<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">37</span>
<span class="linenos">38</span>macro<span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="mi">4096</span><span class="o">.</span>
<span class="linenos">39</span>
<span class="linenos">40</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">41</span><span class="w">  </span>std.time<span class="w"> </span>(build<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time0</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">42</span><span class="w">  </span>std.time<span class="w"> </span>(test<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>assoc<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time1</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">43</span><span class="w">  </span>bindings<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span>
<span class="linenos">44</span><span class="w">  </span>std.assert!<span class="w"> </span>({std.length<span class="w"> </span><span class="nv">B</span>} <span class="kd">=</span><span class="w"> </span><span class="kd">@</span>iters<span class="kd">,</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span>pr<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;bindings broken&quot;</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">45</span><span class="w">  </span>std.time<span class="w"> </span>(test2<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>remove<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time2</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">46</span><span class="w">  </span>print<span class="w"> </span><span class="nv">Time0</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time1</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">8.557725 + 3.912829 + 0.411586</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.116</span>

<span class="go">Success:</span>

<span class="go">Time: 12.892</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/name_builtin.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">f x y</span>\
<span class="linenos">3</span><span class="w">    </span>name<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>x<span class="w"> </span>y<span class="o">)</span><span class="w"> </span>f<span class="w"> </span><span class="kd">[</span>x<span class="kd">,</span><span class="w"> </span>y<span class="kd">]</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>name<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">[]</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">f x y</span>\
<span class="linenos">6</span><span class="w">    </span>name<span class="w"> </span><span class="o">(</span><span class="nv">A</span><span class="w"> </span>f<span class="w"> </span>x<span class="w"> </span>y<span class="o">)</span><span class="w"> </span>f<span class="w"> </span><span class="kd">[</span>x<span class="kd">,</span>y<span class="kd">],</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;A=&quot;</span><span class="w"> </span><span class="nv">A</span><span class="kd">,</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>f<span class="w"> </span>x<span class="w"> </span>y<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="o">(</span>f<span class="w"> </span>x<span class="w"> </span>y<span class="o">))</span><span class="kd">,</span>
<span class="linenos">7</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>name<span class="w"> </span><span class="o">(</span><span class="nv">B</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>x<span class="w"> </span><span class="kd">[],</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;B=&quot;</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=</span><span class="w"> </span>x<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/name_builtin.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Error: (c2) has type any but is applied to c3 c4</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.105</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/named_clauses00.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k k-Mode">:name</span><span class="w"> </span><span class="s2">&quot;name1&quot;</span>
<span class="linenos">2</span>c1<span class="o">.</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k k-Mode">:name</span><span class="w"> </span><span class="s2">&quot;name1&quot;</span>
<span class="linenos">5</span>c2<span class="o">.</span>
<span class="linenos">6</span>
<span class="linenos">7</span>main<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/named_clauses00.elpi&quot;, line 4, column 0, character 19:a clause named name1 already exists at File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/named_clauses00.elpi&quot;, line 1, column 0, character 0:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/named_clauses01.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k k-Mode">:before</span><span class="w"> </span><span class="s2">&quot;c&quot;</span>
<span class="linenos">2</span>c1<span class="w"> </span>
<span class="linenos">3</span>
<span class="linenos">4</span>main<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/named_clauses01.elpi&quot;, line 2, column 0, character 1:unable to graft this clause: no clause named c</span>
</pre></div>
</div>
<p><strong>../../tests/sources/named_clauses02.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k k-Mode">:name</span><span class="w"> </span><span class="s2">&quot;c&quot;</span>
<span class="linenos"> 2</span>c<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k k-Mode">:before</span><span class="w"> </span><span class="s2">&quot;c&quot;</span>
<span class="linenos"> 5</span>c<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k k-Mode">:before</span><span class="w"> </span><span class="s2">&quot;c&quot;</span>
<span class="linenos"> 8</span>c<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>fail<span class="kd">,</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>c<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/named_clauses02.elpi&quot;, line 5, column 0, character 26:</span>
<span class="go"> Warning:</span>
<span class="go"> constant c has no declared type. Did you mean std.map.private.create std.set.private.create std.set.cardinal std.set.private.cardinal gc.compact trace.counter std.loc.set.cardinal std.int.set.cardinal std.string.set.cardinal std.string.concat ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.110</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/namespaces00.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">namespace</span><span class="w"> </span>rev<span class="w"> </span>{
<span class="linenos">2</span><span class="w">  </span><span class="kd">pred</span><span class="w"> </span><span class="nf">aux</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">A</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">A</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">3</span><span class="w">  </span>aux<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">ACC</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>aux<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">ACC</span><span class="kd">]</span><span class="w"> </span><span class="nv">R</span><span class="o">.</span>
<span class="linenos">4</span><span class="w">  </span>aux<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos">5</span>}
<span class="linenos">6</span><span class="kd">pred</span><span class="w"> </span><span class="nf">rev</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">A</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">list</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">7</span>rev<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">RL</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>rev.aux<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">[]</span><span class="w">  </span><span class="nv">RL</span><span class="o">.</span>
<span class="linenos">8</span>
<span class="linenos">9</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>rev<span class="w"> </span><span class="kd">[</span><span class="mi">1</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">3</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span><span class="mi">3</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">1</span><span class="kd">],</span><span class="w"> </span>not(aux<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>rev.aux<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces00.elpi&quot;, line 9, column 0, character 174:</span>
<span class="go"> Warning: constant aux has no declared type. Did you mean rev.aux ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.110</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/namespaces01.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>toto<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c">% We test toto is not put inside the namespace</span>
<span class="linenos">4</span><span class="kd">namespace</span><span class="w"> </span>foo<span class="w"> </span>{
<span class="linenos">5</span><span class="w">  </span>bar<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>toto<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>baz<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">6</span><span class="w">  </span>baz<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>toto<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">7</span>}
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo.bar<span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span>foo.baz<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces01.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant toto has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces01.elpi&quot;, line 5, column 3, character 75:</span>
<span class="go"> Warning: constant foo.baz has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces01.elpi&quot;, line 5, column 3, character 75:</span>
<span class="go"> Warning: constant foo.bar has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.112</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/namespaces02.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">namespace</span><span class="w"> </span>x<span class="w"> </span>{
<span class="linenos">2</span><span class="w">  </span><span class="kd">namespace</span><span class="w"> </span>acc<span class="w"> </span>{ <span class="kd">accumulate</span><span class="w"> </span>namespaces00<span class="o">.</span><span class="w"> </span>}
<span class="linenos">3</span><span class="w">  </span>foo<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>rev.aux<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span><span class="w"> </span><span class="c">% does not exists, since it is inside acc</span>
<span class="linenos">4</span>}
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>x.acc.rev<span class="w"> </span><span class="kd">[</span><span class="mi">1</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">3</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span><span class="mi">3</span><span class="kd">,</span><span class="mi">2</span><span class="kd">,</span><span class="mi">1</span><span class="kd">],</span><span class="w"> </span>x.acc.rev.aux<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[],</span><span class="w"> </span>not(x.foo<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces02.elpi&quot;, line 3, column 3, character 62:</span>
<span class="go"> Warning: constant x.foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces00.elpi&quot;, line 9, column 0, character 174:</span>
<span class="go"> Warning: constant x.acc.main has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces00.elpi&quot;, line 9, column 0, character 174:</span>
<span class="go"> Warning: constant aux has no declared type. Did you mean x.acc.rev.aux ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.002</span>

<span class="go">Compilation time: 0.001</span>

<span class="go">Typechecking time: 0.116</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/namespaces03.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">namespace</span><span class="w"> </span>a<span class="w"> </span>{
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="w">  </span>foo1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b.c.foo<span class="o">.</span>
<span class="linenos"> 4</span><span class="w">  </span>foo2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b.foo1<span class="kd">,</span><span class="w"> </span>b.foo2<span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="kd">namespace</span><span class="w"> </span>b<span class="w"> </span>{
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">    </span>foo1<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>c.foo<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">    </span><span class="kd">namespace</span><span class="w"> </span>c<span class="w"> </span>{
<span class="linenos">11</span><span class="w"> </span>
<span class="linenos">12</span><span class="w">      </span>foo<span class="o">.</span>
<span class="linenos">13</span><span class="w">   </span>
<span class="linenos">14</span><span class="w">    </span>}
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span>foo2<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>c.foo<span class="o">.</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">  </span>}
<span class="linenos">19</span>
<span class="linenos">20</span><span class="w">  </span>foo3<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b.c.foo<span class="o">.</span>
<span class="linenos">21</span><span class="w">  </span>foo4<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>b.foo1<span class="kd">,</span><span class="w"> </span>b.foo2<span class="o">.</span>
<span class="linenos">22</span>
<span class="linenos">23</span>}
<span class="linenos">24</span>
<span class="linenos">25</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a.foo1<span class="kd">,</span><span class="w"> </span>a.foo2<span class="kd">,</span><span class="w"> </span>a.foo3<span class="kd">,</span><span class="w"> </span>a.foo4<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 21, column 3, character 187:</span>
<span class="go"> Warning: constant a.foo4 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 20, column 3, character 168:</span>
<span class="go"> Warning: constant a.foo3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 4, column 3, character 37:</span>
<span class="go"> Warning: constant a.foo2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 3, column 3, character 18:</span>
<span class="go"> Warning: constant a.foo1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 4, column 3, character 37:</span>
<span class="go"> Warning: constant a.b.foo2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 4, column 3, character 37:</span>
<span class="go"> Warning: constant a.b.foo1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/namespaces03.elpi&quot;, line 3, column 3, character 18:</span>
<span class="go"> Warning: constant a.b.c.foo has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.138</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/nil_cons.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>nil<span class="kd">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>cons<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.105</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/notation.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>module<span class="w"> </span>test<span class="o">.</span>
<span class="linenos"> 2</span><span class="c">/*</span>
<span class="linenos"> 3</span>infixl<span class="w"> </span>x+<span class="kd">,</span>y+<span class="w"> </span><span class="mi">190</span><span class="o">.</span>
<span class="linenos"> 4</span>infixr<span class="w"> </span>x++<span class="w"> </span><span class="mi">191</span><span class="o">.</span>
<span class="linenos"> 5</span>prefixr<span class="w"> </span>z+<span class="w"> </span><span class="mi">191</span><span class="o">.</span>
<span class="linenos"> 6</span>postfixl<span class="w"> </span>w+<span class="w"> </span><span class="mi">190</span><span class="o">.</span>
<span class="linenos"> 7</span>infixl<span class="w"> </span>x*<span class="w"> </span><span class="mi">200</span><span class="o">.</span>
<span class="linenos"> 8</span><span class="kd">*/</span>
<span class="linenos"> 9</span><span class="nv">X</span><span class="w"> </span><span class="kd">+</span>x<span class="w"> </span><span class="nv">D</span><span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>foo<span class="w"> </span>xx<span class="w"> </span>uu<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="kd">~</span>z<span class="w"> </span>x<span class="w"> </span>?w<span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span>x<span class="w"> </span><span class="kd">*</span>x<span class="w"> </span>y<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>z<span class="w"> </span><span class="kd">*</span>x<span class="w"> </span>w<span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span>a<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>b<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>c<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>d<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>e<span class="o">.</span>
<span class="linenos">18</span>a<span class="w"> </span><span class="kd">++</span>x<span class="w"> </span>b<span class="w"> </span><span class="kd">++</span>x<span class="w"> </span>c<span class="w"> </span><span class="kd">++</span>x<span class="w"> </span>d<span class="w"> </span><span class="kd">++</span>x<span class="w"> </span>e<span class="o">.</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kd">type</span><span class="w"> </span><span class="nf">a</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">21</span><span class="kd">type</span><span class="w"> </span><span class="nf">d</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">22</span><span class="kd">type</span><span class="w"> </span><span class="nf">(+x)</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">C</span>.
<span class="linenos">23</span><span class="kd">type</span><span class="w"> </span><span class="nf">(+y)</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">C</span>.
<span class="linenos">24</span>
<span class="linenos">25</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span>(a<span class="w"> </span>a<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span><span class="kd">[</span>b<span class="kd">]</span><span class="w"> </span><span class="kd">+</span>y<span class="w"> </span>d<span class="o">)</span><span class="kd">,</span><span class="w"> </span>cd<span class="w"> </span><span class="kd">+</span>x<span class="w"> </span>d<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 13, column 0, character 122:</span>
<span class="go"> Warning: constant ~z has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 15, column 0, character 132:</span>
<span class="go"> Warning: constant z has no declared type. Did you mean std.zip ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 15, column 0, character 132:</span>
<span class="go"> Warning: constant y has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 11, column 0, character 110:</span>
<span class="go"> Warning: constant xx has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 13, column 0, character 122:</span>
<span class="go"> Warning: constant x has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 15, column 0, character 132:</span>
<span class="go"> Warning: constant w has no declared type. Did you mean std.while-ok-do! ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 11, column 0, character 110:</span>
<span class="go"> Warning: constant uu has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 11, column 0, character 110:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 17, column 0, character 151:</span>
<span class="go"> Warning:</span>
<span class="go"> constant e has no declared type. Did you mean std.exists std.exists2 std.map.private.empty std.set.private.empty std.set.elements std.set.private.elements std.loc.set.elements std.loc.set.equal std.loc.set.empty std.int.set.elements std.int.set.equal std.int.set.empty std.string.set.elements std.string.set.equal std.string.set.empty std.loc.map.empty std.int.map.empty std.string.map.empty ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 25, column 0, character 269:</span>
<span class="go"> Warning: constant cd has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 17, column 0, character 151:</span>
<span class="go"> Warning: [suppressing 5 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 9, column 0, character 101:</span>
<span class="go"> Warning: D is linear: name it _D (discard) or D_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation.elpi&quot;, line 9, column 0, character 101:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">a a +x [b] +y d</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.159</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/notation_error.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>infix<span class="w"> </span>foo<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation_error.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go">Mixfix directives are not supported by this parser.</span>

<span class="go">The parser is based on token families.</span>
<span class="go">A family is identified by some starting characters, for example</span>
<span class="go">a token &#39;+--&gt;&#39; belongs to the family of &#39;+&#39;. There is no need</span>
<span class="go">to declare it.</span>

<span class="go">All the tokens of a family are parsed with the same precedence and</span>
<span class="go">associativity, for example &#39;x +--&gt; y *--&gt; z&#39; is parsed as</span>
<span class="go">&#39;x +--&gt; (y *--&gt; z)&#39; since the family of &#39;*&#39; has higher precedence</span>
<span class="go">than the family of &#39;+&#39;.</span>

<span class="go">Here the table of tokens and token families.</span>
<span class="go">Token families are represented by the start symbols followed by &#39;..&#39;.</span>
<span class="go">Tokens of families marked with [*] cannot end with the starting symbol,</span>
<span class="go">eg `foo` is not an infix, while `foo is.</span>
<span class="go">The listing is ordered by increasing precedence.</span>

<span class="go">fixity                     | tokens / token families</span>
<span class="go">-------------------------- + -----------------------------------</span>
<span class="go">Infix   not   associative  | :-  ?-</span>
<span class="go">Infix   right associative  | ;</span>
<span class="go">Infix   right associative  | ,  &amp;</span>
<span class="go">Infix   right associative  | -&gt;</span>
<span class="go">Infix   right associative  | =&gt;</span>
<span class="go">Infix   not   associative  | =  ==  =&lt;  r&lt;  i&lt;  s&lt;  r=&lt;  i=&lt;  s=&lt;</span>
<span class="go">                             &lt;..  r&gt;  i&gt;  s&gt;  r&gt;=  i&gt;=  s&gt;=  &gt;..</span>
<span class="go">                             is</span>
<span class="go">Infix   right associative  | ::</span>
<span class="go">Infix   not   associative  | &#39;.. [*]</span>
<span class="go">Infix   left  associative  | ^..  r+  i+  s+  +..  -  r-  i-  s-</span>
<span class="go">Infix   left  associative  | r*  i*  s*  *..  /  div  mod</span>
<span class="go">Infix   right associative  | --..</span>
<span class="go">Infix   not   associative  | `.. [*]</span>
<span class="go">Infix   right associative  | ==..</span>
<span class="go">Infix   right associative  | ||..</span>
<span class="go">Infix   right associative  | &amp;&amp;..</span>
<span class="go">Infix   left  associative  | #..</span>
<span class="go">Prefix  not   associative  | r~  i~  ~..</span>
<span class="go">Postfix not   associative  | ?..</span>

<span class="go">If the token is a valid mixfix, and you want the file to stay compatible</span>
<span class="go">with Teyjus, you can ask Elpi to skip the directive. Eg:</span>

<span class="gp">% </span>elpi:skip<span class="w"> </span><span class="m">2</span><span class="w">  </span>//<span class="w"> </span>skips<span class="w"> </span>the<span class="w"> </span>next<span class="w"> </span>two<span class="w"> </span>lines
<span class="go">infixr ==&gt; 120.</span>
<span class="go">infixr || 120.</span>

<span class="go">As a debugging facility one can ask Elpi to print the AST in order to</span>
<span class="go">verify how the text was parsed. Eg:</span>

<span class="go">echo &#39;MyFormula = a || b ==&gt; c &amp;&amp; d&#39; | elpi -parse-term</span>
</pre></div>
</div>
<p><strong>../../tests/sources/notation_legacy.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>module<span class="w"> </span>test<span class="o">.</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>infixl<span class="w"> </span>x+<span class="kd">,</span>y+<span class="w"> </span><span class="mi">190</span><span class="o">.</span>
<span class="linenos"> 4</span>infixr<span class="w"> </span>x++<span class="w"> </span><span class="mi">191</span><span class="o">.</span>
<span class="linenos"> 5</span>prefixr<span class="w"> </span>z+<span class="w"> </span><span class="mi">191</span><span class="o">.</span>
<span class="linenos"> 6</span>postfixl<span class="w"> </span>w+<span class="w"> </span><span class="mi">190</span><span class="o">.</span>
<span class="linenos"> 7</span>infixl<span class="w"> </span>x*<span class="w"> </span><span class="mi">200</span><span class="o">.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="nv">X</span><span class="w"> </span>x+<span class="w"> </span><span class="nv">D</span><span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>foo<span class="w"> </span>xx<span class="w"> </span>uu<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>z+<span class="w"> </span>x<span class="w"> </span>w+<span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span>x<span class="w"> </span>x*<span class="w"> </span>y<span class="w"> </span>x+<span class="w"> </span>z<span class="w"> </span>x*<span class="w"> </span>w<span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span>a<span class="w"> </span>x+<span class="w"> </span>b<span class="w"> </span>x+<span class="w"> </span>c<span class="w"> </span>x+<span class="w"> </span>d<span class="w"> </span>x+<span class="w"> </span>e<span class="o">.</span>
<span class="linenos">18</span>a<span class="w"> </span>x++<span class="w"> </span>b<span class="w"> </span>x++<span class="w"> </span>c<span class="w"> </span>x++<span class="w"> </span>d<span class="w"> </span>x++<span class="w"> </span>e<span class="o">.</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kd">type</span><span class="w"> </span><span class="nf">a</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">21</span><span class="kd">type</span><span class="w"> </span><span class="nf">d</span><span class="w"> </span><span class="kt">A</span>.
<span class="linenos">22</span><span class="kd">type</span><span class="w"> </span><span class="nf">(x+)</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">C</span>.
<span class="linenos">23</span><span class="kd">type</span><span class="w"> </span><span class="nf">(y+)</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">C</span>.
<span class="linenos">24</span>
<span class="linenos">25</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span>(a<span class="w"> </span>a<span class="w"> </span>x+<span class="w"> </span><span class="kd">[</span>b<span class="kd">]</span><span class="w"> </span>y+<span class="w"> </span>d<span class="o">)</span><span class="kd">,</span><span class="w"> </span>cd<span class="w"> </span>x+<span class="w"> </span>d<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/notation_legacy.elpi&quot;, line 3, column 10, character 24:</span>
<span class="go">Mixfix declaration expected (Teyjus compatibility, ignored by Elpi).</span>
<span class="go">Examples:</span>
<span class="go">infixl and 30.</span>
<span class="go">infixr ++ 45.</span>
<span class="go">prefix - 12.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/patternunif.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q Y should yield Y = \\\f 2</span>
<span class="linenos">2</span>q<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">b</span>\<span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span>(r<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">a</span>\<span class="w"> </span>s<span class="w"> </span><span class="o">(</span>f<span class="w"> </span>a<span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>s<span class="w"> </span><span class="o">(</span><span class="nv">X</span><span class="w"> </span>b<span class="w"> </span>c<span class="w"> </span>a<span class="o">))</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>r<span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">3</span>
<span class="linenos">4</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">x\y\z\</span>f<span class="w"> </span>z<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif.elpi&quot;, line 2, column 0, character 30:</span>
<span class="go"> Warning:</span>
<span class="go"> constant s has no declared type. Did you mean std.spy std.spy! std.split-at std.spy-do! std.set.mem std.set.make std.set.add std.set.remove std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.cardinal std.set.elements std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.set std.set std.loc.set std.int.set std.string.set std.string.map gc.stat gc.set std.loc.set.cardinal std.loc.set.elements std.loc.set.subset std.loc.set.equal std.loc.set.diff std.loc.set.inter std.loc.set.union std.loc.set.remove std.loc.set.add std.loc.set.mem std.loc.set.empty std.int.set.cardinal std.int.set.elements std.int.set.subset std.int.set.equal std.int.set.diff std.int.set.inter std.int.set.union std.int.set.remove std.int.set.add std.int.set.mem std.int.set.empty std.string.set.cardinal std.string.set.elements std.string.set.subset std.string.set.equal std.string.set.diff std.string.set.inter std.string.set.union std.string.set.remove std.string.set.add std.string.set.mem std.string.set.empty std.string.map.bindings std.string.map.find std.string.map.remove std.string.map.add std.string.map.mem std.string.map.empty std.string.concat random.self_init rex.split ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif.elpi&quot;, line 2, column 0, character 30:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif.elpi&quot;, line 2, column 0, character 30:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif.elpi&quot;, line 2, column 0, character 30:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.116</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/patternunif2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% r Y yields Y=\0</span>
<span class="linenos">2</span>q<span class="w"> </span>(<span class="nv">a\</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>a<span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">3</span>r<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span>q<span class="w"> </span>(<span class="nv">a\</span>a<span class="o">)</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">x\</span>x<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif2.elpi&quot;, line 3, column 0, character 32:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/patternunif2.elpi&quot;, line 2, column 0, character 18:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.113</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/pi.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q X yields X=ok</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>p<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\<span class="w"> </span>r<span class="w"> </span>y<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>z<span class="w"> </span>x<span class="w"> </span>y<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>z<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>ko<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>r<span class="w"> </span><span class="nv">A</span><span class="kd">,</span><span class="w"> </span>p<span class="w"> </span><span class="nv">B</span><span class="o">.</span>
<span class="linenos">6</span>z<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>ok<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="w"> </span><span class="nv">A</span><span class="kd">,</span><span class="w"> </span>r<span class="w"> </span><span class="nv">B</span><span class="o">.</span>
<span class="linenos">7</span>
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning: constant z has no declared type. Did you mean std.zip ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi.elpi&quot;, line 3, column 0, character 19:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi.elpi&quot;, line 5, column 0, character 62:</span>
<span class="go"> Warning: constant ko has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.126</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/pi3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% q X yields X=\0, i.e. X=b\b</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\<span class="w"> </span>z<span class="w"> </span>(<span class="nv">w\</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">4</span>
<span class="linenos">5</span>z<span class="w"> </span>(<span class="nv">a\</span><span class="w"> </span>a<span class="o">).</span>
<span class="linenos">6</span>z<span class="w"> </span>(<span class="nv">a\</span><span class="w"> </span><span class="nv">b\</span><span class="w"> </span>b<span class="o">).</span>
<span class="linenos">7</span>
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">b\</span>b<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi3.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning: constant z has no declared type. Did you mean std.zip ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi3.elpi&quot;, line 3, column 0, character 31:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.109</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/pi5.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% q X, r X, s X all yields X=ok</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>of<span class="w"> </span>stop<span class="o">.</span>
<span class="linenos"> 4</span>of<span class="w"> </span>(bam<span class="w"> </span><span class="nv">x\</span>x<span class="o">).</span>
<span class="linenos"> 5</span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\F</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">w</span>\<span class="w"> </span>of<span class="w"> </span><span class="nv">F</span><span class="o">.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>bam<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>y<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 8</span>r<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span>(bam<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>y<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 9</span>s<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>of<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>stop<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>r<span class="w"> </span><span class="nv">S</span><span class="kd">,</span><span class="w"> </span>s<span class="w"> </span><span class="nv">T</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="kd">,</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="kd">,</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 9, column 0, character 152:</span>
<span class="go"> Warning:</span>
<span class="go"> constant s has no declared type. Did you mean std.spy std.spy! std.split-at std.spy-do! std.set.mem std.set.make std.set.add std.set.remove std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.cardinal std.set.elements std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.set std.set std.loc.set std.int.set std.string.set std.string.map gc.stat gc.set std.loc.set.cardinal std.loc.set.elements std.loc.set.subset std.loc.set.equal std.loc.set.diff std.loc.set.inter std.loc.set.union std.loc.set.remove std.loc.set.add std.loc.set.mem std.loc.set.empty std.int.set.cardinal std.int.set.elements std.int.set.subset std.int.set.equal std.int.set.diff std.int.set.inter std.int.set.union std.int.set.remove std.int.set.add std.int.set.mem std.int.set.empty std.string.set.cardinal std.string.set.elements std.string.set.subset std.string.set.equal std.string.set.diff std.string.set.inter std.string.set.union std.string.set.remove std.string.set.add std.string.set.mem std.string.set.empty std.string.map.bindings std.string.map.find std.string.map.remove std.string.map.add std.string.map.mem std.string.map.empty std.string.concat random.self_init rex.split ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 8, column 0, character 122:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 7, column 0, character 85:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 3, column 0, character 33:</span>
<span class="go"> Warning: constant of has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 5, column 0, character 56:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pi5.elpi&quot;, line 4, column 0, character 42:</span>
<span class="go"> Warning: constant bam has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.144</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/pnf.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>
<span class="linenos"> 2</span>/*
<span class="linenos"> 3</span> * Predicates for transforming formulas into prenex normal form 
<span class="linenos"> 4</span> * assuming classical logic equivalences. This is an example of 
<span class="linenos"> 5</span> * analyzing formula structure, including recursion over bindings
<span class="linenos"> 6</span> * and generating modified structure based on this analysis
<span class="linenos"> 7</span> */
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>%module  pnf.
<span class="linenos">10</span>
<span class="linenos">11</span>%type  merge  (form -&gt; form -&gt; o).
<span class="linenos">12</span>
<span class="linenos">13</span>type perp, tru formula.
<span class="linenos">14</span>type and, or, imp formula -&gt; formula -&gt; formula.
<span class="linenos">15</span>type adj, path term -&gt; term -&gt; formula.
<span class="linenos">16</span>type all, some (term -&gt; formula) -&gt; formula.
<span class="linenos">17</span>
<span class="linenos">18</span>quant_free perp.
<span class="linenos">19</span>quant_free tru.
<span class="linenos">20</span>quant_free A :- atom A.
<span class="linenos">21</span>quant_free (and B C) :- quant_free B, quant_free C.
<span class="linenos">22</span>quant_free (or B C) :- quant_free B, quant_free C.
<span class="linenos">23</span>quant_free (imp B C) :- quant_free B, quant_free C.
<span class="linenos">24</span>
<span class="linenos">25</span>atom (path X Y) :- termp X, termp Y.
<span class="linenos">26</span>atom (adj X Y) :- termp X, termp Y.
<span class="linenos">27</span>
<span class="linenos">28</span>type a, b, c term.
<span class="linenos">29</span>type f term -&gt; term.
<span class="linenos">30</span>
<span class="linenos">31</span>termp a.
<span class="linenos">32</span>termp b.
<span class="linenos">33</span>termp c.
<span class="linenos">34</span>termp (f X) :- termp X.
<span class="linenos">35</span>
<span class="linenos">36</span>(prenex B B) :- (quant_free B), !. 
<span class="linenos">37</span>(prenex (and B C) D) :- (prenex B U), (prenex C V), (merge (and U V) D).
<span class="linenos">38</span>(prenex (or B C) D) :- (prenex B U), (prenex C V), (merge (or U V) D).
<span class="linenos">39</span>(prenex (imp B C) D) :- (prenex B U), (prenex C V), (merge (imp U V) D).
<span class="linenos">40</span>(prenex (all B) (all D)) :- (pi x\ ((termp x) =&gt; (prenex (B x) (D x)))).
<span class="linenos">41</span>(prenex (some B) (some D)) :- (pi x\ ((termp x) =&gt; (prenex (B x) (D x)))).
<span class="linenos">42</span>
<span class="linenos">43</span>
<span class="linenos">44</span>/* This predicate is for moving out quantifiers appearing at the head of the 
<span class="linenos">45</span>immediate subformulas of a formula with a propositional connective as its 
<span class="linenos">46</span>top-level symbol */
<span class="linenos">47</span>(merge (and (all B) (all C)) (all D)) :-
<span class="linenos">48</span>       (pi x\ ((termp x) =&gt; (merge (and (B x) (C x)) (D x)))).
<span class="linenos">49</span>(merge (and (all B) C) (all D)) :- 
<span class="linenos">50</span>       (pi x\ ((termp x) =&gt; (merge (and (B x) C) (D x)))).
<span class="linenos">51</span>(merge (and B (all C)) (all D)) :- 
<span class="linenos">52</span>       (pi x\ ((termp x) =&gt; (merge (and B (C x)) (D x)))).
<span class="linenos">53</span>
<span class="linenos">54</span>(merge (and (some B) C) (some D)) :- 
<span class="linenos">55</span>       (pi x\ ((termp x) =&gt; (merge (and (B x) C) (D x)))).
<span class="linenos">56</span>(merge (and B (some C)) (some D)) :-
<span class="linenos">57</span>       (pi x\ ((termp x) =&gt; (merge (and B (C x)) (D x)))).
<span class="linenos">58</span>
<span class="linenos">59</span>(merge (or (all B) C) (all D)) :-
<span class="linenos">60</span>       (pi x\ ((termp x) =&gt; (merge (or (B x) C) (D x)))).
<span class="linenos">61</span>(merge (or B (all C)) (all D)) :-
<span class="linenos">62</span>       (pi x\ ((termp x) =&gt; (merge (or B (C x)) (D x)))).
<span class="linenos">63</span>(merge (or (some B) (some C)) (some D)) :-
<span class="linenos">64</span>       (pi x\ ((termp x) =&gt; (merge (or (B x) (C x)) (D x)))).
<span class="linenos">65</span>(merge (or (some B) C) (some D)) :-
<span class="linenos">66</span>       (pi x\ ((termp x) =&gt; (merge (or (B x) C) (D x)))).
<span class="linenos">67</span>(merge (or B (some C)) (some D)) :-
<span class="linenos">68</span>       (pi x\ ((termp x) =&gt; (merge (or B (C x)) (D x)))).
<span class="linenos">69</span>
<span class="linenos">70</span>(merge (imp (all B) (some C)) (some D)) :- 
<span class="linenos">71</span>       (pi x\ ((termp x) =&gt; (merge (imp (B x) (C x)) (D x)))).
<span class="linenos">72</span>(merge (imp (all B) C) (some D)) :- 
<span class="linenos">73</span>       (pi x\ ((termp x) =&gt; (merge (imp (B x) C) (D x)))).
<span class="linenos">74</span>(merge (imp (some B) C) (all D)) :-
<span class="linenos">75</span>       (pi x\ ((termp x) =&gt; (merge (imp (B x) C) (D x)))).
<span class="linenos">76</span>(merge (imp B (all C)) (all D)) :-
<span class="linenos">77</span>       (pi x\ ((termp x) =&gt; (merge (imp B (C x)) (D x)))).
<span class="linenos">78</span>(merge (imp B (some C)) (some D)) :-
<span class="linenos">79</span>       (pi x\ ((termp x) =&gt; (merge (imp B (C x)) (D x)))).
<span class="linenos">80</span>
<span class="linenos">81</span>(merge B B) :- (quant_free B).
<span class="linenos">82</span>
<span class="linenos">83</span>type one, two, three, four term.
<span class="linenos">84</span>type formula term -&gt; formula -&gt; prop.
<span class="linenos">85</span>
<span class="linenos">86</span>formula one  (imp (all (x \ (path a x))) tru).
<span class="linenos">87</span>formula two  (imp (some (x \ (path a x))) tru).
<span class="linenos">88</span>formula three  (and (all (x \ (path a x))) (all (y \ (path y a)))).
<span class="linenos">89</span>formula four  (imp (some (x \ (path a x))) ((all (y \ (path a y))))).
<span class="linenos">90</span>
<span class="linenos">91</span>(test N F) :- (formula N OF), (prenex OF F).
<span class="linenos">92</span>
<span class="linenos">93</span>main :- (test one F1), (test two F2), (test three F3), (test four F4),!.
<span class="linenos">94</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 91, column 0, character 3225:</span>
<span class="go"> Warning: constant test has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 25, column 0, character 688:</span>
<span class="go"> Warning: constant termp has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 18, column 0, character 475:</span>
<span class="go"> Warning: constant quant_free has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 36, column 0, character 855:</span>
<span class="go"> Warning: constant prenex has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 37, column 0, character 891:</span>
<span class="go"> Warning:</span>
<span class="go"> constant merge has no declared type. Did you mean std.map.private.merge std.set.private.merge ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 20, column 0, character 508:</span>
<span class="go"> Warning: constant atom has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 93, column 0, character 3271:</span>
<span class="go"> Warning: F4 is linear: name it _F4 (discard) or F4_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 93, column 0, character 3271:</span>
<span class="go"> Warning: F3 is linear: name it _F3 (discard) or F3_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 93, column 0, character 3271:</span>
<span class="go"> Warning: F2 is linear: name it _F2 (discard) or F2_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/pnf.elpi&quot;, line 93, column 0, character 3271:</span>
<span class="go"> Warning: F1 is linear: name it _F1 (discard) or F1_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.005</span>

<span class="go">Typechecking time: 0.153</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/polymorphic_variants.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>% Type inference for a super-constrainted functional langage with
<span class="linenos">  2</span>% polymorphic variants
<span class="linenos">  3</span>%
<span class="linenos">  4</span>% Syntax:    f ::= (&lt;case&gt; constant term)^*    unary functions
<span class="linenos">  5</span>%         term ::= constant | &lt;app&gt; funname term
<span class="linenos">  6</span>%      program ::= (&lt;fun&gt; funname f)^*
<span class="linenos">  7</span>%        types ::= (&lt;fun&gt; funname type type)^*
<span class="linenos">  8</span>%         type ::= constant^*
<span class="linenos">  9</span>%
<span class="linenos"> 10</span>%      constant and funnames are distinct lambda-prolog names
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>% check types program types
<span class="linenos"> 13</span>% the functions must be listed in the same order in both
<span class="linenos"> 14</span>%check A B C :- print (check A B C), fail.
<span class="linenos"> 15</span>check [] [] _.
<span class="linenos"> 16</span>check [fun F B | BTL] [fun F D C | TTL] ORIGTYS :-
<span class="linenos"> 17</span> check_domain B D,
<span class="linenos"> 18</span> check_codomain B C ORIGTYS,
<span class="linenos"> 19</span> check BTL TTL ORIGTYS.
<span class="linenos"> 20</span>
<span class="linenos"> 21</span>% check_domain body type
<span class="linenos"> 22</span>%check_domain A B :- print (check_domain A B), fail.
<span class="linenos"> 23</span>check_domain B T :- inputs B I, is_subset T I.
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>%is_subset A B :- print (is_subset A B), fail.
<span class="linenos"> 26</span>is_subset A B :- var A, !, declare_constraint (is_subset A B) [A].
<span class="linenos"> 27</span>is_subset A B :- var B, !, declare_constraint (is_subset A B) [B].
<span class="linenos"> 28</span>is_subset A B :- is_subset_ A B.
<span class="linenos"> 29</span>is_subset_ [] _.
<span class="linenos"> 30</span>is_subset_ [X|TL] TL1 :- mem TL1 X, is_subset TL TL1.
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>mem A B :- var A, !, declare_constraint (mem A B) [A].
<span class="linenos"> 33</span>mem A B :- mem_ A B.
<span class="linenos"> 34</span>mem_ [X|_] X :- !.
<span class="linenos"> 35</span>mem_ [Y|TL] X :- mem TL X.
<span class="linenos"> 36</span>
<span class="linenos"> 37</span>%check_codomain body type types
<span class="linenos"> 38</span>%check_codomain A B C :- print (check_codomain A B C), fail.
<span class="linenos"> 39</span>check_codomain [] _ _.
<span class="linenos"> 40</span>check_codomain [case _ T | TL] TYS ORIGTYS :-
<span class="linenos"> 41</span>  check_term T TYS ORIGTYS,
<span class="linenos"> 42</span>  check_codomain TL TYS ORIGTYS.
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>%check_term term type
<span class="linenos"> 45</span>%check_term A B C :- print &quot;CHECK&quot; (check_term A B C), fail.
<span class="linenos"> 46</span>check_term (app F T) TY ORIGTYS :-
<span class="linenos"> 47</span> !,
<span class="linenos"> 48</span> find ORIGTYS F D C,
<span class="linenos"> 49</span> check_term T D ORIGTYS,
<span class="linenos"> 50</span> is_subset C TY.
<span class="linenos"> 51</span>check_term X TY _ :-
<span class="linenos"> 52</span> mem TY X.
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>find [fun F D C | _] F D C :- !.
<span class="linenos"> 55</span>find [ _ | TL ] F D C :- find TL F D C.
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>%inputs A B :- print &quot;INPUT&quot; (inputs A B), fail.
<span class="linenos"> 58</span>inputs [] [].
<span class="linenos"> 59</span>inputs [case A _ | TL] [A | TL&#39;] :- inputs TL TL&#39;.
<span class="linenos"> 60</span>
<span class="linenos"> 61</span>/* Expected output, according to OCaml
<span class="linenos"> 62</span>Note: I use ref to kill Hindley-Milner polymorphism
<span class="linenos"> 63</span># let g = ref (function `A -&gt; `C | `B -&gt; `D);;
<span class="linenos"> 64</span># let f = function `A -&gt; `A | `B -&gt; !g `A;;
<span class="linenos"> 65</span># f,!g;;
<span class="linenos"> 66</span>- : (_[&lt; `A | `B ] -&gt; (_[&gt; `A | `C | `D ] as &#39;a)) *
<span class="linenos"> 67</span>    (_[&lt; `A | `B &gt; `A ] -&gt; &#39;a) */
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>% This is an interesting propagation rule we would like to add:
<span class="linenos"> 70</span>% a (non empty) subset of a singleton is a singleton.
<span class="linenos"> 71</span>% We cannot add the propagation rule now because:
<span class="linenos"> 72</span>%  1. we match up to unification
<span class="linenos"> 73</span>%     =&gt; the rule turns constraints of the form (is_subset X a::Y) into
<span class="linenos"> 74</span>%        (is_subset X [a])
<span class="linenos"> 75</span>%  2. already unifying the first argument of the rule triggers resumption
<span class="linenos"> 76</span>%     but there is confusion between the two runtimes and a mess happens
<span class="linenos"> 77</span>propagate [] [is_subset X [Y]] (X = [Y]).
<span class="linenos"> 78</span>propagate [is_subset X Y,is_subset Y Z] [] (is_subset X Z).
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>inter [X | A] L [X | B] :- mem L X, !, inter A L B.
<span class="linenos"> 81</span>inter [X | A] L B :- inter A L B.
<span class="linenos"> 82</span>inter [] _ [].
<span class="linenos"> 83</span> 
<span class="linenos"> 84</span>union [X | XS] L L1  :- mem L X, !, union XS L L1.
<span class="linenos"> 85</span>union [X | XS] L [X | L1]  :- union XS L L1.
<span class="linenos"> 86</span>union [] L L .
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>is_ground [].
<span class="linenos"> 89</span>is_ground (_ :: L) :- is_ground L.
<span class="linenos"> 90</span> 
<span class="linenos"> 91</span>propagate [] [is_subset X YS, is_subset X XS] (is_subset X INTER) :-
<span class="linenos"> 92</span>  is_ground YS, is_ground XS, inter YS XS INTER.
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>propagate [X] [X] true.
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>propagate [mem X A,is_subset X Y] [] (mem Y A).
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>propagate [] [mem X A] (is_subset [A] X).
<span class="linenos"> 99</span>propagate [] [is_subset A X, is_subset B X] (is_subset C X) :-
<span class="linenos">100</span>  is_ground A, is_ground B, union A B C.
<span class="linenos">101</span>
<span class="linenos">102</span>main1 :-
<span class="linenos">103</span> P = [ fun f [ case a a
<span class="linenos">104</span>             , case b (app g a) ]
<span class="linenos">105</span>     , fun g [ case a c
<span class="linenos">106</span>             , case b d ]
<span class="linenos">107</span>     ],
<span class="linenos">108</span> T = [ fun f [b] [a, c, d, e ]
<span class="linenos">109</span>     , fun g [a, b] [c, d, e]
<span class="linenos">110</span>     ],
<span class="linenos">111</span> check P T T,
<span class="linenos">112</span> print &quot;Type-checking ok&quot;,
<span class="linenos">113</span>
<span class="linenos">114</span> I = [ fun f If Of
<span class="linenos">115</span>     , fun g Ig Og
<span class="linenos">116</span>     ],
<span class="linenos">117</span> check P I I,
<span class="linenos">118</span> print &quot;Type-inference ok&quot;,
<span class="linenos">119</span> print &quot;:::&quot; f &quot;:&quot; If &quot;-&gt;&quot; Of,
<span class="linenos">120</span> print &quot;:::&quot; g &quot;:&quot; Ig &quot;-&gt;&quot; Og,
<span class="linenos">121</span> print_constraints,
<span class="linenos">122</span> 
<span class="linenos">123</span> Ig = [a],
<span class="linenos">124</span> print &quot;Type specialization ok&quot;,
<span class="linenos">125</span> print &quot;:::&quot; f &quot;:&quot; If &quot;-&gt;&quot; Of,
<span class="linenos">126</span> print &quot;:::&quot; g &quot;:&quot; Ig &quot;-&gt;&quot; Og,
<span class="linenos">127</span> print_constraints.
<span class="linenos">128</span>
<span class="linenos">129</span>main2 :-
<span class="linenos">130</span> P&#39; = [ fun f [ case a a
<span class="linenos">131</span>              , case b (app h1 (app g a))
<span class="linenos">132</span>              , case c (app h2 (app g a)) ]
<span class="linenos">133</span>      , fun g  [ case a a ]
<span class="linenos">134</span>      , fun h1 [ case a a
<span class="linenos">135</span>               , case b b
<span class="linenos">136</span>               , case d d ]
<span class="linenos">137</span>      , fun h2 [ case a a
<span class="linenos">138</span>               , case b b
<span class="linenos">139</span>               , case c c ]
<span class="linenos">140</span>      ],
<span class="linenos">141</span> I&#39; = [ fun f If&#39; Of&#39;
<span class="linenos">142</span>      , fun g Ig&#39; Og&#39;
<span class="linenos">143</span>      , fun h1 Ih1&#39; Oh1&#39;
<span class="linenos">144</span>      , fun h2 Ih2&#39; Oh2&#39;
<span class="linenos">145</span>      ],
<span class="linenos">146</span> check P&#39; I&#39; I&#39;,
<span class="linenos">147</span> print &quot;Type-inference ok&quot;,
<span class="linenos">148</span> print &quot;:::&quot; f &quot;:&quot; If&#39; &quot;-&gt;&quot; Of&#39;,
<span class="linenos">149</span> print &quot;:::&quot; g &quot;:&quot; Ig&#39; &quot;-&gt;&quot; Og&#39;,
<span class="linenos">150</span> print &quot;:::&quot; h1 &quot;:&quot; Ih1&#39; &quot;-&gt;&quot; Oh1&#39;,
<span class="linenos">151</span> print &quot;:::&quot; h2 &quot;:&quot; Ih2&#39; &quot;-&gt;&quot; Oh2&#39;.
<span class="linenos">152</span>
<span class="linenos">153</span>main :- (main1, print &quot;xxx failing&quot;, fail) ; print &quot;xxx failed&quot;, main2.
<span class="linenos">154</span>
<span class="linenos">155</span>% vim: set ft=lprolog:
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 84, column 0, character 2748:</span>
<span class="go"> Warning:</span>
<span class="go"> constant union has no declared type. Did you mean std.loc.set.union std.int.set.union std.string.set.union ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 77, column 0, character 2542:</span>
<span class="go"> Warning: constant propagate has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 33, column 0, character 1118:</span>
<span class="go"> Warning: constant mem_ has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 30, column 0, character 1008:</span>
<span class="go"> Warning:</span>
<span class="go"> constant mem has no declared type. Did you mean std.mem! std.mem std.set.mem std.set.private.mem std.loc.set.mem std.int.set.mem std.string.set.mem std.loc.map.mem std.int.map.mem std.string.map.mem ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 129, column 0, character 3786:</span>
<span class="go"> Warning: constant main2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 102, column 0, character 3251:</span>
<span class="go"> Warning: constant main1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 28, column 0, character 958:</span>
<span class="go"> Warning: constant is_subset_ has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 23, column 0, character 729:</span>
<span class="go"> Warning: constant is_subset has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 88, column 0, character 2860:</span>
<span class="go"> Warning: constant is_ground has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 80, column 0, character 2645:</span>
<span class="go"> Warning:</span>
<span class="go"> constant inter has no declared type. Did you mean std.intersperse std.loc.set.inter std.int.set.inter std.string.set.inter ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 23, column 0, character 729:</span>
<span class="go"> Warning: [suppressing 18 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 35, column 0, character 1158:</span>
<span class="go"> Warning: Y is linear: name it _Y (discard) or Y_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/polymorphic_variants.elpi&quot;, line 81, column 0, character 2697:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">Type-checking ok</span>
<span class="go">Type-inference ok</span>
<span class="go">::: f : X0 -&gt; X1</span>
<span class="go">::: g : X2 -&gt; X3</span>
<span class="go"> mem X3 d  /* suspended on X3 */  mem X3 c  /* suspended on X3 */</span>
<span class="go"> X2 is_subset [a, b]  /* suspended on X2 */</span>
<span class="go"> X3 is_subset X1  /* suspended on X3 */  mem X2 a  /* suspended on X2 */</span>
<span class="go"> mem X1 a  /* suspended on X1 */  X0 is_subset [a, b]  /* suspended on X0 */</span>
<span class="go">Type specialization ok</span>
<span class="go">::: f : X0 -&gt; X1</span>
<span class="go">::: g : [a] -&gt; X3</span>
<span class="go"> mem X3 d  /* suspended on X3 */  mem X3 c  /* suspended on X3 */</span>
<span class="go"> X3 is_subset X1  /* suspended on X3 */  mem X1 a  /* suspended on X1 */</span>
<span class="go"> X0 is_subset [a, b]  /* suspended on X0 */</span>
<span class="go">xxx failing</span>
<span class="go">xxx failed</span>
<span class="go">Type-inference ok</span>
<span class="go">::: f : X4 -&gt; X5</span>
<span class="go">::: g : X6 -&gt; X7</span>
<span class="go">::: h1 : X8 -&gt; X9</span>
<span class="go">::: h2 : X10 -&gt; X11</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.183</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> mem X11 c  /* suspended on X11 */ mem X11 b  /* suspended on X11 */</span>
<span class="go"> mem X11 a  /* suspended on X11 */</span>
<span class="go"> X10 is_subset [a, b, c]  /* suspended on X10 */</span>
<span class="go"> mem X9 d  /* suspended on X9 */ mem X9 b  /* suspended on X9 */</span>
<span class="go"> mem X9 a  /* suspended on X9 */ X8 is_subset [a, b, d]  /* suspended on X8 */</span>
<span class="go"> mem X7 a  /* suspended on X7 */ X6 is_subset [a]  /* suspended on X6 */</span>
<span class="go"> X11 is_subset X5  /* suspended on X11 */</span>
<span class="go"> X7 is_subset X10  /* suspended on X7 */ mem X6 a  /* suspended on X6 */</span>
<span class="go"> X9 is_subset X5  /* suspended on X9 */ X7 is_subset X8  /* suspended on X7 */</span>
<span class="go"> mem X6 a  /* suspended on X6 */ mem X5 a  /* suspended on X5 */</span>
<span class="go"> X4 is_subset [a, b, c]  /* suspended on X4 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/printer.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>print<span class="w"> </span>(p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>r<span class="w"> </span>x<span class="o">)</span><span class="kd">,</span>
<span class="linenos">3</span><span class="w">  </span>print<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span>f<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">mod</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span>print<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span>f<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">*</span><span class="w"> </span>g<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span>print<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="o">(</span>f<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">*</span><span class="w"> </span>g<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span>print<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span>f<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">^</span><span class="w"> </span>r<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">^</span><span class="w"> </span>g<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">7</span><span class="w">  </span>print<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span><span class="kd">||</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">&amp;&amp;</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">G</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">8</span><span class="w">  </span>print<span class="w"> </span><span class="kd">[</span>f<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>g<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span>(a<span class="w"> </span><span class="kd">,</span><span class="w"> </span>b<span class="o">)</span><span class="kd">,</span><span class="w"> </span>a<span class="w"> </span><span class="kd">+</span><span class="w"> </span>b<span class="kd">]</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant || has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant x has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant g has no declared type. Did you mean gc.get ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant ==&gt; has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: [suppressing 1 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Error: (r X) has type prop but is used with type int</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Error: (, (q X) (r x)) has type prop but is used with type (list prop)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: G is linear: name it _G (discard) or G_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/printer.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: B is linear: name it _B (discard) or B_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.158</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/queens.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% ?- queens(4, Qs).</span>
<span class="linenos"> 2</span><span class="c">%   produces</span>
<span class="linenos"> 3</span><span class="c">%   Qs = [3,1,4,2] ;</span>
<span class="linenos"> 4</span><span class="c">%   Qs = [2,4,1,3]</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c">% queens   +int  -[int]</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c">%%%%module queens.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c">%spy X :- print start X, X, print ok X.</span>
<span class="linenos">11</span><span class="c">%spy X :- print ko X, fail.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>
<span class="linenos">14</span>plus<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">15</span>plus<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">S</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>plus<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">S</span><span class="o">.</span>
<span class="linenos">16</span>
<span class="linenos">17</span>less<span class="w"> </span>zero<span class="w"> </span>(s<span class="w"> </span><span class="nv">_</span><span class="o">).</span>
<span class="linenos">18</span>less<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>less<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">19</span>
<span class="linenos">20</span>neq<span class="w"> </span>zero<span class="w"> </span>(s<span class="w"> </span><span class="nv">_</span><span class="o">).</span>
<span class="linenos">21</span>neq<span class="w"> </span>(s<span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span>zero<span class="o">.</span>
<span class="linenos">22</span>neq<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>neq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">23</span>
<span class="linenos">24</span>queens<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">Qs</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>range<span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">Ns</span><span class="kd">,</span><span class="w"> </span>queens_aux<span class="w"> </span><span class="nv">Ns</span><span class="w"> </span>xnil<span class="w"> </span><span class="nv">Qs</span><span class="o">.</span>
<span class="linenos">25</span>
<span class="linenos">26</span>queens_aux<span class="w"> </span>xnil<span class="w"> </span><span class="nv">Qs</span><span class="w"> </span><span class="nv">Qs</span><span class="o">.</span>
<span class="linenos">27</span>queens_aux<span class="w"> </span><span class="nv">UnplacedQs</span><span class="w"> </span><span class="nv">SafeQs</span><span class="w"> </span><span class="nv">Qs</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>
<span class="linenos">28</span><span class="w">        </span>select<span class="w"> </span><span class="nv">UnplacedQs</span><span class="w"> </span><span class="nv">UnplacedQs1</span><span class="w"> </span><span class="nv">Q</span><span class="kd">,</span>
<span class="linenos">29</span><span class="w">        </span>not_attack<span class="w"> </span><span class="nv">SafeQs</span><span class="w"> </span><span class="nv">Q</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">)</span><span class="kd">,</span>
<span class="linenos">30</span><span class="w">        </span>queens_aux<span class="w"> </span><span class="nv">UnplacedQs1</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">Q</span><span class="w"> </span><span class="nv">SafeQs</span><span class="o">)</span><span class="w"> </span><span class="nv">Qs</span><span class="o">.</span>
<span class="linenos">31</span>
<span class="linenos">32</span>
<span class="linenos">33</span>not_attack_aux<span class="w"> </span><span class="nv">Xs</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>not_attack<span class="w"> </span><span class="nv">Xs</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">).</span>
<span class="linenos">34</span>not_attack<span class="w"> </span>xnil<span class="w"> </span><span class="nv">DUMMY1</span><span class="w"> </span><span class="nv">DUMMY2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">35</span>not_attack<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Ys</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>plus<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">S1</span><span class="kd">,</span><span class="w"> </span>neq<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">S1</span><span class="kd">,</span><span class="w"> </span>
<span class="linenos">36</span><span class="w">                               </span>plus<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">S2</span><span class="kd">,</span><span class="w"> </span>neq<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">S2</span><span class="kd">,</span>
<span class="linenos">37</span><span class="w">                               </span><span class="nv">N1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>
<span class="linenos">38</span><span class="w">                               </span>not_attack<span class="w"> </span><span class="nv">Ys</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">N1</span><span class="o">.</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c">%select A B C :- print first_clause (select A B C), fail.</span>
<span class="linenos">41</span>select<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Xs</span><span class="o">)</span><span class="w"> </span><span class="nv">Xs</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">42</span><span class="c">%select A B C :- print backtrack (select A B C), fail.</span>
<span class="linenos">43</span>select<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Ys</span><span class="o">)</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Zs</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>select<span class="w"> </span><span class="nv">Ys</span><span class="w"> </span><span class="nv">Zs</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">44</span><span class="c">%select A B C :- print no_more_chances (select A B C), fail.</span>
<span class="linenos">45</span>
<span class="linenos">46</span>range<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">N</span><span class="w"> </span>xnil<span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">47</span>range<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">Ns</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>less<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="kd">,</span><span class="w"> </span><span class="nv">M1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(s<span class="w"> </span><span class="nv">M</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>range<span class="w"> </span><span class="nv">M1</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">Ns</span><span class="o">.</span>
<span class="linenos">48</span>
<span class="linenos">49</span>once<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>queens<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">))))</span><span class="w"> </span><span class="nv">L</span><span class="kd">,</span><span class="w"> </span>xxx<span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos">50</span>xxx<span class="w"> </span>(xcons<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">))</span><span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">))))</span><span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)</span><span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))</span><span class="w"> </span>xnil<span class="o">)))).</span>
<span class="linenos">51</span>
<span class="linenos">52</span>q<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>queens<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">))))</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos">53</span>
<span class="linenos">54</span>iter<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">55</span>iter<span class="w"> </span>(s<span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>iter<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">56</span>
<span class="linenos">57</span>mult<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span>zero<span class="o">.</span>
<span class="linenos">58</span>mult<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>mult<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="kd">,</span><span class="w"> </span>plus<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">59</span>
<span class="linenos">60</span>exp<span class="w"> </span>zero<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(s<span class="w"> </span>zero<span class="o">).</span>
<span class="linenos">61</span>exp<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>exp<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="kd">,</span><span class="w"> </span>mult<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos">62</span>
<span class="linenos">63</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">64</span><span class="w"> </span><span class="nv">TEN</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>s<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">)))))))))</span><span class="kd">,</span>
<span class="linenos">65</span><span class="w"> </span>exp<span class="w"> </span>(s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>zero<span class="o">))))</span><span class="w"> </span><span class="nv">TEN</span><span class="w"> </span><span class="nv">TENTHOUSAND</span><span class="kd">,</span>
<span class="linenos">66</span><span class="w"> </span>iter<span class="w"> </span><span class="nv">TENTHOUSAND</span><span class="w"> </span>once<span class="o">.</span>
<span class="linenos">67</span>
<span class="linenos">68</span><span class="c">% ----------------------------------------------------------</span>
<span class="linenos">69</span><span class="c">%queens(N,Qs) :- range(1,N,Ns), queens(Ns,[],Qs).</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="c">%queens([],Qs,Qs).</span>
<span class="linenos">72</span><span class="c">%queens(UnplacedQs,SafeQs,Qs) :-  select(UnplacedQs,UnplacedQs1,Q),</span>
<span class="linenos">73</span><span class="c">%             not_attack(SafeQs,Q), queens(UnplacedQs1,[Q|SafeQs],Qs).</span>
<span class="linenos">74</span>
<span class="linenos">75</span><span class="c">%not_attack(Xs,X) :- not_attack(Xs,X,1).</span>
<span class="linenos">76</span><span class="c">%not_attack([],_,_) :- !.</span>
<span class="linenos">77</span><span class="c">%not_attack([Y|Ys],X,N) :-X =\= Y+N,X =\= Y-N,N1 is N+1,not_attack(Ys,X,N1).</span>
<span class="linenos">78</span>
<span class="linenos">79</span><span class="c">%select([X|Xs],Xs,X).</span>
<span class="linenos">80</span><span class="c">%select([Y|Ys],[Y|Zs],X) :- select(Ys,Zs,X).</span>
<span class="linenos">81</span>
<span class="linenos">82</span><span class="c">%range(N,N,[N]) :- !.</span>
<span class="linenos">83</span><span class="c">%range(M,N,[M|Ns]) :- M &lt; N, M1 is M+1, range(M1,N,Ns).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 14, column 0, character 189:</span>
<span class="go"> Warning: constant zero has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 49, column 0, character 1240:</span>
<span class="go"> Warning: constant xxx has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 24, column 0, character 348:</span>
<span class="go"> Warning: constant xnil has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 27, column 0, character 431:</span>
<span class="go"> Warning: constant xcons has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 27, column 0, character 431:</span>
<span class="go"> Warning: constant select has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 15, column 0, character 204:</span>
<span class="go"> Warning:</span>
<span class="go"> constant s has no declared type. Did you mean std.spy std.spy! std.split-at std.spy-do! std.set.mem std.set.make std.set.add std.set.remove std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.cardinal std.set.elements std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.set std.set std.loc.set std.int.set std.string.set std.string.map gc.stat gc.set std.loc.set.cardinal std.loc.set.elements std.loc.set.subset std.loc.set.equal std.loc.set.diff std.loc.set.inter std.loc.set.union std.loc.set.remove std.loc.set.add std.loc.set.mem std.loc.set.empty std.int.set.cardinal std.int.set.elements std.int.set.subset std.int.set.equal std.int.set.diff std.int.set.inter std.int.set.union std.int.set.remove std.int.set.add std.int.set.mem std.int.set.empty std.string.set.cardinal std.string.set.elements std.string.set.subset std.string.set.equal std.string.set.diff std.string.set.inter std.string.set.union std.string.set.remove std.string.set.add std.string.set.mem std.string.set.empty std.string.map.bindings std.string.map.find std.string.map.remove std.string.map.add std.string.map.mem std.string.map.empty std.string.concat random.self_init rex.split ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 24, column 0, character 348:</span>
<span class="go"> Warning: constant range has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 24, column 0, character 348:</span>
<span class="go"> Warning: constant queens_aux has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 24, column 0, character 348:</span>
<span class="go"> Warning: constant queens has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 52, column 0, character 1389:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 14, column 0, character 189:</span>
<span class="go"> Warning: [suppressing 10 warnings]</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 34, column 0, character 649:</span>
<span class="go"> Warning:</span>
<span class="go"> DUMMY2 is linear: name it _DUMMY2 (discard) or DUMMY2_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 34, column 0, character 649:</span>
<span class="go"> Warning:</span>
<span class="go"> DUMMY1 is linear: name it _DUMMY1 (discard) or DUMMY1_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 54, column 0, character 1428:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 57, column 0, character 1471:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/queens.elpi&quot;, line 60, column 0, character 1532:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.176</span>

<span class="go">Success:</span>

<span class="go">Time: 2.648</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/quote_syntax.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>quote_syntax<span class="w"> </span><span class="s2">&quot;src/builtin.elpi&quot;</span><span class="w"> </span><span class="s2">&quot;main&quot;</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="nv">B</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/quote_syntax.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: A is linear: name it _A (discard) or A_ (fresh variable)</span>
<span class="go">clause File &quot;(quote_syntax): query&quot;, line 1, column 0, character 0: []</span>
<span class="go"> (const main)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.103</span>

<span class="go">Success:</span>

<span class="go">Time: 0.018</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/random.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>random.self_init<span class="kd">,</span>
<span class="linenos">3</span><span class="w">  </span>random.int<span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">R</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span>print<span class="w"> </span><span class="nv">R</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span><span class="nv">R</span><span class="w"> </span><span class="kd">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span><span class="nv">R</span><span class="w"> </span><span class="kd">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">3</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.109</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/reduce_cbn.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">%copy X Y :- print &quot;XXXXXXXXX&quot; (copy X Y), fail.</span>
<span class="linenos"> 2</span>copy<span class="w"> </span>(app<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span>(app<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">N2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">M2</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N2</span><span class="o">.</span>
<span class="linenos"> 3</span>copy<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c">%cbn X Y :- print &quot;XXXXXXXXX&quot; (cbn X Y), fail.</span>
<span class="linenos"> 6</span>cbn<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\cbn<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>cbn<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span><span class="w"> </span>
<span class="linenos"> 7</span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>subst<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span>cbn<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">M</span><span class="o">.</span>
<span class="linenos"> 8</span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>cbn<span class="w"> </span><span class="nv">M</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">R</span><span class="o">.</span>
<span class="linenos"> 9</span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(app<span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">Y2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>cbn<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X2</span><span class="kd">,</span><span class="w"> </span>cbn<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Y2</span><span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c">%subst F N B :- print &quot;XXXXXXXXX&quot; (subst F N B), fail.</span>
<span class="linenos">12</span>subst<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">B2</span><span class="w"> </span>x<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">B2</span><span class="w"> </span>x<span class="o">.</span>
<span class="linenos">13</span>
<span class="linenos">14</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">15</span><span class="w"> </span><span class="nv">ZERO</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>z<span class="o">)</span><span class="kd">,</span>
<span class="linenos">16</span><span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>app<span class="w"> </span>s<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>n<span class="w"> </span>s<span class="o">)</span><span class="w"> </span>z<span class="o">))</span><span class="kd">,</span>
<span class="linenos">17</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="nv">ZERO</span><span class="o">)</span><span class="w"> </span><span class="nv">ONE</span><span class="kd">,</span>
<span class="linenos">18</span><span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>n<span class="w"> </span>s<span class="o">)</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>m<span class="w"> </span>s<span class="o">)</span><span class="w"> </span>z<span class="o">))</span><span class="kd">,</span>
<span class="linenos">19</span><span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>app<span class="w"> </span>n<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>m<span class="w"> </span>s<span class="o">))</span><span class="kd">,</span>
<span class="linenos">20</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="nv">ZERO</span><span class="o">))</span><span class="w"> </span><span class="nv">TWO</span><span class="kd">,</span>
<span class="linenos">21</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">))</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">SIX</span><span class="kd">,</span>
<span class="linenos">22</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="nv">SIX</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWELVE</span><span class="kd">,</span>
<span class="linenos">23</span><span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>app<span class="w"> </span>n<span class="w"> </span>m<span class="o">)</span><span class="kd">,</span>
<span class="linenos">24</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">ONE</span><span class="o">)</span><span class="w"> </span><span class="nv">THREE</span><span class="kd">,</span>
<span class="linenos">25</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">THREE</span><span class="o">)</span><span class="w"> </span><span class="nv">NINE</span><span class="kd">,</span>
<span class="linenos">26</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">FOUR</span><span class="kd">,</span>
<span class="linenos">27</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">THREE</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">FOUR</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">SIX</span><span class="kd">,</span>
<span class="linenos">29</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">30</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">31</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">32</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">33</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">34</span><span class="w"> </span>cbn<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 7, column 0, character 285:</span>
<span class="go"> Warning: constant subst has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 3, column 0, character 101:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 2, column 0, character 49:</span>
<span class="go"> Warning: constant copy has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 6, column 0, character 211:</span>
<span class="go"> Warning: constant cbn has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 2, column 0, character 49:</span>
<span class="go"> Warning:</span>
<span class="go"> constant app has no declared type. Did you mean std.append std.appendR ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 14, column 0, character 563:</span>
<span class="go"> Warning: NINE is linear: name it _NINE (discard) or NINE_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbn.elpi&quot;, line 14, column 0, character 563:</span>
<span class="go"> Warning:</span>
<span class="go"> TWELVE is linear: name it _TWELVE (discard) or TWELVE_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.151</span>

<span class="go">Success:</span>

<span class="go">Time: 0.434</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/reduce_cbv.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>copy<span class="w"> </span>(app<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span>(app<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">N2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">M2</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N2</span><span class="o">.</span>
<span class="linenos"> 2</span>copy<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>cbv<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>cbv<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>cbv<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos"> 5</span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">N</span><span class="o">)</span><span class="w"> </span><span class="nv">R2</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 6</span><span class="w"> </span>cbv<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N2</span><span class="kd">,</span>
<span class="linenos"> 7</span><span class="w"> </span>cbv<span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">M2</span><span class="kd">,</span>
<span class="linenos"> 8</span><span class="w"> </span>beta<span class="w"> </span><span class="nv">M2</span><span class="w"> </span><span class="nv">N2</span><span class="w"> </span><span class="nv">R2</span><span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>beta<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">R2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">11</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span><span class="o">(</span><span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="nv">R&#39;</span><span class="w"> </span>x<span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">R&#39;</span><span class="w"> </span>x<span class="o">)</span><span class="kd">,</span>
<span class="linenos">12</span><span class="w"> </span>cbv<span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="nv">R2</span><span class="o">.</span>
<span class="linenos">13</span>beta<span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>(app<span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos">14</span>
<span class="linenos">15</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">16</span><span class="w"> </span><span class="nv">ZERO</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>z<span class="o">)</span><span class="kd">,</span>
<span class="linenos">17</span><span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>app<span class="w"> </span>s<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>n<span class="w"> </span>s<span class="o">)</span><span class="w"> </span>z<span class="o">))</span><span class="kd">,</span>
<span class="linenos">18</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="nv">ZERO</span><span class="o">)</span><span class="w"> </span><span class="nv">ONE</span><span class="kd">,</span>
<span class="linenos">19</span><span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">z\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>n<span class="w"> </span>s<span class="o">)</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>m<span class="w"> </span>s<span class="o">)</span><span class="w"> </span>z<span class="o">))</span><span class="kd">,</span>
<span class="linenos">20</span><span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">s\</span><span class="w"> </span>app<span class="w"> </span>n<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>m<span class="w"> </span>s<span class="o">))</span><span class="kd">,</span>
<span class="linenos">21</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">SUCC</span><span class="w"> </span><span class="nv">ZERO</span><span class="o">))</span><span class="w"> </span><span class="nv">TWO</span><span class="kd">,</span>
<span class="linenos">22</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">))</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">SIX</span><span class="kd">,</span>
<span class="linenos">23</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="nv">SIX</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWELVE</span><span class="kd">,</span>
<span class="linenos">24</span><span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">n\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">m\</span><span class="w"> </span>app<span class="w"> </span>n<span class="w"> </span>m<span class="o">)</span><span class="kd">,</span>
<span class="linenos">25</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">ONE</span><span class="o">)</span><span class="w"> </span><span class="nv">THREE</span><span class="kd">,</span>
<span class="linenos">26</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">THREE</span><span class="o">)</span><span class="w"> </span><span class="nv">NINE</span><span class="kd">,</span>
<span class="linenos">27</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">MULT</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">FOUR</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">THREE</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="kd">,</span>
<span class="linenos">29</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">PLUS</span><span class="w"> </span><span class="nv">FOUR</span><span class="o">)</span><span class="w"> </span><span class="nv">TWO</span><span class="o">)</span><span class="w"> </span><span class="nv">SIX</span><span class="kd">,</span>
<span class="linenos">30</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">31</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">32</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">33</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">34</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="kd">,</span>
<span class="linenos">35</span><span class="w"> </span>cbv<span class="w"> </span>(app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">FIVE</span><span class="o">)</span><span class="w"> </span><span class="nv">RES</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 2, column 0, character 52:</span>
<span class="go"> Warning: constant lam has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant copy has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 4, column 0, character 115:</span>
<span class="go"> Warning: constant cbv has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 5, column 0, character 186:</span>
<span class="go"> Warning: constant beta has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant app has no declared type. Did you mean std.append std.appendR ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 15, column 0, character 351:</span>
<span class="go"> Warning: NINE is linear: name it _NINE (discard) or NINE_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/reduce_cbv.elpi&quot;, line 15, column 0, character 351:</span>
<span class="go"> Warning:</span>
<span class="go"> TWELVE is linear: name it _TWELVE (discard) or TWELVE_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.144</span>

<span class="go">Success:</span>

<span class="go">Time: 2.768</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/restriction.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% main should fail.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction.elpi&quot;, line 3, column 0, character 21:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.102</span>
</pre></div>
</div>
<p><strong>../../tests/sources/restriction3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">type</span><span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="kt">prop</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos"> 2</span>mode<span class="w"> </span>(if<span class="w"> </span>i<span class="w"> </span>i<span class="w"> </span>i<span class="o">).</span>
<span class="linenos"> 3</span>if<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">B</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos"> 4</span>if<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">E</span><span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kd">type</span><span class="w"> </span><span class="nf">debug-print</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos"> 7</span>debug-print<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">pred</span><span class="w"> </span><span class="nf">spy</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">prop</span>.
<span class="linenos">10</span>spy<span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>counter<span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="w"> </span><span class="nv">NR</span><span class="kd">,</span><span class="w"> </span>if<span class="w"> </span>(not<span class="o">(</span><span class="nv">NR</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="mi">0</span><span class="o">))</span><span class="w"> </span>(debug-print<span class="w"> </span><span class="s2">&quot;run=&quot;</span><span class="w"> </span><span class="nv">NR</span><span class="o">)</span><span class="w"> </span>true<span class="kd">,</span>
<span class="linenos">11</span><span class="w">         </span>debug-print<span class="w"> </span><span class="s2">&quot;----&lt;&lt;---- enter: &quot;</span><span class="w"> </span><span class="nv">P</span><span class="kd">,</span>
<span class="linenos">12</span><span class="w">         </span><span class="nv">P</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">13</span><span class="w">         </span>debug-print<span class="w"> </span><span class="s2">&quot;----&gt;&gt;---- exit: &quot;</span><span class="w"> </span><span class="nv">P</span><span class="o">.</span>
<span class="linenos">14</span>spy<span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>debug-print<span class="w"> </span><span class="s2">&quot;----&gt;&gt;---- fail: &quot;</span><span class="w"> </span><span class="nv">P</span><span class="kd">,</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="kd">type</span><span class="w"> </span><span class="nf">lam</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos">17</span>
<span class="linenos">18</span>foo<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">19</span><span class="w">  </span>spy(<span class="nv">A</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">i\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">j\</span><span class="w"> </span><span class="nv">X_</span><span class="w"> </span>i<span class="w"> </span>j<span class="o">)</span><span class="kd">,</span>
<span class="linenos">20</span><span class="w">  </span>spy(<span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">i\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">j\</span><span class="w"> </span><span class="nv">Y_</span><span class="w"> </span>i<span class="w"> </span>j<span class="o">)</span><span class="kd">,</span>
<span class="linenos">21</span><span class="w">  </span>spy(<span class="nv">A</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">i\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">j\</span><span class="w"> </span>i<span class="o">)</span><span class="kd">,</span>
<span class="linenos">22</span><span class="w">  </span>spy(<span class="nv">B</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">i\</span><span class="w"> </span>lam<span class="w"> </span><span class="nv">j\</span><span class="w"> </span>i<span class="o">).</span>
<span class="linenos">23</span>
<span class="linenos">24</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>foo<span class="w"> </span>(<span class="nv">A_</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="nv">B_</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction3.elpi&quot;, line 18, column 0, character 442:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">----&lt;&lt;---- enter:  X0 c0 = lam c1 \ lam c2 \ X1^1 c1 c2</span>
<span class="go">----&gt;&gt;---- exit:  lam c1 \ lam c2 \ X1^1 c1 c2 = lam c1 \ lam c2 \ X1^1 c1 c2</span>
<span class="go">----&lt;&lt;---- enter:  X2 = lam c1 \ lam c2 \ X3^1 c1 c2</span>
<span class="go">----&gt;&gt;---- exit:  lam c1 \ lam c2 \ X4 c1 c2 = lam c1 \ lam c2 \ X4 c1 c2</span>
<span class="go">----&lt;&lt;---- enter:  lam c1 \ lam c2 \ X1^1 c1 c2 = lam c1 \ lam c2 \ c1</span>
<span class="go">----&gt;&gt;---- exit:  lam c1 \ lam c2 \ c1 = lam c1 \ lam c2 \ c1</span>
<span class="go">----&lt;&lt;---- enter:  lam c1 \ lam c2 \ X4 c1 c2 = lam c1 \ lam c2 \ c1</span>
<span class="go">----&gt;&gt;---- exit:  lam c1 \ lam c2 \ c1 = lam c1 \ lam c2 \ c1</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.107</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/restriction4.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">    </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">Y Z</span>\<span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\
<span class="linenos">3</span><span class="w">      </span>std.spy(<span class="nv">X</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=</span><span class="w"> </span>f<span class="w"> </span><span class="o">(</span><span class="nv">Y</span><span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">e\</span><span class="w"> </span><span class="o">(</span><span class="nv">Z</span><span class="w"> </span>y<span class="w"> </span>e<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction4.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction4.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">----&lt;&lt;---- enter:  X0 c0 = f (X1^1 c1) c2 \ X2^1 c1 c2</span>
<span class="go">----&gt;&gt;---- exit:  f (X3 c0) c2 \ X4 c0 c2 = f (X3 c0) c2 \ X4 c0 c2</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.107</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/restriction5.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x y z u w</span>\
<span class="linenos">3</span><span class="w">    </span>std.spy(<span class="nv">X</span><span class="w"> </span>x<span class="w"> </span>y<span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>u<span class="w"> </span>w<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">----&lt;&lt;---- enter:  X0 c0 c1 = X0 c3 c4</span>
<span class="go">----&gt;&gt;---- exit:  X1 = X1</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.102</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/restriction6.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">Y</span>\<span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">y</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">Z</span>\
<span class="linenos">3</span><span class="w">      </span>std.spy(<span class="nv">X</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=</span><span class="w"> </span>f<span class="w"> </span><span class="o">(</span><span class="nv">Y</span><span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">l\e\</span><span class="w"> </span><span class="o">(</span><span class="nv">Z</span><span class="w"> </span>e<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction6.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant f has no declared type. Did you mean std.forall std.fatal-error std.fatal-error-w-data std.fold std.fold2 std.fold-map std.forall-ok std.forall2 std.filter std.flatten std.flip std.findall std.map.find std.map.private.find gc.full std.loc.map.find std.int.map.find std.string.map.find loc.fields ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/restriction6.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">----&lt;&lt;---- enter:  X0 c0 = f (X1^1 c1) c2 \ c3 \ X2^2 c3</span>
<span class="go">----&gt;&gt;---- exit:  f (X3 c0) c2 \ c3 \ X4^1 c3 = f (X3 c0) c2 \ c3 \ X4^1 c3</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.112</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/rev.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% X10:</span>
<span class="linenos"> 2</span><span class="c">%   yap                                     0.027s</span>
<span class="linenos"> 3</span><span class="c">%   elpi                                    3.771s</span>
<span class="linenos"> 4</span><span class="c">%   one level index hashtbl                 0.528s</span>
<span class="linenos"> 5</span><span class="c">%   two level inefficient index             0.681s</span>
<span class="linenos"> 6</span><span class="c">%   one level index hashtbl + automatic GC  0.899s</span>
<span class="linenos"> 7</span><span class="c">%   one lvl hashtbl + flat + automatic GC   0.763s</span>
<span class="linenos"> 8</span><span class="c">%   one lvl hashtbl + flat                  0.629s</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c">% X13:</span>
<span class="linenos">12</span><span class="c">%   yap                          0.083s</span>
<span class="linenos">13</span><span class="c">%   elpi                        10.068s</span>
<span class="linenos">14</span><span class="c">%   one level index hashtbl      3.90s</span>
<span class="linenos">15</span><span class="c">%   two level inefficient index  4.48s</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c">% X14:</span>
<span class="linenos">18</span><span class="c">%   ocamlopt                     0.014s</span>
<span class="linenos">19</span><span class="c">%   ocamlc                       0.024s</span>
<span class="linenos">20</span><span class="c">%   yap                          0.033s</span>
<span class="linenos">21</span><span class="c">%   teyjus                       0.257s</span>
<span class="linenos">22</span><span class="c">%   elpi                         4.72s (setting ulimit -s 81920)</span>
<span class="linenos">23</span><span class="c">%                                newlazy  lazy   eager   with formula       with terms</span>
<span class="linenos">24</span><span class="c">%   no index                     2.90s  3.85s  4.74s   4.49s              4.28s</span>
<span class="linenos">25</span><span class="c">%   one level index hashtbl      2.51s  2.37s  2.35s   2.29s              2.28s</span>
<span class="linenos">26</span><span class="c">%   two level inefficient index  1.78s  2.19s  3.00s   2.30s              2.34s</span>
<span class="linenos">27</span><span class="c">%   one level hashtbl + auto GC  3.78s  3.97s  4.67s   3.39s              3.88s</span>
<span class="linenos">28</span><span class="c">%   one lvl hash+flat+ auto GC   3.10s  3.22s  3.40s   3.38s              3.14s</span>
<span class="linenos">29</span><span class="c">%   one lvl hashtbl + flat              2.42s  2.43s   2.64s              2.27s</span>
<span class="linenos">30</span><span class="c">%   one lvl hash+ flat + man GC         2.99s  2.80s   2.83s              2.37s</span>
<span class="linenos">31</span><span class="c">%   one lvl index map main       2.61s  2.44s  2.60s   2.40s              2.18s</span>
<span class="linenos">32</span><span class="c">%I  one lvl hashtbl              0.72s  0.61s  -----   0.63s              0.57s</span>
<span class="linenos">33</span><span class="c">%I  two lvl efficient index      0.36s  0.55s  0.62s</span>
<span class="linenos">34</span><span class="c">%II two lvl inefficient index    0.70s</span>
<span class="linenos">35</span><span class="c">%I  desperate two lvl effici     0.19s</span>
<span class="linenos">36</span><span class="c">%I  desperate.ml                 0.11s  0.14s</span>
<span class="linenos">37</span><span class="c">%I  desperate2.ml                0.11s</span>
<span class="linenos">38</span><span class="c">%I  desperate3.ml                0.12s</span>
<span class="linenos">39</span>
<span class="linenos">40</span>rev<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">RL</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>aux<span class="w"> </span><span class="nv">L</span><span class="w"> </span>xnil<span class="w">  </span><span class="nv">RL</span><span class="w"> </span><span class="o">.</span>
<span class="linenos">41</span>aux<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w">  </span><span class="nv">ACC</span><span class="w">  </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>aux<span class="w"> </span><span class="nv">XS</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">ACC</span><span class="o">)</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="o">.</span><span class="w"> </span>
<span class="linenos">42</span>aux<span class="w"> </span>xnil<span class="w">  </span><span class="nv">L</span><span class="w">  </span><span class="nv">L</span><span class="w"> </span><span class="o">.</span>
<span class="linenos">43</span>
<span class="linenos">44</span>append<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>append<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="o">.</span>
<span class="linenos">45</span>append<span class="w"> </span>xnil<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="o">.</span>
<span class="linenos">46</span>
<span class="linenos">47</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">48</span><span class="w">    </span><span class="nv">X1</span><span class="w"> </span><span class="kd">=</span><span class="w">  </span>(xcons<span class="w"> </span>x1<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x2<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x3<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x4<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x5<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x6<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x7<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x8<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x9<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x10<span class="w"> </span>xnil<span class="o">))))))))))</span><span class="kd">,</span>
<span class="linenos">49</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X2</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">50</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X3</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">51</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X4</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">52</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X5</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">53</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X6</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">54</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="nv">X7</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">55</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X7</span><span class="w"> </span><span class="nv">X7</span><span class="w"> </span><span class="nv">X8</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">56</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X8</span><span class="w"> </span><span class="nv">X8</span><span class="w"> </span><span class="nv">X9</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">57</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X9</span><span class="w"> </span><span class="nv">X9</span><span class="w"> </span><span class="nv">X10</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">58</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X10</span><span class="w"> </span><span class="nv">X10</span><span class="w"> </span><span class="nv">X11</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">59</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X11</span><span class="w"> </span><span class="nv">X11</span><span class="w"> </span><span class="nv">X12</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">60</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X12</span><span class="w"> </span><span class="nv">X12</span><span class="w"> </span><span class="nv">X13</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">61</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X13</span><span class="w"> </span><span class="nv">X13</span><span class="w"> </span><span class="nv">X14</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">62</span><span class="w">   </span><span class="c">% append X14 X14 X15  ,</span>
<span class="linenos">63</span><span class="w">   </span><span class="c">% append X15 X15 X16  ,</span>
<span class="linenos">64</span><span class="w">   </span><span class="c">% append X16 X16 X17  ,</span>
<span class="linenos">65</span><span class="w">   </span><span class="c">% append X17 X17 X18  ,</span>
<span class="linenos">66</span><span class="w">   </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X14</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">67</span><span class="w">   </span>rev<span class="w"> </span><span class="nv">X</span><span class="w">  </span><span class="nv">Y</span><span class="kd">,</span><span class="w">   </span>rev<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 40, column 0, character 1827:</span>
<span class="go"> Warning: constant xnil has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 41, column 0, character 1857:</span>
<span class="go"> Warning: constant xcons has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x9 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x8 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x7 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x6 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x5 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x4 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: constant x2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev.elpi&quot;, line 47, column 0, character 2004:</span>
<span class="go"> Warning: [suppressing 17 warnings]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.156</span>

<span class="go">Success:</span>

<span class="go">Time: 0.206</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/rev14.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>rev<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">RL</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>aux<span class="w"> </span><span class="nv">L</span><span class="w"> </span>xnil<span class="w">  </span><span class="nv">RL</span><span class="o">.</span>
<span class="linenos"> 2</span>aux<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w">  </span><span class="nv">ACC</span><span class="w">  </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>aux<span class="w"> </span><span class="nv">XS</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">ACC</span><span class="o">)</span><span class="w"> </span><span class="nv">R</span><span class="o">.</span>
<span class="linenos"> 3</span>aux<span class="w"> </span>xnil<span class="w">  </span><span class="nv">L</span><span class="w">  </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>append<span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XS</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span>(xcons<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w">  </span><span class="kd">:-</span><span class="w"> </span>append<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 6</span>append<span class="w"> </span>xnil<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nv">X1</span><span class="w"> </span><span class="kd">=</span><span class="w">  </span>(xcons<span class="w"> </span>x1<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x2<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x3<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x4<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x5<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x6<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x7<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x8<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x9<span class="w"> </span><span class="o">(</span>xcons<span class="w"> </span>x10<span class="w"> </span>xnil<span class="o">))))))))))</span><span class="kd">,</span>
<span class="linenos">10</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X2</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">11</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">X3</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">12</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="nv">X4</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">13</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="nv">X5</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">14</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X6</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">15</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="nv">X6</span><span class="w"> </span><span class="nv">X7</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">16</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X7</span><span class="w"> </span><span class="nv">X7</span><span class="w"> </span><span class="nv">X8</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">17</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X8</span><span class="w"> </span><span class="nv">X8</span><span class="w"> </span><span class="nv">X9</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">18</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X9</span><span class="w"> </span><span class="nv">X9</span><span class="w"> </span><span class="nv">X10</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">19</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X10</span><span class="w"> </span><span class="nv">X10</span><span class="w"> </span><span class="nv">X11</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">20</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X11</span><span class="w"> </span><span class="nv">X11</span><span class="w"> </span><span class="nv">X12</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">21</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X12</span><span class="w"> </span><span class="nv">X12</span><span class="w"> </span><span class="nv">X13</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">22</span><span class="w">   </span>append<span class="w"> </span><span class="nv">X13</span><span class="w"> </span><span class="nv">X13</span><span class="w"> </span><span class="nv">X14</span><span class="w">  </span><span class="kd">,</span>
<span class="linenos">23</span><span class="w">   </span><span class="c">% append X14 X14 X15  ,</span>
<span class="linenos">24</span><span class="w">   </span><span class="c">% append X15 X15 X16  ,</span>
<span class="linenos">25</span><span class="w">   </span><span class="c">% append X16 X16 X17  ,</span>
<span class="linenos">26</span><span class="w">   </span><span class="c">% append X17 X17 X18  ,</span>
<span class="linenos">27</span><span class="w">   </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X14</span><span class="w"> </span><span class="kd">,</span>
<span class="linenos">28</span><span class="w">   </span>rev<span class="w"> </span><span class="nv">X</span><span class="w">  </span><span class="nv">Y</span><span class="kd">,</span><span class="w">   </span>rev<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant xnil has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 2, column 0, character 29:</span>
<span class="go"> Warning: constant xcons has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x9 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x8 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x7 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x6 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x5 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x4 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x3 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: constant x2 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/rev14.elpi&quot;, line 8, column 0, character 171:</span>
<span class="go"> Warning: [suppressing 17 warnings]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.155</span>

<span class="go">Success:</span>

<span class="go">Time: 0.198</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/same_term.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="kd">==</span><span class="w"> </span><span class="mi">3</span><span class="kd">,</span>
<span class="linenos">3</span><span class="w">  </span>not(<span class="kd">[</span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">_</span><span class="kd">]</span><span class="w"> </span><span class="kd">==</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="kd">]</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span>not(<span class="nv">X</span><span class="w"> </span><span class="kd">==</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span>(<span class="nv">x\</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="kd">==</span><span class="w"> </span>(<span class="nv">y\</span><span class="w"> </span>y<span class="o">)</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span><span class="nv">ID</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(<span class="nv">x\</span>x<span class="o">)</span><span class="kd">,</span>
<span class="linenos">7</span><span class="w">  </span>(<span class="nv">ID</span><span class="w"> </span><span class="mi">3</span><span class="o">)</span><span class="w"> </span><span class="kd">==</span><span class="w"> </span>(<span class="nv">ID</span><span class="w"> </span><span class="mi">3</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">8</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span>same_var<span class="w"> </span>(<span class="nv">X</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">X</span><span class="w"> </span>y<span class="o">)</span><span class="kd">,</span><span class="w"> </span>not(same_term<span class="w"> </span><span class="o">(</span><span class="nv">X</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="nv">X</span><span class="w"> </span>y<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.102</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/self_assignment.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c">% main should succeed</span>
<span class="linenos">2</span>
<span class="linenos">3</span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">c</span>\<span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>d<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/self_assignment.elpi&quot;, line 3, column 0, character 23:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/self_assignment.elpi&quot;, line 5, column 0, character 33:</span>
<span class="go"> Warning:</span>
<span class="go"> constant d has no declared type. Did you mean std.debug-print std.drop std.drop-last std.do! std.do-ok! std.loc.set.diff std.int.set.diff std.string.set.diff ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/self_assignment.elpi&quot;, line 3, column 0, character 23:</span>
<span class="go"> Warning: A is linear: name it _A (discard) or A_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.116</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/set.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">build</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">std.set</span><span class="w"> </span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">std.set</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos"> 2</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 3</span>build<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos"> 5</span><span class="w">  </span>std.set.add<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XR</span><span class="kd">,</span>
<span class="linenos"> 6</span><span class="w">  </span>build<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">XR</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>.
<span class="linenos"> 9</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">10</span>test<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">11</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">12</span><span class="w">  </span>std.assert!<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="kd">,</span>
<span class="linenos">13</span><span class="w">  </span>test<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="kd">pred</span><span class="w"> </span><span class="nf">test2</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">(B</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop)</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">A</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">A</span>.
<span class="linenos">16</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">17</span>test2<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">18</span><span class="w">  </span><span class="nv">N1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span>
<span class="linenos">19</span><span class="w">  </span><span class="nv">F</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="kd">,</span>
<span class="linenos">20</span><span class="w">  </span>test2<span class="w"> </span><span class="nv">N1</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">R</span><span class="o">.</span>
<span class="linenos">21</span>
<span class="linenos">22</span>macro<span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="mi">4096</span><span class="o">.</span>
<span class="linenos">23</span>
<span class="linenos">24</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">25</span><span class="w">  </span>std.time<span class="w"> </span>(build<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>{std.set.make<span class="w"> </span>cmp_term} <span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time0</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">26</span><span class="w">  </span>std.time<span class="w"> </span>(test<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>std.set.mem<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">Time1</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">27</span><span class="w">  </span>std.set.elements<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">L</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w">  </span>std.assert!<span class="w"> </span>({std.length<span class="w"> </span><span class="nv">L</span>} <span class="kd">=</span><span class="w"> </span><span class="kd">@</span>iters<span class="kd">,</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="mi">0</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;elements broken&quot;</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">29</span><span class="w">  </span>std.time<span class="w"> </span>(test2<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kd">@</span>iters<span class="w"> </span>std.set.remove<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">E</span><span class="o">)</span><span class="w"> </span><span class="nv">Time2</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span>
<span class="linenos">30</span><span class="w">  </span>std.assert!<span class="w"> </span>(std.set.cardinal<span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;not empty&quot;</span><span class="kd">,</span>
<span class="linenos">31</span><span class="w">  </span>print<span class="w"> </span><span class="nv">Time0</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time1</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="w"> </span><span class="nv">Time2</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1.817831 + 0.065527 + 1.350947</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.111</span>

<span class="go">Success:</span>

<span class="go">Time: 3.410</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">namespace</span><span class="w"> </span>b<span class="w"> </span>{
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>foo<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos"> 4</span>baz<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="kd">namespace</span><span class="w"> </span>bar<span class="w"> </span>{
<span class="linenos"> 7</span><span class="w">  </span>
<span class="linenos"> 8</span><span class="w">  </span>baz<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">  </span>}
<span class="linenos">11</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="kd">shorten</span><span class="w"> </span>bar.{ baz<span class="w"> </span>}.
<span class="linenos">14</span>
<span class="linenos">15</span>}
<span class="linenos">16</span>
<span class="linenos">17</span><span class="kd">namespace</span><span class="w"> </span>a<span class="w"> </span>{
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">  </span><span class="kd">shorten</span><span class="w"> </span>b.{ foo<span class="w"> </span>}.
<span class="linenos">20</span><span class="w">  </span><span class="kd">shorten</span><span class="w"> </span>b.bar.{ baz<span class="w"> </span>}.
<span class="linenos">21</span><span class="w">  </span>
<span class="linenos">22</span><span class="w">  </span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo<span class="kd">,</span><span class="w"> </span>b.foo<span class="kd">,</span><span class="w"> </span>baz<span class="kd">,</span><span class="w"> </span>bar.baz<span class="kd">,</span><span class="w"> </span>b.bar.baz<span class="o">.</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">  </span>bar.baz<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="kd">shorten</span><span class="w"> </span>b.{ baz<span class="w"> </span>}.
<span class="linenos">27</span><span class="w">  </span>
<span class="linenos">28</span><span class="w">  </span>baz<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos">29</span><span class="w">  </span>bar.baz<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>baz<span class="o">.</span>
<span class="linenos">30</span>
<span class="linenos">31</span>}
<span class="linenos">32</span>
<span class="linenos">33</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>a.main<span class="o">.</span><span class="w"> </span>
<span class="linenos">34</span><span class="w">       </span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten.elpi&quot;, line 4, column 0, character 16:</span>
<span class="go"> Warning: constant b.foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten.elpi&quot;, line 5, column 0, character 29:</span>
<span class="go"> Warning: constant b.baz has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten.elpi&quot;, line 9, column 3, character 67:</span>
<span class="go"> Warning: constant b.bar.baz has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten.elpi&quot;, line 23, column 3, character 177:</span>
<span class="go"> Warning: constant a.main has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten.elpi&quot;, line 23, column 3, character 177:</span>
<span class="go"> Warning: constant a.bar.baz has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.139</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">accumulate</span><span class="w"> </span>shorten_aux<span class="kd">,</span><span class="w"> </span>shorten_aux2<span class="o">.</span>
<span class="linenos">2</span>
<span class="linenos">3</span>foo<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">6</span><span class="w">  </span>foo<span class="kd">,</span><span class="w"> </span>bar<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant bar has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux.elpi&quot;, line 2, column 3, character 17:</span>
<span class="go"> Warning: constant a.foo has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.001</span>

<span class="go">Typechecking time: 0.127</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten_aux.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">namespace</span><span class="w"> </span>a<span class="w"> </span>{
<span class="linenos">2</span><span class="w">  </span>foo<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos">3</span>}
<span class="linenos">4</span>
<span class="linenos">5</span><span class="kd">shorten</span><span class="w"> </span>a.{ foo<span class="w"> </span>}.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux.elpi&quot;, line 2, column 3, character 17:</span>
<span class="go"> Warning: constant a.foo has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.105</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten_aux2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>bar<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_aux2.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant bar has no declared type.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.119</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten_builtin.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">shorten</span><span class="w"> </span>std.string.set.{ empty<span class="w"> </span>}.
<span class="linenos">2</span>
<span class="linenos">3</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">4</span><span class="w">  </span>print<span class="w"> </span>{empty}.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{{  }}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.110</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/shorten_trie.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>std.list.map _ _.
<span class="linenos">2</span>std.string.concat1 _ _ _.
<span class="linenos">3</span>std.string.escape _ _.
<span class="linenos">4</span>
<span class="linenos">5</span>shorten std.{list.map, string.{ concat1, escape }}.
<span class="linenos">6</span>
<span class="linenos">7</span>main :- list.map F [], concat1 &quot;a&quot; &quot;b&quot; AB, escape &quot;x y&quot; E.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 3, column 0, character 44:</span>
<span class="go"> Warning: constant std.string.escape has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 2, column 0, character 18:</span>
<span class="go"> Warning: constant std.string.concat1 has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant std.list.map has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 7, column 0, character 121:</span>
<span class="go"> Warning: E is linear: name it _E (discard) or E_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 7, column 0, character 121:</span>
<span class="go"> Warning: AB is linear: name it _AB (discard) or AB_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/shorten_trie.elpi&quot;, line 7, column 0, character 121:</span>
<span class="go"> Warning: F is linear: name it _F (discard) or F_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.125</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/spill_and.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>kind term type.
<span class="linenos"> 2</span>type app term -&gt; term -&gt; term.
<span class="linenos"> 3</span>type lam (term -&gt; term) -&gt; term.
<span class="linenos"> 4</span>type t term.
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>pred copy i:term, o:term.
<span class="linenos"> 7</span>copy (app A B) (app A1 B1) :- copy A A1, copy B B1.
<span class="linenos"> 8</span>copy (lam F) (lam F1) :- pi x\ copy (F x) (F1 x).
<span class="linenos"> 9</span>% we omit (copy x x) on purpose
<span class="linenos">10</span>
<span class="linenos">11</span>main :-
<span class="linenos">12</span>  T = (lam x\ {copy x t =&gt; ((A x) = x, copy (app (A x) x))}),
<span class="linenos">13</span>  print T,
<span class="linenos">14</span>  T = (lam _\ app t t). 
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">lam c0 \ app t t</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.106</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/spill_impl.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>kind term type.
<span class="linenos"> 2</span>type app term -&gt; term -&gt; term.
<span class="linenos"> 3</span>type lam (term -&gt; term) -&gt; term.
<span class="linenos"> 4</span>type t term.
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>pred copy i:term, o:term.
<span class="linenos"> 7</span>copy (app A B) (app A1 B1) :- copy A A1, copy B B1.
<span class="linenos"> 8</span>copy (lam F) (lam F1) :- pi x\ copy (F x) (F1 x).
<span class="linenos"> 9</span>% we omit (copy x x) on purpose
<span class="linenos">10</span>
<span class="linenos">11</span>main :-
<span class="linenos">12</span>  T = (lam x\ {copy x t =&gt; copy (app x x)}),
<span class="linenos">13</span>  print T,
<span class="linenos">14</span>  T = (lam _\ app t t). 
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">lam c0 \ app t t</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.098</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/spill_lam.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">pp</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">string</span>.
<span class="linenos">2</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">x\</span><span class="w"> </span>print<span class="w"> </span>{pp<span class="w"> </span>x}.
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/spill_lam.elpi&quot;, line 2, column 0, character 25:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.115</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trace.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="mi">3</span><span class="o">.</span>
<span class="linenos">2</span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
<span class="linenos">3</span>p<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">6</span><span class="w">  </span>p<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">;</span><span class="w"> </span>p<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">Y</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trace.elpi&quot;, line 2, column 0, character 1:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trace.elpi&quot;, line 6, column 0, character 60:</span>
<span class="go"> Warning: Y is linear: name it _Y (discard) or Y_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trace.elpi&quot;, line 6, column 0, character 60:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.115</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trace2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>print<span class="w"> </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">Y</span>\<span class="w"> </span>fail<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span><span class="o">(</span>true<span class="kd">,</span><span class="w"> </span>fail<span class="o">)).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.099</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trace_chr.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">even odd </span>{
<span class="linenos"> 2</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(even<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(odd<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(odd<span class="w"> </span>z<span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>true<span class="o">.</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(even<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(odd<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(odd<span class="w"> </span><span class="o">(</span>s<span class="w"> </span>z<span class="o">))</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 4</span>}
<span class="linenos"> 5</span><span class="kd">kind</span><span class="w"> </span><span class="nf">nat</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 6</span><span class="kd">type</span><span class="w"> </span><span class="nf">s</span><span class="w"> </span><span class="kt">nat</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">nat</span>.
<span class="linenos"> 7</span><span class="kd">type</span><span class="w"> </span><span class="nf">z</span><span class="w"> </span><span class="kt">nat</span>.
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">pred</span><span class="w"> </span><span class="nf">even</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">nat</span>.
<span class="linenos">10</span><span class="kd">pred</span><span class="w"> </span><span class="nf">odd</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">nat</span>.
<span class="linenos">11</span>even<span class="w"> </span>z<span class="o">.</span>
<span class="linenos">12</span>
<span class="linenos">13</span>odd<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>even<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">14</span>even<span class="w"> </span>(s<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>odd<span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">15</span>
<span class="linenos">16</span>even<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>declare_constraint<span class="w"> </span>(even<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">17</span>odd<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>declare_constraint<span class="w"> </span>(odd<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">18</span>
<span class="linenos">19</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">20</span><span class="w">  </span>even<span class="w"> </span><span class="nv">Z</span><span class="kd">,</span>
<span class="linenos">21</span><span class="w">  </span>declare_constraint<span class="w"> </span>true<span class="w"> </span><span class="nv">Z</span><span class="kd">,</span>
<span class="linenos">22</span><span class="w">  </span><span class="nv">Z</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>s<span class="w"> </span><span class="nv">W</span><span class="kd">,</span>
<span class="linenos">23</span><span class="w">  </span>not(even<span class="w"> </span><span class="nv">W</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.107</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> odd X0  /* suspended on X0 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trace_cut.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">pred</span><span class="w"> </span><span class="nf">p</span>.
<span class="linenos"> 2</span>p<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 3</span>p<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>fail<span class="o">.</span>
<span class="linenos"> 4</span>p<span class="o">.</span>
<span class="linenos"> 5</span>p<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kd">pred</span><span class="w"> </span><span class="nf">q</span>.
<span class="linenos"> 8</span>q<span class="o">.</span>
<span class="linenos"> 9</span>q<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="o">.</span>
<span class="linenos">12</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>q<span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>q<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>(q<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>q<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.106</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trace_findall.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>p<span class="w"> </span><span class="mi">1</span><span class="o">.</span>
<span class="linenos">2</span>p<span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">3</span>p<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="w"> </span><span class="mi">2</span><span class="o">.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">6</span><span class="w">  </span>std.findall<span class="w"> </span>(p<span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="nv">L</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trace_findall.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">[p 1, p 2, p 3]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.106</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/trail.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% Query: p X Z.</span>
<span class="linenos"> 2</span><span class="c">% Expected outcome: X=ok, Z=ok.</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span>r<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">Z</span><span class="o">.</span>
<span class="linenos"> 5</span>foo<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="kd">,</span><span class="w"> </span>q<span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">A</span><span class="o">.</span>
<span class="linenos"> 6</span>q<span class="w"> </span>a<span class="o">.</span>
<span class="linenos"> 7</span>q<span class="w"> </span>b<span class="o">.</span>
<span class="linenos"> 8</span>r<span class="w"> </span>b<span class="w"> </span>ok<span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>p<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Z</span><span class="kd">,</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="kd">,</span><span class="w"> </span><span class="nv">Z</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>ok<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 4, column 0, character 49:</span>
<span class="go"> Warning:</span>
<span class="go"> constant r has no declared type. Did you mean std.rev std.map.remove std.map.private.remove std.map.private.remove-min-binding std.set.remove std.set.private.remove std.set.private.remove-min-binding std.loc.set.remove std.int.set.remove std.string.set.remove std.loc.map.remove std.int.map.remove std.string.map.remove rex.replace ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 5, column 0, character 74:</span>
<span class="go"> Warning: constant q has no declared type. Did you mean gc.quick-stat ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 4, column 0, character 49:</span>
<span class="go"> Warning:</span>
<span class="go"> constant p has no declared type. Did you mean std.map.private.empty std.map.private.find std.map.private.add std.map.private.remove std.map.private.bindings std.map.private.merge std.map.private.min-binding std.map.private.remove-min-binding std.map.private.bal std.map.private.create std.map.private.height std.map.private.node std.set.private.empty std.set.private.add std.set.private.remove std.set.private.merge std.set.private.min-binding std.set.private.remove-min-binding std.set.private.bal std.set.private.create std.set.private.height std.set.private.node std.set.private.mem std.set.private.cardinal std.set.private.elements std.set.private.set std.map.private.map ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 4, column 0, character 49:</span>
<span class="go"> Warning: constant foo has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 7, column 0, character 110:</span>
<span class="go"> Warning:</span>
<span class="go"> constant b has no declared type. Did you mean std.map.bindings std.map.private.bindings std.map.private.bal std.set.private.bal std.loc.map.bindings std.int.map.bindings std.string.map.bindings ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/trail.elpi&quot;, line 6, column 0, character 105:</span>
<span class="go"> Warning:</span>
<span class="go"> constant a has no declared type. Did you mean std.assert! std.assert-ok! std.append std.appendR std.any-&gt;string std.map.add std.map.private.add std.set.add std.set.private.add std.loc.set.add std.int.set.add std.string.set.add std.loc.map.add std.int.map.add std.string.map.add ?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.136</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">xx</span><span class="w"> </span><span class="kt">bool</span>.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kd">namespace</span><span class="w"> </span>foo<span class="w"> </span>{
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">xx</span>.
<span class="linenos"> 6</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>}
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo.f<span class="w"> </span>tt<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.100</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv1.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t1</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">t1</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span><span class="mi">3</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.101</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv10.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>typeabbrev<span class="w"> </span>(bar<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span>(list<span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos">2</span>typeabbrev<span class="w"> </span>(tmp<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span>(list<span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos">3</span>typeabbrev<span class="w"> </span>(foo<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span>(tmp<span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">foo</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">int</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">int</span>.
<span class="linenos">6</span>
<span class="linenos">7</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>std.map<span class="w"> </span><span class="mi">3</span><span class="w"> </span>foo<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv10.elpi&quot;, line 7, column 0, character 111:</span>
<span class="go"> Error: 3 has type int but is used with type type</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv10.elpi&quot;, line 7, column 0, character 111:</span>
<span class="go"> Error: 3 has type int but is used with type (std.map.private.map X27 X26)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv10.elpi&quot;, line 7, column 0, character 111:</span>
<span class="go"> Error: 3 has type int but is used with type (foo X28)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv10.elpi&quot;, line 7, column 0, character 111:</span>
<span class="go"> Error: 3 has type int but is used with type (std.map.private.map X30 X29)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv10.elpi&quot;, line 7, column 0, character 111:</span>
<span class="go"> Error: 3 has type int but is used with type (foo X31)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.104</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv11.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">x</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">x</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv11.elpi&quot;, line 4, column 0, character 31:</span>
<span class="go"> Error: x has type string but is used with type int</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.113</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv12.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">y</span><span class="w"> </span><span class="kt">(list</span><span class="w"> </span><span class="kt">int)</span>.
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">y</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv12.elpi&quot;, line 4, column 0, character 38:</span>
<span class="go"> Error: x has type string but is used with type y</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.102</span>
<span class="go">Type error. To ignore it, pass -no-tc.</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv2.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t1</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">t1</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t1</span><span class="w"> </span><span class="kt">bool</span>.
<span class="linenos">7</span>
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span><span class="mi">3</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv2.elpi&quot;, line 6, column 0, character 39:duplicate type abbreviation for t1. Previous declaration: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv2.elpi&quot;, line 1, column 0, character 0:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv3.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>typeabbrev<span class="w"> </span>(t1<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span>(pair<span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">t1</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span>(pr<span class="w"> </span><span class="mi">2</span><span class="w"> </span>tt<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.098</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv4.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t1</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">t1</span>.
<span class="linenos">4</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t1</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos">7</span>
<span class="linenos">8</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span><span class="mi">3</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.100</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv5.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">x</span><span class="w"> </span><span class="kt">y</span>.
<span class="linenos">2</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">y</span><span class="w"> </span><span class="kt">x</span>.
<span class="linenos">3</span>
<span class="linenos">4</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">x</span>.
<span class="linenos">5</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">6</span>
<span class="linenos">7</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span><span class="mi">0</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>
<span class="go">Fatal error: exception Elpi__Compiler.CompileError(_, &quot;looping while unfolding type abbreviation for x&quot;)</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv6.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">x</span><span class="w"> </span><span class="kt">(option</span><span class="w"> </span><span class="kt">A)</span>.
<span class="linenos">2</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">x</span>.
<span class="linenos">3</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos">4</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span>(some<span class="w"> </span><span class="mi">3</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>
<span class="go">Fatal error: File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/typeabbrv6.elpi&quot;, line 1, column 0, character 0:type abbreviation for x has unbound variables</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv7.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">xx</span><span class="w"> </span><span class="kt">bool</span>.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kd">namespace</span><span class="w"> </span>foo<span class="w"> </span>{
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">xx</span>.
<span class="linenos"> 6</span>f<span class="w"> </span><span class="nv">_</span><span class="o">.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>}
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>foo.f<span class="w"> </span>tt<span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.102</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv8.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>{ <span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">xx</span><span class="w"> </span><span class="kt">bool</span>.<span class="w"> </span>}
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kd">type</span><span class="w"> </span><span class="nf">g</span><span class="w"> </span><span class="kt">xx</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">xx</span>.
<span class="linenos"> 4</span>{
<span class="linenos"> 5</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">xx</span>.
<span class="linenos"> 6</span>f<span class="w"> </span>(g<span class="w"> </span><span class="nv">_</span><span class="o">).</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>}
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span>(g<span class="w"> </span>tt<span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.102</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/typeabbrv9.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kd">namespace</span><span class="w"> </span>xx<span class="w"> </span>{
<span class="linenos"> 4</span><span class="w">    </span><span class="kd">typeabbrev</span><span class="w"> </span><span class="nf">t</span><span class="w"> </span><span class="kt">int</span>.
<span class="linenos"> 5</span>}
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kd">pred</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">t</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">xx.t</span>.
<span class="linenos"> 8</span>f<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span>f<span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.104</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/uminus.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kd">-</span><span class="w"> </span><span class="mi">2</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">is</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kd">+</span><span class="w"> </span><span class="kd">-</span><span class="mi">2</span><span class="kd">,</span>
<span class="linenos">3</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w">  </span><span class="mi">1</span><span class="kd">,</span><span class="w"> </span><span class="nv">Y</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.003</span>

<span class="go">Typechecking time: 0.108</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/uvar_chr.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">type</span><span class="w"> </span><span class="nf">app</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 2</span><span class="kd">type</span><span class="w"> </span><span class="nf">lam</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="kd">pred</span><span class="w"> </span><span class="nf">unsafe-cast</span><span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">A</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">B</span>.
<span class="linenos"> 5</span>unsafe-cast<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kd">pred</span><span class="w"> </span><span class="nf">mk-app</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">list</span><span class="w"> </span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">term</span>.
<span class="linenos"> 8</span>mk-app<span class="w"> </span><span class="nv">HD</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">HD</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos"> 9</span>mk-app<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">K</span><span class="o">)</span><span class="w"> </span><span class="kd">[</span><span class="nv">A</span><span class="kd">|</span><span class="nv">Args</span><span class="kd">]</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>unsafe-cast<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">K&#39;</span><span class="kd">,</span><span class="w"> </span>mk-app<span class="w"> </span>(<span class="nv">K&#39;</span><span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="nv">Args</span><span class="w"> </span><span class="nv">R</span><span class="o">.</span>
<span class="linenos">10</span>mk-app<span class="w"> </span><span class="nv">HD</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>mk-app<span class="w"> </span>(app<span class="w"> </span><span class="nv">HD</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="kd">pred</span><span class="w"> </span><span class="nf">copy</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">term</span>.
<span class="linenos">13</span>
<span class="linenos">14</span>copy<span class="w"> </span>(app<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(app<span class="w"> </span><span class="nv">A1</span><span class="w"> </span><span class="nv">B1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A1</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos">15</span>copy<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">F1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F1</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos">16</span>copy<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="kd">as</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>var<span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>copy-list<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>mk-app<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos">17</span>copy<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">L1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy-list<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos">18</span>
<span class="linenos">19</span>copy-list<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
<span class="linenos">20</span>copy-list<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="kd">[</span><span class="nv">Y</span><span class="kd">|</span><span class="nv">YS</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span>copy-list<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">YS</span><span class="o">.</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="kd">pred</span><span class="w"> </span><span class="nf">meta-copy</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">term</span>.
<span class="linenos">23</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">meta-copy </span>{
<span class="linenos">24</span><span class="w">  </span><span class="kd">rule</span><span class="w"> </span>(meta-copy<span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">O</span><span class="o">)</span><span class="w"> </span><span class="kd">|</span><span class="w"> </span>(copy<span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">O</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">X</span><span class="o">).</span>
<span class="linenos">25</span>}
<span class="linenos">26</span>
<span class="linenos">27</span>main<span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="kd">,</span>
<span class="linenos">28</span><span class="w">  </span>copy<span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="nv">T</span><span class="kd">,</span><span class="w"> </span>print<span class="w"> </span><span class="nv">T</span><span class="kd">,</span>
<span class="linenos">29</span><span class="w">  </span>declare_constraint<span class="w"> </span>(meta-copy<span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="nv">S</span><span class="o">)</span><span class="w"> </span><span class="kd">[],</span><span class="w"> </span>print<span class="w"> </span><span class="nv">S</span><span class="kd">,</span><span class="w"> </span>not(var<span class="w"> </span><span class="nv">S</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/uvar_chr.elpi&quot;, line 17, column 0, character 438:</span>
<span class="go"> Warning: constant copy-list has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/uvar_chr.elpi&quot;, line 28, column 0, character 731:</span>
<span class="go"> Warning: F is linear: name it _F (discard) or F_ (fresh variable)</span>
<span class="go">lam X0</span>
<span class="go">lam c0 \ X0 c0</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.111</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> meta-copy (lam c0 \ X0 c0) (lam c0 \ X0 c0)  /* suspended on  */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/var.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">2</span><span class="w">  </span>var<span class="w"> </span><span class="nv">X0</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">[],</span>
<span class="linenos">3</span><span class="w">  </span>var<span class="w"> </span><span class="nv">X1</span><span class="kd">,</span>
<span class="linenos">4</span><span class="w">  </span>var<span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="kd">,</span>
<span class="linenos">5</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span><span class="o">(</span>var<span class="w"> </span><span class="o">(</span><span class="nv">X3</span><span class="w"> </span>x<span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="kd">[</span>x<span class="kd">,</span>y<span class="kd">]</span><span class="o">))</span><span class="kd">,</span>
<span class="linenos">6</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span><span class="o">(</span>var<span class="w"> </span><span class="o">(</span><span class="nv">X9</span><span class="w"> </span>x<span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">X9</span><span class="w"> </span><span class="o">(</span><span class="nv">X10</span><span class="w"> </span>x<span class="w"> </span>y<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">7</span><span class="w">  </span>(<span class="kd">pi</span><span class="w"> </span><span class="nv">x y</span>\<span class="w"> </span><span class="kd">sigma</span><span class="w"> </span><span class="nv">X5</span>\<span class="w"> </span><span class="o">(</span>var<span class="w"> </span><span class="nv">X5</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="kd">[</span>x<span class="kd">,</span>y<span class="kd">]</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos">8</span><span class="w">           </span>print<span class="w"> </span><span class="nv">X0</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="nv">X2</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="nv">X3</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="nv">X4</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="nv">X5</span><span class="o">).</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/var.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: X10 is linear: name it _X10 (discard) or X10_ (fresh variable)</span>
<span class="go">X0 , X1 , X2 , X3 , X4 , X4 c0 c1</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.105</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/variadic_declare_constraints.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">type</span><span class="w"> </span><span class="nf">foo</span><span class="w"> </span><span class="kt">tm</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">(tm</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tm)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">prop</span>.
<span class="linenos">2</span>
<span class="linenos">3</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">4</span><span class="w">  </span>declare_constraint<span class="w"> </span>(foo<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">Y</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">[</span><span class="nv">Y</span><span class="kd">,</span><span class="w"> </span><span class="nv">Z</span><span class="kd">]</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/variadic_declare_constraints.elpi&quot;, line 3, column 0, character 36:</span>
<span class="go"> Warning: Z is linear: name it _Z (discard) or Z_ (fresh variable)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.000</span>

<span class="go">Compilation time: 0.002</span>

<span class="go">Typechecking time: 0.104</span>

<span class="go">Success:</span>

<span class="go">Time: 0.000</span>

<span class="go">Constraints:</span>
<span class="go"> foo X0 X1  /* suspended on X0, X1, X2 */</span>

<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/w.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>filter<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
<span class="linenos">  2</span>filter<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">YS</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>filter<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="o">.</span>
<span class="linenos">  3</span>filter<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>filter<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="o">.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span>mem<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">  6</span>mem<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>mem<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span>if<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">G</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos">  9</span>if<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">E</span><span class="o">.</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="kd">kind</span><span class="w"> </span><span class="nf">term</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 12</span><span class="kd">type</span><span class="w"> </span><span class="nf">app</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 13</span><span class="kd">type</span><span class="w"> </span><span class="nf">lam</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 14</span><span class="kd">type</span><span class="w"> </span><span class="nf">let</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="kd">kind</span><span class="w"> </span><span class="nf">tye</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 17</span><span class="c">% elpi:skip 2</span>
<span class="linenos"> 18</span>infixr<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="mi">50</span><span class="o">.</span>
<span class="linenos"> 19</span>infixl<span class="w"> </span>#<span class="w"> </span><span class="mi">60</span><span class="o">.</span>
<span class="linenos"> 20</span><span class="kd">type</span><span class="w"> </span><span class="nf">(==&gt;)</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 21</span><span class="kd">type</span><span class="w"> </span><span class="nf">(#)</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="kd">kind</span><span class="w"> </span><span class="nf">ty</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 24</span><span class="kd">type</span><span class="w"> </span><span class="nf">all</span><span class="w"> </span><span class="kt">(tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span>.
<span class="linenos"> 25</span><span class="kd">type</span><span class="w"> </span><span class="nf">mono</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span>.
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="kd">type</span><span class="w"> </span><span class="nf">one</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 28</span><span class="kd">type</span><span class="w"> </span><span class="nf">plus</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 29</span><span class="kd">type</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 30</span><span class="kd">type</span><span class="w"> </span><span class="nf">empty</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 31</span><span class="kd">type</span><span class="w"> </span><span class="nf">comma</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="kd">type</span><span class="w"> </span><span class="nf">integer</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 34</span><span class="kd">type</span><span class="w"> </span><span class="nf">list</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 35</span><span class="kd">type</span><span class="w"> </span><span class="nf">pair</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="c">% constants</span>
<span class="linenos"> 38</span>w<span class="w"> </span>one<span class="w">    </span>(mono<span class="w"> </span>integer<span class="o">).</span>
<span class="linenos"> 39</span>w<span class="w"> </span>plus<span class="w">   </span>(mono<span class="w"> </span><span class="o">(</span>integer<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="o">)).</span>
<span class="linenos"> 40</span>w<span class="w"> </span>size<span class="w">   </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>list<span class="w"> </span>#<span class="w"> </span>x<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="o">)).</span>
<span class="linenos"> 41</span>w<span class="w"> </span>empty<span class="w">  </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>list<span class="w"> </span>#<span class="w"> </span>x<span class="o">)).</span>
<span class="linenos"> 42</span>w<span class="w"> </span>comma<span class="w">  </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>all<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>x<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>y<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="o">(</span>pair<span class="w"> </span>#<span class="w"> </span>x<span class="w"> </span>#<span class="w"> </span>y<span class="o">))).</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="kd">pred</span><span class="w"> </span><span class="nf">w</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">ty</span>.
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>w<span class="w"> </span>(app<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">R</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 47</span><span class="w">  </span>w<span class="w"> </span><span class="nv">F</span><span class="w"> </span>(mono<span class="w"> </span><span class="o">(</span><span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">R</span><span class="o">))</span><span class="kd">,</span>
<span class="linenos"> 48</span><span class="w">  </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span>w<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="o">(</span><span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">R</span><span class="o">))</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 51</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>w<span class="w"> </span>x<span class="w"> </span>(mono<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>w<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">R</span><span class="o">).</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>w<span class="w"> </span>(let<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">FP</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">TC</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 54</span><span class="w">  </span>w<span class="w"> </span><span class="nv">F</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">FT</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos"> 55</span><span class="w">  </span>declare_constraint<span class="w"> </span>(overbar<span class="w"> </span><span class="o">(</span>mono<span class="w"> </span><span class="nv">FT</span><span class="o">)</span><span class="w"> </span><span class="nv">FP</span><span class="o">)</span><span class="w"> </span><span class="kd">[],</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>w<span class="w"> </span>x<span class="w"> </span><span class="nv">FP</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>w<span class="w"> </span>(<span class="nv">B</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">TC</span><span class="o">).</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">Poly</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>specialize<span class="w"> </span>(all<span class="w"> </span><span class="nv">Poly</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">TY</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;Error: &quot;</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="s2">&quot;cannot have type&quot;</span><span class="w"> </span><span class="nv">TY</span><span class="o">.</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span><span class="kd">pred</span><span class="w"> </span><span class="nf">specialize</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">ty</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">tye</span>.
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>specialize<span class="w"> </span>(all<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>specialize<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">FRESH_</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos"> 65</span>specialize<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="kd">pred</span><span class="w"> </span><span class="nf">overbar</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">ty</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">ty</span>.
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">w overbar </span>{
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">G</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>overbar<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">T1</span><span class="o">)</span>
<span class="linenos"> 72</span><span class="w">     </span><span class="kd">|</span><span class="w"> </span>(generalize<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">POLYT</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">T1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">POLYT</span><span class="o">).</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">G</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>overbar<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(print<span class="w"> </span><span class="s2">&quot;overbar&quot;</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="s2">&quot;|-&quot;</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="s2">&quot;failed&quot;</span><span class="kd">,</span><span class="w"> </span>halt<span class="o">).</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>generalize<span class="w"> </span><span class="nv">G</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">ALL</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 77</span><span class="w">  </span>free-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">VT</span><span class="kd">,</span>
<span class="linenos"> 78</span><span class="w">  </span>free-gamma<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">VG</span><span class="kd">,</span>
<span class="linenos"> 79</span><span class="w">  </span>filter<span class="w"> </span><span class="nv">VT</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>not<span class="o">(</span>mem<span class="w"> </span><span class="nv">VG</span><span class="w"> </span>x<span class="o">))</span><span class="w"> </span><span class="nv">Q</span><span class="kd">,</span>
<span class="linenos"> 80</span><span class="w">  </span>quantify<span class="w"> </span><span class="nv">Q</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">ALL</span><span class="o">.</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>free-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 83</span>free-ty<span class="w"> </span>(all<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>free-ty<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>free-gamma<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 86</span>free-gamma<span class="w"> </span><span class="kd">[</span>w<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">T</span><span class="kd">|</span><span class="nv">X</span><span class="kd">]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free-ty<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free-gamma<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>free<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 89</span>free<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 90</span>free<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>if<span class="w"> </span>(mem<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(<span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(<span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">L</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 91</span>free<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>copy-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">X2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X2</span><span class="o">.</span>
<span class="linenos"> 94</span>copy-ty<span class="w"> </span>(all<span class="w"> </span><span class="nv">F1</span><span class="o">)</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy-ty<span class="w"> </span>(<span class="nv">F1</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>copy<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(<span class="nv">A1</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A1</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos"> 97</span>copy<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(<span class="nv">A1</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A1</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos"> 98</span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>quantify<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">101</span>quantify<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span><span class="nv">T2</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">102</span><span class="w">  </span>quantify<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">T1</span><span class="kd">,</span>
<span class="linenos">103</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy-ty<span class="w"> </span><span class="nv">T1</span><span class="w"> </span>(<span class="nv">T2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos">104</span>
<span class="linenos">105</span>}
<span class="linenos">106</span>
<span class="linenos">107</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">108</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 1&quot;</span><span class="kd">,</span>
<span class="linenos">109</span><span class="w">  </span><span class="nv">P</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>let<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span>x<span class="o">)</span><span class="w"> </span><span class="nv">T_</span><span class="w"> </span>(<span class="nv">id\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>plus<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>one<span class="o">))</span>
<span class="linenos">110</span><span class="w">                                  </span><span class="o">(</span>app<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>empty<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">111</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">P</span><span class="kd">,</span>
<span class="linenos">112</span><span class="w">  </span>w<span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">TP</span><span class="kd">,</span>
<span class="linenos">113</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="s2">&quot;has type&quot;</span><span class="w"> </span><span class="nv">TP</span><span class="kd">,</span>
<span class="linenos">114</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="kd">,</span>
<span class="linenos">115</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 2&quot;</span><span class="kd">,</span>
<span class="linenos">116</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span>(<span class="nv">x\</span>
<span class="linenos">117</span><span class="w">        </span>let<span class="w"> </span><span class="o">(</span>lam<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>comma<span class="w"> </span>x<span class="o">)</span><span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">Y_</span><span class="w"> </span><span class="o">(</span><span class="nv">mk\</span>
<span class="linenos">118</span><span class="w">          </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>comma<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>mk<span class="w"> </span>one<span class="o">))</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span>mk<span class="w"> </span>x<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">119</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span>
<span class="linenos">120</span><span class="w">  </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XT</span><span class="kd">,</span>
<span class="linenos">121</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="s2">&quot;has type&quot;</span><span class="w"> </span><span class="nv">XT</span><span class="kd">,</span>
<span class="linenos">122</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="kd">,</span>
<span class="linenos">123</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 3&quot;</span><span class="kd">,</span>
<span class="linenos">124</span><span class="w">  </span><span class="nv">Q</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span>(<span class="nv">id\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>plus<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>one<span class="o">))</span>
<span class="linenos">125</span><span class="w">                                  </span><span class="o">(</span>app<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>empty<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">126</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">Q</span><span class="kd">,</span>
<span class="linenos">127</span><span class="w">  </span>w<span class="w"> </span><span class="nv">Q</span><span class="w"> </span><span class="nv">TQ</span><span class="o">.</span><span class="w"> </span><span class="c">% should print error</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 76, column 0, character 1561:</span>
<span class="go"> Warning: constant quantify has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 5, column 0, character 105:</span>
<span class="go"> Warning:</span>
<span class="go"> constant mem has no declared type. Did you mean std.mem! std.mem std.set.mem std.set.private.mem std.loc.set.mem std.int.set.mem std.string.set.mem std.loc.map.mem std.int.map.mem std.string.map.mem ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 76, column 0, character 1561:</span>
<span class="go"> Warning: constant generalize has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 76, column 0, character 1561:</span>
<span class="go"> Warning: constant free-ty has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 76, column 0, character 1561:</span>
<span class="go"> Warning: constant free-gamma has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 82, column 0, character 1693:</span>
<span class="go"> Warning: constant free has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 1, column 0, character 0:</span>
<span class="go"> Warning: constant filter has no declared type. Did you mean std.filter ?</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 93, column 0, character 2038:</span>
<span class="go"> Warning: constant copy-ty has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 93, column 0, character 2038:</span>
<span class="go"> Warning: constant copy has no declared type.</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 91, column 0, character 2025:</span>
<span class="go"> Warning: X is linear: name it _X (discard) or X_ (fresh variable)</span>
<span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w.elpi&quot;, line 107, column 0, character 2408:</span>
<span class="go"> Warning: TQ is linear: name it _TQ (discard) or TQ_ (fresh variable)</span>
<span class="go">Test 1</span>
<span class="go">Typing</span>
<span class="go"> let (lam c0 \ c0) X0 c0 \</span>
<span class="go">  app (app plus (app c0 one)) (app size (app c0 empty))</span>
<span class="go">OK</span>
<span class="go"> let (lam c0 \ c0) (all c0 \ mono (c0 ==&gt; c0)) c0 \</span>
<span class="go">  app (app plus (app c0 one)) (app size (app c0 empty)) has type mono integer</span>

<span class="go">Test 2</span>
<span class="go">Typing</span>
<span class="go"> lam c0 \</span>
<span class="go">  let (lam c1 \ app (app comma c0) c1) X1 c1 \</span>
<span class="go">   app (app comma (app c1 one)) (app c1 c0)</span>
<span class="go">OK</span>
<span class="go"> lam c0 \</span>
<span class="go">  let (lam c1 \ app (app comma c0) c1) (all c1 \ mono (c1 ==&gt; pair # X2 # c1))</span>
<span class="go">   c1 \ app (app comma (app c1 one)) (app c1 c0) has type</span>
<span class="go"> mono (X2 ==&gt; pair # (pair # X2 # integer) # (pair # X2 # X2))</span>

<span class="go">Test 3</span>
<span class="go">Typing lam c0 \ app (app plus (app c0 one)) (app size (app c0 empty))</span>
<span class="go">Error:  c0 cannot have type all X3^1</span>
<span class="go">Error:  c0 cannot have type mono (X4^1 ==&gt; list # X5^1)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Parsing time: 0.001</span>

<span class="go">Compilation time: 0.004</span>

<span class="go">Typechecking time: 0.175</span>

<span class="go">Success:</span>

<span class="go">Time: 0.001</span>

<span class="go">Constraints:</span>


<span class="go">State:</span>
</pre></div>
</div>
<p><strong>../../tests/sources/w_legacy.elpi
:</strong></p>
<div class="highlight-elpi notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>filter<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">[]</span><span class="o">.</span>
<span class="linenos">  2</span>filter<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">YS</span><span class="kd">]</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span>filter<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="o">.</span>
<span class="linenos">  3</span>filter<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>filter<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">YS</span><span class="o">.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span>mem<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">_</span><span class="kd">]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">!</span><span class="o">.</span>
<span class="linenos">  6</span>mem<span class="w"> </span><span class="kd">[</span><span class="nv">_</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>mem<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span>if<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">G</span><span class="kd">,</span><span class="w"> </span><span class="kd">!,</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos">  9</span>if<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="nv">E</span><span class="o">.</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="kd">kind</span><span class="w"> </span><span class="nf">term</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 12</span><span class="kd">type</span><span class="w"> </span><span class="nf">app</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 13</span><span class="kd">type</span><span class="w"> </span><span class="nf">lam</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 14</span><span class="kd">type</span><span class="w"> </span><span class="nf">let</span><span class="w"> </span><span class="kt">term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">(term</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="kd">kind</span><span class="w"> </span><span class="nf">tye</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 17</span>infixr<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="mi">50</span><span class="o">.</span>
<span class="linenos"> 18</span>infixl<span class="w"> </span>#<span class="w"> </span><span class="mi">60</span><span class="o">.</span>
<span class="linenos"> 19</span><span class="kd">type</span><span class="w"> </span><span class="nf">(==&gt;)</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 20</span><span class="kd">type</span><span class="w"> </span><span class="nf">(#)</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="kd">kind</span><span class="w"> </span><span class="nf">ty</span><span class="w"> </span><span class="kt">type</span>.
<span class="linenos"> 23</span><span class="kd">type</span><span class="w"> </span><span class="nf">all</span><span class="w"> </span><span class="kt">(tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty)</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span>.
<span class="linenos"> 24</span><span class="kd">type</span><span class="w"> </span><span class="nf">mono</span><span class="w"> </span><span class="kt">tye</span><span class="w"> </span><span class="kt">-&gt;</span><span class="w"> </span><span class="kt">ty</span>.
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="kd">type</span><span class="w"> </span><span class="nf">one</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 27</span><span class="kd">type</span><span class="w"> </span><span class="nf">plus</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 28</span><span class="kd">type</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 29</span><span class="kd">type</span><span class="w"> </span><span class="nf">empty</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 30</span><span class="kd">type</span><span class="w"> </span><span class="nf">comma</span><span class="w"> </span><span class="kt">term</span>.
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="kd">type</span><span class="w"> </span><span class="nf">integer</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 33</span><span class="kd">type</span><span class="w"> </span><span class="nf">list</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 34</span><span class="kd">type</span><span class="w"> </span><span class="nf">pair</span><span class="w"> </span><span class="kt">tye</span>.
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="c">% constants</span>
<span class="linenos"> 37</span>w<span class="w"> </span>one<span class="w">    </span>(mono<span class="w"> </span>integer<span class="o">).</span>
<span class="linenos"> 38</span>w<span class="w"> </span>plus<span class="w">   </span>(mono<span class="w"> </span><span class="o">(</span>integer<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="o">)).</span>
<span class="linenos"> 39</span>w<span class="w"> </span>size<span class="w">   </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>list<span class="w"> </span>#<span class="w"> </span>x<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>integer<span class="o">)).</span>
<span class="linenos"> 40</span>w<span class="w"> </span>empty<span class="w">  </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>list<span class="w"> </span>#<span class="w"> </span>x<span class="o">)).</span>
<span class="linenos"> 41</span>w<span class="w"> </span>comma<span class="w">  </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span>all<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>mono<span class="w"> </span><span class="o">(</span>x<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span>y<span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="o">(</span>pair<span class="w"> </span>#<span class="w"> </span>x<span class="w"> </span>#<span class="w"> </span>y<span class="o">))).</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="kd">pred</span><span class="w"> </span><span class="nf">w</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">term</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">ty</span>.
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>w<span class="w"> </span>(app<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">R</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 46</span><span class="w">  </span>w<span class="w"> </span><span class="nv">F</span><span class="w"> </span>(mono<span class="w"> </span><span class="o">(</span><span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">R</span><span class="o">))</span><span class="kd">,</span>
<span class="linenos"> 47</span><span class="w">  </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">A</span><span class="o">).</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span>w<span class="w"> </span>(lam<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="o">(</span><span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">R</span><span class="o">))</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 50</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>w<span class="w"> </span>x<span class="w"> </span>(mono<span class="w"> </span><span class="nv">A</span><span class="o">)</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>w<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">R</span><span class="o">).</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>w<span class="w"> </span>(let<span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">FP</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">TC</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 53</span><span class="w">  </span>w<span class="w"> </span><span class="nv">F</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">FT</span><span class="o">)</span><span class="kd">,</span>
<span class="linenos"> 54</span><span class="w">  </span>declare_constraint<span class="w"> </span>(overbar<span class="w"> </span><span class="o">(</span>mono<span class="w"> </span><span class="nv">FT</span><span class="o">)</span><span class="w"> </span><span class="nv">FP</span><span class="o">)</span><span class="w"> </span><span class="kd">[],</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>w<span class="w"> </span>x<span class="w"> </span><span class="nv">FP</span><span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>w<span class="w"> </span>(<span class="nv">B</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">TC</span><span class="o">).</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">Poly</span><span class="o">)</span><span class="kd">,</span><span class="w"> </span>specialize<span class="w"> </span>(all<span class="w"> </span><span class="nv">Poly</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">TY</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>print<span class="w"> </span><span class="s2">&quot;Error: &quot;</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="s2">&quot;cannot have type&quot;</span><span class="w"> </span><span class="nv">TY</span><span class="o">.</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span><span class="kd">pred</span><span class="w"> </span><span class="nf">specialize</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">ty</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">tye</span>.
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>specialize<span class="w"> </span>(all<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>specialize<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span><span class="nv">FRESH_</span><span class="o">)</span><span class="w"> </span><span class="nv">T</span><span class="o">.</span>
<span class="linenos"> 64</span>specialize<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span><span class="kd">pred</span><span class="w"> </span><span class="nf">overbar</span><span class="w"> </span><span class="k k-Mode">i:</span><span class="kt">ty</span>,<span class="w"> </span><span class="k k-Mode">o:</span><span class="kt">ty</span>.
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="kd">constraint</span><span class="w"> </span><span class="nf">w overbar </span>{
<span class="linenos"> 69</span>
<span class="linenos"> 70</span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">G</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>overbar<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">T1</span><span class="o">)</span>
<span class="linenos"> 71</span><span class="w">     </span><span class="kd">|</span><span class="w"> </span>(generalize<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">POLYT</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(<span class="nv">T1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">POLYT</span><span class="o">).</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span><span class="kd">rule</span><span class="w"> </span><span class="kd">\</span><span class="w"> </span>(<span class="nv">G</span><span class="w"> </span><span class="kd">?-</span><span class="w"> </span>overbar<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="kd">&lt;=&gt;</span><span class="w"> </span>(print<span class="w"> </span><span class="s2">&quot;overbar&quot;</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="s2">&quot;|-&quot;</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="s2">&quot;failed&quot;</span><span class="kd">,</span><span class="w"> </span>halt<span class="o">).</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>generalize<span class="w"> </span><span class="nv">G</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="nv">ALL</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos"> 76</span><span class="w">  </span>free-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">T</span><span class="o">)</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">VT</span><span class="kd">,</span>
<span class="linenos"> 77</span><span class="w">  </span>free-gamma<span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">VG</span><span class="kd">,</span>
<span class="linenos"> 78</span><span class="w">  </span>filter<span class="w"> </span><span class="nv">VT</span><span class="w"> </span>(<span class="nv">x\</span><span class="w"> </span>not<span class="o">(</span>mem<span class="w"> </span><span class="nv">VG</span><span class="w"> </span>x<span class="o">))</span><span class="w"> </span><span class="nv">Q</span><span class="kd">,</span>
<span class="linenos"> 79</span><span class="w">  </span>quantify<span class="w"> </span><span class="nv">Q</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">ALL</span><span class="o">.</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>free-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 82</span>free-ty<span class="w"> </span>(all<span class="w"> </span><span class="nv">F</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>free-ty<span class="w"> </span>(<span class="nv">F</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="o">.</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>free-gamma<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 85</span>free-gamma<span class="w"> </span><span class="kd">[</span>w<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">T</span><span class="kd">|</span><span class="nv">X</span><span class="kd">]</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free-ty<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free-gamma<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>free<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 88</span>free<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>free<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="kd">,</span><span class="w"> </span>free<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="nv">L2</span><span class="o">.</span>
<span class="linenos"> 89</span>free<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L1</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>if<span class="w"> </span>(mem<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">X</span><span class="o">)</span><span class="w"> </span>(<span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="nv">L</span><span class="o">)</span><span class="w"> </span>(<span class="nv">L1</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">L</span><span class="kd">]</span><span class="o">).</span>
<span class="linenos"> 90</span>free<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">L</span><span class="o">.</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>copy-ty<span class="w"> </span>(mono<span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">X2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X1</span><span class="w"> </span><span class="nv">X2</span><span class="o">.</span>
<span class="linenos"> 93</span>copy-ty<span class="w"> </span>(all<span class="w"> </span><span class="nv">F1</span><span class="o">)</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">F2</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>x<span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy-ty<span class="w"> </span>(<span class="nv">F1</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span>(<span class="nv">F2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>copy<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(<span class="nv">A1</span><span class="w"> </span><span class="kd">==&gt;</span><span class="w"> </span><span class="nv">B1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A1</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos"> 96</span>copy<span class="w"> </span>(<span class="nv">A</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B</span><span class="o">)</span><span class="w"> </span>(<span class="nv">A1</span><span class="w"> </span>#<span class="w"> </span><span class="nv">B1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">A1</span><span class="kd">,</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">B1</span><span class="o">.</span>
<span class="linenos"> 97</span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X</span><span class="o">.</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span>quantify<span class="w"> </span><span class="kd">[]</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span>(mono<span class="w"> </span><span class="nv">X1</span><span class="o">)</span><span class="w"> </span><span class="kd">:-</span><span class="w"> </span>copy<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">X1</span><span class="o">.</span>
<span class="linenos">100</span>quantify<span class="w"> </span><span class="kd">[</span><span class="nv">X</span><span class="kd">|</span><span class="nv">XS</span><span class="kd">]</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span>(all<span class="w"> </span><span class="nv">x\</span><span class="w"> </span><span class="nv">T2</span><span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="kd">:-</span>
<span class="linenos">101</span><span class="w">  </span>quantify<span class="w"> </span><span class="nv">XS</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">T1</span><span class="kd">,</span>
<span class="linenos">102</span><span class="w">  </span><span class="kd">pi</span><span class="w"> </span><span class="nv">x</span>\<span class="w"> </span>copy<span class="w"> </span>(<span class="kd">uvar</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">_</span><span class="o">)</span><span class="w"> </span>x<span class="w"> </span><span class="kd">=&gt;</span><span class="w"> </span>copy-ty<span class="w"> </span><span class="nv">T1</span><span class="w"> </span>(<span class="nv">T2</span><span class="w"> </span>x<span class="o">).</span>
<span class="linenos">103</span>
<span class="linenos">104</span>}
<span class="linenos">105</span>
<span class="linenos">106</span>main<span class="w"> </span><span class="kd">:-</span>
<span class="linenos">107</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 1&quot;</span><span class="kd">,</span>
<span class="linenos">108</span><span class="w">  </span><span class="nv">P</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>let<span class="w"> </span>(lam<span class="w"> </span><span class="nv">x\</span>x<span class="o">)</span><span class="w"> </span><span class="nv">T_</span><span class="w"> </span>(<span class="nv">id\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>plus<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>one<span class="o">))</span>
<span class="linenos">109</span><span class="w">                                  </span><span class="o">(</span>app<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>empty<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">110</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">P</span><span class="kd">,</span>
<span class="linenos">111</span><span class="w">  </span>w<span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">TP</span><span class="kd">,</span>
<span class="linenos">112</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="s2">&quot;has type&quot;</span><span class="w"> </span><span class="nv">TP</span><span class="kd">,</span>
<span class="linenos">113</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="kd">,</span>
<span class="linenos">114</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 2&quot;</span><span class="kd">,</span>
<span class="linenos">115</span><span class="w">  </span><span class="nv">X</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span>(<span class="nv">x\</span>
<span class="linenos">116</span><span class="w">        </span>let<span class="w"> </span><span class="o">(</span>lam<span class="w"> </span><span class="nv">y\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>comma<span class="w"> </span>x<span class="o">)</span><span class="w"> </span>y<span class="o">)</span><span class="w"> </span><span class="nv">Y_</span><span class="w"> </span><span class="o">(</span><span class="nv">mk\</span>
<span class="linenos">117</span><span class="w">          </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>comma<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>mk<span class="w"> </span>one<span class="o">))</span><span class="w"> </span><span class="o">(</span>app<span class="w"> </span>mk<span class="w"> </span>x<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">118</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">X</span><span class="kd">,</span>
<span class="linenos">119</span><span class="w">  </span>w<span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="nv">XT</span><span class="kd">,</span>
<span class="linenos">120</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="w"> </span><span class="nv">X</span><span class="w"> </span><span class="s2">&quot;has type&quot;</span><span class="w"> </span><span class="nv">XT</span><span class="kd">,</span>
<span class="linenos">121</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="kd">,</span>
<span class="linenos">122</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Test 3&quot;</span><span class="kd">,</span>
<span class="linenos">123</span><span class="w">  </span><span class="nv">Q</span><span class="w"> </span><span class="kd">=</span><span class="w"> </span>lam<span class="w"> </span>(<span class="nv">id\</span><span class="w"> </span>app<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>plus<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>one<span class="o">))</span>
<span class="linenos">124</span><span class="w">                                  </span><span class="o">(</span>app<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>app<span class="w"> </span>id<span class="w"> </span>empty<span class="o">)))</span><span class="kd">,</span>
<span class="linenos">125</span><span class="w">  </span>print<span class="w"> </span><span class="s2">&quot;Typing&quot;</span><span class="w"> </span><span class="nv">Q</span><span class="kd">,</span>
<span class="linenos">126</span><span class="w">  </span>w<span class="w"> </span><span class="nv">Q</span><span class="w"> </span><span class="nv">TQ</span><span class="o">.</span><span class="w"> </span><span class="c">% should print error</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">File &quot;/home/runner/work/elpi/elpi/docs/source/../../tests/sources/w_legacy.elpi&quot;, line 17, column 0, character 330:</span>
<span class="go">Mixfix directives are not supported by this parser.</span>

<span class="go">The parser is based on token families.</span>
<span class="go">A family is identified by some starting characters, for example</span>
<span class="go">a token &#39;+--&gt;&#39; belongs to the family of &#39;+&#39;. There is no need</span>
<span class="go">to declare it.</span>

<span class="go">All the tokens of a family are parsed with the same precedence and</span>
<span class="go">associativity, for example &#39;x +--&gt; y *--&gt; z&#39; is parsed as</span>
<span class="go">&#39;x +--&gt; (y *--&gt; z)&#39; since the family of &#39;*&#39; has higher precedence</span>
<span class="go">than the family of &#39;+&#39;.</span>

<span class="go">Here the table of tokens and token families.</span>
<span class="go">Token families are represented by the start symbols followed by &#39;..&#39;.</span>
<span class="go">Tokens of families marked with [*] cannot end with the starting symbol,</span>
<span class="go">eg `foo` is not an infix, while `foo is.</span>
<span class="go">The listing is ordered by increasing precedence.</span>

<span class="go">fixity                     | tokens / token families</span>
<span class="go">-------------------------- + -----------------------------------</span>
<span class="go">Infix   not   associative  | :-  ?-</span>
<span class="go">Infix   right associative  | ;</span>
<span class="go">Infix   right associative  | ,  &amp;</span>
<span class="go">Infix   right associative  | -&gt;</span>
<span class="go">Infix   right associative  | =&gt;</span>
<span class="go">Infix   not   associative  | =  ==  =&lt;  r&lt;  i&lt;  s&lt;  r=&lt;  i=&lt;  s=&lt;</span>
<span class="go">                             &lt;..  r&gt;  i&gt;  s&gt;  r&gt;=  i&gt;=  s&gt;=  &gt;..</span>
<span class="go">                             is</span>
<span class="go">Infix   right associative  | ::</span>
<span class="go">Infix   not   associative  | &#39;.. [*]</span>
<span class="go">Infix   left  associative  | ^..  r+  i+  s+  +..  -  r-  i-  s-</span>
<span class="go">Infix   left  associative  | r*  i*  s*  *..  /  div  mod</span>
<span class="go">Infix   right associative  | --..</span>
<span class="go">Infix   not   associative  | `.. [*]</span>
<span class="go">Infix   right associative  | ==..</span>
<span class="go">Infix   right associative  | ||..</span>
<span class="go">Infix   right associative  | &amp;&amp;..</span>
<span class="go">Infix   left  associative  | #..</span>
<span class="go">Prefix  not   associative  | r~  i~  ~..</span>
<span class="go">Postfix not   associative  | ?..</span>

<span class="go">If the token is a valid mixfix, and you want the file to stay compatible</span>
<span class="go">with Teyjus, you can ask Elpi to skip the directive. Eg:</span>

<span class="gp">% </span>elpi:skip<span class="w"> </span><span class="m">2</span><span class="w">  </span>//<span class="w"> </span>skips<span class="w"> </span>the<span class="w"> </span>next<span class="w"> </span>two<span class="w"> </span>lines
<span class="go">infixr ==&gt; 120.</span>
<span class="go">infixr || 120.</span>

<span class="go">As a debugging facility one can ask Elpi to print the AST in order to</span>
<span class="go">verify how the text was parsed. Eg:</span>

<span class="go">echo &#39;MyFormula = a || b ==&gt; c &amp;&amp; d&#39; | elpi -parse-term</span>
</pre></div>
</div>
<p><strong>../../tests/sources/zebra.elpi:</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Fatal error: exception Failure(&quot;File /home/runner/work/elpi/elpi/docs/source/../../tests/sources/zebra.elp not found in: /home/runner/work/elpi/elpi/_build/default/../lib/, /home/runner/work/elpi/elpi/_build/default/../lib/ocaml, /home/runner/work/elpi/elpi/_build/install/default/lib, /home/runner/work/elpi/elpi/_build/default&quot;)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Enrico Tassi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>